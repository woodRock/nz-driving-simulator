(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();function Tw(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var j1={exports:{}},Gd={},X1={exports:{}},Nn={};var NS;function fb(){if(NS)return Nn;NS=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),a=Symbol.for("react.context"),o=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),c=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),m=Symbol.iterator;function g(z){return z===null||typeof z!="object"?null:(z=m&&z[m]||z["@@iterator"],typeof z=="function"?z:null)}var y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},_=Object.assign,E={};function x(z,K,le){this.props=z,this.context=K,this.refs=E,this.updater=le||y}x.prototype.isReactComponent={},x.prototype.setState=function(z,K){if(typeof z!="object"&&typeof z!="function"&&z!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,z,K,"setState")},x.prototype.forceUpdate=function(z){this.updater.enqueueForceUpdate(this,z,"forceUpdate")};function S(){}S.prototype=x.prototype;function T(z,K,le){this.props=z,this.context=K,this.refs=E,this.updater=le||y}var A=T.prototype=new S;A.constructor=T,_(A,x.prototype),A.isPureReactComponent=!0;var P=Array.isArray,L=Object.prototype.hasOwnProperty,D={current:null},F={key:!0,ref:!0,__self:!0,__source:!0};function k(z,K,le){var me,ve={},re=null,he=null;if(K!=null)for(me in K.ref!==void 0&&(he=K.ref),K.key!==void 0&&(re=""+K.key),K)L.call(K,me)&&!F.hasOwnProperty(me)&&(ve[me]=K[me]);var ye=arguments.length-2;if(ye===1)ve.children=le;else if(1<ye){for(var ze=Array(ye),Ve=0;Ve<ye;Ve++)ze[Ve]=arguments[Ve+2];ve.children=ze}if(z&&z.defaultProps)for(me in ye=z.defaultProps,ye)ve[me]===void 0&&(ve[me]=ye[me]);return{$$typeof:n,type:z,key:re,ref:he,props:ve,_owner:D.current}}function R(z,K){return{$$typeof:n,type:z.type,key:K,ref:z.ref,props:z.props,_owner:z._owner}}function U(z){return typeof z=="object"&&z!==null&&z.$$typeof===n}function V(z){var K={"=":"=0",":":"=2"};return"$"+z.replace(/[=:]/g,function(le){return K[le]})}var H=/\/+/g;function J(z,K){return typeof z=="object"&&z!==null&&z.key!=null?V(""+z.key):K.toString(36)}function $(z,K,le,me,ve){var re=typeof z;(re==="undefined"||re==="boolean")&&(z=null);var he=!1;if(z===null)he=!0;else switch(re){case"string":case"number":he=!0;break;case"object":switch(z.$$typeof){case n:case e:he=!0}}if(he)return he=z,ve=ve(he),z=me===""?"."+J(he,0):me,P(ve)?(le="",z!=null&&(le=z.replace(H,"$&/")+"/"),$(ve,K,le,"",function(Ve){return Ve})):ve!=null&&(U(ve)&&(ve=R(ve,le+(!ve.key||he&&he.key===ve.key?"":(""+ve.key).replace(H,"$&/")+"/")+z)),K.push(ve)),1;if(he=0,me=me===""?".":me+":",P(z))for(var ye=0;ye<z.length;ye++){re=z[ye];var ze=me+J(re,ye);he+=$(re,K,le,ze,ve)}else if(ze=g(z),typeof ze=="function")for(z=ze.call(z),ye=0;!(re=z.next()).done;)re=re.value,ze=me+J(re,ye++),he+=$(re,K,le,ze,ve);else if(re==="object")throw K=String(z),Error("Objects are not valid as a React child (found: "+(K==="[object Object]"?"object with keys {"+Object.keys(z).join(", ")+"}":K)+"). If you meant to render a collection of children, use an array instead.");return he}function ae(z,K,le){if(z==null)return z;var me=[],ve=0;return $(z,me,"","",function(re){return K.call(le,re,ve++)}),me}function ne(z){if(z._status===-1){var K=z._result;K=K(),K.then(function(le){(z._status===0||z._status===-1)&&(z._status=1,z._result=le)},function(le){(z._status===0||z._status===-1)&&(z._status=2,z._result=le)}),z._status===-1&&(z._status=0,z._result=K)}if(z._status===1)return z._result.default;throw z._result}var oe={current:null},te={transition:null},ie={ReactCurrentDispatcher:oe,ReactCurrentBatchConfig:te,ReactCurrentOwner:D};function Y(){throw Error("act(...) is not supported in production builds of React.")}return Nn.Children={map:ae,forEach:function(z,K,le){ae(z,function(){K.apply(this,arguments)},le)},count:function(z){var K=0;return ae(z,function(){K++}),K},toArray:function(z){return ae(z,function(K){return K})||[]},only:function(z){if(!U(z))throw Error("React.Children.only expected to receive a single React element child.");return z}},Nn.Component=x,Nn.Fragment=t,Nn.Profiler=i,Nn.PureComponent=T,Nn.StrictMode=r,Nn.Suspense=u,Nn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ie,Nn.act=Y,Nn.cloneElement=function(z,K,le){if(z==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+z+".");var me=_({},z.props),ve=z.key,re=z.ref,he=z._owner;if(K!=null){if(K.ref!==void 0&&(re=K.ref,he=D.current),K.key!==void 0&&(ve=""+K.key),z.type&&z.type.defaultProps)var ye=z.type.defaultProps;for(ze in K)L.call(K,ze)&&!F.hasOwnProperty(ze)&&(me[ze]=K[ze]===void 0&&ye!==void 0?ye[ze]:K[ze])}var ze=arguments.length-2;if(ze===1)me.children=le;else if(1<ze){ye=Array(ze);for(var Ve=0;Ve<ze;Ve++)ye[Ve]=arguments[Ve+2];me.children=ye}return{$$typeof:n,type:z.type,key:ve,ref:re,props:me,_owner:he}},Nn.createContext=function(z){return z={$$typeof:a,_currentValue:z,_currentValue2:z,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},z.Provider={$$typeof:s,_context:z},z.Consumer=z},Nn.createElement=k,Nn.createFactory=function(z){var K=k.bind(null,z);return K.type=z,K},Nn.createRef=function(){return{current:null}},Nn.forwardRef=function(z){return{$$typeof:o,render:z}},Nn.isValidElement=U,Nn.lazy=function(z){return{$$typeof:f,_payload:{_status:-1,_result:z},_init:ne}},Nn.memo=function(z,K){return{$$typeof:c,type:z,compare:K===void 0?null:K}},Nn.startTransition=function(z){var K=te.transition;te.transition={};try{z()}finally{te.transition=K}},Nn.unstable_act=Y,Nn.useCallback=function(z,K){return oe.current.useCallback(z,K)},Nn.useContext=function(z){return oe.current.useContext(z)},Nn.useDebugValue=function(){},Nn.useDeferredValue=function(z){return oe.current.useDeferredValue(z)},Nn.useEffect=function(z,K){return oe.current.useEffect(z,K)},Nn.useId=function(){return oe.current.useId()},Nn.useImperativeHandle=function(z,K,le){return oe.current.useImperativeHandle(z,K,le)},Nn.useInsertionEffect=function(z,K){return oe.current.useInsertionEffect(z,K)},Nn.useLayoutEffect=function(z,K){return oe.current.useLayoutEffect(z,K)},Nn.useMemo=function(z,K){return oe.current.useMemo(z,K)},Nn.useReducer=function(z,K,le){return oe.current.useReducer(z,K,le)},Nn.useRef=function(z){return oe.current.useRef(z)},Nn.useState=function(z){return oe.current.useState(z)},Nn.useSyncExternalStore=function(z,K,le){return oe.current.useSyncExternalStore(z,K,le)},Nn.useTransition=function(){return oe.current.useTransition()},Nn.version="18.3.1",Nn}var DS;function Rv(){return DS||(DS=1,X1.exports=fb()),X1.exports}var US;function db(){if(US)return Gd;US=1;var n=Rv(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,i=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function a(o,u,c){var f,m={},g=null,y=null;c!==void 0&&(g=""+c),u.key!==void 0&&(g=""+u.key),u.ref!==void 0&&(y=u.ref);for(f in u)r.call(u,f)&&!s.hasOwnProperty(f)&&(m[f]=u[f]);if(o&&o.defaultProps)for(f in u=o.defaultProps,u)m[f]===void 0&&(m[f]=u[f]);return{$$typeof:e,type:o,key:g,ref:y,props:m,_owner:i.current}}return Gd.Fragment=t,Gd.jsx=a,Gd.jsxs=a,Gd}var FS;function pb(){return FS||(FS=1,j1.exports=db()),j1.exports}var O=pb(),se=Rv();const Uo=Tw(se);var hm={},q1={exports:{}},zs={},Y1={exports:{}},Z1={};var OS;function mb(){return OS||(OS=1,(function(n){function e(te,ie){var Y=te.length;te.push(ie);e:for(;0<Y;){var z=Y-1>>>1,K=te[z];if(0<i(K,ie))te[z]=ie,te[Y]=K,Y=z;else break e}}function t(te){return te.length===0?null:te[0]}function r(te){if(te.length===0)return null;var ie=te[0],Y=te.pop();if(Y!==ie){te[0]=Y;e:for(var z=0,K=te.length,le=K>>>1;z<le;){var me=2*(z+1)-1,ve=te[me],re=me+1,he=te[re];if(0>i(ve,Y))re<K&&0>i(he,ve)?(te[z]=he,te[re]=Y,z=re):(te[z]=ve,te[me]=Y,z=me);else if(re<K&&0>i(he,Y))te[z]=he,te[re]=Y,z=re;else break e}}return ie}function i(te,ie){var Y=te.sortIndex-ie.sortIndex;return Y!==0?Y:te.id-ie.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();n.unstable_now=function(){return a.now()-o}}var u=[],c=[],f=1,m=null,g=3,y=!1,_=!1,E=!1,x=typeof setTimeout=="function"?setTimeout:null,S=typeof clearTimeout=="function"?clearTimeout:null,T=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function A(te){for(var ie=t(c);ie!==null;){if(ie.callback===null)r(c);else if(ie.startTime<=te)r(c),ie.sortIndex=ie.expirationTime,e(u,ie);else break;ie=t(c)}}function P(te){if(E=!1,A(te),!_)if(t(u)!==null)_=!0,ne(L);else{var ie=t(c);ie!==null&&oe(P,ie.startTime-te)}}function L(te,ie){_=!1,E&&(E=!1,S(k),k=-1),y=!0;var Y=g;try{for(A(ie),m=t(u);m!==null&&(!(m.expirationTime>ie)||te&&!V());){var z=m.callback;if(typeof z=="function"){m.callback=null,g=m.priorityLevel;var K=z(m.expirationTime<=ie);ie=n.unstable_now(),typeof K=="function"?m.callback=K:m===t(u)&&r(u),A(ie)}else r(u);m=t(u)}if(m!==null)var le=!0;else{var me=t(c);me!==null&&oe(P,me.startTime-ie),le=!1}return le}finally{m=null,g=Y,y=!1}}var D=!1,F=null,k=-1,R=5,U=-1;function V(){return!(n.unstable_now()-U<R)}function H(){if(F!==null){var te=n.unstable_now();U=te;var ie=!0;try{ie=F(!0,te)}finally{ie?J():(D=!1,F=null)}}else D=!1}var J;if(typeof T=="function")J=function(){T(H)};else if(typeof MessageChannel<"u"){var $=new MessageChannel,ae=$.port2;$.port1.onmessage=H,J=function(){ae.postMessage(null)}}else J=function(){x(H,0)};function ne(te){F=te,D||(D=!0,J())}function oe(te,ie){k=x(function(){te(n.unstable_now())},ie)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(te){te.callback=null},n.unstable_continueExecution=function(){_||y||(_=!0,ne(L))},n.unstable_forceFrameRate=function(te){0>te||125<te?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<te?Math.floor(1e3/te):5},n.unstable_getCurrentPriorityLevel=function(){return g},n.unstable_getFirstCallbackNode=function(){return t(u)},n.unstable_next=function(te){switch(g){case 1:case 2:case 3:var ie=3;break;default:ie=g}var Y=g;g=ie;try{return te()}finally{g=Y}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(te,ie){switch(te){case 1:case 2:case 3:case 4:case 5:break;default:te=3}var Y=g;g=te;try{return ie()}finally{g=Y}},n.unstable_scheduleCallback=function(te,ie,Y){var z=n.unstable_now();switch(typeof Y=="object"&&Y!==null?(Y=Y.delay,Y=typeof Y=="number"&&0<Y?z+Y:z):Y=z,te){case 1:var K=-1;break;case 2:K=250;break;case 5:K=1073741823;break;case 4:K=1e4;break;default:K=5e3}return K=Y+K,te={id:f++,callback:ie,priorityLevel:te,startTime:Y,expirationTime:K,sortIndex:-1},Y>z?(te.sortIndex=Y,e(c,te),t(u)===null&&te===t(c)&&(E?(S(k),k=-1):E=!0,oe(P,Y-z))):(te.sortIndex=K,e(u,te),_||y||(_=!0,ne(L))),te},n.unstable_shouldYield=V,n.unstable_wrapCallback=function(te){var ie=g;return function(){var Y=g;g=ie;try{return te.apply(this,arguments)}finally{g=Y}}}})(Z1)),Z1}var kS;function gb(){return kS||(kS=1,Y1.exports=mb()),Y1.exports}var zS;function vb(){if(zS)return zs;zS=1;var n=Rv(),e=gb();function t(l){for(var h="https://reactjs.org/docs/error-decoder.html?invariant="+l,v=1;v<arguments.length;v++)h+="&args[]="+encodeURIComponent(arguments[v]);return"Minified React error #"+l+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var r=new Set,i={};function s(l,h){a(l,h),a(l+"Capture",h)}function a(l,h){for(i[l]=h,l=0;l<h.length;l++)r.add(h[l])}var o=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),u=Object.prototype.hasOwnProperty,c=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f={},m={};function g(l){return u.call(m,l)?!0:u.call(f,l)?!1:c.test(l)?m[l]=!0:(f[l]=!0,!1)}function y(l,h,v,w){if(v!==null&&v.type===0)return!1;switch(typeof h){case"function":case"symbol":return!0;case"boolean":return w?!1:v!==null?!v.acceptsBooleans:(l=l.toLowerCase().slice(0,5),l!=="data-"&&l!=="aria-");default:return!1}}function _(l,h,v,w){if(h===null||typeof h>"u"||y(l,h,v,w))return!0;if(w)return!1;if(v!==null)switch(v.type){case 3:return!h;case 4:return h===!1;case 5:return isNaN(h);case 6:return isNaN(h)||1>h}return!1}function E(l,h,v,w,C,N,j){this.acceptsBooleans=h===2||h===3||h===4,this.attributeName=w,this.attributeNamespace=C,this.mustUseProperty=v,this.propertyName=l,this.type=h,this.sanitizeURL=N,this.removeEmptyString=j}var x={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(l){x[l]=new E(l,0,!1,l,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(l){var h=l[0];x[h]=new E(h,1,!1,l[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(l){x[l]=new E(l,2,!1,l.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(l){x[l]=new E(l,2,!1,l,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(l){x[l]=new E(l,3,!1,l.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(l){x[l]=new E(l,3,!0,l,null,!1,!1)}),["capture","download"].forEach(function(l){x[l]=new E(l,4,!1,l,null,!1,!1)}),["cols","rows","size","span"].forEach(function(l){x[l]=new E(l,6,!1,l,null,!1,!1)}),["rowSpan","start"].forEach(function(l){x[l]=new E(l,5,!1,l.toLowerCase(),null,!1,!1)});var S=/[\-:]([a-z])/g;function T(l){return l[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(l){var h=l.replace(S,T);x[h]=new E(h,1,!1,l,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(l){var h=l.replace(S,T);x[h]=new E(h,1,!1,l,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(l){var h=l.replace(S,T);x[h]=new E(h,1,!1,l,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(l){x[l]=new E(l,1,!1,l.toLowerCase(),null,!1,!1)}),x.xlinkHref=new E("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(l){x[l]=new E(l,1,!1,l.toLowerCase(),null,!0,!0)});function A(l,h,v,w){var C=x.hasOwnProperty(h)?x[h]:null;(C!==null?C.type!==0:w||!(2<h.length)||h[0]!=="o"&&h[0]!=="O"||h[1]!=="n"&&h[1]!=="N")&&(_(h,v,C,w)&&(v=null),w||C===null?g(h)&&(v===null?l.removeAttribute(h):l.setAttribute(h,""+v)):C.mustUseProperty?l[C.propertyName]=v===null?C.type===3?!1:"":v:(h=C.attributeName,w=C.attributeNamespace,v===null?l.removeAttribute(h):(C=C.type,v=C===3||C===4&&v===!0?"":""+v,w?l.setAttributeNS(w,h,v):l.setAttribute(h,v))))}var P=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,L=Symbol.for("react.element"),D=Symbol.for("react.portal"),F=Symbol.for("react.fragment"),k=Symbol.for("react.strict_mode"),R=Symbol.for("react.profiler"),U=Symbol.for("react.provider"),V=Symbol.for("react.context"),H=Symbol.for("react.forward_ref"),J=Symbol.for("react.suspense"),$=Symbol.for("react.suspense_list"),ae=Symbol.for("react.memo"),ne=Symbol.for("react.lazy"),oe=Symbol.for("react.offscreen"),te=Symbol.iterator;function ie(l){return l===null||typeof l!="object"?null:(l=te&&l[te]||l["@@iterator"],typeof l=="function"?l:null)}var Y=Object.assign,z;function K(l){if(z===void 0)try{throw Error()}catch(v){var h=v.stack.trim().match(/\n( *(at )?)/);z=h&&h[1]||""}return`
`+z+l}var le=!1;function me(l,h){if(!l||le)return"";le=!0;var v=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(h)if(h=function(){throw Error()},Object.defineProperty(h.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(h,[])}catch(We){var w=We}Reflect.construct(l,[],h)}else{try{h.call()}catch(We){w=We}l.call(h.prototype)}else{try{throw Error()}catch(We){w=We}l()}}catch(We){if(We&&w&&typeof We.stack=="string"){for(var C=We.stack.split(`
`),N=w.stack.split(`
`),j=C.length-1,fe=N.length-1;1<=j&&0<=fe&&C[j]!==N[fe];)fe--;for(;1<=j&&0<=fe;j--,fe--)if(C[j]!==N[fe]){if(j!==1||fe!==1)do if(j--,fe--,0>fe||C[j]!==N[fe]){var _e=`
`+C[j].replace(" at new "," at ");return l.displayName&&_e.includes("<anonymous>")&&(_e=_e.replace("<anonymous>",l.displayName)),_e}while(1<=j&&0<=fe);break}}}finally{le=!1,Error.prepareStackTrace=v}return(l=l?l.displayName||l.name:"")?K(l):""}function ve(l){switch(l.tag){case 5:return K(l.type);case 16:return K("Lazy");case 13:return K("Suspense");case 19:return K("SuspenseList");case 0:case 2:case 15:return l=me(l.type,!1),l;case 11:return l=me(l.type.render,!1),l;case 1:return l=me(l.type,!0),l;default:return""}}function re(l){if(l==null)return null;if(typeof l=="function")return l.displayName||l.name||null;if(typeof l=="string")return l;switch(l){case F:return"Fragment";case D:return"Portal";case R:return"Profiler";case k:return"StrictMode";case J:return"Suspense";case $:return"SuspenseList"}if(typeof l=="object")switch(l.$$typeof){case V:return(l.displayName||"Context")+".Consumer";case U:return(l._context.displayName||"Context")+".Provider";case H:var h=l.render;return l=l.displayName,l||(l=h.displayName||h.name||"",l=l!==""?"ForwardRef("+l+")":"ForwardRef"),l;case ae:return h=l.displayName||null,h!==null?h:re(l.type)||"Memo";case ne:h=l._payload,l=l._init;try{return re(l(h))}catch{}}return null}function he(l){var h=l.type;switch(l.tag){case 24:return"Cache";case 9:return(h.displayName||"Context")+".Consumer";case 10:return(h._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return l=h.render,l=l.displayName||l.name||"",h.displayName||(l!==""?"ForwardRef("+l+")":"ForwardRef");case 7:return"Fragment";case 5:return h;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return re(h);case 8:return h===k?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof h=="function")return h.displayName||h.name||null;if(typeof h=="string")return h}return null}function ye(l){switch(typeof l){case"boolean":case"number":case"string":case"undefined":return l;case"object":return l;default:return""}}function ze(l){var h=l.type;return(l=l.nodeName)&&l.toLowerCase()==="input"&&(h==="checkbox"||h==="radio")}function Ve(l){var h=ze(l)?"checked":"value",v=Object.getOwnPropertyDescriptor(l.constructor.prototype,h),w=""+l[h];if(!l.hasOwnProperty(h)&&typeof v<"u"&&typeof v.get=="function"&&typeof v.set=="function"){var C=v.get,N=v.set;return Object.defineProperty(l,h,{configurable:!0,get:function(){return C.call(this)},set:function(j){w=""+j,N.call(this,j)}}),Object.defineProperty(l,h,{enumerable:v.enumerable}),{getValue:function(){return w},setValue:function(j){w=""+j},stopTracking:function(){l._valueTracker=null,delete l[h]}}}}function Ke(l){l._valueTracker||(l._valueTracker=Ve(l))}function Qe(l){if(!l)return!1;var h=l._valueTracker;if(!h)return!0;var v=h.getValue(),w="";return l&&(w=ze(l)?l.checked?"true":"false":l.value),l=w,l!==v?(h.setValue(l),!0):!1}function pt(l){if(l=l||(typeof document<"u"?document:void 0),typeof l>"u")return null;try{return l.activeElement||l.body}catch{return l.body}}function Ne(l,h){var v=h.checked;return Y({},h,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:v??l._wrapperState.initialChecked})}function Be(l,h){var v=h.defaultValue==null?"":h.defaultValue,w=h.checked!=null?h.checked:h.defaultChecked;v=ye(h.value!=null?h.value:v),l._wrapperState={initialChecked:w,initialValue:v,controlled:h.type==="checkbox"||h.type==="radio"?h.checked!=null:h.value!=null}}function De(l,h){h=h.checked,h!=null&&A(l,"checked",h,!1)}function it(l,h){De(l,h);var v=ye(h.value),w=h.type;if(v!=null)w==="number"?(v===0&&l.value===""||l.value!=v)&&(l.value=""+v):l.value!==""+v&&(l.value=""+v);else if(w==="submit"||w==="reset"){l.removeAttribute("value");return}h.hasOwnProperty("value")?at(l,h.type,v):h.hasOwnProperty("defaultValue")&&at(l,h.type,ye(h.defaultValue)),h.checked==null&&h.defaultChecked!=null&&(l.defaultChecked=!!h.defaultChecked)}function Q(l,h,v){if(h.hasOwnProperty("value")||h.hasOwnProperty("defaultValue")){var w=h.type;if(!(w!=="submit"&&w!=="reset"||h.value!==void 0&&h.value!==null))return;h=""+l._wrapperState.initialValue,v||h===l.value||(l.value=h),l.defaultValue=h}v=l.name,v!==""&&(l.name=""),l.defaultChecked=!!l._wrapperState.initialChecked,v!==""&&(l.name=v)}function at(l,h,v){(h!=="number"||pt(l.ownerDocument)!==l)&&(v==null?l.defaultValue=""+l._wrapperState.initialValue:l.defaultValue!==""+v&&(l.defaultValue=""+v))}var je=Array.isArray;function Ce(l,h,v,w){if(l=l.options,h){h={};for(var C=0;C<v.length;C++)h["$"+v[C]]=!0;for(v=0;v<l.length;v++)C=h.hasOwnProperty("$"+l[v].value),l[v].selected!==C&&(l[v].selected=C),C&&w&&(l[v].defaultSelected=!0)}else{for(v=""+ye(v),h=null,C=0;C<l.length;C++){if(l[C].value===v){l[C].selected=!0,w&&(l[C].defaultSelected=!0);return}h!==null||l[C].disabled||(h=l[C])}h!==null&&(h.selected=!0)}}function He(l,h){if(h.dangerouslySetInnerHTML!=null)throw Error(t(91));return Y({},h,{value:void 0,defaultValue:void 0,children:""+l._wrapperState.initialValue})}function q(l,h){var v=h.value;if(v==null){if(v=h.children,h=h.defaultValue,v!=null){if(h!=null)throw Error(t(92));if(je(v)){if(1<v.length)throw Error(t(93));v=v[0]}h=v}h==null&&(h=""),v=h}l._wrapperState={initialValue:ye(v)}}function B(l,h){var v=ye(h.value),w=ye(h.defaultValue);v!=null&&(v=""+v,v!==l.value&&(l.value=v),h.defaultValue==null&&l.defaultValue!==v&&(l.defaultValue=v)),w!=null&&(l.defaultValue=""+w)}function ue(l){var h=l.textContent;h===l._wrapperState.initialValue&&h!==""&&h!==null&&(l.value=h)}function Re(l){switch(l){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Pe(l,h){return l==null||l==="http://www.w3.org/1999/xhtml"?Re(h):l==="http://www.w3.org/2000/svg"&&h==="foreignObject"?"http://www.w3.org/1999/xhtml":l}var Te,ot=(function(l){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(h,v,w,C){MSApp.execUnsafeLocalFunction(function(){return l(h,v,w,C)})}:l})(function(l,h){if(l.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in l)l.innerHTML=h;else{for(Te=Te||document.createElement("div"),Te.innerHTML="<svg>"+h.valueOf().toString()+"</svg>",h=Te.firstChild;l.firstChild;)l.removeChild(l.firstChild);for(;h.firstChild;)l.appendChild(h.firstChild)}});function rt(l,h){if(h){var v=l.firstChild;if(v&&v===l.lastChild&&v.nodeType===3){v.nodeValue=h;return}}l.textContent=h}var mt={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Rt=["Webkit","ms","Moz","O"];Object.keys(mt).forEach(function(l){Rt.forEach(function(h){h=h+l.charAt(0).toUpperCase()+l.substring(1),mt[h]=mt[l]})});function Ge(l,h,v){return h==null||typeof h=="boolean"||h===""?"":v||typeof h!="number"||h===0||mt.hasOwnProperty(l)&&mt[l]?(""+h).trim():h+"px"}function Xe(l,h){l=l.style;for(var v in h)if(h.hasOwnProperty(v)){var w=v.indexOf("--")===0,C=Ge(v,h[v],w);v==="float"&&(v="cssFloat"),w?l.setProperty(v,C):l[v]=C}}var nt=Y({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function gt(l,h){if(h){if(nt[l]&&(h.children!=null||h.dangerouslySetInnerHTML!=null))throw Error(t(137,l));if(h.dangerouslySetInnerHTML!=null){if(h.children!=null)throw Error(t(60));if(typeof h.dangerouslySetInnerHTML!="object"||!("__html"in h.dangerouslySetInnerHTML))throw Error(t(61))}if(h.style!=null&&typeof h.style!="object")throw Error(t(62))}}function st(l,h){if(l.indexOf("-")===-1)return typeof h.is=="string";switch(l){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ot=null;function pe(l){return l=l.target||l.srcElement||window,l.correspondingUseElement&&(l=l.correspondingUseElement),l.nodeType===3?l.parentNode:l}var Ee=null,et=null,Pt=null;function tt(l){if(l=Ga(l)){if(typeof Ee!="function")throw Error(t(280));var h=l.stateNode;h&&(h=Ah(h),Ee(l.stateNode,l.type,h))}}function ke(l){et?Pt?Pt.push(l):Pt=[l]:et=l}function dt(){if(et){var l=et,h=Pt;if(Pt=et=null,tt(l),h)for(l=0;l<h.length;l++)tt(h[l])}}function kt(l,h){return l(h)}function zt(){}var nn=!1;function zn(l,h,v){if(nn)return l(h,v);nn=!0;try{return kt(l,h,v)}finally{nn=!1,(et!==null||Pt!==null)&&(zt(),dt())}}function Un(l,h){var v=l.stateNode;if(v===null)return null;var w=Ah(v);if(w===null)return null;v=w[h];e:switch(h){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(w=!w.disabled)||(l=l.type,w=!(l==="button"||l==="input"||l==="select"||l==="textarea")),l=!w;break e;default:l=!1}if(l)return null;if(v&&typeof v!="function")throw Error(t(231,h,typeof v));return v}var Kn=!1;if(o)try{var Si={};Object.defineProperty(Si,"passive",{get:function(){Kn=!0}}),window.addEventListener("test",Si,Si),window.removeEventListener("test",Si,Si)}catch{Kn=!1}function Di(l,h,v,w,C,N,j,fe,_e){var We=Array.prototype.slice.call(arguments,3);try{h.apply(v,We)}catch(xt){this.onError(xt)}}var Ai=!1,Mi=null,ri=!1,on=null,li={onError:function(l){Ai=!0,Mi=l}};function Xr(l,h,v,w,C,N,j,fe,_e){Ai=!1,Mi=null,Di.apply(li,arguments)}function W(l,h,v,w,C,N,j,fe,_e){if(Xr.apply(this,arguments),Ai){if(Ai){var We=Mi;Ai=!1,Mi=null}else throw Error(t(198));ri||(ri=!0,on=We)}}function ee(l){var h=l,v=l;if(l.alternate)for(;h.return;)h=h.return;else{l=h;do h=l,(h.flags&4098)!==0&&(v=h.return),l=h.return;while(l)}return h.tag===3?v:null}function ge(l){if(l.tag===13){var h=l.memoizedState;if(h===null&&(l=l.alternate,l!==null&&(h=l.memoizedState)),h!==null)return h.dehydrated}return null}function Ue(l){if(ee(l)!==l)throw Error(t(188))}function qe(l){var h=l.alternate;if(!h){if(h=ee(l),h===null)throw Error(t(188));return h!==l?null:l}for(var v=l,w=h;;){var C=v.return;if(C===null)break;var N=C.alternate;if(N===null){if(w=C.return,w!==null){v=w;continue}break}if(C.child===N.child){for(N=C.child;N;){if(N===v)return Ue(C),l;if(N===w)return Ue(C),h;N=N.sibling}throw Error(t(188))}if(v.return!==w.return)v=C,w=N;else{for(var j=!1,fe=C.child;fe;){if(fe===v){j=!0,v=C,w=N;break}if(fe===w){j=!0,w=C,v=N;break}fe=fe.sibling}if(!j){for(fe=N.child;fe;){if(fe===v){j=!0,v=N,w=C;break}if(fe===w){j=!0,w=N,v=C;break}fe=fe.sibling}if(!j)throw Error(t(189))}}if(v.alternate!==w)throw Error(t(190))}if(v.tag!==3)throw Error(t(188));return v.stateNode.current===v?l:h}function Ye(l){return l=qe(l),l!==null?Mt(l):null}function Mt(l){if(l.tag===5||l.tag===6)return l;for(l=l.child;l!==null;){var h=Mt(l);if(h!==null)return h;l=l.sibling}return null}var vt=e.unstable_scheduleCallback,Et=e.unstable_cancelCallback,Tt=e.unstable_shouldYield,At=e.unstable_requestPaint,Ie=e.unstable_now,Z=e.unstable_getCurrentPriorityLevel,de=e.unstable_ImmediatePriority,xe=e.unstable_UserBlockingPriority,Me=e.unstable_NormalPriority,Se=e.unstable_LowPriority,lt=e.unstable_IdlePriority,ut=null,Je=null;function ht(l){if(Je&&typeof Je.onCommitFiberRoot=="function")try{Je.onCommitFiberRoot(ut,l,void 0,(l.current.flags&128)===128)}catch{}}var ft=Math.clz32?Math.clz32:Xt,Nt=Math.log,St=Math.LN2;function Xt(l){return l>>>=0,l===0?32:31-(Nt(l)/St|0)|0}var un=64,dn=4194304;function fn(l){switch(l&-l){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return l&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return l&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return l}}function Kt(l,h){var v=l.pendingLanes;if(v===0)return 0;var w=0,C=l.suspendedLanes,N=l.pingedLanes,j=v&268435455;if(j!==0){var fe=j&~C;fe!==0?w=fn(fe):(N&=j,N!==0&&(w=fn(N)))}else j=v&~C,j!==0?w=fn(j):N!==0&&(w=fn(N));if(w===0)return 0;if(h!==0&&h!==w&&(h&C)===0&&(C=w&-w,N=h&-h,C>=N||C===16&&(N&4194240)!==0))return h;if((w&4)!==0&&(w|=v&16),h=l.entangledLanes,h!==0)for(l=l.entanglements,h&=w;0<h;)v=31-ft(h),C=1<<v,w|=l[v],h&=~C;return w}function Ut(l,h){switch(l){case 1:case 2:case 4:return h+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return h+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function $t(l,h){for(var v=l.suspendedLanes,w=l.pingedLanes,C=l.expirationTimes,N=l.pendingLanes;0<N;){var j=31-ft(N),fe=1<<j,_e=C[j];_e===-1?((fe&v)===0||(fe&w)!==0)&&(C[j]=Ut(fe,h)):_e<=h&&(l.expiredLanes|=fe),N&=~fe}}function Dt(l){return l=l.pendingLanes&-1073741825,l!==0?l:l&1073741824?1073741824:0}function bn(){var l=un;return un<<=1,(un&4194240)===0&&(un=64),l}function mi(l){for(var h=[],v=0;31>v;v++)h.push(l);return h}function In(l,h,v){l.pendingLanes|=h,h!==536870912&&(l.suspendedLanes=0,l.pingedLanes=0),l=l.eventTimes,h=31-ft(h),l[h]=v}function Hi(l,h){var v=l.pendingLanes&~h;l.pendingLanes=h,l.suspendedLanes=0,l.pingedLanes=0,l.expiredLanes&=h,l.mutableReadLanes&=h,l.entangledLanes&=h,h=l.entanglements;var w=l.eventTimes;for(l=l.expirationTimes;0<v;){var C=31-ft(v),N=1<<C;h[C]=0,w[C]=-1,l[C]=-1,v&=~N}}function Ln(l,h){var v=l.entangledLanes|=h;for(l=l.entanglements;v;){var w=31-ft(v),C=1<<w;C&h|l[w]&h&&(l[w]|=h),v&=~C}}var cn=0;function gi(l){return l&=-l,1<l?4<l?(l&268435455)!==0?16:536870912:4:1}var ui,Ci,ha,$i,jo,As=!1,Ys=[],hr=null,yn=null,Cs=null,as=new Map,fa=new Map,Ps=[],nh="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ci(l,h){switch(l){case"focusin":case"focusout":hr=null;break;case"dragenter":case"dragleave":yn=null;break;case"mouseover":case"mouseout":Cs=null;break;case"pointerover":case"pointerout":as.delete(h.pointerId);break;case"gotpointercapture":case"lostpointercapture":fa.delete(h.pointerId)}}function Zs(l,h,v,w,C,N){return l===null||l.nativeEvent!==N?(l={blockedOn:h,domEventName:v,eventSystemFlags:w,nativeEvent:N,targetContainers:[C]},h!==null&&(h=Ga(h),h!==null&&Ci(h)),l):(l.eventSystemFlags|=w,h=l.targetContainers,C!==null&&h.indexOf(C)===-1&&h.push(C),l)}function ih(l,h,v,w,C){switch(h){case"focusin":return hr=Zs(hr,l,h,v,w,C),!0;case"dragenter":return yn=Zs(yn,l,h,v,w,C),!0;case"mouseover":return Cs=Zs(Cs,l,h,v,w,C),!0;case"pointerover":var N=C.pointerId;return as.set(N,Zs(as.get(N)||null,l,h,v,w,C)),!0;case"gotpointercapture":return N=C.pointerId,fa.set(N,Zs(fa.get(N)||null,l,h,v,w,C)),!0}return!1}function Sr(l){var h=bo(l.target);if(h!==null){var v=ee(h);if(v!==null){if(h=v.tag,h===13){if(h=ge(v),h!==null){l.blockedOn=h,jo(l.priority,function(){ha(v)});return}}else if(h===3&&v.stateNode.current.memoizedState.isDehydrated){l.blockedOn=v.tag===3?v.stateNode.containerInfo:null;return}}}l.blockedOn=null}function mo(l){if(l.blockedOn!==null)return!1;for(var h=l.targetContainers;0<h.length;){var v=Mr(l.domEventName,l.eventSystemFlags,h[0],l.nativeEvent);if(v===null){v=l.nativeEvent;var w=new v.constructor(v.type,v);Ot=w,v.target.dispatchEvent(w),Ot=null}else return h=Ga(v),h!==null&&Ci(h),l.blockedOn=v,!1;h.shift()}return!0}function go(l,h,v){mo(l)&&v.delete(h)}function os(){As=!1,hr!==null&&mo(hr)&&(hr=null),yn!==null&&mo(yn)&&(yn=null),Cs!==null&&mo(Cs)&&(Cs=null),as.forEach(go),fa.forEach(go)}function Ra(l,h){l.blockedOn===h&&(l.blockedOn=null,As||(As=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,os)))}function vo(l){function h(C){return Ra(C,l)}if(0<Ys.length){Ra(Ys[0],l);for(var v=1;v<Ys.length;v++){var w=Ys[v];w.blockedOn===l&&(w.blockedOn=null)}}for(hr!==null&&Ra(hr,l),yn!==null&&Ra(yn,l),Cs!==null&&Ra(Cs,l),as.forEach(h),fa.forEach(h),v=0;v<Ps.length;v++)w=Ps[v],w.blockedOn===l&&(w.blockedOn=null);for(;0<Ps.length&&(v=Ps[0],v.blockedOn===null);)Sr(v),v.blockedOn===null&&Ps.shift()}var er=P.ReactCurrentBatchConfig,tr=!0;function da(l,h,v,w){var C=cn,N=er.transition;er.transition=null;try{cn=1,Xo(l,h,v,w)}finally{cn=C,er.transition=N}}function Rs(l,h,v,w){var C=cn,N=er.transition;er.transition=null;try{cn=4,Xo(l,h,v,w)}finally{cn=C,er.transition=N}}function Xo(l,h,v,w){if(tr){var C=Mr(l,h,v,w);if(C===null)Sh(l,h,w,yo,v),ci(l,w);else if(ih(C,l,h,v,w))w.stopPropagation();else if(ci(l,w),h&4&&-1<nh.indexOf(l)){for(;C!==null;){var N=Ga(C);if(N!==null&&ui(N),N=Mr(l,h,v,w),N===null&&Sh(l,h,w,yo,v),N===C)break;C=N}C!==null&&w.stopPropagation()}else Sh(l,h,w,null,v)}}var yo=null;function Mr(l,h,v,w){if(yo=null,l=pe(w),l=bo(l),l!==null)if(h=ee(l),h===null)l=null;else if(v=h.tag,v===13){if(l=ge(h),l!==null)return l;l=null}else if(v===3){if(h.stateNode.current.memoizedState.isDehydrated)return h.tag===3?h.stateNode.containerInfo:null;l=null}else h!==l&&(l=null);return yo=l,null}function _o(l){switch(l){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Z()){case de:return 1;case xe:return 4;case Me:case Se:return 16;case lt:return 536870912;default:return 16}default:return 16}}var qr=null,Ia=null,nr=null;function Wi(){if(nr)return nr;var l,h=Ia,v=h.length,w,C="value"in qr?qr.value:qr.textContent,N=C.length;for(l=0;l<v&&h[l]===C[l];l++);var j=v-l;for(w=1;w<=j&&h[v-w]===C[N-w];w++);return nr=C.slice(l,1<w?1-w:void 0)}function La(l){var h=l.keyCode;return"charCode"in l?(l=l.charCode,l===0&&h===13&&(l=13)):l=h,l===10&&(l=13),32<=l||l===13?l:0}function Yr(){return!0}function Na(){return!1}function ir(l){function h(v,w,C,N,j){this._reactName=v,this._targetInst=C,this.type=w,this.nativeEvent=N,this.target=j,this.currentTarget=null;for(var fe in l)l.hasOwnProperty(fe)&&(v=l[fe],this[fe]=v?v(N):N[fe]);return this.isDefaultPrevented=(N.defaultPrevented!=null?N.defaultPrevented:N.returnValue===!1)?Yr:Na,this.isPropagationStopped=Na,this}return Y(h.prototype,{preventDefault:function(){this.defaultPrevented=!0;var v=this.nativeEvent;v&&(v.preventDefault?v.preventDefault():typeof v.returnValue!="unknown"&&(v.returnValue=!1),this.isDefaultPrevented=Yr)},stopPropagation:function(){var v=this.nativeEvent;v&&(v.stopPropagation?v.stopPropagation():typeof v.cancelBubble!="unknown"&&(v.cancelBubble=!0),this.isPropagationStopped=Yr)},persist:function(){},isPersistent:Yr}),h}var Da={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(l){return l.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ui=ir(Da),ji=Y({},Da,{view:0,detail:0}),Pi=ir(ji),vi,Ur,Is,Il=Y({},ji,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:So,button:0,buttons:0,relatedTarget:function(l){return l.relatedTarget===void 0?l.fromElement===l.srcElement?l.toElement:l.fromElement:l.relatedTarget},movementX:function(l){return"movementX"in l?l.movementX:(l!==Is&&(Is&&l.type==="mousemove"?(vi=l.screenX-Is.screenX,Ur=l.screenY-Is.screenY):Ur=vi=0,Is=l),vi)},movementY:function(l){return"movementY"in l?l.movementY:Ur}}),Jf=ir(Il),Ua=Y({},Il,{dataTransfer:0}),xo=ir(Ua),rh=Y({},ji,{relatedTarget:0}),sh=ir(rh),ah=Y({},Da,{animationName:0,elapsedTime:0,pseudoElement:0}),S0=ir(ah),M0=Y({},Da,{clipboardData:function(l){return"clipboardData"in l?l.clipboardData:window.clipboardData}}),Kf=ir(M0),oh=Y({},Da,{data:0}),Qf=ir(oh),w0={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},E0={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},$f={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ll(l){var h=this.nativeEvent;return h.getModifierState?h.getModifierState(l):(l=$f[l])?!!h[l]:!1}function So(){return Ll}var lh=Y({},ji,{key:function(l){if(l.key){var h=w0[l.key]||l.key;if(h!=="Unidentified")return h}return l.type==="keypress"?(l=La(l),l===13?"Enter":String.fromCharCode(l)):l.type==="keydown"||l.type==="keyup"?E0[l.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:So,charCode:function(l){return l.type==="keypress"?La(l):0},keyCode:function(l){return l.type==="keydown"||l.type==="keyup"?l.keyCode:0},which:function(l){return l.type==="keypress"?La(l):l.type==="keydown"||l.type==="keyup"?l.keyCode:0}}),uh=ir(lh),Ls=Y({},Il,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ls=ir(Ls),qo=Y({},ji,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:So}),Fa=ir(qo),Oa=Y({},Da,{propertyName:0,elapsedTime:0,pseudoElement:0}),Yo=ir(Oa),T0=Y({},Il,{deltaX:function(l){return"deltaX"in l?l.deltaX:"wheelDeltaX"in l?-l.wheelDeltaX:0},deltaY:function(l){return"deltaY"in l?l.deltaY:"wheelDeltaY"in l?-l.wheelDeltaY:"wheelDelta"in l?-l.wheelDelta:0},deltaZ:0,deltaMode:0}),ed=ir(T0),td=[9,13,27,32],Fr=o&&"CompositionEvent"in window,fr=null;o&&"documentMode"in document&&(fr=document.documentMode);var hi=o&&"TextEvent"in window&&!fr,Nl=o&&(!Fr||fr&&8<fr&&11>=fr),Ns=" ",nd=!1;function id(l,h){switch(l){case"keyup":return td.indexOf(h.keyCode)!==-1;case"keydown":return h.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ch(l){return l=l.detail,typeof l=="object"&&"data"in l?l.data:null}var Mo=!1;function b0(l,h){switch(l){case"compositionend":return ch(h);case"keypress":return h.which!==32?null:(nd=!0,Ns);case"textInput":return l=h.data,l===Ns&&nd?null:l;default:return null}}function Fu(l,h){if(Mo)return l==="compositionend"||!Fr&&id(l,h)?(l=Wi(),nr=Ia=qr=null,Mo=!1,l):null;switch(l){case"paste":return null;case"keypress":if(!(h.ctrlKey||h.altKey||h.metaKey)||h.ctrlKey&&h.altKey){if(h.char&&1<h.char.length)return h.char;if(h.which)return String.fromCharCode(h.which)}return null;case"compositionend":return Nl&&h.locale!=="ko"?null:h.data;default:return null}}var Dl={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function hh(l){var h=l&&l.nodeName&&l.nodeName.toLowerCase();return h==="input"?!!Dl[l.type]:h==="textarea"}function Ul(l,h,v,w){ke(w),h=Mh(h,"onChange"),0<h.length&&(v=new Ui("onChange","change",null,v,w),l.push({event:v,listeners:h}))}var wo=null,Fl=null;function A0(l){Bl(l,0)}function ka(l){var h=Ri(l);if(Qe(h))return l}function C0(l,h){if(l==="change")return h}var Ol=!1;if(o){var Zr;if(o){var Zo="oninput"in document;if(!Zo){var Jo=document.createElement("div");Jo.setAttribute("oninput","return;"),Zo=typeof Jo.oninput=="function"}Zr=Zo}else Zr=!1;Ol=Zr&&(!document.documentMode||9<document.documentMode)}function Js(){wo&&(wo.detachEvent("onpropertychange",fh),Fl=wo=null)}function fh(l){if(l.propertyName==="value"&&ka(Fl)){var h=[];Ul(h,Fl,l,pe(l)),zn(A0,h)}}function kl(l,h,v){l==="focusin"?(Js(),wo=h,Fl=v,wo.attachEvent("onpropertychange",fh)):l==="focusout"&&Js()}function P0(l){if(l==="selectionchange"||l==="keyup"||l==="keydown")return ka(Fl)}function rd(l,h){if(l==="click")return ka(h)}function yi(l,h){if(l==="input"||l==="change")return ka(h)}function dh(l,h){return l===h&&(l!==0||1/l===1/h)||l!==l&&h!==h}var us=typeof Object.is=="function"?Object.is:dh;function Ko(l,h){if(us(l,h))return!0;if(typeof l!="object"||l===null||typeof h!="object"||h===null)return!1;var v=Object.keys(l),w=Object.keys(h);if(v.length!==w.length)return!1;for(w=0;w<v.length;w++){var C=v[w];if(!u.call(h,C)||!us(l[C],h[C]))return!1}return!0}function Ou(l){for(;l&&l.firstChild;)l=l.firstChild;return l}function cs(l,h){var v=Ou(l);l=0;for(var w;v;){if(v.nodeType===3){if(w=l+v.textContent.length,l<=h&&w>=h)return{node:v,offset:h-l};l=w}e:{for(;v;){if(v.nextSibling){v=v.nextSibling;break e}v=v.parentNode}v=void 0}v=Ou(v)}}function Qo(l,h){return l&&h?l===h?!0:l&&l.nodeType===3?!1:h&&h.nodeType===3?Qo(l,h.parentNode):"contains"in l?l.contains(h):l.compareDocumentPosition?!!(l.compareDocumentPosition(h)&16):!1:!1}function _i(){for(var l=window,h=pt();h instanceof l.HTMLIFrameElement;){try{var v=typeof h.contentWindow.location.href=="string"}catch{v=!1}if(v)l=h.contentWindow;else break;h=pt(l.document)}return h}function rr(l){var h=l&&l.nodeName&&l.nodeName.toLowerCase();return h&&(h==="input"&&(l.type==="text"||l.type==="search"||l.type==="tel"||l.type==="url"||l.type==="password")||h==="textarea"||l.contentEditable==="true")}function sr(l){var h=_i(),v=l.focusedElem,w=l.selectionRange;if(h!==v&&v&&v.ownerDocument&&Qo(v.ownerDocument.documentElement,v)){if(w!==null&&rr(v)){if(h=w.start,l=w.end,l===void 0&&(l=h),"selectionStart"in v)v.selectionStart=h,v.selectionEnd=Math.min(l,v.value.length);else if(l=(h=v.ownerDocument||document)&&h.defaultView||window,l.getSelection){l=l.getSelection();var C=v.textContent.length,N=Math.min(w.start,C);w=w.end===void 0?N:Math.min(w.end,C),!l.extend&&N>w&&(C=w,w=N,N=C),C=cs(v,N);var j=cs(v,w);C&&j&&(l.rangeCount!==1||l.anchorNode!==C.node||l.anchorOffset!==C.offset||l.focusNode!==j.node||l.focusOffset!==j.offset)&&(h=h.createRange(),h.setStart(C.node,C.offset),l.removeAllRanges(),N>w?(l.addRange(h),l.extend(j.node,j.offset)):(h.setEnd(j.node,j.offset),l.addRange(h)))}}for(h=[],l=v;l=l.parentNode;)l.nodeType===1&&h.push({element:l,left:l.scrollLeft,top:l.scrollTop});for(typeof v.focus=="function"&&v.focus(),v=0;v<h.length;v++)l=h[v],l.element.scrollLeft=l.left,l.element.scrollTop=l.top}}var ph=o&&"documentMode"in document&&11>=document.documentMode,pa=null,$o=null,ku=null,ar=!1;function mh(l,h,v){var w=v.window===v?v.document:v.nodeType===9?v:v.ownerDocument;ar||pa==null||pa!==pt(w)||(w=pa,"selectionStart"in w&&rr(w)?w={start:w.selectionStart,end:w.selectionEnd}:(w=(w.ownerDocument&&w.ownerDocument.defaultView||window).getSelection(),w={anchorNode:w.anchorNode,anchorOffset:w.anchorOffset,focusNode:w.focusNode,focusOffset:w.focusOffset}),ku&&Ko(ku,w)||(ku=w,w=Mh($o,"onSelect"),0<w.length&&(h=new Ui("onSelect","select",null,h,v),l.push({event:h,listeners:w}),h.target=pa)))}function zl(l,h){var v={};return v[l.toLowerCase()]=h.toLowerCase(),v["Webkit"+l]="webkit"+h,v["Moz"+l]="moz"+h,v}var Eo={animationend:zl("Animation","AnimationEnd"),animationiteration:zl("Animation","AnimationIteration"),animationstart:zl("Animation","AnimationStart"),transitionend:zl("Transition","TransitionEnd")},Ks={},Qs={};o&&(Qs=document.createElement("div").style,"AnimationEvent"in window||(delete Eo.animationend.animation,delete Eo.animationiteration.animation,delete Eo.animationstart.animation),"TransitionEvent"in window||delete Eo.transitionend.transition);function ma(l){if(Ks[l])return Ks[l];if(!Eo[l])return l;var h=Eo[l],v;for(v in h)if(h.hasOwnProperty(v)&&v in Qs)return Ks[l]=h[v];return l}var zu=ma("animationend"),Bu=ma("animationiteration"),sd=ma("animationstart"),ad=ma("transitionend"),od=new Map,ld="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function za(l,h){od.set(l,h),s(h,[l])}for(var gh=0;gh<ld.length;gh++){var Gu=ld[gh],Vu=Gu.toLowerCase(),R0=Gu[0].toUpperCase()+Gu.slice(1);za(Vu,"on"+R0)}za(zu,"onAnimationEnd"),za(Bu,"onAnimationIteration"),za(sd,"onAnimationStart"),za("dblclick","onDoubleClick"),za("focusin","onFocus"),za("focusout","onBlur"),za(ad,"onTransitionEnd"),a("onMouseEnter",["mouseout","mouseover"]),a("onMouseLeave",["mouseout","mouseover"]),a("onPointerEnter",["pointerout","pointerover"]),a("onPointerLeave",["pointerout","pointerover"]),s("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),s("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),s("onBeforeInput",["compositionend","keypress","textInput","paste"]),s("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var To="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),vh=new Set("cancel close invalid load scroll toggle".split(" ").concat(To));function yh(l,h,v){var w=l.type||"unknown-event";l.currentTarget=v,W(w,h,void 0,l),l.currentTarget=null}function Bl(l,h){h=(h&4)!==0;for(var v=0;v<l.length;v++){var w=l[v],C=w.event;w=w.listeners;e:{var N=void 0;if(h)for(var j=w.length-1;0<=j;j--){var fe=w[j],_e=fe.instance,We=fe.currentTarget;if(fe=fe.listener,_e!==N&&C.isPropagationStopped())break e;yh(C,fe,We),N=_e}else for(j=0;j<w.length;j++){if(fe=w[j],_e=fe.instance,We=fe.currentTarget,fe=fe.listener,_e!==N&&C.isPropagationStopped())break e;yh(C,fe,We),N=_e}}}if(ri)throw l=on,ri=!1,on=null,l}function ti(l,h){var v=h[nl];v===void 0&&(v=h[nl]=new Set);var w=l+"__bubble";v.has(w)||(xh(h,l,2,!1),v.add(w))}function _h(l,h,v){var w=0;h&&(w|=4),xh(v,l,w,h)}var Hu="_reactListening"+Math.random().toString(36).slice(2);function Gl(l){if(!l[Hu]){l[Hu]=!0,r.forEach(function(v){v!=="selectionchange"&&(vh.has(v)||_h(v,!1,l),_h(v,!0,l))});var h=l.nodeType===9?l:l.ownerDocument;h===null||h[Hu]||(h[Hu]=!0,_h("selectionchange",!1,h))}}function xh(l,h,v,w){switch(_o(h)){case 1:var C=da;break;case 4:C=Rs;break;default:C=Xo}v=C.bind(null,h,v,l),C=void 0,!Kn||h!=="touchstart"&&h!=="touchmove"&&h!=="wheel"||(C=!0),w?C!==void 0?l.addEventListener(h,v,{capture:!0,passive:C}):l.addEventListener(h,v,!0):C!==void 0?l.addEventListener(h,v,{passive:C}):l.addEventListener(h,v,!1)}function Sh(l,h,v,w,C){var N=w;if((h&1)===0&&(h&2)===0&&w!==null)e:for(;;){if(w===null)return;var j=w.tag;if(j===3||j===4){var fe=w.stateNode.containerInfo;if(fe===C||fe.nodeType===8&&fe.parentNode===C)break;if(j===4)for(j=w.return;j!==null;){var _e=j.tag;if((_e===3||_e===4)&&(_e=j.stateNode.containerInfo,_e===C||_e.nodeType===8&&_e.parentNode===C))return;j=j.return}for(;fe!==null;){if(j=bo(fe),j===null)return;if(_e=j.tag,_e===5||_e===6){w=N=j;continue e}fe=fe.parentNode}}w=w.return}zn(function(){var We=N,xt=pe(v),wt=[];e:{var yt=od.get(l);if(yt!==void 0){var qt=Ui,tn=l;switch(l){case"keypress":if(La(v)===0)break e;case"keydown":case"keyup":qt=uh;break;case"focusin":tn="focus",qt=sh;break;case"focusout":tn="blur",qt=sh;break;case"beforeblur":case"afterblur":qt=sh;break;case"click":if(v.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":qt=Jf;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":qt=xo;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":qt=Fa;break;case zu:case Bu:case sd:qt=S0;break;case ad:qt=Yo;break;case"scroll":qt=Pi;break;case"wheel":qt=ed;break;case"copy":case"cut":case"paste":qt=Kf;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":qt=ls}var rn=(h&4)!==0,qi=!rn&&l==="scroll",Le=rn?yt!==null?yt+"Capture":null:yt;rn=[];for(var we=We,Fe;we!==null;){Fe=we;var Ct=Fe.stateNode;if(Fe.tag===5&&Ct!==null&&(Fe=Ct,Le!==null&&(Ct=Un(we,Le),Ct!=null&&rn.push(Vl(we,Ct,Fe)))),qi)break;we=we.return}0<rn.length&&(yt=new qt(yt,tn,null,v,xt),wt.push({event:yt,listeners:rn}))}}if((h&7)===0){e:{if(yt=l==="mouseover"||l==="pointerover",qt=l==="mouseout"||l==="pointerout",yt&&v!==Ot&&(tn=v.relatedTarget||v.fromElement)&&(bo(tn)||tn[hs]))break e;if((qt||yt)&&(yt=xt.window===xt?xt:(yt=xt.ownerDocument)?yt.defaultView||yt.parentWindow:window,qt?(tn=v.relatedTarget||v.toElement,qt=We,tn=tn?bo(tn):null,tn!==null&&(qi=ee(tn),tn!==qi||tn.tag!==5&&tn.tag!==6)&&(tn=null)):(qt=null,tn=We),qt!==tn)){if(rn=Jf,Ct="onMouseLeave",Le="onMouseEnter",we="mouse",(l==="pointerout"||l==="pointerover")&&(rn=ls,Ct="onPointerLeave",Le="onPointerEnter",we="pointer"),qi=qt==null?yt:Ri(qt),Fe=tn==null?yt:Ri(tn),yt=new rn(Ct,we+"leave",qt,v,xt),yt.target=qi,yt.relatedTarget=Fe,Ct=null,bo(xt)===We&&(rn=new rn(Le,we+"enter",tn,v,xt),rn.target=Fe,rn.relatedTarget=qi,Ct=rn),qi=Ct,qt&&tn)t:{for(rn=qt,Le=tn,we=0,Fe=rn;Fe;Fe=el(Fe))we++;for(Fe=0,Ct=Le;Ct;Ct=el(Ct))Fe++;for(;0<we-Fe;)rn=el(rn),we--;for(;0<Fe-we;)Le=el(Le),Fe--;for(;we--;){if(rn===Le||Le!==null&&rn===Le.alternate)break t;rn=el(rn),Le=el(Le)}rn=null}else rn=null;qt!==null&&I0(wt,yt,qt,rn,!1),tn!==null&&qi!==null&&I0(wt,qi,tn,rn,!0)}}e:{if(yt=We?Ri(We):window,qt=yt.nodeName&&yt.nodeName.toLowerCase(),qt==="select"||qt==="input"&&yt.type==="file")var an=C0;else if(hh(yt))if(Ol)an=yi;else{an=P0;var pn=kl}else(qt=yt.nodeName)&&qt.toLowerCase()==="input"&&(yt.type==="checkbox"||yt.type==="radio")&&(an=rd);if(an&&(an=an(l,We))){Ul(wt,an,v,xt);break e}pn&&pn(l,yt,We),l==="focusout"&&(pn=yt._wrapperState)&&pn.controlled&&yt.type==="number"&&at(yt,"number",yt.value)}switch(pn=We?Ri(We):window,l){case"focusin":(hh(pn)||pn.contentEditable==="true")&&(pa=pn,$o=We,ku=null);break;case"focusout":ku=$o=pa=null;break;case"mousedown":ar=!0;break;case"contextmenu":case"mouseup":case"dragend":ar=!1,mh(wt,v,xt);break;case"selectionchange":if(ph)break;case"keydown":case"keyup":mh(wt,v,xt)}var mn;if(Fr)e:{switch(l){case"compositionstart":var _n="onCompositionStart";break e;case"compositionend":_n="onCompositionEnd";break e;case"compositionupdate":_n="onCompositionUpdate";break e}_n=void 0}else Mo?id(l,v)&&(_n="onCompositionEnd"):l==="keydown"&&v.keyCode===229&&(_n="onCompositionStart");_n&&(Nl&&v.locale!=="ko"&&(Mo||_n!=="onCompositionStart"?_n==="onCompositionEnd"&&Mo&&(mn=Wi()):(qr=xt,Ia="value"in qr?qr.value:qr.textContent,Mo=!0)),pn=Mh(We,_n),0<pn.length&&(_n=new Qf(_n,l,null,v,xt),wt.push({event:_n,listeners:pn}),mn?_n.data=mn:(mn=ch(v),mn!==null&&(_n.data=mn)))),(mn=hi?b0(l,v):Fu(l,v))&&(We=Mh(We,"onBeforeInput"),0<We.length&&(xt=new Qf("onBeforeInput","beforeinput",null,v,xt),wt.push({event:xt,listeners:We}),xt.data=mn))}Bl(wt,h)})}function Vl(l,h,v){return{instance:l,listener:h,currentTarget:v}}function Mh(l,h){for(var v=h+"Capture",w=[];l!==null;){var C=l,N=C.stateNode;C.tag===5&&N!==null&&(C=N,N=Un(l,v),N!=null&&w.unshift(Vl(l,N,C)),N=Un(l,h),N!=null&&w.push(Vl(l,N,C))),l=l.return}return w}function el(l){if(l===null)return null;do l=l.return;while(l&&l.tag!==5);return l||null}function I0(l,h,v,w,C){for(var N=h._reactName,j=[];v!==null&&v!==w;){var fe=v,_e=fe.alternate,We=fe.stateNode;if(_e!==null&&_e===w)break;fe.tag===5&&We!==null&&(fe=We,C?(_e=Un(v,N),_e!=null&&j.unshift(Vl(v,_e,fe))):C||(_e=Un(v,N),_e!=null&&j.push(Vl(v,_e,fe)))),v=v.return}j.length!==0&&l.push({event:h,listeners:j})}var y1=/\r\n?/g,L0=/\u0000|\uFFFD/g;function ud(l){return(typeof l=="string"?l:""+l).replace(y1,`
`).replace(L0,"")}function Wu(l,h,v){if(h=ud(h),ud(l)!==h&&v)throw Error(t(425))}function ju(){}var Hl=null,cd=null;function hd(l,h){return l==="textarea"||l==="noscript"||typeof h.children=="string"||typeof h.children=="number"||typeof h.dangerouslySetInnerHTML=="object"&&h.dangerouslySetInnerHTML!==null&&h.dangerouslySetInnerHTML.__html!=null}var fd=typeof setTimeout=="function"?setTimeout:void 0,dd=typeof clearTimeout=="function"?clearTimeout:void 0,wh=typeof Promise=="function"?Promise:void 0,_1=typeof queueMicrotask=="function"?queueMicrotask:typeof wh<"u"?function(l){return wh.resolve(null).then(l).catch(N0)}:fd;function N0(l){setTimeout(function(){throw l})}function Eh(l,h){var v=h,w=0;do{var C=v.nextSibling;if(l.removeChild(v),C&&C.nodeType===8)if(v=C.data,v==="/$"){if(w===0){l.removeChild(C),vo(h);return}w--}else v!=="$"&&v!=="$?"&&v!=="$!"||w++;v=C}while(v);vo(h)}function Ba(l){for(;l!=null;l=l.nextSibling){var h=l.nodeType;if(h===1||h===3)break;if(h===8){if(h=l.data,h==="$"||h==="$!"||h==="$?")break;if(h==="/$")return null}}return l}function pd(l){l=l.previousSibling;for(var h=0;l;){if(l.nodeType===8){var v=l.data;if(v==="$"||v==="$!"||v==="$?"){if(h===0)return l;h--}else v==="/$"&&h++}l=l.previousSibling}return null}var tl=Math.random().toString(36).slice(2),Xi="__reactFiber$"+tl,Wl="__reactProps$"+tl,hs="__reactContainer$"+tl,nl="__reactEvents$"+tl,Th="__reactListeners$"+tl,bh="__reactHandles$"+tl;function bo(l){var h=l[Xi];if(h)return h;for(var v=l.parentNode;v;){if(h=v[hs]||v[Xi]){if(v=h.alternate,h.child!==null||v!==null&&v.child!==null)for(l=pd(l);l!==null;){if(v=l[Xi])return v;l=pd(l)}return h}l=v,v=l.parentNode}return null}function Ga(l){return l=l[Xi]||l[hs],!l||l.tag!==5&&l.tag!==6&&l.tag!==13&&l.tag!==3?null:l}function Ri(l){if(l.tag===5||l.tag===6)return l.stateNode;throw Error(t(33))}function Ah(l){return l[Wl]||null}var md=[],or=-1;function wi(l){return{current:l}}function ni(l){0>or||(l.current=md[or],md[or]=null,or--)}function Qn(l,h){or++,md[or]=l.current,l.current=h}var Va={},dr=wi(Va),Or=wi(!1),Ha=Va;function il(l,h){var v=l.type.contextTypes;if(!v)return Va;var w=l.stateNode;if(w&&w.__reactInternalMemoizedUnmaskedChildContext===h)return w.__reactInternalMemoizedMaskedChildContext;var C={},N;for(N in v)C[N]=h[N];return w&&(l=l.stateNode,l.__reactInternalMemoizedUnmaskedChildContext=h,l.__reactInternalMemoizedMaskedChildContext=C),C}function wr(l){return l=l.childContextTypes,l!=null}function Xu(){ni(Or),ni(dr)}function gd(l,h,v){if(dr.current!==Va)throw Error(t(168));Qn(dr,h),Qn(Or,v)}function qu(l,h,v){var w=l.stateNode;if(h=h.childContextTypes,typeof w.getChildContext!="function")return v;w=w.getChildContext();for(var C in w)if(!(C in h))throw Error(t(108,he(l)||"Unknown",C));return Y({},v,w)}function rl(l){return l=(l=l.stateNode)&&l.__reactInternalMemoizedMergedChildContext||Va,Ha=dr.current,Qn(dr,l),Qn(Or,Or.current),!0}function vd(l,h,v){var w=l.stateNode;if(!w)throw Error(t(169));v?(l=qu(l,h,Ha),w.__reactInternalMemoizedMergedChildContext=l,ni(Or),ni(dr),Qn(dr,l)):ni(Or),Qn(Or,v)}var $s=null,Yu=!1,Ch=!1;function Zu(l){$s===null?$s=[l]:$s.push(l)}function D0(l){Yu=!0,Zu(l)}function ga(){if(!Ch&&$s!==null){Ch=!0;var l=0,h=cn;try{var v=$s;for(cn=1;l<v.length;l++){var w=v[l];do w=w(!0);while(w!==null)}$s=null,Yu=!1}catch(C){throw $s!==null&&($s=$s.slice(l+1)),vt(de,ga),C}finally{cn=h,Ch=!1}}return null}var sl=[],Jr=0,Ph=null,Rh=0,kr=[],lr=0,al=null,It=1,Ds="";function Wa(l,h){sl[Jr++]=Rh,sl[Jr++]=Ph,Ph=l,Rh=h}function yd(l,h,v){kr[lr++]=It,kr[lr++]=Ds,kr[lr++]=al,al=l;var w=It;l=Ds;var C=32-ft(w)-1;w&=~(1<<C),v+=1;var N=32-ft(h)+C;if(30<N){var j=C-C%5;N=(w&(1<<j)-1).toString(32),w>>=j,C-=j,It=1<<32-ft(h)+C|v<<C|w,Ds=N+l}else It=1<<N|v<<C|w,Ds=l}function _d(l){l.return!==null&&(Wa(l,1),yd(l,1,0))}function ja(l){for(;l===Ph;)Ph=sl[--Jr],sl[Jr]=null,Rh=sl[--Jr],sl[Jr]=null;for(;l===al;)al=kr[--lr],kr[lr]=null,Ds=kr[--lr],kr[lr]=null,It=kr[--lr],kr[lr]=null}var pr=null,zr=null,si=!1,Us=null;function xd(l,h){var v=Sa(5,null,null,0);v.elementType="DELETED",v.stateNode=h,v.return=l,h=l.deletions,h===null?(l.deletions=[v],l.flags|=16):h.push(v)}function Sd(l,h){switch(l.tag){case 5:var v=l.type;return h=h.nodeType!==1||v.toLowerCase()!==h.nodeName.toLowerCase()?null:h,h!==null?(l.stateNode=h,pr=l,zr=Ba(h.firstChild),!0):!1;case 6:return h=l.pendingProps===""||h.nodeType!==3?null:h,h!==null?(l.stateNode=h,pr=l,zr=null,!0):!1;case 13:return h=h.nodeType!==8?null:h,h!==null?(v=al!==null?{id:It,overflow:Ds}:null,l.memoizedState={dehydrated:h,treeContext:v,retryLane:1073741824},v=Sa(18,null,null,0),v.stateNode=h,v.return=l,l.child=v,pr=l,zr=null,!0):!1;default:return!1}}function Ih(l){return(l.mode&1)!==0&&(l.flags&128)===0}function Lh(l){if(si){var h=zr;if(h){var v=h;if(!Sd(l,h)){if(Ih(l))throw Error(t(418));h=Ba(v.nextSibling);var w=pr;h&&Sd(l,h)?xd(w,v):(l.flags=l.flags&-4097|2,si=!1,pr=l)}}else{if(Ih(l))throw Error(t(418));l.flags=l.flags&-4097|2,si=!1,pr=l}}}function Nh(l){for(l=l.return;l!==null&&l.tag!==5&&l.tag!==3&&l.tag!==13;)l=l.return;pr=l}function jl(l){if(l!==pr)return!1;if(!si)return Nh(l),si=!0,!1;var h;if((h=l.tag!==3)&&!(h=l.tag!==5)&&(h=l.type,h=h!=="head"&&h!=="body"&&!hd(l.type,l.memoizedProps)),h&&(h=zr)){if(Ih(l))throw Md(),Error(t(418));for(;h;)xd(l,h),h=Ba(h.nextSibling)}if(Nh(l),l.tag===13){if(l=l.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(t(317));e:{for(l=l.nextSibling,h=0;l;){if(l.nodeType===8){var v=l.data;if(v==="/$"){if(h===0){zr=Ba(l.nextSibling);break e}h--}else v!=="$"&&v!=="$!"&&v!=="$?"||h++}l=l.nextSibling}zr=null}}else zr=pr?Ba(l.stateNode.nextSibling):null;return!0}function Md(){for(var l=zr;l;)l=Ba(l.nextSibling)}function Ao(){zr=pr=null,si=!1}function Xl(l){Us===null?Us=[l]:Us.push(l)}var x1=P.ReactCurrentBatchConfig;function Ju(l,h,v){if(l=v.ref,l!==null&&typeof l!="function"&&typeof l!="object"){if(v._owner){if(v=v._owner,v){if(v.tag!==1)throw Error(t(309));var w=v.stateNode}if(!w)throw Error(t(147,l));var C=w,N=""+l;return h!==null&&h.ref!==null&&typeof h.ref=="function"&&h.ref._stringRef===N?h.ref:(h=function(j){var fe=C.refs;j===null?delete fe[N]:fe[N]=j},h._stringRef=N,h)}if(typeof l!="string")throw Error(t(284));if(!v._owner)throw Error(t(290,l))}return l}function Ku(l,h){throw l=Object.prototype.toString.call(h),Error(t(31,l==="[object Object]"?"object with keys {"+Object.keys(h).join(", ")+"}":l))}function wd(l){var h=l._init;return h(l._payload)}function Ed(l){function h(Le,we){if(l){var Fe=Le.deletions;Fe===null?(Le.deletions=[we],Le.flags|=16):Fe.push(we)}}function v(Le,we){if(!l)return null;for(;we!==null;)h(Le,we),we=we.sibling;return null}function w(Le,we){for(Le=new Map;we!==null;)we.key!==null?Le.set(we.key,we):Le.set(we.index,we),we=we.sibling;return Le}function C(Le,we){return Le=iu(Le,we),Le.index=0,Le.sibling=null,Le}function N(Le,we,Fe){return Le.index=Fe,l?(Fe=Le.alternate,Fe!==null?(Fe=Fe.index,Fe<we?(Le.flags|=2,we):Fe):(Le.flags|=2,we)):(Le.flags|=1048576,we)}function j(Le){return l&&Le.alternate===null&&(Le.flags|=2),Le}function fe(Le,we,Fe,Ct){return we===null||we.tag!==6?(we=z1(Fe,Le.mode,Ct),we.return=Le,we):(we=C(we,Fe),we.return=Le,we)}function _e(Le,we,Fe,Ct){var an=Fe.type;return an===F?xt(Le,we,Fe.props.children,Ct,Fe.key):we!==null&&(we.elementType===an||typeof an=="object"&&an!==null&&an.$$typeof===ne&&wd(an)===we.type)?(Ct=C(we,Fe.props),Ct.ref=Ju(Le,we,Fe),Ct.return=Le,Ct):(Ct=im(Fe.type,Fe.key,Fe.props,null,Le.mode,Ct),Ct.ref=Ju(Le,we,Fe),Ct.return=Le,Ct)}function We(Le,we,Fe,Ct){return we===null||we.tag!==4||we.stateNode.containerInfo!==Fe.containerInfo||we.stateNode.implementation!==Fe.implementation?(we=B1(Fe,Le.mode,Ct),we.return=Le,we):(we=C(we,Fe.children||[]),we.return=Le,we)}function xt(Le,we,Fe,Ct,an){return we===null||we.tag!==7?(we=pc(Fe,Le.mode,Ct,an),we.return=Le,we):(we=C(we,Fe),we.return=Le,we)}function wt(Le,we,Fe){if(typeof we=="string"&&we!==""||typeof we=="number")return we=z1(""+we,Le.mode,Fe),we.return=Le,we;if(typeof we=="object"&&we!==null){switch(we.$$typeof){case L:return Fe=im(we.type,we.key,we.props,null,Le.mode,Fe),Fe.ref=Ju(Le,null,we),Fe.return=Le,Fe;case D:return we=B1(we,Le.mode,Fe),we.return=Le,we;case ne:var Ct=we._init;return wt(Le,Ct(we._payload),Fe)}if(je(we)||ie(we))return we=pc(we,Le.mode,Fe,null),we.return=Le,we;Ku(Le,we)}return null}function yt(Le,we,Fe,Ct){var an=we!==null?we.key:null;if(typeof Fe=="string"&&Fe!==""||typeof Fe=="number")return an!==null?null:fe(Le,we,""+Fe,Ct);if(typeof Fe=="object"&&Fe!==null){switch(Fe.$$typeof){case L:return Fe.key===an?_e(Le,we,Fe,Ct):null;case D:return Fe.key===an?We(Le,we,Fe,Ct):null;case ne:return an=Fe._init,yt(Le,we,an(Fe._payload),Ct)}if(je(Fe)||ie(Fe))return an!==null?null:xt(Le,we,Fe,Ct,null);Ku(Le,Fe)}return null}function qt(Le,we,Fe,Ct,an){if(typeof Ct=="string"&&Ct!==""||typeof Ct=="number")return Le=Le.get(Fe)||null,fe(we,Le,""+Ct,an);if(typeof Ct=="object"&&Ct!==null){switch(Ct.$$typeof){case L:return Le=Le.get(Ct.key===null?Fe:Ct.key)||null,_e(we,Le,Ct,an);case D:return Le=Le.get(Ct.key===null?Fe:Ct.key)||null,We(we,Le,Ct,an);case ne:var pn=Ct._init;return qt(Le,we,Fe,pn(Ct._payload),an)}if(je(Ct)||ie(Ct))return Le=Le.get(Fe)||null,xt(we,Le,Ct,an,null);Ku(we,Ct)}return null}function tn(Le,we,Fe,Ct){for(var an=null,pn=null,mn=we,_n=we=0,Ar=null;mn!==null&&_n<Fe.length;_n++){mn.index>_n?(Ar=mn,mn=null):Ar=mn.sibling;var Wn=yt(Le,mn,Fe[_n],Ct);if(Wn===null){mn===null&&(mn=Ar);break}l&&mn&&Wn.alternate===null&&h(Le,mn),we=N(Wn,we,_n),pn===null?an=Wn:pn.sibling=Wn,pn=Wn,mn=Ar}if(_n===Fe.length)return v(Le,mn),si&&Wa(Le,_n),an;if(mn===null){for(;_n<Fe.length;_n++)mn=wt(Le,Fe[_n],Ct),mn!==null&&(we=N(mn,we,_n),pn===null?an=mn:pn.sibling=mn,pn=mn);return si&&Wa(Le,_n),an}for(mn=w(Le,mn);_n<Fe.length;_n++)Ar=qt(mn,Le,_n,Fe[_n],Ct),Ar!==null&&(l&&Ar.alternate!==null&&mn.delete(Ar.key===null?_n:Ar.key),we=N(Ar,we,_n),pn===null?an=Ar:pn.sibling=Ar,pn=Ar);return l&&mn.forEach(function(ru){return h(Le,ru)}),si&&Wa(Le,_n),an}function rn(Le,we,Fe,Ct){var an=ie(Fe);if(typeof an!="function")throw Error(t(150));if(Fe=an.call(Fe),Fe==null)throw Error(t(151));for(var pn=an=null,mn=we,_n=we=0,Ar=null,Wn=Fe.next();mn!==null&&!Wn.done;_n++,Wn=Fe.next()){mn.index>_n?(Ar=mn,mn=null):Ar=mn.sibling;var ru=yt(Le,mn,Wn.value,Ct);if(ru===null){mn===null&&(mn=Ar);break}l&&mn&&ru.alternate===null&&h(Le,mn),we=N(ru,we,_n),pn===null?an=ru:pn.sibling=ru,pn=ru,mn=Ar}if(Wn.done)return v(Le,mn),si&&Wa(Le,_n),an;if(mn===null){for(;!Wn.done;_n++,Wn=Fe.next())Wn=wt(Le,Wn.value,Ct),Wn!==null&&(we=N(Wn,we,_n),pn===null?an=Wn:pn.sibling=Wn,pn=Wn);return si&&Wa(Le,_n),an}for(mn=w(Le,mn);!Wn.done;_n++,Wn=Fe.next())Wn=qt(mn,Le,_n,Wn.value,Ct),Wn!==null&&(l&&Wn.alternate!==null&&mn.delete(Wn.key===null?_n:Wn.key),we=N(Wn,we,_n),pn===null?an=Wn:pn.sibling=Wn,pn=Wn);return l&&mn.forEach(function(hb){return h(Le,hb)}),si&&Wa(Le,_n),an}function qi(Le,we,Fe,Ct){if(typeof Fe=="object"&&Fe!==null&&Fe.type===F&&Fe.key===null&&(Fe=Fe.props.children),typeof Fe=="object"&&Fe!==null){switch(Fe.$$typeof){case L:e:{for(var an=Fe.key,pn=we;pn!==null;){if(pn.key===an){if(an=Fe.type,an===F){if(pn.tag===7){v(Le,pn.sibling),we=C(pn,Fe.props.children),we.return=Le,Le=we;break e}}else if(pn.elementType===an||typeof an=="object"&&an!==null&&an.$$typeof===ne&&wd(an)===pn.type){v(Le,pn.sibling),we=C(pn,Fe.props),we.ref=Ju(Le,pn,Fe),we.return=Le,Le=we;break e}v(Le,pn);break}else h(Le,pn);pn=pn.sibling}Fe.type===F?(we=pc(Fe.props.children,Le.mode,Ct,Fe.key),we.return=Le,Le=we):(Ct=im(Fe.type,Fe.key,Fe.props,null,Le.mode,Ct),Ct.ref=Ju(Le,we,Fe),Ct.return=Le,Le=Ct)}return j(Le);case D:e:{for(pn=Fe.key;we!==null;){if(we.key===pn)if(we.tag===4&&we.stateNode.containerInfo===Fe.containerInfo&&we.stateNode.implementation===Fe.implementation){v(Le,we.sibling),we=C(we,Fe.children||[]),we.return=Le,Le=we;break e}else{v(Le,we);break}else h(Le,we);we=we.sibling}we=B1(Fe,Le.mode,Ct),we.return=Le,Le=we}return j(Le);case ne:return pn=Fe._init,qi(Le,we,pn(Fe._payload),Ct)}if(je(Fe))return tn(Le,we,Fe,Ct);if(ie(Fe))return rn(Le,we,Fe,Ct);Ku(Le,Fe)}return typeof Fe=="string"&&Fe!==""||typeof Fe=="number"?(Fe=""+Fe,we!==null&&we.tag===6?(v(Le,we.sibling),we=C(we,Fe),we.return=Le,Le=we):(v(Le,we),we=z1(Fe,Le.mode,Ct),we.return=Le,Le=we),j(Le)):v(Le,we)}return qi}var ol=Ed(!0),Qu=Ed(!1),ll=wi(null),ul=null,Xa=null,ql=null;function cl(){ql=Xa=ul=null}function $u(l){var h=ll.current;ni(ll),l._currentValue=h}function ec(l,h,v){for(;l!==null;){var w=l.alternate;if((l.childLanes&h)!==h?(l.childLanes|=h,w!==null&&(w.childLanes|=h)):w!==null&&(w.childLanes&h)!==h&&(w.childLanes|=h),l===v)break;l=l.return}}function Co(l,h){ul=l,ql=Xa=null,l=l.dependencies,l!==null&&l.firstContext!==null&&((l.lanes&h)!==0&&(Cn=!0),l.firstContext=null)}function fs(l){var h=l._currentValue;if(ql!==l)if(l={context:l,memoizedValue:h,next:null},Xa===null){if(ul===null)throw Error(t(308));Xa=l,ul.dependencies={lanes:0,firstContext:l}}else Xa=Xa.next=l;return h}var qa=null;function Td(l){qa===null?qa=[l]:qa.push(l)}function tc(l,h,v,w){var C=h.interleaved;return C===null?(v.next=v,Td(h)):(v.next=C.next,C.next=v),h.interleaved=v,ea(l,w)}function ea(l,h){l.lanes|=h;var v=l.alternate;for(v!==null&&(v.lanes|=h),v=l,l=l.return;l!==null;)l.childLanes|=h,v=l.alternate,v!==null&&(v.childLanes|=h),v=l,l=l.return;return v.tag===3?v.stateNode:null}var Xn=!1;function An(l){l.updateQueue={baseState:l.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Ii(l,h){l=l.updateQueue,h.updateQueue===l&&(h.updateQueue={baseState:l.baseState,firstBaseUpdate:l.firstBaseUpdate,lastBaseUpdate:l.lastBaseUpdate,shared:l.shared,effects:l.effects})}function qn(l,h){return{eventTime:l,lane:h,tag:0,payload:null,callback:null,next:null}}function fi(l,h,v){var w=l.updateQueue;if(w===null)return null;if(w=w.shared,(Gn&2)!==0){var C=w.pending;return C===null?h.next=h:(h.next=C.next,C.next=h),w.pending=h,ea(l,v)}return C=w.interleaved,C===null?(h.next=h,Td(w)):(h.next=C.next,C.next=h),w.interleaved=h,ea(l,v)}function Er(l,h,v){if(h=h.updateQueue,h!==null&&(h=h.shared,(v&4194240)!==0)){var w=h.lanes;w&=l.pendingLanes,v|=w,h.lanes=v,Ln(l,v)}}function hl(l,h){var v=l.updateQueue,w=l.alternate;if(w!==null&&(w=w.updateQueue,v===w)){var C=null,N=null;if(v=v.firstBaseUpdate,v!==null){do{var j={eventTime:v.eventTime,lane:v.lane,tag:v.tag,payload:v.payload,callback:v.callback,next:null};N===null?C=N=j:N=N.next=j,v=v.next}while(v!==null);N===null?C=N=h:N=N.next=h}else C=N=h;v={baseState:w.baseState,firstBaseUpdate:C,lastBaseUpdate:N,shared:w.shared,effects:w.effects},l.updateQueue=v;return}l=v.lastBaseUpdate,l===null?v.firstBaseUpdate=h:l.next=h,v.lastBaseUpdate=h}function Ei(l,h,v,w){var C=l.updateQueue;Xn=!1;var N=C.firstBaseUpdate,j=C.lastBaseUpdate,fe=C.shared.pending;if(fe!==null){C.shared.pending=null;var _e=fe,We=_e.next;_e.next=null,j===null?N=We:j.next=We,j=_e;var xt=l.alternate;xt!==null&&(xt=xt.updateQueue,fe=xt.lastBaseUpdate,fe!==j&&(fe===null?xt.firstBaseUpdate=We:fe.next=We,xt.lastBaseUpdate=_e))}if(N!==null){var wt=C.baseState;j=0,xt=We=_e=null,fe=N;do{var yt=fe.lane,qt=fe.eventTime;if((w&yt)===yt){xt!==null&&(xt=xt.next={eventTime:qt,lane:0,tag:fe.tag,payload:fe.payload,callback:fe.callback,next:null});e:{var tn=l,rn=fe;switch(yt=h,qt=v,rn.tag){case 1:if(tn=rn.payload,typeof tn=="function"){wt=tn.call(qt,wt,yt);break e}wt=tn;break e;case 3:tn.flags=tn.flags&-65537|128;case 0:if(tn=rn.payload,yt=typeof tn=="function"?tn.call(qt,wt,yt):tn,yt==null)break e;wt=Y({},wt,yt);break e;case 2:Xn=!0}}fe.callback!==null&&fe.lane!==0&&(l.flags|=64,yt=C.effects,yt===null?C.effects=[fe]:yt.push(fe))}else qt={eventTime:qt,lane:yt,tag:fe.tag,payload:fe.payload,callback:fe.callback,next:null},xt===null?(We=xt=qt,_e=wt):xt=xt.next=qt,j|=yt;if(fe=fe.next,fe===null){if(fe=C.shared.pending,fe===null)break;yt=fe,fe=yt.next,yt.next=null,C.lastBaseUpdate=yt,C.shared.pending=null}}while(!0);if(xt===null&&(_e=wt),C.baseState=_e,C.firstBaseUpdate=We,C.lastBaseUpdate=xt,h=C.shared.interleaved,h!==null){C=h;do j|=C.lane,C=C.next;while(C!==h)}else N===null&&(C.shared.lanes=0);cc|=j,l.lanes=j,l.memoizedState=wt}}function Yl(l,h,v){if(l=h.effects,h.effects=null,l!==null)for(h=0;h<l.length;h++){var w=l[h],C=w.callback;if(C!==null){if(w.callback=null,w=v,typeof C!="function")throw Error(t(191,C));C.call(w)}}}var va={},ds=wi(va),fl=wi(va),Ya=wi(va);function Fi(l){if(l===va)throw Error(t(174));return l}function nc(l,h){switch(Qn(Ya,h),Qn(fl,l),Qn(ds,va),l=h.nodeType,l){case 9:case 11:h=(h=h.documentElement)?h.namespaceURI:Pe(null,"");break;default:l=l===8?h.parentNode:h,h=l.namespaceURI||null,l=l.tagName,h=Pe(h,l)}ni(ds),Qn(ds,h)}function Po(){ni(ds),ni(fl),ni(Ya)}function dl(l){Fi(Ya.current);var h=Fi(ds.current),v=Pe(h,l.type);h!==v&&(Qn(fl,l),Qn(ds,v))}function Zl(l){fl.current===l&&(ni(ds),ni(fl))}var ai=wi(0);function ta(l){for(var h=l;h!==null;){if(h.tag===13){var v=h.memoizedState;if(v!==null&&(v=v.dehydrated,v===null||v.data==="$?"||v.data==="$!"))return h}else if(h.tag===19&&h.memoizedProps.revealOrder!==void 0){if((h.flags&128)!==0)return h}else if(h.child!==null){h.child.return=h,h=h.child;continue}if(h===l)break;for(;h.sibling===null;){if(h.return===null||h.return===l)return null;h=h.return}h.sibling.return=h.return,h=h.sibling}return null}var Jl=[];function ya(){for(var l=0;l<Jl.length;l++)Jl[l]._workInProgressVersionPrimary=null;Jl.length=0}var pl=P.ReactCurrentDispatcher,ml=P.ReactCurrentBatchConfig,Za=0,ii=null,Ti=null,Bn=null,na=!1,Tr=!1,Ro=0,Kr=0;function mr(){throw Error(t(321))}function ic(l,h){if(h===null)return!1;for(var v=0;v<h.length&&v<l.length;v++)if(!us(l[v],h[v]))return!1;return!0}function rc(l,h,v,w,C,N){if(Za=N,ii=h,h.memoizedState=null,h.updateQueue=null,h.lanes=0,pl.current=l===null||l.memoizedState===null?G0:V0,l=v(w,C),Tr){N=0;do{if(Tr=!1,Ro=0,25<=N)throw Error(t(301));N+=1,Bn=Ti=null,h.updateQueue=null,pl.current=H0,l=v(w,C)}while(Tr)}if(pl.current=Bh,h=Ti!==null&&Ti.next!==null,Za=0,Bn=Ti=ii=null,na=!1,h)throw Error(t(300));return l}function bd(){var l=Ro!==0;return Ro=0,l}function gr(){var l={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Bn===null?ii.memoizedState=Bn=l:Bn=Bn.next=l,Bn}function ps(){if(Ti===null){var l=ii.alternate;l=l!==null?l.memoizedState:null}else l=Ti.next;var h=Bn===null?ii.memoizedState:Bn.next;if(h!==null)Bn=h,Ti=l;else{if(l===null)throw Error(t(310));Ti=l,l={memoizedState:Ti.memoizedState,baseState:Ti.baseState,baseQueue:Ti.baseQueue,queue:Ti.queue,next:null},Bn===null?ii.memoizedState=Bn=l:Bn=Bn.next=l}return Bn}function Kl(l,h){return typeof h=="function"?h(l):h}function sc(l){var h=ps(),v=h.queue;if(v===null)throw Error(t(311));v.lastRenderedReducer=l;var w=Ti,C=w.baseQueue,N=v.pending;if(N!==null){if(C!==null){var j=C.next;C.next=N.next,N.next=j}w.baseQueue=C=N,v.pending=null}if(C!==null){N=C.next,w=w.baseState;var fe=j=null,_e=null,We=N;do{var xt=We.lane;if((Za&xt)===xt)_e!==null&&(_e=_e.next={lane:0,action:We.action,hasEagerState:We.hasEagerState,eagerState:We.eagerState,next:null}),w=We.hasEagerState?We.eagerState:l(w,We.action);else{var wt={lane:xt,action:We.action,hasEagerState:We.hasEagerState,eagerState:We.eagerState,next:null};_e===null?(fe=_e=wt,j=w):_e=_e.next=wt,ii.lanes|=xt,cc|=xt}We=We.next}while(We!==null&&We!==N);_e===null?j=w:_e.next=fe,us(w,h.memoizedState)||(Cn=!0),h.memoizedState=w,h.baseState=j,h.baseQueue=_e,v.lastRenderedState=w}if(l=v.interleaved,l!==null){C=l;do N=C.lane,ii.lanes|=N,cc|=N,C=C.next;while(C!==l)}else C===null&&(v.lanes=0);return[h.memoizedState,v.dispatch]}function Ja(l){var h=ps(),v=h.queue;if(v===null)throw Error(t(311));v.lastRenderedReducer=l;var w=v.dispatch,C=v.pending,N=h.memoizedState;if(C!==null){v.pending=null;var j=C=C.next;do N=l(N,j.action),j=j.next;while(j!==C);us(N,h.memoizedState)||(Cn=!0),h.memoizedState=N,h.baseQueue===null&&(h.baseState=N),v.lastRenderedState=N}return[N,w]}function Ad(){}function Cd(l,h){var v=ii,w=ps(),C=h(),N=!us(w.memoizedState,C);if(N&&(w.memoizedState=C,Cn=!0),w=w.queue,Id(U0.bind(null,v,w,l),[l]),w.getSnapshot!==h||N||Bn!==null&&Bn.memoizedState.tag&1){if(v.flags|=2048,ia(9,ac.bind(null,v,w,C,h),void 0,null),br===null)throw Error(t(349));(Za&30)!==0||Dh(v,h,C)}return C}function Dh(l,h,v){l.flags|=16384,l={getSnapshot:h,value:v},h=ii.updateQueue,h===null?(h={lastEffect:null,stores:null},ii.updateQueue=h,h.stores=[l]):(v=h.stores,v===null?h.stores=[l]:v.push(l))}function ac(l,h,v,w){h.value=v,h.getSnapshot=w,F0(h)&&Pd(l)}function U0(l,h,v){return v(function(){F0(h)&&Pd(l)})}function F0(l){var h=l.getSnapshot;l=l.value;try{var v=h();return!us(l,v)}catch{return!0}}function Pd(l){var h=ea(l,1);h!==null&&to(h,l,1,-1)}function Rd(l){var h=gr();return typeof l=="function"&&(l=l()),h.memoizedState=h.baseState=l,l={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Kl,lastRenderedState:l},h.queue=l,l=l.dispatch=gl.bind(null,ii,l),[h.memoizedState,l]}function ia(l,h,v,w){return l={tag:l,create:h,destroy:v,deps:w,next:null},h=ii.updateQueue,h===null?(h={lastEffect:null,stores:null},ii.updateQueue=h,h.lastEffect=l.next=l):(v=h.lastEffect,v===null?h.lastEffect=l.next=l:(w=v.next,v.next=l,l.next=w,h.lastEffect=l)),l}function O0(){return ps().memoizedState}function _a(l,h,v,w){var C=gr();ii.flags|=l,C.memoizedState=ia(1|h,v,void 0,w===void 0?null:w)}function oc(l,h,v,w){var C=ps();w=w===void 0?null:w;var N=void 0;if(Ti!==null){var j=Ti.memoizedState;if(N=j.destroy,w!==null&&ic(w,j.deps)){C.memoizedState=ia(h,v,N,w);return}}ii.flags|=l,C.memoizedState=ia(1|h,v,N,w)}function Br(l,h){return _a(8390656,8,l,h)}function Id(l,h){return oc(2048,8,l,h)}function Ld(l,h){return oc(4,2,l,h)}function k0(l,h){return oc(4,4,l,h)}function z0(l,h){if(typeof h=="function")return l=l(),h(l),function(){h(null)};if(h!=null)return l=l(),h.current=l,function(){h.current=null}}function Nd(l,h,v){return v=v!=null?v.concat([l]):null,oc(4,4,z0.bind(null,h,l),v)}function Uh(){}function B0(l,h){var v=ps();h=h===void 0?null:h;var w=v.memoizedState;return w!==null&&h!==null&&ic(h,w[1])?w[0]:(v.memoizedState=[l,h],l)}function ms(l,h){var v=ps();h=h===void 0?null:h;var w=v.memoizedState;return w!==null&&h!==null&&ic(h,w[1])?w[0]:(l=l(),v.memoizedState=[l,h],l)}function Fh(l,h,v){return(Za&21)===0?(l.baseState&&(l.baseState=!1,Cn=!0),l.memoizedState=v):(us(v,h)||(v=bn(),ii.lanes|=v,cc|=v,l.baseState=!0),h)}function S1(l,h){var v=cn;cn=v!==0&&4>v?v:4,l(!0);var w=ml.transition;ml.transition={};try{l(!1),h()}finally{cn=v,ml.transition=w}}function Ka(){return ps().memoizedState}function Oh(l,h,v){var w=tu(l);if(v={lane:w,action:v,hasEagerState:!1,eagerState:null,next:null},lc(l))kh(h,v);else if(v=tc(l,h,v,w),v!==null){var C=vs();to(v,l,w,C),zh(v,h,w)}}function gl(l,h,v){var w=tu(l),C={lane:w,action:v,hasEagerState:!1,eagerState:null,next:null};if(lc(l))kh(h,C);else{var N=l.alternate;if(l.lanes===0&&(N===null||N.lanes===0)&&(N=h.lastRenderedReducer,N!==null))try{var j=h.lastRenderedState,fe=N(j,v);if(C.hasEagerState=!0,C.eagerState=fe,us(fe,j)){var _e=h.interleaved;_e===null?(C.next=C,Td(h)):(C.next=_e.next,_e.next=C),h.interleaved=C;return}}catch{}finally{}v=tc(l,h,C,w),v!==null&&(C=vs(),to(v,l,w,C),zh(v,h,w))}}function lc(l){var h=l.alternate;return l===ii||h!==null&&h===ii}function kh(l,h){Tr=na=!0;var v=l.pending;v===null?h.next=h:(h.next=v.next,v.next=h),l.pending=h}function zh(l,h,v){if((v&4194240)!==0){var w=h.lanes;w&=l.pendingLanes,v|=w,h.lanes=v,Ln(l,v)}}var Bh={readContext:fs,useCallback:mr,useContext:mr,useEffect:mr,useImperativeHandle:mr,useInsertionEffect:mr,useLayoutEffect:mr,useMemo:mr,useReducer:mr,useRef:mr,useState:mr,useDebugValue:mr,useDeferredValue:mr,useTransition:mr,useMutableSource:mr,useSyncExternalStore:mr,useId:mr,unstable_isNewReconciler:!1},G0={readContext:fs,useCallback:function(l,h){return gr().memoizedState=[l,h===void 0?null:h],l},useContext:fs,useEffect:Br,useImperativeHandle:function(l,h,v){return v=v!=null?v.concat([l]):null,_a(4194308,4,z0.bind(null,h,l),v)},useLayoutEffect:function(l,h){return _a(4194308,4,l,h)},useInsertionEffect:function(l,h){return _a(4,2,l,h)},useMemo:function(l,h){var v=gr();return h=h===void 0?null:h,l=l(),v.memoizedState=[l,h],l},useReducer:function(l,h,v){var w=gr();return h=v!==void 0?v(h):h,w.memoizedState=w.baseState=h,l={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:l,lastRenderedState:h},w.queue=l,l=l.dispatch=Oh.bind(null,ii,l),[w.memoizedState,l]},useRef:function(l){var h=gr();return l={current:l},h.memoizedState=l},useState:Rd,useDebugValue:Uh,useDeferredValue:function(l){return gr().memoizedState=l},useTransition:function(){var l=Rd(!1),h=l[0];return l=S1.bind(null,l[1]),gr().memoizedState=l,[h,l]},useMutableSource:function(){},useSyncExternalStore:function(l,h,v){var w=ii,C=gr();if(si){if(v===void 0)throw Error(t(407));v=v()}else{if(v=h(),br===null)throw Error(t(349));(Za&30)!==0||Dh(w,h,v)}C.memoizedState=v;var N={value:v,getSnapshot:h};return C.queue=N,Br(U0.bind(null,w,N,l),[l]),w.flags|=2048,ia(9,ac.bind(null,w,N,v,h),void 0,null),v},useId:function(){var l=gr(),h=br.identifierPrefix;if(si){var v=Ds,w=It;v=(w&~(1<<32-ft(w)-1)).toString(32)+v,h=":"+h+"R"+v,v=Ro++,0<v&&(h+="H"+v.toString(32)),h+=":"}else v=Kr++,h=":"+h+"r"+v.toString(32)+":";return l.memoizedState=h},unstable_isNewReconciler:!1},V0={readContext:fs,useCallback:B0,useContext:fs,useEffect:Id,useImperativeHandle:Nd,useInsertionEffect:Ld,useLayoutEffect:k0,useMemo:ms,useReducer:sc,useRef:O0,useState:function(){return sc(Kl)},useDebugValue:Uh,useDeferredValue:function(l){var h=ps();return Fh(h,Ti.memoizedState,l)},useTransition:function(){var l=sc(Kl)[0],h=ps().memoizedState;return[l,h]},useMutableSource:Ad,useSyncExternalStore:Cd,useId:Ka,unstable_isNewReconciler:!1},H0={readContext:fs,useCallback:B0,useContext:fs,useEffect:Id,useImperativeHandle:Nd,useInsertionEffect:Ld,useLayoutEffect:k0,useMemo:ms,useReducer:Ja,useRef:O0,useState:function(){return Ja(Kl)},useDebugValue:Uh,useDeferredValue:function(l){var h=ps();return Ti===null?h.memoizedState=l:Fh(h,Ti.memoizedState,l)},useTransition:function(){var l=Ja(Kl)[0],h=ps().memoizedState;return[l,h]},useMutableSource:Ad,useSyncExternalStore:Cd,useId:Ka,unstable_isNewReconciler:!1};function Fs(l,h){if(l&&l.defaultProps){h=Y({},h),l=l.defaultProps;for(var v in l)h[v]===void 0&&(h[v]=l[v]);return h}return h}function uc(l,h,v,w){h=l.memoizedState,v=v(w,h),v=v==null?h:Y({},h,v),l.memoizedState=v,l.lanes===0&&(l.updateQueue.baseState=v)}var Gh={isMounted:function(l){return(l=l._reactInternals)?ee(l)===l:!1},enqueueSetState:function(l,h,v){l=l._reactInternals;var w=vs(),C=tu(l),N=qn(w,C);N.payload=h,v!=null&&(N.callback=v),h=fi(l,N,C),h!==null&&(to(h,l,C,w),Er(h,l,C))},enqueueReplaceState:function(l,h,v){l=l._reactInternals;var w=vs(),C=tu(l),N=qn(w,C);N.tag=1,N.payload=h,v!=null&&(N.callback=v),h=fi(l,N,C),h!==null&&(to(h,l,C,w),Er(h,l,C))},enqueueForceUpdate:function(l,h){l=l._reactInternals;var v=vs(),w=tu(l),C=qn(v,w);C.tag=2,h!=null&&(C.callback=h),h=fi(l,C,w),h!==null&&(to(h,l,w,v),Er(h,l,w))}};function W0(l,h,v,w,C,N,j){return l=l.stateNode,typeof l.shouldComponentUpdate=="function"?l.shouldComponentUpdate(w,N,j):h.prototype&&h.prototype.isPureReactComponent?!Ko(v,w)||!Ko(C,N):!0}function d(l,h,v){var w=!1,C=Va,N=h.contextType;return typeof N=="object"&&N!==null?N=fs(N):(C=wr(h)?Ha:dr.current,w=h.contextTypes,N=(w=w!=null)?il(l,C):Va),h=new h(v,N),l.memoizedState=h.state!==null&&h.state!==void 0?h.state:null,h.updater=Gh,l.stateNode=h,h._reactInternals=l,w&&(l=l.stateNode,l.__reactInternalMemoizedUnmaskedChildContext=C,l.__reactInternalMemoizedMaskedChildContext=N),h}function p(l,h,v,w){l=h.state,typeof h.componentWillReceiveProps=="function"&&h.componentWillReceiveProps(v,w),typeof h.UNSAFE_componentWillReceiveProps=="function"&&h.UNSAFE_componentWillReceiveProps(v,w),h.state!==l&&Gh.enqueueReplaceState(h,h.state,null)}function M(l,h,v,w){var C=l.stateNode;C.props=v,C.state=l.memoizedState,C.refs={},An(l);var N=h.contextType;typeof N=="object"&&N!==null?C.context=fs(N):(N=wr(h)?Ha:dr.current,C.context=il(l,N)),C.state=l.memoizedState,N=h.getDerivedStateFromProps,typeof N=="function"&&(uc(l,h,N,v),C.state=l.memoizedState),typeof h.getDerivedStateFromProps=="function"||typeof C.getSnapshotBeforeUpdate=="function"||typeof C.UNSAFE_componentWillMount!="function"&&typeof C.componentWillMount!="function"||(h=C.state,typeof C.componentWillMount=="function"&&C.componentWillMount(),typeof C.UNSAFE_componentWillMount=="function"&&C.UNSAFE_componentWillMount(),h!==C.state&&Gh.enqueueReplaceState(C,C.state,null),Ei(l,v,C,w),C.state=l.memoizedState),typeof C.componentDidMount=="function"&&(l.flags|=4194308)}function b(l,h){try{var v="",w=h;do v+=ve(w),w=w.return;while(w);var C=v}catch(N){C=`
Error generating stack: `+N.message+`
`+N.stack}return{value:l,source:h,stack:C,digest:null}}function I(l,h,v){return{value:l,source:null,stack:v??null,digest:h??null}}function G(l,h){try{console.error(h.value)}catch(v){setTimeout(function(){throw v})}}var ce=typeof WeakMap=="function"?WeakMap:Map;function be(l,h,v){v=qn(-1,v),v.tag=3,v.payload={element:null};var w=h.value;return v.callback=function(){K0||(K0=!0,I1=w),G(l,h)},v}function $e(l,h,v){v=qn(-1,v),v.tag=3;var w=l.type.getDerivedStateFromError;if(typeof w=="function"){var C=h.value;v.payload=function(){return w(C)},v.callback=function(){G(l,h)}}var N=l.stateNode;return N!==null&&typeof N.componentDidCatch=="function"&&(v.callback=function(){G(l,h),typeof w!="function"&&($l===null?$l=new Set([this]):$l.add(this));var j=h.stack;this.componentDidCatch(h.value,{componentStack:j!==null?j:""})}),v}function bt(l,h,v){var w=l.pingCache;if(w===null){w=l.pingCache=new ce;var C=new Set;w.set(h,C)}else C=w.get(h),C===void 0&&(C=new Set,w.set(h,C));C.has(v)||(C.add(v),l=eb.bind(null,l,h,v),h.then(l,l))}function Zt(l){do{var h;if((h=l.tag===13)&&(h=l.memoizedState,h=h!==null?h.dehydrated!==null:!0),h)return l;l=l.return}while(l!==null);return null}function Mn(l,h,v,w,C){return(l.mode&1)===0?(l===h?l.flags|=65536:(l.flags|=128,v.flags|=131072,v.flags&=-52805,v.tag===1&&(v.alternate===null?v.tag=17:(h=qn(-1,1),h.tag=2,fi(v,h,1))),v.lanes|=1),l):(l.flags|=65536,l.lanes=C,l)}var hn=P.ReactCurrentOwner,Cn=!1;function Wt(l,h,v,w){h.child=l===null?Qu(h,null,v,w):ol(h,l.child,v,w)}function vr(l,h,v,w,C){v=v.render;var N=h.ref;return Co(h,C),w=rc(l,h,v,w,N,C),v=bd(),l!==null&&!Cn?(h.updateQueue=l.updateQueue,h.flags&=-2053,l.lanes&=~C,vl(l,h,C)):(si&&v&&_d(h),h.flags|=1,Wt(l,h,w,C),h.child)}function gs(l,h,v,w,C){if(l===null){var N=v.type;return typeof N=="function"&&!k1(N)&&N.defaultProps===void 0&&v.compare===null&&v.defaultProps===void 0?(h.tag=15,h.type=N,Oe(l,h,N,w,C)):(l=im(v.type,null,w,h,h.mode,C),l.ref=h.ref,l.return=h,h.child=l)}if(N=l.child,(l.lanes&C)===0){var j=N.memoizedProps;if(v=v.compare,v=v!==null?v:Ko,v(j,w)&&l.ref===h.ref)return vl(l,h,C)}return h.flags|=1,l=iu(N,w),l.ref=h.ref,l.return=h,h.child=l}function Oe(l,h,v,w,C){if(l!==null){var N=l.memoizedProps;if(Ko(N,w)&&l.ref===h.ref)if(Cn=!1,h.pendingProps=w=N,(l.lanes&C)!==0)(l.flags&131072)!==0&&(Cn=!0);else return h.lanes=l.lanes,vl(l,h,C)}return Bt(l,h,v,w,C)}function Ae(l,h,v){var w=h.pendingProps,C=w.children,N=l!==null?l.memoizedState:null;if(w.mode==="hidden")if((h.mode&1)===0)h.memoizedState={baseLanes:0,cachePool:null,transitions:null},Qn(Hh,ra),ra|=v;else{if((v&1073741824)===0)return l=N!==null?N.baseLanes|v:v,h.lanes=h.childLanes=1073741824,h.memoizedState={baseLanes:l,cachePool:null,transitions:null},h.updateQueue=null,Qn(Hh,ra),ra|=l,null;h.memoizedState={baseLanes:0,cachePool:null,transitions:null},w=N!==null?N.baseLanes:v,Qn(Hh,ra),ra|=w}else N!==null?(w=N.baseLanes|v,h.memoizedState=null):w=v,Qn(Hh,ra),ra|=w;return Wt(l,h,C,v),h.child}function Ze(l,h){var v=h.ref;(l===null&&v!==null||l!==null&&l.ref!==v)&&(h.flags|=512,h.flags|=2097152)}function Bt(l,h,v,w,C){var N=wr(v)?Ha:dr.current;return N=il(h,N),Co(h,C),v=rc(l,h,v,w,N,C),w=bd(),l!==null&&!Cn?(h.updateQueue=l.updateQueue,h.flags&=-2053,l.lanes&=~C,vl(l,h,C)):(si&&w&&_d(h),h.flags|=1,Wt(l,h,v,C),h.child)}function sn(l,h,v,w,C){if(wr(v)){var N=!0;rl(h)}else N=!1;if(Co(h,C),h.stateNode===null)X0(l,h),d(h,v,w),M(h,v,w,C),w=!0;else if(l===null){var j=h.stateNode,fe=h.memoizedProps;j.props=fe;var _e=j.context,We=v.contextType;typeof We=="object"&&We!==null?We=fs(We):(We=wr(v)?Ha:dr.current,We=il(h,We));var xt=v.getDerivedStateFromProps,wt=typeof xt=="function"||typeof j.getSnapshotBeforeUpdate=="function";wt||typeof j.UNSAFE_componentWillReceiveProps!="function"&&typeof j.componentWillReceiveProps!="function"||(fe!==w||_e!==We)&&p(h,j,w,We),Xn=!1;var yt=h.memoizedState;j.state=yt,Ei(h,w,j,C),_e=h.memoizedState,fe!==w||yt!==_e||Or.current||Xn?(typeof xt=="function"&&(uc(h,v,xt,w),_e=h.memoizedState),(fe=Xn||W0(h,v,fe,w,yt,_e,We))?(wt||typeof j.UNSAFE_componentWillMount!="function"&&typeof j.componentWillMount!="function"||(typeof j.componentWillMount=="function"&&j.componentWillMount(),typeof j.UNSAFE_componentWillMount=="function"&&j.UNSAFE_componentWillMount()),typeof j.componentDidMount=="function"&&(h.flags|=4194308)):(typeof j.componentDidMount=="function"&&(h.flags|=4194308),h.memoizedProps=w,h.memoizedState=_e),j.props=w,j.state=_e,j.context=We,w=fe):(typeof j.componentDidMount=="function"&&(h.flags|=4194308),w=!1)}else{j=h.stateNode,Ii(l,h),fe=h.memoizedProps,We=h.type===h.elementType?fe:Fs(h.type,fe),j.props=We,wt=h.pendingProps,yt=j.context,_e=v.contextType,typeof _e=="object"&&_e!==null?_e=fs(_e):(_e=wr(v)?Ha:dr.current,_e=il(h,_e));var qt=v.getDerivedStateFromProps;(xt=typeof qt=="function"||typeof j.getSnapshotBeforeUpdate=="function")||typeof j.UNSAFE_componentWillReceiveProps!="function"&&typeof j.componentWillReceiveProps!="function"||(fe!==wt||yt!==_e)&&p(h,j,w,_e),Xn=!1,yt=h.memoizedState,j.state=yt,Ei(h,w,j,C);var tn=h.memoizedState;fe!==wt||yt!==tn||Or.current||Xn?(typeof qt=="function"&&(uc(h,v,qt,w),tn=h.memoizedState),(We=Xn||W0(h,v,We,w,yt,tn,_e)||!1)?(xt||typeof j.UNSAFE_componentWillUpdate!="function"&&typeof j.componentWillUpdate!="function"||(typeof j.componentWillUpdate=="function"&&j.componentWillUpdate(w,tn,_e),typeof j.UNSAFE_componentWillUpdate=="function"&&j.UNSAFE_componentWillUpdate(w,tn,_e)),typeof j.componentDidUpdate=="function"&&(h.flags|=4),typeof j.getSnapshotBeforeUpdate=="function"&&(h.flags|=1024)):(typeof j.componentDidUpdate!="function"||fe===l.memoizedProps&&yt===l.memoizedState||(h.flags|=4),typeof j.getSnapshotBeforeUpdate!="function"||fe===l.memoizedProps&&yt===l.memoizedState||(h.flags|=1024),h.memoizedProps=w,h.memoizedState=tn),j.props=w,j.state=tn,j.context=_e,w=We):(typeof j.componentDidUpdate!="function"||fe===l.memoizedProps&&yt===l.memoizedState||(h.flags|=4),typeof j.getSnapshotBeforeUpdate!="function"||fe===l.memoizedProps&&yt===l.memoizedState||(h.flags|=1024),w=!1)}return En(l,h,v,w,N,C)}function En(l,h,v,w,C,N){Ze(l,h);var j=(h.flags&128)!==0;if(!w&&!j)return C&&vd(h,v,!1),vl(l,h,N);w=h.stateNode,hn.current=h;var fe=j&&typeof v.getDerivedStateFromError!="function"?null:w.render();return h.flags|=1,l!==null&&j?(h.child=ol(h,l.child,null,N),h.child=ol(h,null,fe,N)):Wt(l,h,fe,N),h.memoizedState=w.state,C&&vd(h,v,!0),h.child}function wn(l){var h=l.stateNode;h.pendingContext?gd(l,h.pendingContext,h.pendingContext!==h.context):h.context&&gd(l,h.context,!1),nc(l,h.containerInfo)}function On(l,h,v,w,C){return Ao(),Xl(C),h.flags|=256,Wt(l,h,v,w),h.child}var Oi={dehydrated:null,treeContext:null,retryLane:0};function Fn(l){return{baseLanes:l,cachePool:null,transitions:null}}function Qa(l,h,v){var w=h.pendingProps,C=ai.current,N=!1,j=(h.flags&128)!==0,fe;if((fe=j)||(fe=l!==null&&l.memoizedState===null?!1:(C&2)!==0),fe?(N=!0,h.flags&=-129):(l===null||l.memoizedState!==null)&&(C|=1),Qn(ai,C&1),l===null)return Lh(h),l=h.memoizedState,l!==null&&(l=l.dehydrated,l!==null)?((h.mode&1)===0?h.lanes=1:l.data==="$!"?h.lanes=8:h.lanes=1073741824,null):(j=w.children,l=w.fallback,N?(w=h.mode,N=h.child,j={mode:"hidden",children:j},(w&1)===0&&N!==null?(N.childLanes=0,N.pendingProps=j):N=rm(j,w,0,null),l=pc(l,w,v,null),N.return=h,l.return=h,N.sibling=l,h.child=N,h.child.memoizedState=Fn(v),h.memoizedState=Oi,l):Dd(h,j));if(C=l.memoizedState,C!==null&&(fe=C.dehydrated,fe!==null))return VT(l,h,j,w,fe,C,v);if(N){N=w.fallback,j=h.mode,C=l.child,fe=C.sibling;var _e={mode:"hidden",children:w.children};return(j&1)===0&&h.child!==C?(w=h.child,w.childLanes=0,w.pendingProps=_e,h.deletions=null):(w=iu(C,_e),w.subtreeFlags=C.subtreeFlags&14680064),fe!==null?N=iu(fe,N):(N=pc(N,j,v,null),N.flags|=2),N.return=h,w.return=h,w.sibling=N,h.child=w,w=N,N=h.child,j=l.child.memoizedState,j=j===null?Fn(v):{baseLanes:j.baseLanes|v,cachePool:null,transitions:j.transitions},N.memoizedState=j,N.childLanes=l.childLanes&~v,h.memoizedState=Oi,w}return N=l.child,l=N.sibling,w=iu(N,{mode:"visible",children:w.children}),(h.mode&1)===0&&(w.lanes=v),w.return=h,w.sibling=null,l!==null&&(v=h.deletions,v===null?(h.deletions=[l],h.flags|=16):v.push(l)),h.child=w,h.memoizedState=null,w}function Dd(l,h){return h=rm({mode:"visible",children:h},l.mode,0,null),h.return=l,l.child=h}function j0(l,h,v,w){return w!==null&&Xl(w),ol(h,l.child,null,v),l=Dd(h,h.pendingProps.children),l.flags|=2,h.memoizedState=null,l}function VT(l,h,v,w,C,N,j){if(v)return h.flags&256?(h.flags&=-257,w=I(Error(t(422))),j0(l,h,j,w)):h.memoizedState!==null?(h.child=l.child,h.flags|=128,null):(N=w.fallback,C=h.mode,w=rm({mode:"visible",children:w.children},C,0,null),N=pc(N,C,j,null),N.flags|=2,w.return=h,N.return=h,w.sibling=N,h.child=w,(h.mode&1)!==0&&ol(h,l.child,null,j),h.child.memoizedState=Fn(j),h.memoizedState=Oi,N);if((h.mode&1)===0)return j0(l,h,j,null);if(C.data==="$!"){if(w=C.nextSibling&&C.nextSibling.dataset,w)var fe=w.dgst;return w=fe,N=Error(t(419)),w=I(N,w,void 0),j0(l,h,j,w)}if(fe=(j&l.childLanes)!==0,Cn||fe){if(w=br,w!==null){switch(j&-j){case 4:C=2;break;case 16:C=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:C=32;break;case 536870912:C=268435456;break;default:C=0}C=(C&(w.suspendedLanes|j))!==0?0:C,C!==0&&C!==N.retryLane&&(N.retryLane=C,ea(l,C),to(w,l,C,-1))}return O1(),w=I(Error(t(421))),j0(l,h,j,w)}return C.data==="$?"?(h.flags|=128,h.child=l.child,h=tb.bind(null,l),C._reactRetry=h,null):(l=N.treeContext,zr=Ba(C.nextSibling),pr=h,si=!0,Us=null,l!==null&&(kr[lr++]=It,kr[lr++]=Ds,kr[lr++]=al,It=l.id,Ds=l.overflow,al=h),h=Dd(h,w.children),h.flags|=4096,h)}function nS(l,h,v){l.lanes|=h;var w=l.alternate;w!==null&&(w.lanes|=h),ec(l.return,h,v)}function M1(l,h,v,w,C){var N=l.memoizedState;N===null?l.memoizedState={isBackwards:h,rendering:null,renderingStartTime:0,last:w,tail:v,tailMode:C}:(N.isBackwards=h,N.rendering=null,N.renderingStartTime=0,N.last=w,N.tail=v,N.tailMode=C)}function iS(l,h,v){var w=h.pendingProps,C=w.revealOrder,N=w.tail;if(Wt(l,h,w.children,v),w=ai.current,(w&2)!==0)w=w&1|2,h.flags|=128;else{if(l!==null&&(l.flags&128)!==0)e:for(l=h.child;l!==null;){if(l.tag===13)l.memoizedState!==null&&nS(l,v,h);else if(l.tag===19)nS(l,v,h);else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===h)break e;for(;l.sibling===null;){if(l.return===null||l.return===h)break e;l=l.return}l.sibling.return=l.return,l=l.sibling}w&=1}if(Qn(ai,w),(h.mode&1)===0)h.memoizedState=null;else switch(C){case"forwards":for(v=h.child,C=null;v!==null;)l=v.alternate,l!==null&&ta(l)===null&&(C=v),v=v.sibling;v=C,v===null?(C=h.child,h.child=null):(C=v.sibling,v.sibling=null),M1(h,!1,C,v,N);break;case"backwards":for(v=null,C=h.child,h.child=null;C!==null;){if(l=C.alternate,l!==null&&ta(l)===null){h.child=C;break}l=C.sibling,C.sibling=v,v=C,C=l}M1(h,!0,v,null,N);break;case"together":M1(h,!1,null,null,void 0);break;default:h.memoizedState=null}return h.child}function X0(l,h){(h.mode&1)===0&&l!==null&&(l.alternate=null,h.alternate=null,h.flags|=2)}function vl(l,h,v){if(l!==null&&(h.dependencies=l.dependencies),cc|=h.lanes,(v&h.childLanes)===0)return null;if(l!==null&&h.child!==l.child)throw Error(t(153));if(h.child!==null){for(l=h.child,v=iu(l,l.pendingProps),h.child=v,v.return=h;l.sibling!==null;)l=l.sibling,v=v.sibling=iu(l,l.pendingProps),v.return=h;v.sibling=null}return h.child}function HT(l,h,v){switch(h.tag){case 3:wn(h),Ao();break;case 5:dl(h);break;case 1:wr(h.type)&&rl(h);break;case 4:nc(h,h.stateNode.containerInfo);break;case 10:var w=h.type._context,C=h.memoizedProps.value;Qn(ll,w._currentValue),w._currentValue=C;break;case 13:if(w=h.memoizedState,w!==null)return w.dehydrated!==null?(Qn(ai,ai.current&1),h.flags|=128,null):(v&h.child.childLanes)!==0?Qa(l,h,v):(Qn(ai,ai.current&1),l=vl(l,h,v),l!==null?l.sibling:null);Qn(ai,ai.current&1);break;case 19:if(w=(v&h.childLanes)!==0,(l.flags&128)!==0){if(w)return iS(l,h,v);h.flags|=128}if(C=h.memoizedState,C!==null&&(C.rendering=null,C.tail=null,C.lastEffect=null),Qn(ai,ai.current),w)break;return null;case 22:case 23:return h.lanes=0,Ae(l,h,v)}return vl(l,h,v)}var rS,w1,sS,aS;rS=function(l,h){for(var v=h.child;v!==null;){if(v.tag===5||v.tag===6)l.appendChild(v.stateNode);else if(v.tag!==4&&v.child!==null){v.child.return=v,v=v.child;continue}if(v===h)break;for(;v.sibling===null;){if(v.return===null||v.return===h)return;v=v.return}v.sibling.return=v.return,v=v.sibling}},w1=function(){},sS=function(l,h,v,w){var C=l.memoizedProps;if(C!==w){l=h.stateNode,Fi(ds.current);var N=null;switch(v){case"input":C=Ne(l,C),w=Ne(l,w),N=[];break;case"select":C=Y({},C,{value:void 0}),w=Y({},w,{value:void 0}),N=[];break;case"textarea":C=He(l,C),w=He(l,w),N=[];break;default:typeof C.onClick!="function"&&typeof w.onClick=="function"&&(l.onclick=ju)}gt(v,w);var j;v=null;for(We in C)if(!w.hasOwnProperty(We)&&C.hasOwnProperty(We)&&C[We]!=null)if(We==="style"){var fe=C[We];for(j in fe)fe.hasOwnProperty(j)&&(v||(v={}),v[j]="")}else We!=="dangerouslySetInnerHTML"&&We!=="children"&&We!=="suppressContentEditableWarning"&&We!=="suppressHydrationWarning"&&We!=="autoFocus"&&(i.hasOwnProperty(We)?N||(N=[]):(N=N||[]).push(We,null));for(We in w){var _e=w[We];if(fe=C?.[We],w.hasOwnProperty(We)&&_e!==fe&&(_e!=null||fe!=null))if(We==="style")if(fe){for(j in fe)!fe.hasOwnProperty(j)||_e&&_e.hasOwnProperty(j)||(v||(v={}),v[j]="");for(j in _e)_e.hasOwnProperty(j)&&fe[j]!==_e[j]&&(v||(v={}),v[j]=_e[j])}else v||(N||(N=[]),N.push(We,v)),v=_e;else We==="dangerouslySetInnerHTML"?(_e=_e?_e.__html:void 0,fe=fe?fe.__html:void 0,_e!=null&&fe!==_e&&(N=N||[]).push(We,_e)):We==="children"?typeof _e!="string"&&typeof _e!="number"||(N=N||[]).push(We,""+_e):We!=="suppressContentEditableWarning"&&We!=="suppressHydrationWarning"&&(i.hasOwnProperty(We)?(_e!=null&&We==="onScroll"&&ti("scroll",l),N||fe===_e||(N=[])):(N=N||[]).push(We,_e))}v&&(N=N||[]).push("style",v);var We=N;(h.updateQueue=We)&&(h.flags|=4)}},aS=function(l,h,v,w){v!==w&&(h.flags|=4)};function Ud(l,h){if(!si)switch(l.tailMode){case"hidden":h=l.tail;for(var v=null;h!==null;)h.alternate!==null&&(v=h),h=h.sibling;v===null?l.tail=null:v.sibling=null;break;case"collapsed":v=l.tail;for(var w=null;v!==null;)v.alternate!==null&&(w=v),v=v.sibling;w===null?h||l.tail===null?l.tail=null:l.tail.sibling=null:w.sibling=null}}function Qr(l){var h=l.alternate!==null&&l.alternate.child===l.child,v=0,w=0;if(h)for(var C=l.child;C!==null;)v|=C.lanes|C.childLanes,w|=C.subtreeFlags&14680064,w|=C.flags&14680064,C.return=l,C=C.sibling;else for(C=l.child;C!==null;)v|=C.lanes|C.childLanes,w|=C.subtreeFlags,w|=C.flags,C.return=l,C=C.sibling;return l.subtreeFlags|=w,l.childLanes=v,h}function WT(l,h,v){var w=h.pendingProps;switch(ja(h),h.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Qr(h),null;case 1:return wr(h.type)&&Xu(),Qr(h),null;case 3:return w=h.stateNode,Po(),ni(Or),ni(dr),ya(),w.pendingContext&&(w.context=w.pendingContext,w.pendingContext=null),(l===null||l.child===null)&&(jl(h)?h.flags|=4:l===null||l.memoizedState.isDehydrated&&(h.flags&256)===0||(h.flags|=1024,Us!==null&&(D1(Us),Us=null))),w1(l,h),Qr(h),null;case 5:Zl(h);var C=Fi(Ya.current);if(v=h.type,l!==null&&h.stateNode!=null)sS(l,h,v,w,C),l.ref!==h.ref&&(h.flags|=512,h.flags|=2097152);else{if(!w){if(h.stateNode===null)throw Error(t(166));return Qr(h),null}if(l=Fi(ds.current),jl(h)){w=h.stateNode,v=h.type;var N=h.memoizedProps;switch(w[Xi]=h,w[Wl]=N,l=(h.mode&1)!==0,v){case"dialog":ti("cancel",w),ti("close",w);break;case"iframe":case"object":case"embed":ti("load",w);break;case"video":case"audio":for(C=0;C<To.length;C++)ti(To[C],w);break;case"source":ti("error",w);break;case"img":case"image":case"link":ti("error",w),ti("load",w);break;case"details":ti("toggle",w);break;case"input":Be(w,N),ti("invalid",w);break;case"select":w._wrapperState={wasMultiple:!!N.multiple},ti("invalid",w);break;case"textarea":q(w,N),ti("invalid",w)}gt(v,N),C=null;for(var j in N)if(N.hasOwnProperty(j)){var fe=N[j];j==="children"?typeof fe=="string"?w.textContent!==fe&&(N.suppressHydrationWarning!==!0&&Wu(w.textContent,fe,l),C=["children",fe]):typeof fe=="number"&&w.textContent!==""+fe&&(N.suppressHydrationWarning!==!0&&Wu(w.textContent,fe,l),C=["children",""+fe]):i.hasOwnProperty(j)&&fe!=null&&j==="onScroll"&&ti("scroll",w)}switch(v){case"input":Ke(w),Q(w,N,!0);break;case"textarea":Ke(w),ue(w);break;case"select":case"option":break;default:typeof N.onClick=="function"&&(w.onclick=ju)}w=C,h.updateQueue=w,w!==null&&(h.flags|=4)}else{j=C.nodeType===9?C:C.ownerDocument,l==="http://www.w3.org/1999/xhtml"&&(l=Re(v)),l==="http://www.w3.org/1999/xhtml"?v==="script"?(l=j.createElement("div"),l.innerHTML="<script><\/script>",l=l.removeChild(l.firstChild)):typeof w.is=="string"?l=j.createElement(v,{is:w.is}):(l=j.createElement(v),v==="select"&&(j=l,w.multiple?j.multiple=!0:w.size&&(j.size=w.size))):l=j.createElementNS(l,v),l[Xi]=h,l[Wl]=w,rS(l,h,!1,!1),h.stateNode=l;e:{switch(j=st(v,w),v){case"dialog":ti("cancel",l),ti("close",l),C=w;break;case"iframe":case"object":case"embed":ti("load",l),C=w;break;case"video":case"audio":for(C=0;C<To.length;C++)ti(To[C],l);C=w;break;case"source":ti("error",l),C=w;break;case"img":case"image":case"link":ti("error",l),ti("load",l),C=w;break;case"details":ti("toggle",l),C=w;break;case"input":Be(l,w),C=Ne(l,w),ti("invalid",l);break;case"option":C=w;break;case"select":l._wrapperState={wasMultiple:!!w.multiple},C=Y({},w,{value:void 0}),ti("invalid",l);break;case"textarea":q(l,w),C=He(l,w),ti("invalid",l);break;default:C=w}gt(v,C),fe=C;for(N in fe)if(fe.hasOwnProperty(N)){var _e=fe[N];N==="style"?Xe(l,_e):N==="dangerouslySetInnerHTML"?(_e=_e?_e.__html:void 0,_e!=null&&ot(l,_e)):N==="children"?typeof _e=="string"?(v!=="textarea"||_e!=="")&&rt(l,_e):typeof _e=="number"&&rt(l,""+_e):N!=="suppressContentEditableWarning"&&N!=="suppressHydrationWarning"&&N!=="autoFocus"&&(i.hasOwnProperty(N)?_e!=null&&N==="onScroll"&&ti("scroll",l):_e!=null&&A(l,N,_e,j))}switch(v){case"input":Ke(l),Q(l,w,!1);break;case"textarea":Ke(l),ue(l);break;case"option":w.value!=null&&l.setAttribute("value",""+ye(w.value));break;case"select":l.multiple=!!w.multiple,N=w.value,N!=null?Ce(l,!!w.multiple,N,!1):w.defaultValue!=null&&Ce(l,!!w.multiple,w.defaultValue,!0);break;default:typeof C.onClick=="function"&&(l.onclick=ju)}switch(v){case"button":case"input":case"select":case"textarea":w=!!w.autoFocus;break e;case"img":w=!0;break e;default:w=!1}}w&&(h.flags|=4)}h.ref!==null&&(h.flags|=512,h.flags|=2097152)}return Qr(h),null;case 6:if(l&&h.stateNode!=null)aS(l,h,l.memoizedProps,w);else{if(typeof w!="string"&&h.stateNode===null)throw Error(t(166));if(v=Fi(Ya.current),Fi(ds.current),jl(h)){if(w=h.stateNode,v=h.memoizedProps,w[Xi]=h,(N=w.nodeValue!==v)&&(l=pr,l!==null))switch(l.tag){case 3:Wu(w.nodeValue,v,(l.mode&1)!==0);break;case 5:l.memoizedProps.suppressHydrationWarning!==!0&&Wu(w.nodeValue,v,(l.mode&1)!==0)}N&&(h.flags|=4)}else w=(v.nodeType===9?v:v.ownerDocument).createTextNode(w),w[Xi]=h,h.stateNode=w}return Qr(h),null;case 13:if(ni(ai),w=h.memoizedState,l===null||l.memoizedState!==null&&l.memoizedState.dehydrated!==null){if(si&&zr!==null&&(h.mode&1)!==0&&(h.flags&128)===0)Md(),Ao(),h.flags|=98560,N=!1;else if(N=jl(h),w!==null&&w.dehydrated!==null){if(l===null){if(!N)throw Error(t(318));if(N=h.memoizedState,N=N!==null?N.dehydrated:null,!N)throw Error(t(317));N[Xi]=h}else Ao(),(h.flags&128)===0&&(h.memoizedState=null),h.flags|=4;Qr(h),N=!1}else Us!==null&&(D1(Us),Us=null),N=!0;if(!N)return h.flags&65536?h:null}return(h.flags&128)!==0?(h.lanes=v,h):(w=w!==null,w!==(l!==null&&l.memoizedState!==null)&&w&&(h.child.flags|=8192,(h.mode&1)!==0&&(l===null||(ai.current&1)!==0?yr===0&&(yr=3):O1())),h.updateQueue!==null&&(h.flags|=4),Qr(h),null);case 4:return Po(),w1(l,h),l===null&&Gl(h.stateNode.containerInfo),Qr(h),null;case 10:return $u(h.type._context),Qr(h),null;case 17:return wr(h.type)&&Xu(),Qr(h),null;case 19:if(ni(ai),N=h.memoizedState,N===null)return Qr(h),null;if(w=(h.flags&128)!==0,j=N.rendering,j===null)if(w)Ud(N,!1);else{if(yr!==0||l!==null&&(l.flags&128)!==0)for(l=h.child;l!==null;){if(j=ta(l),j!==null){for(h.flags|=128,Ud(N,!1),w=j.updateQueue,w!==null&&(h.updateQueue=w,h.flags|=4),h.subtreeFlags=0,w=v,v=h.child;v!==null;)N=v,l=w,N.flags&=14680066,j=N.alternate,j===null?(N.childLanes=0,N.lanes=l,N.child=null,N.subtreeFlags=0,N.memoizedProps=null,N.memoizedState=null,N.updateQueue=null,N.dependencies=null,N.stateNode=null):(N.childLanes=j.childLanes,N.lanes=j.lanes,N.child=j.child,N.subtreeFlags=0,N.deletions=null,N.memoizedProps=j.memoizedProps,N.memoizedState=j.memoizedState,N.updateQueue=j.updateQueue,N.type=j.type,l=j.dependencies,N.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext}),v=v.sibling;return Qn(ai,ai.current&1|2),h.child}l=l.sibling}N.tail!==null&&Ie()>Wh&&(h.flags|=128,w=!0,Ud(N,!1),h.lanes=4194304)}else{if(!w)if(l=ta(j),l!==null){if(h.flags|=128,w=!0,v=l.updateQueue,v!==null&&(h.updateQueue=v,h.flags|=4),Ud(N,!0),N.tail===null&&N.tailMode==="hidden"&&!j.alternate&&!si)return Qr(h),null}else 2*Ie()-N.renderingStartTime>Wh&&v!==1073741824&&(h.flags|=128,w=!0,Ud(N,!1),h.lanes=4194304);N.isBackwards?(j.sibling=h.child,h.child=j):(v=N.last,v!==null?v.sibling=j:h.child=j,N.last=j)}return N.tail!==null?(h=N.tail,N.rendering=h,N.tail=h.sibling,N.renderingStartTime=Ie(),h.sibling=null,v=ai.current,Qn(ai,w?v&1|2:v&1),h):(Qr(h),null);case 22:case 23:return F1(),w=h.memoizedState!==null,l!==null&&l.memoizedState!==null!==w&&(h.flags|=8192),w&&(h.mode&1)!==0?(ra&1073741824)!==0&&(Qr(h),h.subtreeFlags&6&&(h.flags|=8192)):Qr(h),null;case 24:return null;case 25:return null}throw Error(t(156,h.tag))}function jT(l,h){switch(ja(h),h.tag){case 1:return wr(h.type)&&Xu(),l=h.flags,l&65536?(h.flags=l&-65537|128,h):null;case 3:return Po(),ni(Or),ni(dr),ya(),l=h.flags,(l&65536)!==0&&(l&128)===0?(h.flags=l&-65537|128,h):null;case 5:return Zl(h),null;case 13:if(ni(ai),l=h.memoizedState,l!==null&&l.dehydrated!==null){if(h.alternate===null)throw Error(t(340));Ao()}return l=h.flags,l&65536?(h.flags=l&-65537|128,h):null;case 19:return ni(ai),null;case 4:return Po(),null;case 10:return $u(h.type._context),null;case 22:case 23:return F1(),null;case 24:return null;default:return null}}var q0=!1,$r=!1,XT=typeof WeakSet=="function"?WeakSet:Set,Qt=null;function Vh(l,h){var v=l.ref;if(v!==null)if(typeof v=="function")try{v(null)}catch(w){ki(l,h,w)}else v.current=null}function E1(l,h,v){try{v()}catch(w){ki(l,h,w)}}var oS=!1;function qT(l,h){if(Hl=tr,l=_i(),rr(l)){if("selectionStart"in l)var v={start:l.selectionStart,end:l.selectionEnd};else e:{v=(v=l.ownerDocument)&&v.defaultView||window;var w=v.getSelection&&v.getSelection();if(w&&w.rangeCount!==0){v=w.anchorNode;var C=w.anchorOffset,N=w.focusNode;w=w.focusOffset;try{v.nodeType,N.nodeType}catch{v=null;break e}var j=0,fe=-1,_e=-1,We=0,xt=0,wt=l,yt=null;t:for(;;){for(var qt;wt!==v||C!==0&&wt.nodeType!==3||(fe=j+C),wt!==N||w!==0&&wt.nodeType!==3||(_e=j+w),wt.nodeType===3&&(j+=wt.nodeValue.length),(qt=wt.firstChild)!==null;)yt=wt,wt=qt;for(;;){if(wt===l)break t;if(yt===v&&++We===C&&(fe=j),yt===N&&++xt===w&&(_e=j),(qt=wt.nextSibling)!==null)break;wt=yt,yt=wt.parentNode}wt=qt}v=fe===-1||_e===-1?null:{start:fe,end:_e}}else v=null}v=v||{start:0,end:0}}else v=null;for(cd={focusedElem:l,selectionRange:v},tr=!1,Qt=h;Qt!==null;)if(h=Qt,l=h.child,(h.subtreeFlags&1028)!==0&&l!==null)l.return=h,Qt=l;else for(;Qt!==null;){h=Qt;try{var tn=h.alternate;if((h.flags&1024)!==0)switch(h.tag){case 0:case 11:case 15:break;case 1:if(tn!==null){var rn=tn.memoizedProps,qi=tn.memoizedState,Le=h.stateNode,we=Le.getSnapshotBeforeUpdate(h.elementType===h.type?rn:Fs(h.type,rn),qi);Le.__reactInternalSnapshotBeforeUpdate=we}break;case 3:var Fe=h.stateNode.containerInfo;Fe.nodeType===1?Fe.textContent="":Fe.nodeType===9&&Fe.documentElement&&Fe.removeChild(Fe.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(Ct){ki(h,h.return,Ct)}if(l=h.sibling,l!==null){l.return=h.return,Qt=l;break}Qt=h.return}return tn=oS,oS=!1,tn}function Fd(l,h,v){var w=h.updateQueue;if(w=w!==null?w.lastEffect:null,w!==null){var C=w=w.next;do{if((C.tag&l)===l){var N=C.destroy;C.destroy=void 0,N!==void 0&&E1(h,v,N)}C=C.next}while(C!==w)}}function Y0(l,h){if(h=h.updateQueue,h=h!==null?h.lastEffect:null,h!==null){var v=h=h.next;do{if((v.tag&l)===l){var w=v.create;v.destroy=w()}v=v.next}while(v!==h)}}function T1(l){var h=l.ref;if(h!==null){var v=l.stateNode;switch(l.tag){case 5:l=v;break;default:l=v}typeof h=="function"?h(l):h.current=l}}function lS(l){var h=l.alternate;h!==null&&(l.alternate=null,lS(h)),l.child=null,l.deletions=null,l.sibling=null,l.tag===5&&(h=l.stateNode,h!==null&&(delete h[Xi],delete h[Wl],delete h[nl],delete h[Th],delete h[bh])),l.stateNode=null,l.return=null,l.dependencies=null,l.memoizedProps=null,l.memoizedState=null,l.pendingProps=null,l.stateNode=null,l.updateQueue=null}function uS(l){return l.tag===5||l.tag===3||l.tag===4}function cS(l){e:for(;;){for(;l.sibling===null;){if(l.return===null||uS(l.return))return null;l=l.return}for(l.sibling.return=l.return,l=l.sibling;l.tag!==5&&l.tag!==6&&l.tag!==18;){if(l.flags&2||l.child===null||l.tag===4)continue e;l.child.return=l,l=l.child}if(!(l.flags&2))return l.stateNode}}function b1(l,h,v){var w=l.tag;if(w===5||w===6)l=l.stateNode,h?v.nodeType===8?v.parentNode.insertBefore(l,h):v.insertBefore(l,h):(v.nodeType===8?(h=v.parentNode,h.insertBefore(l,v)):(h=v,h.appendChild(l)),v=v._reactRootContainer,v!=null||h.onclick!==null||(h.onclick=ju));else if(w!==4&&(l=l.child,l!==null))for(b1(l,h,v),l=l.sibling;l!==null;)b1(l,h,v),l=l.sibling}function A1(l,h,v){var w=l.tag;if(w===5||w===6)l=l.stateNode,h?v.insertBefore(l,h):v.appendChild(l);else if(w!==4&&(l=l.child,l!==null))for(A1(l,h,v),l=l.sibling;l!==null;)A1(l,h,v),l=l.sibling}var Gr=null,$a=!1;function Ql(l,h,v){for(v=v.child;v!==null;)hS(l,h,v),v=v.sibling}function hS(l,h,v){if(Je&&typeof Je.onCommitFiberUnmount=="function")try{Je.onCommitFiberUnmount(ut,v)}catch{}switch(v.tag){case 5:$r||Vh(v,h);case 6:var w=Gr,C=$a;Gr=null,Ql(l,h,v),Gr=w,$a=C,Gr!==null&&($a?(l=Gr,v=v.stateNode,l.nodeType===8?l.parentNode.removeChild(v):l.removeChild(v)):Gr.removeChild(v.stateNode));break;case 18:Gr!==null&&($a?(l=Gr,v=v.stateNode,l.nodeType===8?Eh(l.parentNode,v):l.nodeType===1&&Eh(l,v),vo(l)):Eh(Gr,v.stateNode));break;case 4:w=Gr,C=$a,Gr=v.stateNode.containerInfo,$a=!0,Ql(l,h,v),Gr=w,$a=C;break;case 0:case 11:case 14:case 15:if(!$r&&(w=v.updateQueue,w!==null&&(w=w.lastEffect,w!==null))){C=w=w.next;do{var N=C,j=N.destroy;N=N.tag,j!==void 0&&((N&2)!==0||(N&4)!==0)&&E1(v,h,j),C=C.next}while(C!==w)}Ql(l,h,v);break;case 1:if(!$r&&(Vh(v,h),w=v.stateNode,typeof w.componentWillUnmount=="function"))try{w.props=v.memoizedProps,w.state=v.memoizedState,w.componentWillUnmount()}catch(fe){ki(v,h,fe)}Ql(l,h,v);break;case 21:Ql(l,h,v);break;case 22:v.mode&1?($r=(w=$r)||v.memoizedState!==null,Ql(l,h,v),$r=w):Ql(l,h,v);break;default:Ql(l,h,v)}}function fS(l){var h=l.updateQueue;if(h!==null){l.updateQueue=null;var v=l.stateNode;v===null&&(v=l.stateNode=new XT),h.forEach(function(w){var C=nb.bind(null,l,w);v.has(w)||(v.add(w),w.then(C,C))})}}function eo(l,h){var v=h.deletions;if(v!==null)for(var w=0;w<v.length;w++){var C=v[w];try{var N=l,j=h,fe=j;e:for(;fe!==null;){switch(fe.tag){case 5:Gr=fe.stateNode,$a=!1;break e;case 3:Gr=fe.stateNode.containerInfo,$a=!0;break e;case 4:Gr=fe.stateNode.containerInfo,$a=!0;break e}fe=fe.return}if(Gr===null)throw Error(t(160));hS(N,j,C),Gr=null,$a=!1;var _e=C.alternate;_e!==null&&(_e.return=null),C.return=null}catch(We){ki(C,h,We)}}if(h.subtreeFlags&12854)for(h=h.child;h!==null;)dS(h,l),h=h.sibling}function dS(l,h){var v=l.alternate,w=l.flags;switch(l.tag){case 0:case 11:case 14:case 15:if(eo(h,l),Io(l),w&4){try{Fd(3,l,l.return),Y0(3,l)}catch(rn){ki(l,l.return,rn)}try{Fd(5,l,l.return)}catch(rn){ki(l,l.return,rn)}}break;case 1:eo(h,l),Io(l),w&512&&v!==null&&Vh(v,v.return);break;case 5:if(eo(h,l),Io(l),w&512&&v!==null&&Vh(v,v.return),l.flags&32){var C=l.stateNode;try{rt(C,"")}catch(rn){ki(l,l.return,rn)}}if(w&4&&(C=l.stateNode,C!=null)){var N=l.memoizedProps,j=v!==null?v.memoizedProps:N,fe=l.type,_e=l.updateQueue;if(l.updateQueue=null,_e!==null)try{fe==="input"&&N.type==="radio"&&N.name!=null&&De(C,N),st(fe,j);var We=st(fe,N);for(j=0;j<_e.length;j+=2){var xt=_e[j],wt=_e[j+1];xt==="style"?Xe(C,wt):xt==="dangerouslySetInnerHTML"?ot(C,wt):xt==="children"?rt(C,wt):A(C,xt,wt,We)}switch(fe){case"input":it(C,N);break;case"textarea":B(C,N);break;case"select":var yt=C._wrapperState.wasMultiple;C._wrapperState.wasMultiple=!!N.multiple;var qt=N.value;qt!=null?Ce(C,!!N.multiple,qt,!1):yt!==!!N.multiple&&(N.defaultValue!=null?Ce(C,!!N.multiple,N.defaultValue,!0):Ce(C,!!N.multiple,N.multiple?[]:"",!1))}C[Wl]=N}catch(rn){ki(l,l.return,rn)}}break;case 6:if(eo(h,l),Io(l),w&4){if(l.stateNode===null)throw Error(t(162));C=l.stateNode,N=l.memoizedProps;try{C.nodeValue=N}catch(rn){ki(l,l.return,rn)}}break;case 3:if(eo(h,l),Io(l),w&4&&v!==null&&v.memoizedState.isDehydrated)try{vo(h.containerInfo)}catch(rn){ki(l,l.return,rn)}break;case 4:eo(h,l),Io(l);break;case 13:eo(h,l),Io(l),C=l.child,C.flags&8192&&(N=C.memoizedState!==null,C.stateNode.isHidden=N,!N||C.alternate!==null&&C.alternate.memoizedState!==null||(R1=Ie())),w&4&&fS(l);break;case 22:if(xt=v!==null&&v.memoizedState!==null,l.mode&1?($r=(We=$r)||xt,eo(h,l),$r=We):eo(h,l),Io(l),w&8192){if(We=l.memoizedState!==null,(l.stateNode.isHidden=We)&&!xt&&(l.mode&1)!==0)for(Qt=l,xt=l.child;xt!==null;){for(wt=Qt=xt;Qt!==null;){switch(yt=Qt,qt=yt.child,yt.tag){case 0:case 11:case 14:case 15:Fd(4,yt,yt.return);break;case 1:Vh(yt,yt.return);var tn=yt.stateNode;if(typeof tn.componentWillUnmount=="function"){w=yt,v=yt.return;try{h=w,tn.props=h.memoizedProps,tn.state=h.memoizedState,tn.componentWillUnmount()}catch(rn){ki(w,v,rn)}}break;case 5:Vh(yt,yt.return);break;case 22:if(yt.memoizedState!==null){gS(wt);continue}}qt!==null?(qt.return=yt,Qt=qt):gS(wt)}xt=xt.sibling}e:for(xt=null,wt=l;;){if(wt.tag===5){if(xt===null){xt=wt;try{C=wt.stateNode,We?(N=C.style,typeof N.setProperty=="function"?N.setProperty("display","none","important"):N.display="none"):(fe=wt.stateNode,_e=wt.memoizedProps.style,j=_e!=null&&_e.hasOwnProperty("display")?_e.display:null,fe.style.display=Ge("display",j))}catch(rn){ki(l,l.return,rn)}}}else if(wt.tag===6){if(xt===null)try{wt.stateNode.nodeValue=We?"":wt.memoizedProps}catch(rn){ki(l,l.return,rn)}}else if((wt.tag!==22&&wt.tag!==23||wt.memoizedState===null||wt===l)&&wt.child!==null){wt.child.return=wt,wt=wt.child;continue}if(wt===l)break e;for(;wt.sibling===null;){if(wt.return===null||wt.return===l)break e;xt===wt&&(xt=null),wt=wt.return}xt===wt&&(xt=null),wt.sibling.return=wt.return,wt=wt.sibling}}break;case 19:eo(h,l),Io(l),w&4&&fS(l);break;case 21:break;default:eo(h,l),Io(l)}}function Io(l){var h=l.flags;if(h&2){try{e:{for(var v=l.return;v!==null;){if(uS(v)){var w=v;break e}v=v.return}throw Error(t(160))}switch(w.tag){case 5:var C=w.stateNode;w.flags&32&&(rt(C,""),w.flags&=-33);var N=cS(l);A1(l,N,C);break;case 3:case 4:var j=w.stateNode.containerInfo,fe=cS(l);b1(l,fe,j);break;default:throw Error(t(161))}}catch(_e){ki(l,l.return,_e)}l.flags&=-3}h&4096&&(l.flags&=-4097)}function YT(l,h,v){Qt=l,pS(l)}function pS(l,h,v){for(var w=(l.mode&1)!==0;Qt!==null;){var C=Qt,N=C.child;if(C.tag===22&&w){var j=C.memoizedState!==null||q0;if(!j){var fe=C.alternate,_e=fe!==null&&fe.memoizedState!==null||$r;fe=q0;var We=$r;if(q0=j,($r=_e)&&!We)for(Qt=C;Qt!==null;)j=Qt,_e=j.child,j.tag===22&&j.memoizedState!==null?vS(C):_e!==null?(_e.return=j,Qt=_e):vS(C);for(;N!==null;)Qt=N,pS(N),N=N.sibling;Qt=C,q0=fe,$r=We}mS(l)}else(C.subtreeFlags&8772)!==0&&N!==null?(N.return=C,Qt=N):mS(l)}}function mS(l){for(;Qt!==null;){var h=Qt;if((h.flags&8772)!==0){var v=h.alternate;try{if((h.flags&8772)!==0)switch(h.tag){case 0:case 11:case 15:$r||Y0(5,h);break;case 1:var w=h.stateNode;if(h.flags&4&&!$r)if(v===null)w.componentDidMount();else{var C=h.elementType===h.type?v.memoizedProps:Fs(h.type,v.memoizedProps);w.componentDidUpdate(C,v.memoizedState,w.__reactInternalSnapshotBeforeUpdate)}var N=h.updateQueue;N!==null&&Yl(h,N,w);break;case 3:var j=h.updateQueue;if(j!==null){if(v=null,h.child!==null)switch(h.child.tag){case 5:v=h.child.stateNode;break;case 1:v=h.child.stateNode}Yl(h,j,v)}break;case 5:var fe=h.stateNode;if(v===null&&h.flags&4){v=fe;var _e=h.memoizedProps;switch(h.type){case"button":case"input":case"select":case"textarea":_e.autoFocus&&v.focus();break;case"img":_e.src&&(v.src=_e.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(h.memoizedState===null){var We=h.alternate;if(We!==null){var xt=We.memoizedState;if(xt!==null){var wt=xt.dehydrated;wt!==null&&vo(wt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}$r||h.flags&512&&T1(h)}catch(yt){ki(h,h.return,yt)}}if(h===l){Qt=null;break}if(v=h.sibling,v!==null){v.return=h.return,Qt=v;break}Qt=h.return}}function gS(l){for(;Qt!==null;){var h=Qt;if(h===l){Qt=null;break}var v=h.sibling;if(v!==null){v.return=h.return,Qt=v;break}Qt=h.return}}function vS(l){for(;Qt!==null;){var h=Qt;try{switch(h.tag){case 0:case 11:case 15:var v=h.return;try{Y0(4,h)}catch(_e){ki(h,v,_e)}break;case 1:var w=h.stateNode;if(typeof w.componentDidMount=="function"){var C=h.return;try{w.componentDidMount()}catch(_e){ki(h,C,_e)}}var N=h.return;try{T1(h)}catch(_e){ki(h,N,_e)}break;case 5:var j=h.return;try{T1(h)}catch(_e){ki(h,j,_e)}}}catch(_e){ki(h,h.return,_e)}if(h===l){Qt=null;break}var fe=h.sibling;if(fe!==null){fe.return=h.return,Qt=fe;break}Qt=h.return}}var ZT=Math.ceil,Z0=P.ReactCurrentDispatcher,C1=P.ReactCurrentOwner,xa=P.ReactCurrentBatchConfig,Gn=0,br=null,ur=null,Vr=0,ra=0,Hh=wi(0),yr=0,Od=null,cc=0,J0=0,P1=0,kd=null,Os=null,R1=0,Wh=1/0,yl=null,K0=!1,I1=null,$l=null,Q0=!1,eu=null,$0=0,zd=0,L1=null,em=-1,tm=0;function vs(){return(Gn&6)!==0?Ie():em!==-1?em:em=Ie()}function tu(l){return(l.mode&1)===0?1:(Gn&2)!==0&&Vr!==0?Vr&-Vr:x1.transition!==null?(tm===0&&(tm=bn()),tm):(l=cn,l!==0||(l=window.event,l=l===void 0?16:_o(l.type)),l)}function to(l,h,v,w){if(50<zd)throw zd=0,L1=null,Error(t(185));In(l,v,w),((Gn&2)===0||l!==br)&&(l===br&&((Gn&2)===0&&(J0|=v),yr===4&&nu(l,Vr)),ks(l,w),v===1&&Gn===0&&(h.mode&1)===0&&(Wh=Ie()+500,Yu&&ga()))}function ks(l,h){var v=l.callbackNode;$t(l,h);var w=Kt(l,l===br?Vr:0);if(w===0)v!==null&&Et(v),l.callbackNode=null,l.callbackPriority=0;else if(h=w&-w,l.callbackPriority!==h){if(v!=null&&Et(v),h===1)l.tag===0?D0(_S.bind(null,l)):Zu(_S.bind(null,l)),_1(function(){(Gn&6)===0&&ga()}),v=null;else{switch(gi(w)){case 1:v=de;break;case 4:v=xe;break;case 16:v=Me;break;case 536870912:v=lt;break;default:v=Me}v=AS(v,yS.bind(null,l))}l.callbackPriority=h,l.callbackNode=v}}function yS(l,h){if(em=-1,tm=0,(Gn&6)!==0)throw Error(t(327));var v=l.callbackNode;if(jh()&&l.callbackNode!==v)return null;var w=Kt(l,l===br?Vr:0);if(w===0)return null;if((w&30)!==0||(w&l.expiredLanes)!==0||h)h=nm(l,w);else{h=w;var C=Gn;Gn|=2;var N=SS();(br!==l||Vr!==h)&&(yl=null,Wh=Ie()+500,fc(l,h));do try{QT();break}catch(fe){xS(l,fe)}while(!0);cl(),Z0.current=N,Gn=C,ur!==null?h=0:(br=null,Vr=0,h=yr)}if(h!==0){if(h===2&&(C=Dt(l),C!==0&&(w=C,h=N1(l,C))),h===1)throw v=Od,fc(l,0),nu(l,w),ks(l,Ie()),v;if(h===6)nu(l,w);else{if(C=l.current.alternate,(w&30)===0&&!JT(C)&&(h=nm(l,w),h===2&&(N=Dt(l),N!==0&&(w=N,h=N1(l,N))),h===1))throw v=Od,fc(l,0),nu(l,w),ks(l,Ie()),v;switch(l.finishedWork=C,l.finishedLanes=w,h){case 0:case 1:throw Error(t(345));case 2:dc(l,Os,yl);break;case 3:if(nu(l,w),(w&130023424)===w&&(h=R1+500-Ie(),10<h)){if(Kt(l,0)!==0)break;if(C=l.suspendedLanes,(C&w)!==w){vs(),l.pingedLanes|=l.suspendedLanes&C;break}l.timeoutHandle=fd(dc.bind(null,l,Os,yl),h);break}dc(l,Os,yl);break;case 4:if(nu(l,w),(w&4194240)===w)break;for(h=l.eventTimes,C=-1;0<w;){var j=31-ft(w);N=1<<j,j=h[j],j>C&&(C=j),w&=~N}if(w=C,w=Ie()-w,w=(120>w?120:480>w?480:1080>w?1080:1920>w?1920:3e3>w?3e3:4320>w?4320:1960*ZT(w/1960))-w,10<w){l.timeoutHandle=fd(dc.bind(null,l,Os,yl),w);break}dc(l,Os,yl);break;case 5:dc(l,Os,yl);break;default:throw Error(t(329))}}}return ks(l,Ie()),l.callbackNode===v?yS.bind(null,l):null}function N1(l,h){var v=kd;return l.current.memoizedState.isDehydrated&&(fc(l,h).flags|=256),l=nm(l,h),l!==2&&(h=Os,Os=v,h!==null&&D1(h)),l}function D1(l){Os===null?Os=l:Os.push.apply(Os,l)}function JT(l){for(var h=l;;){if(h.flags&16384){var v=h.updateQueue;if(v!==null&&(v=v.stores,v!==null))for(var w=0;w<v.length;w++){var C=v[w],N=C.getSnapshot;C=C.value;try{if(!us(N(),C))return!1}catch{return!1}}}if(v=h.child,h.subtreeFlags&16384&&v!==null)v.return=h,h=v;else{if(h===l)break;for(;h.sibling===null;){if(h.return===null||h.return===l)return!0;h=h.return}h.sibling.return=h.return,h=h.sibling}}return!0}function nu(l,h){for(h&=~P1,h&=~J0,l.suspendedLanes|=h,l.pingedLanes&=~h,l=l.expirationTimes;0<h;){var v=31-ft(h),w=1<<v;l[v]=-1,h&=~w}}function _S(l){if((Gn&6)!==0)throw Error(t(327));jh();var h=Kt(l,0);if((h&1)===0)return ks(l,Ie()),null;var v=nm(l,h);if(l.tag!==0&&v===2){var w=Dt(l);w!==0&&(h=w,v=N1(l,w))}if(v===1)throw v=Od,fc(l,0),nu(l,h),ks(l,Ie()),v;if(v===6)throw Error(t(345));return l.finishedWork=l.current.alternate,l.finishedLanes=h,dc(l,Os,yl),ks(l,Ie()),null}function U1(l,h){var v=Gn;Gn|=1;try{return l(h)}finally{Gn=v,Gn===0&&(Wh=Ie()+500,Yu&&ga())}}function hc(l){eu!==null&&eu.tag===0&&(Gn&6)===0&&jh();var h=Gn;Gn|=1;var v=xa.transition,w=cn;try{if(xa.transition=null,cn=1,l)return l()}finally{cn=w,xa.transition=v,Gn=h,(Gn&6)===0&&ga()}}function F1(){ra=Hh.current,ni(Hh)}function fc(l,h){l.finishedWork=null,l.finishedLanes=0;var v=l.timeoutHandle;if(v!==-1&&(l.timeoutHandle=-1,dd(v)),ur!==null)for(v=ur.return;v!==null;){var w=v;switch(ja(w),w.tag){case 1:w=w.type.childContextTypes,w!=null&&Xu();break;case 3:Po(),ni(Or),ni(dr),ya();break;case 5:Zl(w);break;case 4:Po();break;case 13:ni(ai);break;case 19:ni(ai);break;case 10:$u(w.type._context);break;case 22:case 23:F1()}v=v.return}if(br=l,ur=l=iu(l.current,null),Vr=ra=h,yr=0,Od=null,P1=J0=cc=0,Os=kd=null,qa!==null){for(h=0;h<qa.length;h++)if(v=qa[h],w=v.interleaved,w!==null){v.interleaved=null;var C=w.next,N=v.pending;if(N!==null){var j=N.next;N.next=C,w.next=j}v.pending=w}qa=null}return l}function xS(l,h){do{var v=ur;try{if(cl(),pl.current=Bh,na){for(var w=ii.memoizedState;w!==null;){var C=w.queue;C!==null&&(C.pending=null),w=w.next}na=!1}if(Za=0,Bn=Ti=ii=null,Tr=!1,Ro=0,C1.current=null,v===null||v.return===null){yr=1,Od=h,ur=null;break}e:{var N=l,j=v.return,fe=v,_e=h;if(h=Vr,fe.flags|=32768,_e!==null&&typeof _e=="object"&&typeof _e.then=="function"){var We=_e,xt=fe,wt=xt.tag;if((xt.mode&1)===0&&(wt===0||wt===11||wt===15)){var yt=xt.alternate;yt?(xt.updateQueue=yt.updateQueue,xt.memoizedState=yt.memoizedState,xt.lanes=yt.lanes):(xt.updateQueue=null,xt.memoizedState=null)}var qt=Zt(j);if(qt!==null){qt.flags&=-257,Mn(qt,j,fe,N,h),qt.mode&1&&bt(N,We,h),h=qt,_e=We;var tn=h.updateQueue;if(tn===null){var rn=new Set;rn.add(_e),h.updateQueue=rn}else tn.add(_e);break e}else{if((h&1)===0){bt(N,We,h),O1();break e}_e=Error(t(426))}}else if(si&&fe.mode&1){var qi=Zt(j);if(qi!==null){(qi.flags&65536)===0&&(qi.flags|=256),Mn(qi,j,fe,N,h),Xl(b(_e,fe));break e}}N=_e=b(_e,fe),yr!==4&&(yr=2),kd===null?kd=[N]:kd.push(N),N=j;do{switch(N.tag){case 3:N.flags|=65536,h&=-h,N.lanes|=h;var Le=be(N,_e,h);hl(N,Le);break e;case 1:fe=_e;var we=N.type,Fe=N.stateNode;if((N.flags&128)===0&&(typeof we.getDerivedStateFromError=="function"||Fe!==null&&typeof Fe.componentDidCatch=="function"&&($l===null||!$l.has(Fe)))){N.flags|=65536,h&=-h,N.lanes|=h;var Ct=$e(N,fe,h);hl(N,Ct);break e}}N=N.return}while(N!==null)}wS(v)}catch(an){h=an,ur===v&&v!==null&&(ur=v=v.return);continue}break}while(!0)}function SS(){var l=Z0.current;return Z0.current=Bh,l===null?Bh:l}function O1(){(yr===0||yr===3||yr===2)&&(yr=4),br===null||(cc&268435455)===0&&(J0&268435455)===0||nu(br,Vr)}function nm(l,h){var v=Gn;Gn|=2;var w=SS();(br!==l||Vr!==h)&&(yl=null,fc(l,h));do try{KT();break}catch(C){xS(l,C)}while(!0);if(cl(),Gn=v,Z0.current=w,ur!==null)throw Error(t(261));return br=null,Vr=0,yr}function KT(){for(;ur!==null;)MS(ur)}function QT(){for(;ur!==null&&!Tt();)MS(ur)}function MS(l){var h=bS(l.alternate,l,ra);l.memoizedProps=l.pendingProps,h===null?wS(l):ur=h,C1.current=null}function wS(l){var h=l;do{var v=h.alternate;if(l=h.return,(h.flags&32768)===0){if(v=WT(v,h,ra),v!==null){ur=v;return}}else{if(v=jT(v,h),v!==null){v.flags&=32767,ur=v;return}if(l!==null)l.flags|=32768,l.subtreeFlags=0,l.deletions=null;else{yr=6,ur=null;return}}if(h=h.sibling,h!==null){ur=h;return}ur=h=l}while(h!==null);yr===0&&(yr=5)}function dc(l,h,v){var w=cn,C=xa.transition;try{xa.transition=null,cn=1,$T(l,h,v,w)}finally{xa.transition=C,cn=w}return null}function $T(l,h,v,w){do jh();while(eu!==null);if((Gn&6)!==0)throw Error(t(327));v=l.finishedWork;var C=l.finishedLanes;if(v===null)return null;if(l.finishedWork=null,l.finishedLanes=0,v===l.current)throw Error(t(177));l.callbackNode=null,l.callbackPriority=0;var N=v.lanes|v.childLanes;if(Hi(l,N),l===br&&(ur=br=null,Vr=0),(v.subtreeFlags&2064)===0&&(v.flags&2064)===0||Q0||(Q0=!0,AS(Me,function(){return jh(),null})),N=(v.flags&15990)!==0,(v.subtreeFlags&15990)!==0||N){N=xa.transition,xa.transition=null;var j=cn;cn=1;var fe=Gn;Gn|=4,C1.current=null,qT(l,v),dS(v,l),sr(cd),tr=!!Hl,cd=Hl=null,l.current=v,YT(v),At(),Gn=fe,cn=j,xa.transition=N}else l.current=v;if(Q0&&(Q0=!1,eu=l,$0=C),N=l.pendingLanes,N===0&&($l=null),ht(v.stateNode),ks(l,Ie()),h!==null)for(w=l.onRecoverableError,v=0;v<h.length;v++)C=h[v],w(C.value,{componentStack:C.stack,digest:C.digest});if(K0)throw K0=!1,l=I1,I1=null,l;return($0&1)!==0&&l.tag!==0&&jh(),N=l.pendingLanes,(N&1)!==0?l===L1?zd++:(zd=0,L1=l):zd=0,ga(),null}function jh(){if(eu!==null){var l=gi($0),h=xa.transition,v=cn;try{if(xa.transition=null,cn=16>l?16:l,eu===null)var w=!1;else{if(l=eu,eu=null,$0=0,(Gn&6)!==0)throw Error(t(331));var C=Gn;for(Gn|=4,Qt=l.current;Qt!==null;){var N=Qt,j=N.child;if((Qt.flags&16)!==0){var fe=N.deletions;if(fe!==null){for(var _e=0;_e<fe.length;_e++){var We=fe[_e];for(Qt=We;Qt!==null;){var xt=Qt;switch(xt.tag){case 0:case 11:case 15:Fd(8,xt,N)}var wt=xt.child;if(wt!==null)wt.return=xt,Qt=wt;else for(;Qt!==null;){xt=Qt;var yt=xt.sibling,qt=xt.return;if(lS(xt),xt===We){Qt=null;break}if(yt!==null){yt.return=qt,Qt=yt;break}Qt=qt}}}var tn=N.alternate;if(tn!==null){var rn=tn.child;if(rn!==null){tn.child=null;do{var qi=rn.sibling;rn.sibling=null,rn=qi}while(rn!==null)}}Qt=N}}if((N.subtreeFlags&2064)!==0&&j!==null)j.return=N,Qt=j;else e:for(;Qt!==null;){if(N=Qt,(N.flags&2048)!==0)switch(N.tag){case 0:case 11:case 15:Fd(9,N,N.return)}var Le=N.sibling;if(Le!==null){Le.return=N.return,Qt=Le;break e}Qt=N.return}}var we=l.current;for(Qt=we;Qt!==null;){j=Qt;var Fe=j.child;if((j.subtreeFlags&2064)!==0&&Fe!==null)Fe.return=j,Qt=Fe;else e:for(j=we;Qt!==null;){if(fe=Qt,(fe.flags&2048)!==0)try{switch(fe.tag){case 0:case 11:case 15:Y0(9,fe)}}catch(an){ki(fe,fe.return,an)}if(fe===j){Qt=null;break e}var Ct=fe.sibling;if(Ct!==null){Ct.return=fe.return,Qt=Ct;break e}Qt=fe.return}}if(Gn=C,ga(),Je&&typeof Je.onPostCommitFiberRoot=="function")try{Je.onPostCommitFiberRoot(ut,l)}catch{}w=!0}return w}finally{cn=v,xa.transition=h}}return!1}function ES(l,h,v){h=b(v,h),h=be(l,h,1),l=fi(l,h,1),h=vs(),l!==null&&(In(l,1,h),ks(l,h))}function ki(l,h,v){if(l.tag===3)ES(l,l,v);else for(;h!==null;){if(h.tag===3){ES(h,l,v);break}else if(h.tag===1){var w=h.stateNode;if(typeof h.type.getDerivedStateFromError=="function"||typeof w.componentDidCatch=="function"&&($l===null||!$l.has(w))){l=b(v,l),l=$e(h,l,1),h=fi(h,l,1),l=vs(),h!==null&&(In(h,1,l),ks(h,l));break}}h=h.return}}function eb(l,h,v){var w=l.pingCache;w!==null&&w.delete(h),h=vs(),l.pingedLanes|=l.suspendedLanes&v,br===l&&(Vr&v)===v&&(yr===4||yr===3&&(Vr&130023424)===Vr&&500>Ie()-R1?fc(l,0):P1|=v),ks(l,h)}function TS(l,h){h===0&&((l.mode&1)===0?h=1:(h=dn,dn<<=1,(dn&130023424)===0&&(dn=4194304)));var v=vs();l=ea(l,h),l!==null&&(In(l,h,v),ks(l,v))}function tb(l){var h=l.memoizedState,v=0;h!==null&&(v=h.retryLane),TS(l,v)}function nb(l,h){var v=0;switch(l.tag){case 13:var w=l.stateNode,C=l.memoizedState;C!==null&&(v=C.retryLane);break;case 19:w=l.stateNode;break;default:throw Error(t(314))}w!==null&&w.delete(h),TS(l,v)}var bS;bS=function(l,h,v){if(l!==null)if(l.memoizedProps!==h.pendingProps||Or.current)Cn=!0;else{if((l.lanes&v)===0&&(h.flags&128)===0)return Cn=!1,HT(l,h,v);Cn=(l.flags&131072)!==0}else Cn=!1,si&&(h.flags&1048576)!==0&&yd(h,Rh,h.index);switch(h.lanes=0,h.tag){case 2:var w=h.type;X0(l,h),l=h.pendingProps;var C=il(h,dr.current);Co(h,v),C=rc(null,h,w,l,C,v);var N=bd();return h.flags|=1,typeof C=="object"&&C!==null&&typeof C.render=="function"&&C.$$typeof===void 0?(h.tag=1,h.memoizedState=null,h.updateQueue=null,wr(w)?(N=!0,rl(h)):N=!1,h.memoizedState=C.state!==null&&C.state!==void 0?C.state:null,An(h),C.updater=Gh,h.stateNode=C,C._reactInternals=h,M(h,w,l,v),h=En(null,h,w,!0,N,v)):(h.tag=0,si&&N&&_d(h),Wt(null,h,C,v),h=h.child),h;case 16:w=h.elementType;e:{switch(X0(l,h),l=h.pendingProps,C=w._init,w=C(w._payload),h.type=w,C=h.tag=rb(w),l=Fs(w,l),C){case 0:h=Bt(null,h,w,l,v);break e;case 1:h=sn(null,h,w,l,v);break e;case 11:h=vr(null,h,w,l,v);break e;case 14:h=gs(null,h,w,Fs(w.type,l),v);break e}throw Error(t(306,w,""))}return h;case 0:return w=h.type,C=h.pendingProps,C=h.elementType===w?C:Fs(w,C),Bt(l,h,w,C,v);case 1:return w=h.type,C=h.pendingProps,C=h.elementType===w?C:Fs(w,C),sn(l,h,w,C,v);case 3:e:{if(wn(h),l===null)throw Error(t(387));w=h.pendingProps,N=h.memoizedState,C=N.element,Ii(l,h),Ei(h,w,null,v);var j=h.memoizedState;if(w=j.element,N.isDehydrated)if(N={element:w,isDehydrated:!1,cache:j.cache,pendingSuspenseBoundaries:j.pendingSuspenseBoundaries,transitions:j.transitions},h.updateQueue.baseState=N,h.memoizedState=N,h.flags&256){C=b(Error(t(423)),h),h=On(l,h,w,v,C);break e}else if(w!==C){C=b(Error(t(424)),h),h=On(l,h,w,v,C);break e}else for(zr=Ba(h.stateNode.containerInfo.firstChild),pr=h,si=!0,Us=null,v=Qu(h,null,w,v),h.child=v;v;)v.flags=v.flags&-3|4096,v=v.sibling;else{if(Ao(),w===C){h=vl(l,h,v);break e}Wt(l,h,w,v)}h=h.child}return h;case 5:return dl(h),l===null&&Lh(h),w=h.type,C=h.pendingProps,N=l!==null?l.memoizedProps:null,j=C.children,hd(w,C)?j=null:N!==null&&hd(w,N)&&(h.flags|=32),Ze(l,h),Wt(l,h,j,v),h.child;case 6:return l===null&&Lh(h),null;case 13:return Qa(l,h,v);case 4:return nc(h,h.stateNode.containerInfo),w=h.pendingProps,l===null?h.child=ol(h,null,w,v):Wt(l,h,w,v),h.child;case 11:return w=h.type,C=h.pendingProps,C=h.elementType===w?C:Fs(w,C),vr(l,h,w,C,v);case 7:return Wt(l,h,h.pendingProps,v),h.child;case 8:return Wt(l,h,h.pendingProps.children,v),h.child;case 12:return Wt(l,h,h.pendingProps.children,v),h.child;case 10:e:{if(w=h.type._context,C=h.pendingProps,N=h.memoizedProps,j=C.value,Qn(ll,w._currentValue),w._currentValue=j,N!==null)if(us(N.value,j)){if(N.children===C.children&&!Or.current){h=vl(l,h,v);break e}}else for(N=h.child,N!==null&&(N.return=h);N!==null;){var fe=N.dependencies;if(fe!==null){j=N.child;for(var _e=fe.firstContext;_e!==null;){if(_e.context===w){if(N.tag===1){_e=qn(-1,v&-v),_e.tag=2;var We=N.updateQueue;if(We!==null){We=We.shared;var xt=We.pending;xt===null?_e.next=_e:(_e.next=xt.next,xt.next=_e),We.pending=_e}}N.lanes|=v,_e=N.alternate,_e!==null&&(_e.lanes|=v),ec(N.return,v,h),fe.lanes|=v;break}_e=_e.next}}else if(N.tag===10)j=N.type===h.type?null:N.child;else if(N.tag===18){if(j=N.return,j===null)throw Error(t(341));j.lanes|=v,fe=j.alternate,fe!==null&&(fe.lanes|=v),ec(j,v,h),j=N.sibling}else j=N.child;if(j!==null)j.return=N;else for(j=N;j!==null;){if(j===h){j=null;break}if(N=j.sibling,N!==null){N.return=j.return,j=N;break}j=j.return}N=j}Wt(l,h,C.children,v),h=h.child}return h;case 9:return C=h.type,w=h.pendingProps.children,Co(h,v),C=fs(C),w=w(C),h.flags|=1,Wt(l,h,w,v),h.child;case 14:return w=h.type,C=Fs(w,h.pendingProps),C=Fs(w.type,C),gs(l,h,w,C,v);case 15:return Oe(l,h,h.type,h.pendingProps,v);case 17:return w=h.type,C=h.pendingProps,C=h.elementType===w?C:Fs(w,C),X0(l,h),h.tag=1,wr(w)?(l=!0,rl(h)):l=!1,Co(h,v),d(h,w,C),M(h,w,C,v),En(null,h,w,!0,l,v);case 19:return iS(l,h,v);case 22:return Ae(l,h,v)}throw Error(t(156,h.tag))};function AS(l,h){return vt(l,h)}function ib(l,h,v,w){this.tag=l,this.key=v,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=h,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=w,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Sa(l,h,v,w){return new ib(l,h,v,w)}function k1(l){return l=l.prototype,!(!l||!l.isReactComponent)}function rb(l){if(typeof l=="function")return k1(l)?1:0;if(l!=null){if(l=l.$$typeof,l===H)return 11;if(l===ae)return 14}return 2}function iu(l,h){var v=l.alternate;return v===null?(v=Sa(l.tag,h,l.key,l.mode),v.elementType=l.elementType,v.type=l.type,v.stateNode=l.stateNode,v.alternate=l,l.alternate=v):(v.pendingProps=h,v.type=l.type,v.flags=0,v.subtreeFlags=0,v.deletions=null),v.flags=l.flags&14680064,v.childLanes=l.childLanes,v.lanes=l.lanes,v.child=l.child,v.memoizedProps=l.memoizedProps,v.memoizedState=l.memoizedState,v.updateQueue=l.updateQueue,h=l.dependencies,v.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext},v.sibling=l.sibling,v.index=l.index,v.ref=l.ref,v}function im(l,h,v,w,C,N){var j=2;if(w=l,typeof l=="function")k1(l)&&(j=1);else if(typeof l=="string")j=5;else e:switch(l){case F:return pc(v.children,C,N,h);case k:j=8,C|=8;break;case R:return l=Sa(12,v,h,C|2),l.elementType=R,l.lanes=N,l;case J:return l=Sa(13,v,h,C),l.elementType=J,l.lanes=N,l;case $:return l=Sa(19,v,h,C),l.elementType=$,l.lanes=N,l;case oe:return rm(v,C,N,h);default:if(typeof l=="object"&&l!==null)switch(l.$$typeof){case U:j=10;break e;case V:j=9;break e;case H:j=11;break e;case ae:j=14;break e;case ne:j=16,w=null;break e}throw Error(t(130,l==null?l:typeof l,""))}return h=Sa(j,v,h,C),h.elementType=l,h.type=w,h.lanes=N,h}function pc(l,h,v,w){return l=Sa(7,l,w,h),l.lanes=v,l}function rm(l,h,v,w){return l=Sa(22,l,w,h),l.elementType=oe,l.lanes=v,l.stateNode={isHidden:!1},l}function z1(l,h,v){return l=Sa(6,l,null,h),l.lanes=v,l}function B1(l,h,v){return h=Sa(4,l.children!==null?l.children:[],l.key,h),h.lanes=v,h.stateNode={containerInfo:l.containerInfo,pendingChildren:null,implementation:l.implementation},h}function sb(l,h,v,w,C){this.tag=h,this.containerInfo=l,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=mi(0),this.expirationTimes=mi(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=mi(0),this.identifierPrefix=w,this.onRecoverableError=C,this.mutableSourceEagerHydrationData=null}function G1(l,h,v,w,C,N,j,fe,_e){return l=new sb(l,h,v,fe,_e),h===1?(h=1,N===!0&&(h|=8)):h=0,N=Sa(3,null,null,h),l.current=N,N.stateNode=l,N.memoizedState={element:w,isDehydrated:v,cache:null,transitions:null,pendingSuspenseBoundaries:null},An(N),l}function ab(l,h,v){var w=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:D,key:w==null?null:""+w,children:l,containerInfo:h,implementation:v}}function CS(l){if(!l)return Va;l=l._reactInternals;e:{if(ee(l)!==l||l.tag!==1)throw Error(t(170));var h=l;do{switch(h.tag){case 3:h=h.stateNode.context;break e;case 1:if(wr(h.type)){h=h.stateNode.__reactInternalMemoizedMergedChildContext;break e}}h=h.return}while(h!==null);throw Error(t(171))}if(l.tag===1){var v=l.type;if(wr(v))return qu(l,v,h)}return h}function PS(l,h,v,w,C,N,j,fe,_e){return l=G1(v,w,!0,l,C,N,j,fe,_e),l.context=CS(null),v=l.current,w=vs(),C=tu(v),N=qn(w,C),N.callback=h??null,fi(v,N,C),l.current.lanes=C,In(l,C,w),ks(l,w),l}function sm(l,h,v,w){var C=h.current,N=vs(),j=tu(C);return v=CS(v),h.context===null?h.context=v:h.pendingContext=v,h=qn(N,j),h.payload={element:l},w=w===void 0?null:w,w!==null&&(h.callback=w),l=fi(C,h,j),l!==null&&(to(l,C,j,N),Er(l,C,j)),j}function am(l){if(l=l.current,!l.child)return null;switch(l.child.tag){case 5:return l.child.stateNode;default:return l.child.stateNode}}function RS(l,h){if(l=l.memoizedState,l!==null&&l.dehydrated!==null){var v=l.retryLane;l.retryLane=v!==0&&v<h?v:h}}function V1(l,h){RS(l,h),(l=l.alternate)&&RS(l,h)}function ob(){return null}var IS=typeof reportError=="function"?reportError:function(l){console.error(l)};function H1(l){this._internalRoot=l}om.prototype.render=H1.prototype.render=function(l){var h=this._internalRoot;if(h===null)throw Error(t(409));sm(l,h,null,null)},om.prototype.unmount=H1.prototype.unmount=function(){var l=this._internalRoot;if(l!==null){this._internalRoot=null;var h=l.containerInfo;hc(function(){sm(null,l,null,null)}),h[hs]=null}};function om(l){this._internalRoot=l}om.prototype.unstable_scheduleHydration=function(l){if(l){var h=$i();l={blockedOn:null,target:l,priority:h};for(var v=0;v<Ps.length&&h!==0&&h<Ps[v].priority;v++);Ps.splice(v,0,l),v===0&&Sr(l)}};function W1(l){return!(!l||l.nodeType!==1&&l.nodeType!==9&&l.nodeType!==11)}function lm(l){return!(!l||l.nodeType!==1&&l.nodeType!==9&&l.nodeType!==11&&(l.nodeType!==8||l.nodeValue!==" react-mount-point-unstable "))}function LS(){}function lb(l,h,v,w,C){if(C){if(typeof w=="function"){var N=w;w=function(){var We=am(j);N.call(We)}}var j=PS(h,w,l,0,null,!1,!1,"",LS);return l._reactRootContainer=j,l[hs]=j.current,Gl(l.nodeType===8?l.parentNode:l),hc(),j}for(;C=l.lastChild;)l.removeChild(C);if(typeof w=="function"){var fe=w;w=function(){var We=am(_e);fe.call(We)}}var _e=G1(l,0,!1,null,null,!1,!1,"",LS);return l._reactRootContainer=_e,l[hs]=_e.current,Gl(l.nodeType===8?l.parentNode:l),hc(function(){sm(h,_e,v,w)}),_e}function um(l,h,v,w,C){var N=v._reactRootContainer;if(N){var j=N;if(typeof C=="function"){var fe=C;C=function(){var _e=am(j);fe.call(_e)}}sm(h,j,l,C)}else j=lb(v,h,l,C,w);return am(j)}ui=function(l){switch(l.tag){case 3:var h=l.stateNode;if(h.current.memoizedState.isDehydrated){var v=fn(h.pendingLanes);v!==0&&(Ln(h,v|1),ks(h,Ie()),(Gn&6)===0&&(Wh=Ie()+500,ga()))}break;case 13:hc(function(){var w=ea(l,1);if(w!==null){var C=vs();to(w,l,1,C)}}),V1(l,1)}},Ci=function(l){if(l.tag===13){var h=ea(l,134217728);if(h!==null){var v=vs();to(h,l,134217728,v)}V1(l,134217728)}},ha=function(l){if(l.tag===13){var h=tu(l),v=ea(l,h);if(v!==null){var w=vs();to(v,l,h,w)}V1(l,h)}},$i=function(){return cn},jo=function(l,h){var v=cn;try{return cn=l,h()}finally{cn=v}},Ee=function(l,h,v){switch(h){case"input":if(it(l,v),h=v.name,v.type==="radio"&&h!=null){for(v=l;v.parentNode;)v=v.parentNode;for(v=v.querySelectorAll("input[name="+JSON.stringify(""+h)+'][type="radio"]'),h=0;h<v.length;h++){var w=v[h];if(w!==l&&w.form===l.form){var C=Ah(w);if(!C)throw Error(t(90));Qe(w),it(w,C)}}}break;case"textarea":B(l,v);break;case"select":h=v.value,h!=null&&Ce(l,!!v.multiple,h,!1)}},kt=U1,zt=hc;var ub={usingClientEntryPoint:!1,Events:[Ga,Ri,Ah,ke,dt,U1]},Bd={findFiberByHostInstance:bo,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},cb={bundleType:Bd.bundleType,version:Bd.version,rendererPackageName:Bd.rendererPackageName,rendererConfig:Bd.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:P.ReactCurrentDispatcher,findHostInstanceByFiber:function(l){return l=Ye(l),l===null?null:l.stateNode},findFiberByHostInstance:Bd.findFiberByHostInstance||ob,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var cm=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!cm.isDisabled&&cm.supportsFiber)try{ut=cm.inject(cb),Je=cm}catch{}}return zs.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ub,zs.createPortal=function(l,h){var v=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!W1(h))throw Error(t(200));return ab(l,h,null,v)},zs.createRoot=function(l,h){if(!W1(l))throw Error(t(299));var v=!1,w="",C=IS;return h!=null&&(h.unstable_strictMode===!0&&(v=!0),h.identifierPrefix!==void 0&&(w=h.identifierPrefix),h.onRecoverableError!==void 0&&(C=h.onRecoverableError)),h=G1(l,1,!1,null,null,v,!1,w,C),l[hs]=h.current,Gl(l.nodeType===8?l.parentNode:l),new H1(h)},zs.findDOMNode=function(l){if(l==null)return null;if(l.nodeType===1)return l;var h=l._reactInternals;if(h===void 0)throw typeof l.render=="function"?Error(t(188)):(l=Object.keys(l).join(","),Error(t(268,l)));return l=Ye(h),l=l===null?null:l.stateNode,l},zs.flushSync=function(l){return hc(l)},zs.hydrate=function(l,h,v){if(!lm(h))throw Error(t(200));return um(null,l,h,!0,v)},zs.hydrateRoot=function(l,h,v){if(!W1(l))throw Error(t(405));var w=v!=null&&v.hydratedSources||null,C=!1,N="",j=IS;if(v!=null&&(v.unstable_strictMode===!0&&(C=!0),v.identifierPrefix!==void 0&&(N=v.identifierPrefix),v.onRecoverableError!==void 0&&(j=v.onRecoverableError)),h=PS(h,null,l,1,v??null,C,!1,N,j),l[hs]=h.current,Gl(l),w)for(l=0;l<w.length;l++)v=w[l],C=v._getVersion,C=C(v._source),h.mutableSourceEagerHydrationData==null?h.mutableSourceEagerHydrationData=[v,C]:h.mutableSourceEagerHydrationData.push(v,C);return new om(h)},zs.render=function(l,h,v){if(!lm(h))throw Error(t(200));return um(null,l,h,!1,v)},zs.unmountComponentAtNode=function(l){if(!lm(l))throw Error(t(40));return l._reactRootContainer?(hc(function(){um(null,null,l,!1,function(){l._reactRootContainer=null,l[hs]=null})}),!0):!1},zs.unstable_batchedUpdates=U1,zs.unstable_renderSubtreeIntoContainer=function(l,h,v,w){if(!lm(v))throw Error(t(200));if(l==null||l._reactInternals===void 0)throw Error(t(38));return um(l,h,v,!1,w)},zs.version="18.3.1-next-f1338f8080-20240426",zs}var BS;function yb(){if(BS)return q1.exports;BS=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),q1.exports=vb(),q1.exports}var GS;function _b(){if(GS)return hm;GS=1;var n=yb();return hm.createRoot=n.createRoot,hm.hydrateRoot=n.hydrateRoot,hm}var xb=_b();const $p="182",Sb={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Mb={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},bw=0,l_=1,Aw=2,wb=3,Cw=0,Af=1,pp=2,Nc=3,Pl=0,Ms=1,Ea=2,uo=0,zc=1,u_=2,c_=3,h_=4,Pw=5,gu=100,Rw=101,Iw=102,Lw=103,Nw=104,Dw=200,Uw=201,Fw=202,Ow=203,bg=204,Ag=205,kw=206,zw=207,Bw=208,Gw=209,Vw=210,Hw=211,Ww=212,jw=213,Xw=214,Cg=0,Pg=1,Rg=2,Wc=3,Ig=4,Lg=5,Ng=6,Dg=7,e0=0,qw=1,Yw=2,ba=0,V_=1,H_=2,W_=3,Iv=4,j_=5,X_=6,q_=7,f_="attached",Zw="detached",wu=300,ho=301,Eu=302,Lf=303,Ip=304,Wf=306,Lp=1e3,Gi=1001,Np=1002,Ji=1003,Y_=1004,Eb=1004,_f=1005,Tb=1005,Dn=1006,mp=1007,bb=1007,Fo=1008,d_=1008,Rr=1009,Lv=1010,Nv=1011,Nf=1012,t0=1013,ca=1014,bi=1015,Vi=1016,Dv=1017,Uv=1018,Df=1020,Z_=35902,J_=35899,K_=1021,Q_=1022,Ki=1023,ko=1026,vu=1027,n0=1028,i0=1029,jc=1030,Fv=1031,Ab=1032,Ov=1033,gp=33776,vp=33777,yp=33778,_p=33779,Ug=35840,Fg=35841,Og=35842,kg=35843,zg=36196,Bg=37492,Gg=37496,Vg=37488,Hg=37489,Wg=37490,jg=37491,Xg=37808,qg=37809,Yg=37810,Zg=37811,Jg=37812,Kg=37813,Qg=37814,$g=37815,ev=37816,tv=37817,nv=37818,iv=37819,rv=37820,sv=37821,av=36492,ov=36494,lv=36495,uv=36283,cv=36284,hv=36285,fv=36286,Jw=2200,Kw=2201,Qw=2202,Dp=2300,dv=2301,mg=2302,Dc=2400,Uc=2401,Up=2402,kv=2500,$_=2501,Cb=0,Pb=1,Rb=2,$w=3200,eE=3201,Ib=3202,Lb=3203,Ru=0,tE=1,bl="",rs="srgb",zo="srgb-linear",Fp="linear",Yn="srgb",Nb="",Db="rg",Ub="ga",Fb=0,Rc=7680,Ob=7681,kb=7682,zb=7683,Bb=34055,Gb=34056,Vb=5386,Hb=512,Wb=513,jb=514,Xb=515,qb=516,Yb=517,Zb=518,p_=519,nE=512,iE=513,rE=514,zv=515,sE=516,aE=517,Bv=518,oE=519,Op=35044,Jb=35048,Kb=35040,Qb=35045,$b=35049,eA=35041,tA=35046,nA=35050,iA=35042,rA="100",m_="300 es",oa=2e3,Uf=2001,sA={COMPUTE:"compute",RENDER:"render"},aA={PERSPECTIVE:"perspective",LINEAR:"linear",FLAT:"flat"},oA={NORMAL:"normal",CENTROID:"centroid",SAMPLE:"sample",FIRST:"first",EITHER:"either"};function lE(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}const lA={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function xf(n,e){return new lA[n](e)}function uE(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function kp(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function cE(){const n=kp("canvas");return n.style.display="block",n}const VS={};let Tu=null;function uA(n){Tu=n}function cA(){return Tu}function zp(...n){const e="THREE."+n.shift();Tu?Tu("log",e,...n):console.log(e,...n)}function Ft(...n){const e="THREE."+n.shift();Tu?Tu("warn",e,...n):console.warn(e,...n)}function ln(...n){const e="THREE."+n.shift();Tu?Tu("error",e,...n):console.error(e,...n)}function Ff(...n){const e=n.join(" ");e in VS||(VS[e]=!0,Ft(...n))}function hA(n,e,t){return new Promise(function(r,i){function s(){switch(n.clientWaitSync(e,n.SYNC_FLUSH_COMMANDS_BIT,0)){case n.WAIT_FAILED:i();break;case n.TIMEOUT_EXPIRED:setTimeout(s,t);break;default:r()}}setTimeout(s,t)})}class Vo{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(t)===-1&&r[e].push(t)}hasEventListener(e,t){const r=this._listeners;return r===void 0?!1:r[e]!==void 0&&r[e].indexOf(t)!==-1}removeEventListener(e,t){const r=this._listeners;if(r===void 0)return;const i=r[e];if(i!==void 0){const s=i.indexOf(t);s!==-1&&i.splice(s,1)}}dispatchEvent(e){const t=this._listeners;if(t===void 0)return;const r=t[e.type];if(r!==void 0){e.target=this;const i=r.slice(0);for(let s=0,a=i.length;s<a;s++)i[s].call(this,e);e.target=null}}}const es=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let HS=1234567;const Bc=Math.PI/180,Of=180/Math.PI;function la(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(es[n&255]+es[n>>8&255]+es[n>>16&255]+es[n>>24&255]+"-"+es[e&255]+es[e>>8&255]+"-"+es[e>>16&15|64]+es[e>>24&255]+"-"+es[t&63|128]+es[t>>8&255]+"-"+es[t>>16&255]+es[t>>24&255]+es[r&255]+es[r>>8&255]+es[r>>16&255]+es[r>>24&255]).toLowerCase()}function gn(n,e,t){return Math.max(e,Math.min(t,n))}function ex(n,e){return(n%e+e)%e}function fA(n,e,t,r,i){return r+(n-e)*(i-r)/(t-e)}function dA(n,e,t){return n!==e?(t-n)/(e-n):0}function xp(n,e,t){return(1-t)*n+t*e}function pA(n,e,t,r){return xp(n,e,1-Math.exp(-t*r))}function mA(n,e=1){return e-Math.abs(ex(n,e*2)-e)}function gA(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*(3-2*n))}function vA(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*n*(n*(n*6-15)+10))}function yA(n,e){return n+Math.floor(Math.random()*(e-n+1))}function _A(n,e){return n+Math.random()*(e-n)}function xA(n){return n*(.5-Math.random())}function SA(n){n!==void 0&&(HS=n);let e=HS+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function MA(n){return n*Bc}function wA(n){return n*Of}function EA(n){return(n&n-1)===0&&n!==0}function TA(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function bA(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function AA(n,e,t,r,i){const s=Math.cos,a=Math.sin,o=s(t/2),u=a(t/2),c=s((e+r)/2),f=a((e+r)/2),m=s((e-r)/2),g=a((e-r)/2),y=s((r-e)/2),_=a((r-e)/2);switch(i){case"XYX":n.set(o*f,u*m,u*g,o*c);break;case"YZY":n.set(u*g,o*f,u*m,o*c);break;case"ZXZ":n.set(u*m,u*g,o*f,o*c);break;case"XZX":n.set(o*f,u*_,u*y,o*c);break;case"YXY":n.set(u*y,o*f,u*_,o*c);break;case"ZYZ":n.set(u*_,u*y,o*f,o*c);break;default:Ft("MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}function xs(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function Rn(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const CA={DEG2RAD:Bc,RAD2DEG:Of,generateUUID:la,clamp:gn,euclideanModulo:ex,mapLinear:fA,inverseLerp:dA,lerp:xp,damp:pA,pingpong:mA,smoothstep:gA,smootherstep:vA,randInt:yA,randFloat:_A,randFloatSpread:xA,seededRandom:SA,degToRad:MA,radToDeg:wA,isPowerOfTwo:EA,ceilPowerOfTwo:TA,floorPowerOfTwo:bA,setQuaternionFromProperEuler:AA,normalize:Rn,denormalize:xs};class ct{constructor(e=0,t=0){ct.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,r=this.y,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6],this.y=i[1]*t+i[4]*r+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=gn(this.x,e.x,t.x),this.y=gn(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=gn(this.x,e,t),this.y=gn(this.y,e,t),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(gn(r,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(gn(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y;return t*t+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const r=Math.cos(t),i=Math.sin(t),s=this.x-e.x,a=this.y-e.y;return this.x=s*r-a*i+e.x,this.y=s*i+a*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class xn{constructor(e=0,t=0,r=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=r,this._w=i}static slerpFlat(e,t,r,i,s,a,o){let u=r[i+0],c=r[i+1],f=r[i+2],m=r[i+3],g=s[a+0],y=s[a+1],_=s[a+2],E=s[a+3];if(o<=0){e[t+0]=u,e[t+1]=c,e[t+2]=f,e[t+3]=m;return}if(o>=1){e[t+0]=g,e[t+1]=y,e[t+2]=_,e[t+3]=E;return}if(m!==E||u!==g||c!==y||f!==_){let x=u*g+c*y+f*_+m*E;x<0&&(g=-g,y=-y,_=-_,E=-E,x=-x);let S=1-o;if(x<.9995){const T=Math.acos(x),A=Math.sin(T);S=Math.sin(S*T)/A,o=Math.sin(o*T)/A,u=u*S+g*o,c=c*S+y*o,f=f*S+_*o,m=m*S+E*o}else{u=u*S+g*o,c=c*S+y*o,f=f*S+_*o,m=m*S+E*o;const T=1/Math.sqrt(u*u+c*c+f*f+m*m);u*=T,c*=T,f*=T,m*=T}}e[t]=u,e[t+1]=c,e[t+2]=f,e[t+3]=m}static multiplyQuaternionsFlat(e,t,r,i,s,a){const o=r[i],u=r[i+1],c=r[i+2],f=r[i+3],m=s[a],g=s[a+1],y=s[a+2],_=s[a+3];return e[t]=o*_+f*m+u*y-c*g,e[t+1]=u*_+f*g+c*m-o*y,e[t+2]=c*_+f*y+o*g-u*m,e[t+3]=f*_-o*m-u*g-c*y,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const r=e._x,i=e._y,s=e._z,a=e._order,o=Math.cos,u=Math.sin,c=o(r/2),f=o(i/2),m=o(s/2),g=u(r/2),y=u(i/2),_=u(s/2);switch(a){case"XYZ":this._x=g*f*m+c*y*_,this._y=c*y*m-g*f*_,this._z=c*f*_+g*y*m,this._w=c*f*m-g*y*_;break;case"YXZ":this._x=g*f*m+c*y*_,this._y=c*y*m-g*f*_,this._z=c*f*_-g*y*m,this._w=c*f*m+g*y*_;break;case"ZXY":this._x=g*f*m-c*y*_,this._y=c*y*m+g*f*_,this._z=c*f*_+g*y*m,this._w=c*f*m-g*y*_;break;case"ZYX":this._x=g*f*m-c*y*_,this._y=c*y*m+g*f*_,this._z=c*f*_-g*y*m,this._w=c*f*m+g*y*_;break;case"YZX":this._x=g*f*m+c*y*_,this._y=c*y*m+g*f*_,this._z=c*f*_-g*y*m,this._w=c*f*m-g*y*_;break;case"XZY":this._x=g*f*m-c*y*_,this._y=c*y*m-g*f*_,this._z=c*f*_+g*y*m,this._w=c*f*m+g*y*_;break;default:Ft("Quaternion: .setFromEuler() encountered an unknown order: "+a)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const r=t/2,i=Math.sin(r);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,r=t[0],i=t[4],s=t[8],a=t[1],o=t[5],u=t[9],c=t[2],f=t[6],m=t[10],g=r+o+m;if(g>0){const y=.5/Math.sqrt(g+1);this._w=.25/y,this._x=(f-u)*y,this._y=(s-c)*y,this._z=(a-i)*y}else if(r>o&&r>m){const y=2*Math.sqrt(1+r-o-m);this._w=(f-u)/y,this._x=.25*y,this._y=(i+a)/y,this._z=(s+c)/y}else if(o>m){const y=2*Math.sqrt(1+o-r-m);this._w=(s-c)/y,this._x=(i+a)/y,this._y=.25*y,this._z=(u+f)/y}else{const y=2*Math.sqrt(1+m-r-o);this._w=(a-i)/y,this._x=(s+c)/y,this._y=(u+f)/y,this._z=.25*y}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let r=e.dot(t)+1;return r<1e-8?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(gn(this.dot(e),-1,1)))}rotateTowards(e,t){const r=this.angleTo(e);if(r===0)return this;const i=Math.min(1,t/r);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const r=e._x,i=e._y,s=e._z,a=e._w,o=t._x,u=t._y,c=t._z,f=t._w;return this._x=r*f+a*o+i*c-s*u,this._y=i*f+a*u+s*o-r*c,this._z=s*f+a*c+r*u-i*o,this._w=a*f-r*o-i*u-s*c,this._onChangeCallback(),this}slerp(e,t){if(t<=0)return this;if(t>=1)return this.copy(e);let r=e._x,i=e._y,s=e._z,a=e._w,o=this.dot(e);o<0&&(r=-r,i=-i,s=-s,a=-a,o=-o);let u=1-t;if(o<.9995){const c=Math.acos(o),f=Math.sin(c);u=Math.sin(u*c)/f,t=Math.sin(t*c)/f,this._x=this._x*u+r*t,this._y=this._y*u+i*t,this._z=this._z*u+s*t,this._w=this._w*u+a*t,this._onChangeCallback()}else this._x=this._x*u+r*t,this._y=this._y*u+i*t,this._z=this._z*u+s*t,this._w=this._w*u+a*t,this.normalize();return this}slerpQuaternions(e,t,r){return this.copy(e).slerp(t,r)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),r=Math.random(),i=Math.sqrt(1-r),s=Math.sqrt(r);return this.set(i*Math.sin(e),i*Math.cos(e),s*Math.sin(t),s*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class X{constructor(e=0,t=0,r=0){X.prototype.isVector3=!0,this.x=e,this.y=t,this.z=r}set(e,t,r){return r===void 0&&(r=this.z),this.x=e,this.y=t,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(WS.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(WS.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,r=this.y,i=this.z,s=e.elements;return this.x=s[0]*t+s[3]*r+s[6]*i,this.y=s[1]*t+s[4]*r+s[7]*i,this.z=s[2]*t+s[5]*r+s[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,r=this.y,i=this.z,s=e.elements,a=1/(s[3]*t+s[7]*r+s[11]*i+s[15]);return this.x=(s[0]*t+s[4]*r+s[8]*i+s[12])*a,this.y=(s[1]*t+s[5]*r+s[9]*i+s[13])*a,this.z=(s[2]*t+s[6]*r+s[10]*i+s[14])*a,this}applyQuaternion(e){const t=this.x,r=this.y,i=this.z,s=e.x,a=e.y,o=e.z,u=e.w,c=2*(a*i-o*r),f=2*(o*t-s*i),m=2*(s*r-a*t);return this.x=t+u*c+a*m-o*f,this.y=r+u*f+o*c-s*m,this.z=i+u*m+s*f-a*c,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,r=this.y,i=this.z,s=e.elements;return this.x=s[0]*t+s[4]*r+s[8]*i,this.y=s[1]*t+s[5]*r+s[9]*i,this.z=s[2]*t+s[6]*r+s[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=gn(this.x,e.x,t.x),this.y=gn(this.y,e.y,t.y),this.z=gn(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=gn(this.x,e,t),this.y=gn(this.y,e,t),this.z=gn(this.z,e,t),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(gn(r,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const r=e.x,i=e.y,s=e.z,a=t.x,o=t.y,u=t.z;return this.x=i*u-s*o,this.y=s*a-r*u,this.z=r*o-i*a,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const r=e.dot(this)/t;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return J1.copy(this).projectOnVector(e),this.sub(J1)}reflect(e){return this.sub(J1.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(gn(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return t*t+r*r+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,r){const i=Math.sin(t)*e;return this.x=i*Math.sin(r),this.y=Math.cos(t)*e,this.z=i*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,r=Math.sqrt(1-t*t);return this.x=r*Math.cos(e),this.y=t,this.z=r*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const J1=new X,WS=new xn;class Tn{constructor(e,t,r,i,s,a,o,u,c){Tn.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,r,i,s,a,o,u,c)}set(e,t,r,i,s,a,o,u,c){const f=this.elements;return f[0]=e,f[1]=i,f[2]=o,f[3]=t,f[4]=s,f[5]=u,f[6]=r,f[7]=a,f[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this}extractBasis(e,t,r){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,i=t.elements,s=this.elements,a=r[0],o=r[3],u=r[6],c=r[1],f=r[4],m=r[7],g=r[2],y=r[5],_=r[8],E=i[0],x=i[3],S=i[6],T=i[1],A=i[4],P=i[7],L=i[2],D=i[5],F=i[8];return s[0]=a*E+o*T+u*L,s[3]=a*x+o*A+u*D,s[6]=a*S+o*P+u*F,s[1]=c*E+f*T+m*L,s[4]=c*x+f*A+m*D,s[7]=c*S+f*P+m*F,s[2]=g*E+y*T+_*L,s[5]=g*x+y*A+_*D,s[8]=g*S+y*P+_*F,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[1],i=e[2],s=e[3],a=e[4],o=e[5],u=e[6],c=e[7],f=e[8];return t*a*f-t*o*c-r*s*f+r*o*u+i*s*c-i*a*u}invert(){const e=this.elements,t=e[0],r=e[1],i=e[2],s=e[3],a=e[4],o=e[5],u=e[6],c=e[7],f=e[8],m=f*a-o*c,g=o*u-f*s,y=c*s-a*u,_=t*m+r*g+i*y;if(_===0)return this.set(0,0,0,0,0,0,0,0,0);const E=1/_;return e[0]=m*E,e[1]=(i*c-f*r)*E,e[2]=(o*r-i*a)*E,e[3]=g*E,e[4]=(f*t-i*u)*E,e[5]=(i*s-o*t)*E,e[6]=y*E,e[7]=(r*u-c*t)*E,e[8]=(a*t-r*s)*E,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,r,i,s,a,o){const u=Math.cos(s),c=Math.sin(s);return this.set(r*u,r*c,-r*(u*a+c*o)+a+e,-i*c,i*u,-i*(-c*a+u*o)+o+t,0,0,1),this}scale(e,t){return this.premultiply(K1.makeScale(e,t)),this}rotate(e){return this.premultiply(K1.makeRotation(-e)),this}translate(e,t){return this.premultiply(K1.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,r,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,r=e.elements;for(let i=0;i<9;i++)if(t[i]!==r[i])return!1;return!0}fromArray(e,t=0){for(let r=0;r<9;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const K1=new Tn,jS=new Tn().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),XS=new Tn().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function PA(){const n={enabled:!0,workingColorSpace:zo,spaces:{},convert:function(i,s,a){return this.enabled===!1||s===a||!s||!a||(this.spaces[s].transfer===Yn&&(i.r=Cl(i.r),i.g=Cl(i.g),i.b=Cl(i.b)),this.spaces[s].primaries!==this.spaces[a].primaries&&(i.applyMatrix3(this.spaces[s].toXYZ),i.applyMatrix3(this.spaces[a].fromXYZ)),this.spaces[a].transfer===Yn&&(i.r=Cf(i.r),i.g=Cf(i.g),i.b=Cf(i.b))),i},workingToColorSpace:function(i,s){return this.convert(i,this.workingColorSpace,s)},colorSpaceToWorking:function(i,s){return this.convert(i,s,this.workingColorSpace)},getPrimaries:function(i){return this.spaces[i].primaries},getTransfer:function(i){return i===bl?Fp:this.spaces[i].transfer},getToneMappingMode:function(i){return this.spaces[i].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(i,s=this.workingColorSpace){return i.fromArray(this.spaces[s].luminanceCoefficients)},define:function(i){Object.assign(this.spaces,i)},_getMatrix:function(i,s,a){return i.copy(this.spaces[s].toXYZ).multiply(this.spaces[a].fromXYZ)},_getDrawingBufferColorSpace:function(i){return this.spaces[i].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(i=this.workingColorSpace){return this.spaces[i].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(i,s){return Ff("ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),n.workingToColorSpace(i,s)},toWorkingColorSpace:function(i,s){return Ff("ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),n.colorSpaceToWorking(i,s)}},e=[.64,.33,.3,.6,.15,.06],t=[.2126,.7152,.0722],r=[.3127,.329];return n.define({[zo]:{primaries:e,whitePoint:r,transfer:Fp,toXYZ:jS,fromXYZ:XS,luminanceCoefficients:t,workingColorSpaceConfig:{unpackColorSpace:rs},outputColorSpaceConfig:{drawingBufferColorSpace:rs}},[rs]:{primaries:e,whitePoint:r,transfer:Yn,toXYZ:jS,fromXYZ:XS,luminanceCoefficients:t,outputColorSpaceConfig:{drawingBufferColorSpace:rs}}}),n}const kn=PA();function Cl(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function Cf(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}let Xh;class hE{static getDataURL(e,t="image/png"){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let r;if(e instanceof HTMLCanvasElement)r=e;else{Xh===void 0&&(Xh=kp("canvas")),Xh.width=e.width,Xh.height=e.height;const i=Xh.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),r=Xh}return r.toDataURL(t)}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=kp("canvas");t.width=e.width,t.height=e.height;const r=t.getContext("2d");r.drawImage(e,0,0,e.width,e.height);const i=r.getImageData(0,0,e.width,e.height),s=i.data;for(let a=0;a<s.length;a++)s[a]=Cl(s[a]/255)*255;return r.putImageData(i,0,0),t}else if(e.data){const t=e.data.slice(0);for(let r=0;r<t.length;r++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[r]=Math.floor(Cl(t[r]/255)*255):t[r]=Cl(t[r]);return{data:t,width:e.width,height:e.height}}else return Ft("ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let RA=0;class yu{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:RA++}),this.uuid=la(),this.data=e,this.dataReady=!0,this.version=0}getSize(e){const t=this.data;return typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement?e.set(t.videoWidth,t.videoHeight,0):typeof VideoFrame<"u"&&t instanceof VideoFrame?e.set(t.displayHeight,t.displayWidth,0):t!==null?e.set(t.width,t.height,t.depth||0):e.set(0,0,0),e}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const r={uuid:this.uuid,url:""},i=this.data;if(i!==null){let s;if(Array.isArray(i)){s=[];for(let a=0,o=i.length;a<o;a++)i[a].isDataTexture?s.push(Q1(i[a].image)):s.push(Q1(i[a]))}else s=Q1(i);r.url=s}return t||(e.images[this.uuid]=r),r}}function Q1(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?hE.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(Ft("Texture: Unable to serialize Texture."),{})}let IA=0;const $1=new X;class ei extends Vo{constructor(e=ei.DEFAULT_IMAGE,t=ei.DEFAULT_MAPPING,r=Gi,i=Gi,s=Dn,a=Fo,o=Ki,u=Rr,c=ei.DEFAULT_ANISOTROPY,f=bl){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:IA++}),this.uuid=la(),this.name="",this.source=new yu(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=r,this.wrapT=i,this.magFilter=s,this.minFilter=a,this.anisotropy=c,this.format=o,this.internalFormat=null,this.type=u,this.offset=new ct(0,0),this.repeat=new ct(1,1),this.center=new ct(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Tn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=f,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(e&&e.depth&&e.depth>1),this.pmremVersion=0}get width(){return this.source.getSize($1).x}get height(){return this.source.getSize($1).y}get depth(){return this.source.getSize($1).z}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isArrayTexture=e.isArrayTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}setValues(e){for(const t in e){const r=e[t];if(r===void 0){Ft(`Texture.setValues(): parameter '${t}' has value of undefined.`);continue}const i=this[t];if(i===void 0){Ft(`Texture.setValues(): property '${t}' does not exist.`);continue}i&&r&&i.isVector2&&r.isVector2||i&&r&&i.isVector3&&r.isVector3||i&&r&&i.isMatrix3&&r.isMatrix3?i.copy(r):this[t]=r}}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const r={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),t||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==wu)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Lp:e.x=e.x-Math.floor(e.x);break;case Gi:e.x=e.x<0?0:1;break;case Np:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Lp:e.y=e.y-Math.floor(e.y);break;case Gi:e.y=e.y<0?0:1;break;case Np:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}ei.DEFAULT_IMAGE=null;ei.DEFAULT_MAPPING=wu;ei.DEFAULT_ANISOTROPY=1;class $n{constructor(e=0,t=0,r=0,i=1){$n.prototype.isVector4=!0,this.x=e,this.y=t,this.z=r,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,r=this.y,i=this.z,s=this.w,a=e.elements;return this.x=a[0]*t+a[4]*r+a[8]*i+a[12]*s,this.y=a[1]*t+a[5]*r+a[9]*i+a[13]*s,this.z=a[2]*t+a[6]*r+a[10]*i+a[14]*s,this.w=a[3]*t+a[7]*r+a[11]*i+a[15]*s,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,r,i,s;const u=e.elements,c=u[0],f=u[4],m=u[8],g=u[1],y=u[5],_=u[9],E=u[2],x=u[6],S=u[10];if(Math.abs(f-g)<.01&&Math.abs(m-E)<.01&&Math.abs(_-x)<.01){if(Math.abs(f+g)<.1&&Math.abs(m+E)<.1&&Math.abs(_+x)<.1&&Math.abs(c+y+S-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const A=(c+1)/2,P=(y+1)/2,L=(S+1)/2,D=(f+g)/4,F=(m+E)/4,k=(_+x)/4;return A>P&&A>L?A<.01?(r=0,i=.707106781,s=.707106781):(r=Math.sqrt(A),i=D/r,s=F/r):P>L?P<.01?(r=.707106781,i=0,s=.707106781):(i=Math.sqrt(P),r=D/i,s=k/i):L<.01?(r=.707106781,i=.707106781,s=0):(s=Math.sqrt(L),r=F/s,i=k/s),this.set(r,i,s,t),this}let T=Math.sqrt((x-_)*(x-_)+(m-E)*(m-E)+(g-f)*(g-f));return Math.abs(T)<.001&&(T=1),this.x=(x-_)/T,this.y=(m-E)/T,this.z=(g-f)/T,this.w=Math.acos((c+y+S-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=gn(this.x,e.x,t.x),this.y=gn(this.y,e.y,t.y),this.z=gn(this.z,e.z,t.z),this.w=gn(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=gn(this.x,e,t),this.y=gn(this.y,e,t),this.z=gn(this.z,e,t),this.w=gn(this.w,e,t),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(gn(r,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this.w=e.w+(t.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class tx extends Vo{constructor(e=1,t=1,r={}){super(),r=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Dn,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},r),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=r.depth,this.scissor=new $n(0,0,e,t),this.scissorTest=!1,this.viewport=new $n(0,0,e,t);const i={width:e,height:t,depth:r.depth},s=new ei(i);this.textures=[];const a=r.count;for(let o=0;o<a;o++)this.textures[o]=s.clone(),this.textures[o].isRenderTargetTexture=!0,this.textures[o].renderTarget=this;this._setTextureOptions(r),this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.resolveDepthBuffer=r.resolveDepthBuffer,this.resolveStencilBuffer=r.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=r.depthTexture,this.samples=r.samples,this.multiview=r.multiview}_setTextureOptions(e={}){const t={minFilter:Dn,generateMipmaps:!1,flipY:!1,internalFormat:null};e.mapping!==void 0&&(t.mapping=e.mapping),e.wrapS!==void 0&&(t.wrapS=e.wrapS),e.wrapT!==void 0&&(t.wrapT=e.wrapT),e.wrapR!==void 0&&(t.wrapR=e.wrapR),e.magFilter!==void 0&&(t.magFilter=e.magFilter),e.minFilter!==void 0&&(t.minFilter=e.minFilter),e.format!==void 0&&(t.format=e.format),e.type!==void 0&&(t.type=e.type),e.anisotropy!==void 0&&(t.anisotropy=e.anisotropy),e.colorSpace!==void 0&&(t.colorSpace=e.colorSpace),e.flipY!==void 0&&(t.flipY=e.flipY),e.generateMipmaps!==void 0&&(t.generateMipmaps=e.generateMipmaps),e.internalFormat!==void 0&&(t.internalFormat=e.internalFormat);for(let r=0;r<this.textures.length;r++)this.textures[r].setValues(t)}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t,r=1){if(this.width!==e||this.height!==t||this.depth!==r){this.width=e,this.height=t,this.depth=r;for(let i=0,s=this.textures.length;i<s;i++)this.textures[i].image.width=e,this.textures[i].image.height=t,this.textures[i].image.depth=r,this.textures[i].isData3DTexture!==!0&&(this.textures[i].isArrayTexture=this.textures[i].image.depth>1);this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,r=e.textures.length;t<r;t++){this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;const i=Object.assign({},e.textures[t].image);this.textures[t].source=new yu(i)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class ws extends tx{constructor(e=1,t=1,r={}){super(e,t,r),this.isWebGLRenderTarget=!0}}class Gv extends ei{constructor(e=null,t=1,r=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:r,depth:i},this.magFilter=Ji,this.minFilter=Ji,this.wrapR=Gi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class LA extends ws{constructor(e=1,t=1,r=1,i={}){super(e,t,i),this.isWebGLArrayRenderTarget=!0,this.depth=r,this.texture=new Gv(null,e,t,r),this._setTextureOptions(i),this.texture.isRenderTargetTexture=!0}}class Vv extends ei{constructor(e=null,t=1,r=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:r,depth:i},this.magFilter=Ji,this.minFilter=Ji,this.wrapR=Gi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class NA extends ws{constructor(e=1,t=1,r=1,i={}){super(e,t,i),this.isWebGL3DRenderTarget=!0,this.depth=r,this.texture=new Vv(null,e,t,r),this._setTextureOptions(i),this.texture.isRenderTargetTexture=!0}}class Nr{constructor(e=new X(1/0,1/0,1/0),t=new X(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t+=3)this.expandByPoint(no.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,r=e.count;t<r;t++)this.expandByPoint(no.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const r=no.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const r=e.geometry;if(r!==void 0){const s=r.getAttribute("position");if(t===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let a=0,o=s.count;a<o;a++)e.isMesh===!0?e.getVertexPosition(a,no):no.fromBufferAttribute(s,a),no.applyMatrix4(e.matrixWorld),this.expandByPoint(no);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),fm.copy(e.boundingBox)):(r.boundingBox===null&&r.computeBoundingBox(),fm.copy(r.boundingBox)),fm.applyMatrix4(e.matrixWorld),this.union(fm)}const i=e.children;for(let s=0,a=i.length;s<a;s++)this.expandByObject(i[s],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,no),no.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,r;return e.normal.x>0?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Vd),dm.subVectors(this.max,Vd),qh.subVectors(e.a,Vd),Yh.subVectors(e.b,Vd),Zh.subVectors(e.c,Vd),su.subVectors(Yh,qh),au.subVectors(Zh,Yh),mc.subVectors(qh,Zh);let t=[0,-su.z,su.y,0,-au.z,au.y,0,-mc.z,mc.y,su.z,0,-su.x,au.z,0,-au.x,mc.z,0,-mc.x,-su.y,su.x,0,-au.y,au.x,0,-mc.y,mc.x,0];return!ey(t,qh,Yh,Zh,dm)||(t=[1,0,0,0,1,0,0,0,1],!ey(t,qh,Yh,Zh,dm))?!1:(pm.crossVectors(su,au),t=[pm.x,pm.y,pm.z],ey(t,qh,Yh,Zh,dm))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,no).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(no).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(_l[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),_l[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),_l[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),_l[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),_l[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),_l[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),_l[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),_l[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(_l),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(e){return this.min.fromArray(e.min),this.max.fromArray(e.max),this}}const _l=[new X,new X,new X,new X,new X,new X,new X,new X],no=new X,fm=new Nr,qh=new X,Yh=new X,Zh=new X,su=new X,au=new X,mc=new X,Vd=new X,dm=new X,pm=new X,gc=new X;function ey(n,e,t,r,i){for(let s=0,a=n.length-3;s<=a;s+=3){gc.fromArray(n,s);const o=i.x*Math.abs(gc.x)+i.y*Math.abs(gc.y)+i.z*Math.abs(gc.z),u=e.dot(gc),c=t.dot(gc),f=r.dot(gc);if(Math.max(-Math.max(u,c,f),Math.min(u,c,f))>o)return!1}return!0}const DA=new Nr,Hd=new X,ty=new X;class Dr{constructor(e=new X,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const r=this.center;t!==void 0?r.copy(t):DA.setFromPoints(e).getCenter(r);let i=0;for(let s=0,a=e.length;s<a;s++)i=Math.max(i,r.distanceToSquared(e[s]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const r=this.center.distanceToSquared(e);return t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Hd.subVectors(e,this.center);const t=Hd.lengthSq();if(t>this.radius*this.radius){const r=Math.sqrt(t),i=(r-this.radius)*.5;this.center.addScaledVector(Hd,i/r),this.radius+=i}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(ty.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Hd.copy(e.center).add(ty)),this.expandByPoint(Hd.copy(e.center).sub(ty))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(e){return this.radius=e.radius,this.center.fromArray(e.center),this}}const xl=new X,ny=new X,mm=new X,ou=new X,iy=new X,gm=new X,ry=new X;class jf{constructor(e=new X,t=new X(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,xl)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const r=t.dot(this.direction);return r<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,r)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=xl.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(xl.copy(this.origin).addScaledVector(this.direction,t),xl.distanceToSquared(e))}distanceSqToSegment(e,t,r,i){ny.copy(e).add(t).multiplyScalar(.5),mm.copy(t).sub(e).normalize(),ou.copy(this.origin).sub(ny);const s=e.distanceTo(t)*.5,a=-this.direction.dot(mm),o=ou.dot(this.direction),u=-ou.dot(mm),c=ou.lengthSq(),f=Math.abs(1-a*a);let m,g,y,_;if(f>0)if(m=a*u-o,g=a*o-u,_=s*f,m>=0)if(g>=-_)if(g<=_){const E=1/f;m*=E,g*=E,y=m*(m+a*g+2*o)+g*(a*m+g+2*u)+c}else g=s,m=Math.max(0,-(a*g+o)),y=-m*m+g*(g+2*u)+c;else g=-s,m=Math.max(0,-(a*g+o)),y=-m*m+g*(g+2*u)+c;else g<=-_?(m=Math.max(0,-(-a*s+o)),g=m>0?-s:Math.min(Math.max(-s,-u),s),y=-m*m+g*(g+2*u)+c):g<=_?(m=0,g=Math.min(Math.max(-s,-u),s),y=g*(g+2*u)+c):(m=Math.max(0,-(a*s+o)),g=m>0?s:Math.min(Math.max(-s,-u),s),y=-m*m+g*(g+2*u)+c);else g=a>0?-s:s,m=Math.max(0,-(a*g+o)),y=-m*m+g*(g+2*u)+c;return r&&r.copy(this.origin).addScaledVector(this.direction,m),i&&i.copy(ny).addScaledVector(mm,g),y}intersectSphere(e,t){xl.subVectors(e.center,this.origin);const r=xl.dot(this.direction),i=xl.dot(xl)-r*r,s=e.radius*e.radius;if(i>s)return null;const a=Math.sqrt(s-i),o=r-a,u=r+a;return u<0?null:o<0?this.at(u,t):this.at(o,t)}intersectsSphere(e){return e.radius<0?!1:this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null}intersectPlane(e,t){const r=this.distanceToPlane(e);return r===null?null:this.at(r,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let r,i,s,a,o,u;const c=1/this.direction.x,f=1/this.direction.y,m=1/this.direction.z,g=this.origin;return c>=0?(r=(e.min.x-g.x)*c,i=(e.max.x-g.x)*c):(r=(e.max.x-g.x)*c,i=(e.min.x-g.x)*c),f>=0?(s=(e.min.y-g.y)*f,a=(e.max.y-g.y)*f):(s=(e.max.y-g.y)*f,a=(e.min.y-g.y)*f),r>a||s>i||((s>r||isNaN(r))&&(r=s),(a<i||isNaN(i))&&(i=a),m>=0?(o=(e.min.z-g.z)*m,u=(e.max.z-g.z)*m):(o=(e.max.z-g.z)*m,u=(e.min.z-g.z)*m),r>u||o>i)||((o>r||r!==r)&&(r=o),(u<i||i!==i)&&(i=u),i<0)?null:this.at(r>=0?r:i,t)}intersectsBox(e){return this.intersectBox(e,xl)!==null}intersectTriangle(e,t,r,i,s){iy.subVectors(t,e),gm.subVectors(r,e),ry.crossVectors(iy,gm);let a=this.direction.dot(ry),o;if(a>0){if(i)return null;o=1}else if(a<0)o=-1,a=-a;else return null;ou.subVectors(this.origin,e);const u=o*this.direction.dot(gm.crossVectors(ou,gm));if(u<0)return null;const c=o*this.direction.dot(iy.cross(ou));if(c<0||u+c>a)return null;const f=-o*ou.dot(ry);return f<0?null:this.at(f/a,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class vn{constructor(e,t,r,i,s,a,o,u,c,f,m,g,y,_,E,x){vn.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,r,i,s,a,o,u,c,f,m,g,y,_,E,x)}set(e,t,r,i,s,a,o,u,c,f,m,g,y,_,E,x){const S=this.elements;return S[0]=e,S[4]=t,S[8]=r,S[12]=i,S[1]=s,S[5]=a,S[9]=o,S[13]=u,S[2]=c,S[6]=f,S[10]=m,S[14]=g,S[3]=y,S[7]=_,S[11]=E,S[15]=x,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new vn().fromArray(this.elements)}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this}copyPosition(e){const t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,r){return this.determinant()===0?(e.set(1,0,0),t.set(0,1,0),r.set(0,0,1),this):(e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this)}makeBasis(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this}extractRotation(e){if(e.determinant()===0)return this.identity();const t=this.elements,r=e.elements,i=1/Jh.setFromMatrixColumn(e,0).length(),s=1/Jh.setFromMatrixColumn(e,1).length(),a=1/Jh.setFromMatrixColumn(e,2).length();return t[0]=r[0]*i,t[1]=r[1]*i,t[2]=r[2]*i,t[3]=0,t[4]=r[4]*s,t[5]=r[5]*s,t[6]=r[6]*s,t[7]=0,t[8]=r[8]*a,t[9]=r[9]*a,t[10]=r[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,r=e.x,i=e.y,s=e.z,a=Math.cos(r),o=Math.sin(r),u=Math.cos(i),c=Math.sin(i),f=Math.cos(s),m=Math.sin(s);if(e.order==="XYZ"){const g=a*f,y=a*m,_=o*f,E=o*m;t[0]=u*f,t[4]=-u*m,t[8]=c,t[1]=y+_*c,t[5]=g-E*c,t[9]=-o*u,t[2]=E-g*c,t[6]=_+y*c,t[10]=a*u}else if(e.order==="YXZ"){const g=u*f,y=u*m,_=c*f,E=c*m;t[0]=g+E*o,t[4]=_*o-y,t[8]=a*c,t[1]=a*m,t[5]=a*f,t[9]=-o,t[2]=y*o-_,t[6]=E+g*o,t[10]=a*u}else if(e.order==="ZXY"){const g=u*f,y=u*m,_=c*f,E=c*m;t[0]=g-E*o,t[4]=-a*m,t[8]=_+y*o,t[1]=y+_*o,t[5]=a*f,t[9]=E-g*o,t[2]=-a*c,t[6]=o,t[10]=a*u}else if(e.order==="ZYX"){const g=a*f,y=a*m,_=o*f,E=o*m;t[0]=u*f,t[4]=_*c-y,t[8]=g*c+E,t[1]=u*m,t[5]=E*c+g,t[9]=y*c-_,t[2]=-c,t[6]=o*u,t[10]=a*u}else if(e.order==="YZX"){const g=a*u,y=a*c,_=o*u,E=o*c;t[0]=u*f,t[4]=E-g*m,t[8]=_*m+y,t[1]=m,t[5]=a*f,t[9]=-o*f,t[2]=-c*f,t[6]=y*m+_,t[10]=g-E*m}else if(e.order==="XZY"){const g=a*u,y=a*c,_=o*u,E=o*c;t[0]=u*f,t[4]=-m,t[8]=c*f,t[1]=g*m+E,t[5]=a*f,t[9]=y*m-_,t[2]=_*m-y,t[6]=o*f,t[10]=E*m+g}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(UA,e,FA)}lookAt(e,t,r){const i=this.elements;return sa.subVectors(e,t),sa.lengthSq()===0&&(sa.z=1),sa.normalize(),lu.crossVectors(r,sa),lu.lengthSq()===0&&(Math.abs(r.z)===1?sa.x+=1e-4:sa.z+=1e-4,sa.normalize(),lu.crossVectors(r,sa)),lu.normalize(),vm.crossVectors(sa,lu),i[0]=lu.x,i[4]=vm.x,i[8]=sa.x,i[1]=lu.y,i[5]=vm.y,i[9]=sa.y,i[2]=lu.z,i[6]=vm.z,i[10]=sa.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,i=t.elements,s=this.elements,a=r[0],o=r[4],u=r[8],c=r[12],f=r[1],m=r[5],g=r[9],y=r[13],_=r[2],E=r[6],x=r[10],S=r[14],T=r[3],A=r[7],P=r[11],L=r[15],D=i[0],F=i[4],k=i[8],R=i[12],U=i[1],V=i[5],H=i[9],J=i[13],$=i[2],ae=i[6],ne=i[10],oe=i[14],te=i[3],ie=i[7],Y=i[11],z=i[15];return s[0]=a*D+o*U+u*$+c*te,s[4]=a*F+o*V+u*ae+c*ie,s[8]=a*k+o*H+u*ne+c*Y,s[12]=a*R+o*J+u*oe+c*z,s[1]=f*D+m*U+g*$+y*te,s[5]=f*F+m*V+g*ae+y*ie,s[9]=f*k+m*H+g*ne+y*Y,s[13]=f*R+m*J+g*oe+y*z,s[2]=_*D+E*U+x*$+S*te,s[6]=_*F+E*V+x*ae+S*ie,s[10]=_*k+E*H+x*ne+S*Y,s[14]=_*R+E*J+x*oe+S*z,s[3]=T*D+A*U+P*$+L*te,s[7]=T*F+A*V+P*ae+L*ie,s[11]=T*k+A*H+P*ne+L*Y,s[15]=T*R+A*J+P*oe+L*z,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[4],i=e[8],s=e[12],a=e[1],o=e[5],u=e[9],c=e[13],f=e[2],m=e[6],g=e[10],y=e[14],_=e[3],E=e[7],x=e[11],S=e[15],T=u*y-c*g,A=o*y-c*m,P=o*g-u*m,L=a*y-c*f,D=a*g-u*f,F=a*m-o*f;return t*(E*T-x*A+S*P)-r*(_*T-x*L+S*D)+i*(_*A-E*L+S*F)-s*(_*P-E*D+x*F)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,r){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=r),this}invert(){const e=this.elements,t=e[0],r=e[1],i=e[2],s=e[3],a=e[4],o=e[5],u=e[6],c=e[7],f=e[8],m=e[9],g=e[10],y=e[11],_=e[12],E=e[13],x=e[14],S=e[15],T=m*x*c-E*g*c+E*u*y-o*x*y-m*u*S+o*g*S,A=_*g*c-f*x*c-_*u*y+a*x*y+f*u*S-a*g*S,P=f*E*c-_*m*c+_*o*y-a*E*y-f*o*S+a*m*S,L=_*m*u-f*E*u-_*o*g+a*E*g+f*o*x-a*m*x,D=t*T+r*A+i*P+s*L;if(D===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const F=1/D;return e[0]=T*F,e[1]=(E*g*s-m*x*s-E*i*y+r*x*y+m*i*S-r*g*S)*F,e[2]=(o*x*s-E*u*s+E*i*c-r*x*c-o*i*S+r*u*S)*F,e[3]=(m*u*s-o*g*s-m*i*c+r*g*c+o*i*y-r*u*y)*F,e[4]=A*F,e[5]=(f*x*s-_*g*s+_*i*y-t*x*y-f*i*S+t*g*S)*F,e[6]=(_*u*s-a*x*s-_*i*c+t*x*c+a*i*S-t*u*S)*F,e[7]=(a*g*s-f*u*s+f*i*c-t*g*c-a*i*y+t*u*y)*F,e[8]=P*F,e[9]=(_*m*s-f*E*s-_*r*y+t*E*y+f*r*S-t*m*S)*F,e[10]=(a*E*s-_*o*s+_*r*c-t*E*c-a*r*S+t*o*S)*F,e[11]=(f*o*s-a*m*s-f*r*c+t*m*c+a*r*y-t*o*y)*F,e[12]=L*F,e[13]=(f*E*i-_*m*i+_*r*g-t*E*g-f*r*x+t*m*x)*F,e[14]=(_*o*i-a*E*i-_*r*u+t*E*u+a*r*x-t*o*x)*F,e[15]=(a*m*i-f*o*i+f*r*u-t*m*u-a*r*g+t*o*g)*F,this}scale(e){const t=this.elements,r=e.x,i=e.y,s=e.z;return t[0]*=r,t[4]*=i,t[8]*=s,t[1]*=r,t[5]*=i,t[9]*=s,t[2]*=r,t[6]*=i,t[10]*=s,t[3]*=r,t[7]*=i,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,i))}makeTranslation(e,t,r){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const r=Math.cos(t),i=Math.sin(t),s=1-r,a=e.x,o=e.y,u=e.z,c=s*a,f=s*o;return this.set(c*a+r,c*o-i*u,c*u+i*o,0,c*o+i*u,f*o+r,f*u-i*a,0,c*u-i*o,f*u+i*a,s*u*u+r,0,0,0,0,1),this}makeScale(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,t,r,i,s,a){return this.set(1,r,s,0,e,1,a,0,t,i,1,0,0,0,0,1),this}compose(e,t,r){const i=this.elements,s=t._x,a=t._y,o=t._z,u=t._w,c=s+s,f=a+a,m=o+o,g=s*c,y=s*f,_=s*m,E=a*f,x=a*m,S=o*m,T=u*c,A=u*f,P=u*m,L=r.x,D=r.y,F=r.z;return i[0]=(1-(E+S))*L,i[1]=(y+P)*L,i[2]=(_-A)*L,i[3]=0,i[4]=(y-P)*D,i[5]=(1-(g+S))*D,i[6]=(x+T)*D,i[7]=0,i[8]=(_+A)*F,i[9]=(x-T)*F,i[10]=(1-(g+E))*F,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,r){const i=this.elements;if(e.x=i[12],e.y=i[13],e.z=i[14],this.determinant()===0)return r.set(1,1,1),t.identity(),this;let s=Jh.set(i[0],i[1],i[2]).length();const a=Jh.set(i[4],i[5],i[6]).length(),o=Jh.set(i[8],i[9],i[10]).length();this.determinant()<0&&(s=-s),io.copy(this);const c=1/s,f=1/a,m=1/o;return io.elements[0]*=c,io.elements[1]*=c,io.elements[2]*=c,io.elements[4]*=f,io.elements[5]*=f,io.elements[6]*=f,io.elements[8]*=m,io.elements[9]*=m,io.elements[10]*=m,t.setFromRotationMatrix(io),r.x=s,r.y=a,r.z=o,this}makePerspective(e,t,r,i,s,a,o=oa,u=!1){const c=this.elements,f=2*s/(t-e),m=2*s/(r-i),g=(t+e)/(t-e),y=(r+i)/(r-i);let _,E;if(u)_=s/(a-s),E=a*s/(a-s);else if(o===oa)_=-(a+s)/(a-s),E=-2*a*s/(a-s);else if(o===Uf)_=-a/(a-s),E=-a*s/(a-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);return c[0]=f,c[4]=0,c[8]=g,c[12]=0,c[1]=0,c[5]=m,c[9]=y,c[13]=0,c[2]=0,c[6]=0,c[10]=_,c[14]=E,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,t,r,i,s,a,o=oa,u=!1){const c=this.elements,f=2/(t-e),m=2/(r-i),g=-(t+e)/(t-e),y=-(r+i)/(r-i);let _,E;if(u)_=1/(a-s),E=a/(a-s);else if(o===oa)_=-2/(a-s),E=-(a+s)/(a-s);else if(o===Uf)_=-1/(a-s),E=-s/(a-s);else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);return c[0]=f,c[4]=0,c[8]=0,c[12]=g,c[1]=0,c[5]=m,c[9]=0,c[13]=y,c[2]=0,c[6]=0,c[10]=_,c[14]=E,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const t=this.elements,r=e.elements;for(let i=0;i<16;i++)if(t[i]!==r[i])return!1;return!0}fromArray(e,t=0){for(let r=0;r<16;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}}const Jh=new X,io=new vn,UA=new X(0,0,0),FA=new X(1,1,1),lu=new X,vm=new X,sa=new X,qS=new vn,YS=new xn;class Qi{constructor(e=0,t=0,r=0,i=Qi.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=r,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,r,i=this._order){return this._x=e,this._y=t,this._z=r,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,r=!0){const i=e.elements,s=i[0],a=i[4],o=i[8],u=i[1],c=i[5],f=i[9],m=i[2],g=i[6],y=i[10];switch(t){case"XYZ":this._y=Math.asin(gn(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-f,y),this._z=Math.atan2(-a,s)):(this._x=Math.atan2(g,c),this._z=0);break;case"YXZ":this._x=Math.asin(-gn(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(o,y),this._z=Math.atan2(u,c)):(this._y=Math.atan2(-m,s),this._z=0);break;case"ZXY":this._x=Math.asin(gn(g,-1,1)),Math.abs(g)<.9999999?(this._y=Math.atan2(-m,y),this._z=Math.atan2(-a,c)):(this._y=0,this._z=Math.atan2(u,s));break;case"ZYX":this._y=Math.asin(-gn(m,-1,1)),Math.abs(m)<.9999999?(this._x=Math.atan2(g,y),this._z=Math.atan2(u,s)):(this._x=0,this._z=Math.atan2(-a,c));break;case"YZX":this._z=Math.asin(gn(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(-f,c),this._y=Math.atan2(-m,s)):(this._x=0,this._y=Math.atan2(o,y));break;case"XZY":this._z=Math.asin(-gn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(g,c),this._y=Math.atan2(o,s)):(this._x=Math.atan2(-f,y),this._y=0);break;default:Ft("Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,r===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,r){return qS.makeRotationFromQuaternion(e),this.setFromRotationMatrix(qS,t,r)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return YS.setFromEuler(this),this.setFromQuaternion(YS,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Qi.DEFAULT_ORDER="XYZ";class Gc{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let OA=0;const ZS=new X,Kh=new xn,Sl=new vn,ym=new X,Wd=new X,kA=new X,zA=new xn,JS=new X(1,0,0),KS=new X(0,1,0),QS=new X(0,0,1),$S={type:"added"},BA={type:"removed"},Qh={type:"childadded",child:null},sy={type:"childremoved",child:null};class Hn extends Vo{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:OA++}),this.uuid=la(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Hn.DEFAULT_UP.clone();const e=new X,t=new Qi,r=new xn,i=new X(1,1,1);function s(){r.setFromEuler(t,!1)}function a(){t.setFromQuaternion(r,void 0,!1)}t._onChange(s),r._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new vn},normalMatrix:{value:new Tn}}),this.matrix=new vn,this.matrixWorld=new vn,this.matrixAutoUpdate=Hn.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Hn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Gc,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Kh.setFromAxisAngle(e,t),this.quaternion.multiply(Kh),this}rotateOnWorldAxis(e,t){return Kh.setFromAxisAngle(e,t),this.quaternion.premultiply(Kh),this}rotateX(e){return this.rotateOnAxis(JS,e)}rotateY(e){return this.rotateOnAxis(KS,e)}rotateZ(e){return this.rotateOnAxis(QS,e)}translateOnAxis(e,t){return ZS.copy(e).applyQuaternion(this.quaternion),this.position.add(ZS.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(JS,e)}translateY(e){return this.translateOnAxis(KS,e)}translateZ(e){return this.translateOnAxis(QS,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Sl.copy(this.matrixWorld).invert())}lookAt(e,t,r){e.isVector3?ym.copy(e):ym.set(e,t,r);const i=this.parent;this.updateWorldMatrix(!0,!1),Wd.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Sl.lookAt(Wd,ym,this.up):Sl.lookAt(ym,Wd,this.up),this.quaternion.setFromRotationMatrix(Sl),i&&(Sl.extractRotation(i.matrixWorld),Kh.setFromRotationMatrix(Sl),this.quaternion.premultiply(Kh.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(ln("Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent($S),Qh.child=e,this.dispatchEvent(Qh),Qh.child=null):ln("Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(BA),sy.child=e,this.dispatchEvent(sy),sy.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Sl.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Sl.multiply(e.parent.matrixWorld)),e.applyMatrix4(Sl),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent($S),Qh.child=e,this.dispatchEvent(Qh),Qh.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let r=0,i=this.children.length;r<i;r++){const a=this.children[r].getObjectByProperty(e,t);if(a!==void 0)return a}}getObjectsByProperty(e,t,r=[]){this[e]===t&&r.push(this);const i=this.children;for(let s=0,a=i.length;s<a;s++)i[s].getObjectsByProperty(e,t,r);return r}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Wd,e,kA),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Wd,zA,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].updateMatrixWorld(e)}updateWorldMatrix(e,t){const r=this.parent;if(e===!0&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const i=this.children;for(let s=0,a=i.length;s<a;s++)i[s].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",r={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.geometryInfo=this._geometryInfo.map(o=>({...o,boundingBox:o.boundingBox?o.boundingBox.toJSON():void 0,boundingSphere:o.boundingSphere?o.boundingSphere.toJSON():void 0})),i.instanceInfo=this._instanceInfo.map(o=>({...o})),i.availableInstanceIds=this._availableInstanceIds.slice(),i.availableGeometryIds=this._availableGeometryIds.slice(),i.nextIndexStart=this._nextIndexStart,i.nextVertexStart=this._nextVertexStart,i.geometryCount=this._geometryCount,i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.matricesTexture=this._matricesTexture.toJSON(e),i.indirectTexture=this._indirectTexture.toJSON(e),this._colorsTexture!==null&&(i.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(i.boundingSphere=this.boundingSphere.toJSON()),this.boundingBox!==null&&(i.boundingBox=this.boundingBox.toJSON()));function s(o,u){return o[u.uuid]===void 0&&(o[u.uuid]=u.toJSON(e)),u.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=s(e.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const u=o.shapes;if(Array.isArray(u))for(let c=0,f=u.length;c<f;c++){const m=u[c];s(e.shapes,m)}else s(e.shapes,u)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let u=0,c=this.material.length;u<c;u++)o.push(s(e.materials,this.material[u]));i.material=o}else i.material=s(e.materials,this.material);if(this.children.length>0){i.children=[];for(let o=0;o<this.children.length;o++)i.children.push(this.children[o].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let o=0;o<this.animations.length;o++){const u=this.animations[o];i.animations.push(s(e.animations,u))}}if(t){const o=a(e.geometries),u=a(e.materials),c=a(e.textures),f=a(e.images),m=a(e.shapes),g=a(e.skeletons),y=a(e.animations),_=a(e.nodes);o.length>0&&(r.geometries=o),u.length>0&&(r.materials=u),c.length>0&&(r.textures=c),f.length>0&&(r.images=f),m.length>0&&(r.shapes=m),g.length>0&&(r.skeletons=g),y.length>0&&(r.animations=y),_.length>0&&(r.nodes=_)}return r.object=i,r;function a(o){const u=[];for(const c in o){const f=o[c];delete f.metadata,u.push(f)}return u}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let r=0;r<e.children.length;r++){const i=e.children[r];this.add(i.clone())}return this}}Hn.DEFAULT_UP=new X(0,1,0);Hn.DEFAULT_MATRIX_AUTO_UPDATE=!0;Hn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const ro=new X,Ml=new X,ay=new X,wl=new X,$h=new X,ef=new X,eM=new X,oy=new X,ly=new X,uy=new X,cy=new $n,hy=new $n,fy=new $n;class Hs{constructor(e=new X,t=new X,r=new X){this.a=e,this.b=t,this.c=r}static getNormal(e,t,r,i){i.subVectors(r,t),ro.subVectors(e,t),i.cross(ro);const s=i.lengthSq();return s>0?i.multiplyScalar(1/Math.sqrt(s)):i.set(0,0,0)}static getBarycoord(e,t,r,i,s){ro.subVectors(i,t),Ml.subVectors(r,t),ay.subVectors(e,t);const a=ro.dot(ro),o=ro.dot(Ml),u=ro.dot(ay),c=Ml.dot(Ml),f=Ml.dot(ay),m=a*c-o*o;if(m===0)return s.set(0,0,0),null;const g=1/m,y=(c*u-o*f)*g,_=(a*f-o*u)*g;return s.set(1-y-_,_,y)}static containsPoint(e,t,r,i){return this.getBarycoord(e,t,r,i,wl)===null?!1:wl.x>=0&&wl.y>=0&&wl.x+wl.y<=1}static getInterpolation(e,t,r,i,s,a,o,u){return this.getBarycoord(e,t,r,i,wl)===null?(u.x=0,u.y=0,"z"in u&&(u.z=0),"w"in u&&(u.w=0),null):(u.setScalar(0),u.addScaledVector(s,wl.x),u.addScaledVector(a,wl.y),u.addScaledVector(o,wl.z),u)}static getInterpolatedAttribute(e,t,r,i,s,a){return cy.setScalar(0),hy.setScalar(0),fy.setScalar(0),cy.fromBufferAttribute(e,t),hy.fromBufferAttribute(e,r),fy.fromBufferAttribute(e,i),a.setScalar(0),a.addScaledVector(cy,s.x),a.addScaledVector(hy,s.y),a.addScaledVector(fy,s.z),a}static isFrontFacing(e,t,r,i){return ro.subVectors(r,t),Ml.subVectors(e,t),ro.cross(Ml).dot(i)<0}set(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this}setFromPointsAndIndices(e,t,r,i){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,r,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return ro.subVectors(this.c,this.b),Ml.subVectors(this.a,this.b),ro.cross(Ml).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Hs.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Hs.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,r,i,s){return Hs.getInterpolation(e,this.a,this.b,this.c,t,r,i,s)}containsPoint(e){return Hs.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Hs.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const r=this.a,i=this.b,s=this.c;let a,o;$h.subVectors(i,r),ef.subVectors(s,r),oy.subVectors(e,r);const u=$h.dot(oy),c=ef.dot(oy);if(u<=0&&c<=0)return t.copy(r);ly.subVectors(e,i);const f=$h.dot(ly),m=ef.dot(ly);if(f>=0&&m<=f)return t.copy(i);const g=u*m-f*c;if(g<=0&&u>=0&&f<=0)return a=u/(u-f),t.copy(r).addScaledVector($h,a);uy.subVectors(e,s);const y=$h.dot(uy),_=ef.dot(uy);if(_>=0&&y<=_)return t.copy(s);const E=y*c-u*_;if(E<=0&&c>=0&&_<=0)return o=c/(c-_),t.copy(r).addScaledVector(ef,o);const x=f*_-y*m;if(x<=0&&m-f>=0&&y-_>=0)return eM.subVectors(s,i),o=(m-f)/(m-f+(y-_)),t.copy(i).addScaledVector(eM,o);const S=1/(x+E+g);return a=E*S,o=g*S,t.copy(r).addScaledVector($h,a).addScaledVector(ef,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const fE={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},uu={h:0,s:0,l:0},_m={h:0,s:0,l:0};function dy(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*6*(2/3-t):n}class jt{constructor(e,t,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,r)}set(e,t,r){if(t===void 0&&r===void 0){const i=e;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(e,t,r);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=rs){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,kn.colorSpaceToWorking(this,t),this}setRGB(e,t,r,i=kn.workingColorSpace){return this.r=e,this.g=t,this.b=r,kn.colorSpaceToWorking(this,i),this}setHSL(e,t,r,i=kn.workingColorSpace){if(e=ex(e,1),t=gn(t,0,1),r=gn(r,0,1),t===0)this.r=this.g=this.b=r;else{const s=r<=.5?r*(1+t):r+t-r*t,a=2*r-s;this.r=dy(a,s,e+1/3),this.g=dy(a,s,e),this.b=dy(a,s,e-1/3)}return kn.colorSpaceToWorking(this,i),this}setStyle(e,t=rs){function r(s){s!==void 0&&parseFloat(s)<1&&Ft("Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const a=i[1],o=i[2];switch(a){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:Ft("Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=i[1],a=s.length;if(a===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(a===6)return this.setHex(parseInt(s,16),t);Ft("Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=rs){const r=fE[e.toLowerCase()];return r!==void 0?this.setHex(r,t):Ft("Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Cl(e.r),this.g=Cl(e.g),this.b=Cl(e.b),this}copyLinearToSRGB(e){return this.r=Cf(e.r),this.g=Cf(e.g),this.b=Cf(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=rs){return kn.workingToColorSpace(ts.copy(this),e),Math.round(gn(ts.r*255,0,255))*65536+Math.round(gn(ts.g*255,0,255))*256+Math.round(gn(ts.b*255,0,255))}getHexString(e=rs){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=kn.workingColorSpace){kn.workingToColorSpace(ts.copy(this),t);const r=ts.r,i=ts.g,s=ts.b,a=Math.max(r,i,s),o=Math.min(r,i,s);let u,c;const f=(o+a)/2;if(o===a)u=0,c=0;else{const m=a-o;switch(c=f<=.5?m/(a+o):m/(2-a-o),a){case r:u=(i-s)/m+(i<s?6:0);break;case i:u=(s-r)/m+2;break;case s:u=(r-i)/m+4;break}u/=6}return e.h=u,e.s=c,e.l=f,e}getRGB(e,t=kn.workingColorSpace){return kn.workingToColorSpace(ts.copy(this),t),e.r=ts.r,e.g=ts.g,e.b=ts.b,e}getStyle(e=rs){kn.workingToColorSpace(ts.copy(this),e);const t=ts.r,r=ts.g,i=ts.b;return e!==rs?`color(${e} ${t.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(r*255)},${Math.round(i*255)})`}offsetHSL(e,t,r){return this.getHSL(uu),this.setHSL(uu.h+e,uu.s+t,uu.l+r)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,r){return this.r=e.r+(t.r-e.r)*r,this.g=e.g+(t.g-e.g)*r,this.b=e.b+(t.b-e.b)*r,this}lerpHSL(e,t){this.getHSL(uu),e.getHSL(_m);const r=xp(uu.h,_m.h,t),i=xp(uu.s,_m.s,t),s=xp(uu.l,_m.l,t);return this.setHSL(r,i,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,r=this.g,i=this.b,s=e.elements;return this.r=s[0]*t+s[3]*r+s[6]*i,this.g=s[1]*t+s[4]*r+s[7]*i,this.b=s[2]*t+s[5]*r+s[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const ts=new jt;jt.NAMES=fE;let GA=0;class ss extends Vo{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:GA++}),this.uuid=la(),this.name="",this.type="Material",this.blending=zc,this.side=Pl,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=bg,this.blendDst=Ag,this.blendEquation=gu,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new jt(0,0,0),this.blendAlpha=0,this.depthFunc=Wc,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=p_,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Rc,this.stencilZFail=Rc,this.stencilZPass=Rc,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const r=e[t];if(r===void 0){Ft(`Material: parameter '${t}' has value of undefined.`);continue}const i=this[t];if(i===void 0){Ft(`Material: '${t}' is not a property of THREE.${this.type}.`);continue}i&&i.isColor?i.set(r):i&&i.isVector3&&r&&r.isVector3?i.copy(r):this[t]=r}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const r={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.sheen!==void 0&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearcoat!==void 0&&(r.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.sheenColorMap&&this.sheenColorMap.isTexture&&(r.sheenColorMap=this.sheenColorMap.toJSON(e).uuid),this.sheenRoughnessMap&&this.sheenRoughnessMap.isTexture&&(r.sheenRoughnessMap=this.sheenRoughnessMap.toJSON(e).uuid),this.dispersion!==void 0&&(r.dispersion=this.dispersion),this.iridescence!==void 0&&(r.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(r.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(r.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(r.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(r.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(r.combine=this.combine)),this.envMapRotation!==void 0&&(r.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(r.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(r.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(r.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(r.size=this.size),this.shadowSide!==null&&(r.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==zc&&(r.blending=this.blending),this.side!==Pl&&(r.side=this.side),this.vertexColors===!0&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=!0),this.blendSrc!==bg&&(r.blendSrc=this.blendSrc),this.blendDst!==Ag&&(r.blendDst=this.blendDst),this.blendEquation!==gu&&(r.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(r.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(r.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(r.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(r.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(r.blendAlpha=this.blendAlpha),this.depthFunc!==Wc&&(r.depthFunc=this.depthFunc),this.depthTest===!1&&(r.depthTest=this.depthTest),this.depthWrite===!1&&(r.depthWrite=this.depthWrite),this.colorWrite===!1&&(r.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(r.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==p_&&(r.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(r.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(r.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Rc&&(r.stencilFail=this.stencilFail),this.stencilZFail!==Rc&&(r.stencilZFail=this.stencilZFail),this.stencilZPass!==Rc&&(r.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(r.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(r.rotation=this.rotation),this.polygonOffset===!0&&(r.polygonOffset=!0),this.polygonOffsetFactor!==0&&(r.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.alphaHash===!0&&(r.alphaHash=!0),this.alphaToCoverage===!0&&(r.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=!0),this.forceSinglePass===!0&&(r.forceSinglePass=!0),this.allowOverride===!1&&(r.allowOverride=!1),this.wireframe===!0&&(r.wireframe=!0),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(r.flatShading=!0),this.visible===!1&&(r.visible=!1),this.toneMapped===!1&&(r.toneMapped=!1),this.fog===!1&&(r.fog=!1),Object.keys(this.userData).length>0&&(r.userData=this.userData);function i(s){const a=[];for(const o in s){const u=s[o];delete u.metadata,a.push(u)}return a}if(t){const s=i(e.textures),a=i(e.images);s.length>0&&(r.textures=s),a.length>0&&(r.images=a)}return r}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let r=null;if(t!==null){const i=t.length;r=new Array(i);for(let s=0;s!==i;++s)r[s]=t[s].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.allowOverride=e.allowOverride,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class Ho extends ss{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new jt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Qi,this.combine=e0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Al=VA();function VA(){const n=new ArrayBuffer(4),e=new Float32Array(n),t=new Uint32Array(n),r=new Uint32Array(512),i=new Uint32Array(512);for(let u=0;u<256;++u){const c=u-127;c<-27?(r[u]=0,r[u|256]=32768,i[u]=24,i[u|256]=24):c<-14?(r[u]=1024>>-c-14,r[u|256]=1024>>-c-14|32768,i[u]=-c-1,i[u|256]=-c-1):c<=15?(r[u]=c+15<<10,r[u|256]=c+15<<10|32768,i[u]=13,i[u|256]=13):c<128?(r[u]=31744,r[u|256]=64512,i[u]=24,i[u|256]=24):(r[u]=31744,r[u|256]=64512,i[u]=13,i[u|256]=13)}const s=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let u=1;u<1024;++u){let c=u<<13,f=0;for(;(c&8388608)===0;)c<<=1,f-=8388608;c&=-8388609,f+=947912704,s[u]=c|f}for(let u=1024;u<2048;++u)s[u]=939524096+(u-1024<<13);for(let u=1;u<31;++u)a[u]=u<<23;a[31]=1199570944,a[32]=2147483648;for(let u=33;u<63;++u)a[u]=2147483648+(u-32<<23);a[63]=3347054592;for(let u=1;u<64;++u)u!==32&&(o[u]=1024);return{floatView:e,uint32View:t,baseTable:r,shiftTable:i,mantissaTable:s,exponentTable:a,offsetTable:o}}function Gs(n){Math.abs(n)>65504&&Ft("DataUtils.toHalfFloat(): Value out of range."),n=gn(n,-65504,65504),Al.floatView[0]=n;const e=Al.uint32View[0],t=e>>23&511;return Al.baseTable[t]+((e&8388607)>>Al.shiftTable[t])}function op(n){const e=n>>10;return Al.uint32View[0]=Al.mantissaTable[Al.offsetTable[e]+(n&1023)]+Al.exponentTable[e],Al.floatView[0]}class Fc{static toHalfFloat(e){return Gs(e)}static fromHalfFloat(e){return op(e)}}const cr=new X,xm=new ct;let HA=0;class jn{constructor(e,t,r=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:HA++}),this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=r,this.usage=Op,this.updateRanges=[],this.gpuType=bi,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,r){e*=this.itemSize,r*=t.itemSize;for(let i=0,s=this.itemSize;i<s;i++)this.array[e+i]=t.array[r+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,r=this.count;t<r;t++)xm.fromBufferAttribute(this,t),xm.applyMatrix3(e),this.setXY(t,xm.x,xm.y);else if(this.itemSize===3)for(let t=0,r=this.count;t<r;t++)cr.fromBufferAttribute(this,t),cr.applyMatrix3(e),this.setXYZ(t,cr.x,cr.y,cr.z);return this}applyMatrix4(e){for(let t=0,r=this.count;t<r;t++)cr.fromBufferAttribute(this,t),cr.applyMatrix4(e),this.setXYZ(t,cr.x,cr.y,cr.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)cr.fromBufferAttribute(this,t),cr.applyNormalMatrix(e),this.setXYZ(t,cr.x,cr.y,cr.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)cr.fromBufferAttribute(this,t),cr.transformDirection(e),this.setXYZ(t,cr.x,cr.y,cr.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let r=this.array[e*this.itemSize+t];return this.normalized&&(r=xs(r,this.array)),r}setComponent(e,t,r){return this.normalized&&(r=Rn(r,this.array)),this.array[e*this.itemSize+t]=r,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=xs(t,this.array)),t}setX(e,t){return this.normalized&&(t=Rn(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=xs(t,this.array)),t}setY(e,t){return this.normalized&&(t=Rn(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=xs(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Rn(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=xs(t,this.array)),t}setW(e,t){return this.normalized&&(t=Rn(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,r){return e*=this.itemSize,this.normalized&&(t=Rn(t,this.array),r=Rn(r,this.array)),this.array[e+0]=t,this.array[e+1]=r,this}setXYZ(e,t,r,i){return e*=this.itemSize,this.normalized&&(t=Rn(t,this.array),r=Rn(r,this.array),i=Rn(i,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this}setXYZW(e,t,r,i,s){return e*=this.itemSize,this.normalized&&(t=Rn(t,this.array),r=Rn(r,this.array),i=Rn(i,this.array),s=Rn(s,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==Op&&(e.usage=this.usage),e}}class WA extends jn{constructor(e,t,r){super(new Int8Array(e),t,r)}}class jA extends jn{constructor(e,t,r){super(new Uint8Array(e),t,r)}}class XA extends jn{constructor(e,t,r){super(new Uint8ClampedArray(e),t,r)}}class qA extends jn{constructor(e,t,r){super(new Int16Array(e),t,r)}}class nx extends jn{constructor(e,t,r){super(new Uint16Array(e),t,r)}}class YA extends jn{constructor(e,t,r){super(new Int32Array(e),t,r)}}class ix extends jn{constructor(e,t,r){super(new Uint32Array(e),t,r)}}class ZA extends jn{constructor(e,t,r){super(new Uint16Array(e),t,r),this.isFloat16BufferAttribute=!0}getX(e){let t=op(this.array[e*this.itemSize]);return this.normalized&&(t=xs(t,this.array)),t}setX(e,t){return this.normalized&&(t=Rn(t,this.array)),this.array[e*this.itemSize]=Gs(t),this}getY(e){let t=op(this.array[e*this.itemSize+1]);return this.normalized&&(t=xs(t,this.array)),t}setY(e,t){return this.normalized&&(t=Rn(t,this.array)),this.array[e*this.itemSize+1]=Gs(t),this}getZ(e){let t=op(this.array[e*this.itemSize+2]);return this.normalized&&(t=xs(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Rn(t,this.array)),this.array[e*this.itemSize+2]=Gs(t),this}getW(e){let t=op(this.array[e*this.itemSize+3]);return this.normalized&&(t=xs(t,this.array)),t}setW(e,t){return this.normalized&&(t=Rn(t,this.array)),this.array[e*this.itemSize+3]=Gs(t),this}setXY(e,t,r){return e*=this.itemSize,this.normalized&&(t=Rn(t,this.array),r=Rn(r,this.array)),this.array[e+0]=Gs(t),this.array[e+1]=Gs(r),this}setXYZ(e,t,r,i){return e*=this.itemSize,this.normalized&&(t=Rn(t,this.array),r=Rn(r,this.array),i=Rn(i,this.array)),this.array[e+0]=Gs(t),this.array[e+1]=Gs(r),this.array[e+2]=Gs(i),this}setXYZW(e,t,r,i,s){return e*=this.itemSize,this.normalized&&(t=Rn(t,this.array),r=Rn(r,this.array),i=Rn(i,this.array),s=Rn(s,this.array)),this.array[e+0]=Gs(t),this.array[e+1]=Gs(r),this.array[e+2]=Gs(i),this.array[e+3]=Gs(s),this}}class Jt extends jn{constructor(e,t,r){super(new Float32Array(e),t,r)}}let JA=0;const Ma=new vn,py=new Hn,tf=new X,aa=new Nr,jd=new Nr,Cr=new X;class Sn extends Vo{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:JA++}),this.uuid=la(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.indirectOffset=0,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(lE(e)?ix:nx)(e,1):this.index=e,this}setIndirect(e,t=0){return this.indirect=e,this.indirectOffset=t,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,r=0){this.groups.push({start:e,count:t,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const r=this.attributes.normal;if(r!==void 0){const s=new Tn().getNormalMatrix(e);r.applyNormalMatrix(s),r.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Ma.makeRotationFromQuaternion(e),this.applyMatrix4(Ma),this}rotateX(e){return Ma.makeRotationX(e),this.applyMatrix4(Ma),this}rotateY(e){return Ma.makeRotationY(e),this.applyMatrix4(Ma),this}rotateZ(e){return Ma.makeRotationZ(e),this.applyMatrix4(Ma),this}translate(e,t,r){return Ma.makeTranslation(e,t,r),this.applyMatrix4(Ma),this}scale(e,t,r){return Ma.makeScale(e,t,r),this.applyMatrix4(Ma),this}lookAt(e){return py.lookAt(e),py.updateMatrix(),this.applyMatrix4(py.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(tf).negate(),this.translate(tf.x,tf.y,tf.z),this}setFromPoints(e){const t=this.getAttribute("position");if(t===void 0){const r=[];for(let i=0,s=e.length;i<s;i++){const a=e[i];r.push(a.x,a.y,a.z||0)}this.setAttribute("position",new Jt(r,3))}else{const r=Math.min(e.length,t.count);for(let i=0;i<r;i++){const s=e[i];t.setXYZ(i,s.x,s.y,s.z||0)}e.length>t.count&&Ft("BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Nr);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){ln("BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new X(-1/0,-1/0,-1/0),new X(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let r=0,i=t.length;r<i;r++){const s=t[r];aa.setFromBufferAttribute(s),this.morphTargetsRelative?(Cr.addVectors(this.boundingBox.min,aa.min),this.boundingBox.expandByPoint(Cr),Cr.addVectors(this.boundingBox.max,aa.max),this.boundingBox.expandByPoint(Cr)):(this.boundingBox.expandByPoint(aa.min),this.boundingBox.expandByPoint(aa.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&ln('BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Dr);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){ln("BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new X,1/0);return}if(e){const r=this.boundingSphere.center;if(aa.setFromBufferAttribute(e),t)for(let s=0,a=t.length;s<a;s++){const o=t[s];jd.setFromBufferAttribute(o),this.morphTargetsRelative?(Cr.addVectors(aa.min,jd.min),aa.expandByPoint(Cr),Cr.addVectors(aa.max,jd.max),aa.expandByPoint(Cr)):(aa.expandByPoint(jd.min),aa.expandByPoint(jd.max))}aa.getCenter(r);let i=0;for(let s=0,a=e.count;s<a;s++)Cr.fromBufferAttribute(e,s),i=Math.max(i,r.distanceToSquared(Cr));if(t)for(let s=0,a=t.length;s<a;s++){const o=t[s],u=this.morphTargetsRelative;for(let c=0,f=o.count;c<f;c++)Cr.fromBufferAttribute(o,c),u&&(tf.fromBufferAttribute(e,c),Cr.add(tf)),i=Math.max(i,r.distanceToSquared(Cr))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&ln('BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){ln("BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const r=t.position,i=t.normal,s=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new jn(new Float32Array(4*r.count),4));const a=this.getAttribute("tangent"),o=[],u=[];for(let k=0;k<r.count;k++)o[k]=new X,u[k]=new X;const c=new X,f=new X,m=new X,g=new ct,y=new ct,_=new ct,E=new X,x=new X;function S(k,R,U){c.fromBufferAttribute(r,k),f.fromBufferAttribute(r,R),m.fromBufferAttribute(r,U),g.fromBufferAttribute(s,k),y.fromBufferAttribute(s,R),_.fromBufferAttribute(s,U),f.sub(c),m.sub(c),y.sub(g),_.sub(g);const V=1/(y.x*_.y-_.x*y.y);isFinite(V)&&(E.copy(f).multiplyScalar(_.y).addScaledVector(m,-y.y).multiplyScalar(V),x.copy(m).multiplyScalar(y.x).addScaledVector(f,-_.x).multiplyScalar(V),o[k].add(E),o[R].add(E),o[U].add(E),u[k].add(x),u[R].add(x),u[U].add(x))}let T=this.groups;T.length===0&&(T=[{start:0,count:e.count}]);for(let k=0,R=T.length;k<R;++k){const U=T[k],V=U.start,H=U.count;for(let J=V,$=V+H;J<$;J+=3)S(e.getX(J+0),e.getX(J+1),e.getX(J+2))}const A=new X,P=new X,L=new X,D=new X;function F(k){L.fromBufferAttribute(i,k),D.copy(L);const R=o[k];A.copy(R),A.sub(L.multiplyScalar(L.dot(R))).normalize(),P.crossVectors(D,R);const V=P.dot(u[k])<0?-1:1;a.setXYZW(k,A.x,A.y,A.z,V)}for(let k=0,R=T.length;k<R;++k){const U=T[k],V=U.start,H=U.count;for(let J=V,$=V+H;J<$;J+=3)F(e.getX(J+0)),F(e.getX(J+1)),F(e.getX(J+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new jn(new Float32Array(t.count*3),3),this.setAttribute("normal",r);else for(let g=0,y=r.count;g<y;g++)r.setXYZ(g,0,0,0);const i=new X,s=new X,a=new X,o=new X,u=new X,c=new X,f=new X,m=new X;if(e)for(let g=0,y=e.count;g<y;g+=3){const _=e.getX(g+0),E=e.getX(g+1),x=e.getX(g+2);i.fromBufferAttribute(t,_),s.fromBufferAttribute(t,E),a.fromBufferAttribute(t,x),f.subVectors(a,s),m.subVectors(i,s),f.cross(m),o.fromBufferAttribute(r,_),u.fromBufferAttribute(r,E),c.fromBufferAttribute(r,x),o.add(f),u.add(f),c.add(f),r.setXYZ(_,o.x,o.y,o.z),r.setXYZ(E,u.x,u.y,u.z),r.setXYZ(x,c.x,c.y,c.z)}else for(let g=0,y=t.count;g<y;g+=3)i.fromBufferAttribute(t,g+0),s.fromBufferAttribute(t,g+1),a.fromBufferAttribute(t,g+2),f.subVectors(a,s),m.subVectors(i,s),f.cross(m),r.setXYZ(g+0,f.x,f.y,f.z),r.setXYZ(g+1,f.x,f.y,f.z),r.setXYZ(g+2,f.x,f.y,f.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,r=e.count;t<r;t++)Cr.fromBufferAttribute(e,t),Cr.normalize(),e.setXYZ(t,Cr.x,Cr.y,Cr.z)}toNonIndexed(){function e(o,u){const c=o.array,f=o.itemSize,m=o.normalized,g=new c.constructor(u.length*f);let y=0,_=0;for(let E=0,x=u.length;E<x;E++){o.isInterleavedBufferAttribute?y=u[E]*o.data.stride+o.offset:y=u[E]*f;for(let S=0;S<f;S++)g[_++]=c[y++]}return new jn(g,f,m)}if(this.index===null)return Ft("BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Sn,r=this.index.array,i=this.attributes;for(const o in i){const u=i[o],c=e(u,r);t.setAttribute(o,c)}const s=this.morphAttributes;for(const o in s){const u=[],c=s[o];for(let f=0,m=c.length;f<m;f++){const g=c[f],y=e(g,r);u.push(y)}t.morphAttributes[o]=u}t.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let o=0,u=a.length;o<u;o++){const c=a[o];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const u=this.parameters;for(const c in u)u[c]!==void 0&&(e[c]=u[c]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const r=this.attributes;for(const u in r){const c=r[u];e.data.attributes[u]=c.toJSON(e.data)}const i={};let s=!1;for(const u in this.morphAttributes){const c=this.morphAttributes[u],f=[];for(let m=0,g=c.length;m<g;m++){const y=c[m];f.push(y.toJSON(e.data))}f.length>0&&(i[u]=f,s=!0)}s&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return o!==null&&(e.data.boundingSphere=o.toJSON()),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const r=e.index;r!==null&&this.setIndex(r.clone());const i=e.attributes;for(const c in i){const f=i[c];this.setAttribute(c,f.clone(t))}const s=e.morphAttributes;for(const c in s){const f=[],m=s[c];for(let g=0,y=m.length;g<y;g++)f.push(m[g].clone(t));this.morphAttributes[c]=f}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let c=0,f=a.length;c<f;c++){const m=a[c];this.addGroup(m.start,m.count,m.materialIndex)}const o=e.boundingBox;o!==null&&(this.boundingBox=o.clone());const u=e.boundingSphere;return u!==null&&(this.boundingSphere=u.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const tM=new vn,vc=new jf,Sm=new Dr,nM=new X,Mm=new X,wm=new X,Em=new X,my=new X,Tm=new X,iM=new X,bm=new X;class pi extends Hn{constructor(e=new Sn,t=new Ho){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,r=Object.keys(t);if(r.length>0){const i=t[r[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=i.length;s<a;s++){const o=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}getVertexPosition(e,t){const r=this.geometry,i=r.attributes.position,s=r.morphAttributes.position,a=r.morphTargetsRelative;t.fromBufferAttribute(i,e);const o=this.morphTargetInfluences;if(s&&o){Tm.set(0,0,0);for(let u=0,c=s.length;u<c;u++){const f=o[u],m=s[u];f!==0&&(my.fromBufferAttribute(m,e),a?Tm.addScaledVector(my,f):Tm.addScaledVector(my.sub(t),f))}t.add(Tm)}return t}raycast(e,t){const r=this.geometry,i=this.material,s=this.matrixWorld;i!==void 0&&(r.boundingSphere===null&&r.computeBoundingSphere(),Sm.copy(r.boundingSphere),Sm.applyMatrix4(s),vc.copy(e.ray).recast(e.near),!(Sm.containsPoint(vc.origin)===!1&&(vc.intersectSphere(Sm,nM)===null||vc.origin.distanceToSquared(nM)>(e.far-e.near)**2))&&(tM.copy(s).invert(),vc.copy(e.ray).applyMatrix4(tM),!(r.boundingBox!==null&&vc.intersectsBox(r.boundingBox)===!1)&&this._computeIntersections(e,t,vc)))}_computeIntersections(e,t,r){let i;const s=this.geometry,a=this.material,o=s.index,u=s.attributes.position,c=s.attributes.uv,f=s.attributes.uv1,m=s.attributes.normal,g=s.groups,y=s.drawRange;if(o!==null)if(Array.isArray(a))for(let _=0,E=g.length;_<E;_++){const x=g[_],S=a[x.materialIndex],T=Math.max(x.start,y.start),A=Math.min(o.count,Math.min(x.start+x.count,y.start+y.count));for(let P=T,L=A;P<L;P+=3){const D=o.getX(P),F=o.getX(P+1),k=o.getX(P+2);i=Am(this,S,e,r,c,f,m,D,F,k),i&&(i.faceIndex=Math.floor(P/3),i.face.materialIndex=x.materialIndex,t.push(i))}}else{const _=Math.max(0,y.start),E=Math.min(o.count,y.start+y.count);for(let x=_,S=E;x<S;x+=3){const T=o.getX(x),A=o.getX(x+1),P=o.getX(x+2);i=Am(this,a,e,r,c,f,m,T,A,P),i&&(i.faceIndex=Math.floor(x/3),t.push(i))}}else if(u!==void 0)if(Array.isArray(a))for(let _=0,E=g.length;_<E;_++){const x=g[_],S=a[x.materialIndex],T=Math.max(x.start,y.start),A=Math.min(u.count,Math.min(x.start+x.count,y.start+y.count));for(let P=T,L=A;P<L;P+=3){const D=P,F=P+1,k=P+2;i=Am(this,S,e,r,c,f,m,D,F,k),i&&(i.faceIndex=Math.floor(P/3),i.face.materialIndex=x.materialIndex,t.push(i))}}else{const _=Math.max(0,y.start),E=Math.min(u.count,y.start+y.count);for(let x=_,S=E;x<S;x+=3){const T=x,A=x+1,P=x+2;i=Am(this,a,e,r,c,f,m,T,A,P),i&&(i.faceIndex=Math.floor(x/3),t.push(i))}}}}function KA(n,e,t,r,i,s,a,o){let u;if(e.side===Ms?u=r.intersectTriangle(a,s,i,!0,o):u=r.intersectTriangle(i,s,a,e.side===Pl,o),u===null)return null;bm.copy(o),bm.applyMatrix4(n.matrixWorld);const c=t.ray.origin.distanceTo(bm);return c<t.near||c>t.far?null:{distance:c,point:bm.clone(),object:n}}function Am(n,e,t,r,i,s,a,o,u,c){n.getVertexPosition(o,Mm),n.getVertexPosition(u,wm),n.getVertexPosition(c,Em);const f=KA(n,e,t,r,Mm,wm,Em,iM);if(f){const m=new X;Hs.getBarycoord(iM,Mm,wm,Em,m),i&&(f.uv=Hs.getInterpolatedAttribute(i,o,u,c,m,new ct)),s&&(f.uv1=Hs.getInterpolatedAttribute(s,o,u,c,m,new ct)),a&&(f.normal=Hs.getInterpolatedAttribute(a,o,u,c,m,new X),f.normal.dot(r.direction)>0&&f.normal.multiplyScalar(-1));const g={a:o,b:u,c,normal:new X,materialIndex:0};Hs.getNormal(Mm,wm,Em,g.normal),f.face=g,f.barycoord=m}return f}class Qc extends Sn{constructor(e=1,t=1,r=1,i=1,s=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:i,heightSegments:s,depthSegments:a};const o=this;i=Math.floor(i),s=Math.floor(s),a=Math.floor(a);const u=[],c=[],f=[],m=[];let g=0,y=0;_("z","y","x",-1,-1,r,t,e,a,s,0),_("z","y","x",1,-1,r,t,-e,a,s,1),_("x","z","y",1,1,e,r,t,i,a,2),_("x","z","y",1,-1,e,r,-t,i,a,3),_("x","y","z",1,-1,e,t,r,i,s,4),_("x","y","z",-1,-1,e,t,-r,i,s,5),this.setIndex(u),this.setAttribute("position",new Jt(c,3)),this.setAttribute("normal",new Jt(f,3)),this.setAttribute("uv",new Jt(m,2));function _(E,x,S,T,A,P,L,D,F,k,R){const U=P/F,V=L/k,H=P/2,J=L/2,$=D/2,ae=F+1,ne=k+1;let oe=0,te=0;const ie=new X;for(let Y=0;Y<ne;Y++){const z=Y*V-J;for(let K=0;K<ae;K++){const le=K*U-H;ie[E]=le*T,ie[x]=z*A,ie[S]=$,c.push(ie.x,ie.y,ie.z),ie[E]=0,ie[x]=0,ie[S]=D>0?1:-1,f.push(ie.x,ie.y,ie.z),m.push(K/F),m.push(1-Y/k),oe+=1}}for(let Y=0;Y<k;Y++)for(let z=0;z<F;z++){const K=g+z+ae*Y,le=g+z+ae*(Y+1),me=g+(z+1)+ae*(Y+1),ve=g+(z+1)+ae*Y;u.push(K,le,ve),u.push(le,me,ve),te+=6}o.addGroup(y,te,R),y+=te,g+=oe}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Qc(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function kf(n){const e={};for(const t in n){e[t]={};for(const r in n[t]){const i=n[t][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(Ft("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][r]=null):e[t][r]=i.clone():Array.isArray(i)?e[t][r]=i.slice():e[t][r]=i}}return e}function _s(n){const e={};for(let t=0;t<n.length;t++){const r=kf(n[t]);for(const i in r)e[i]=r[i]}return e}function QA(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}function dE(n){const e=n.getRenderTarget();return e===null?n.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:kn.workingColorSpace}const rx={clone:kf,merge:_s};var $A=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,eC=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Es extends ss{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=$A,this.fragmentShader=eC,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=kf(e.uniforms),this.uniformsGroups=QA(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this.defaultAttributeValues=Object.assign({},e.defaultAttributeValues),this.index0AttributeName=e.index0AttributeName,this.uniformsNeedUpdate=e.uniformsNeedUpdate,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const a=this.uniforms[i].value;a&&a.isTexture?t.uniforms[i]={type:"t",value:a.toJSON(e).uuid}:a&&a.isColor?t.uniforms[i]={type:"c",value:a.getHex()}:a&&a.isVector2?t.uniforms[i]={type:"v2",value:a.toArray()}:a&&a.isVector3?t.uniforms[i]={type:"v3",value:a.toArray()}:a&&a.isVector4?t.uniforms[i]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?t.uniforms[i]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?t.uniforms[i]={type:"m4",value:a.toArray()}:t.uniforms[i]={value:a}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const r={};for(const i in this.extensions)this.extensions[i]===!0&&(r[i]=!0);return Object.keys(r).length>0&&(t.extensions=r),t}}class r0 extends Hn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new vn,this.projectionMatrix=new vn,this.projectionMatrixInverse=new vn,this.coordinateSystem=oa,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const cu=new X,rM=new ct,sM=new ct;class Pr extends r0{constructor(e=50,t=1,r=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=Of*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Bc*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Of*2*Math.atan(Math.tan(Bc*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,r){cu.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(cu.x,cu.y).multiplyScalar(-e/cu.z),cu.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),r.set(cu.x,cu.y).multiplyScalar(-e/cu.z)}getViewSize(e,t){return this.getViewBounds(e,rM,sM),t.subVectors(sM,rM)}setViewOffset(e,t,r,i,s,a){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(Bc*.5*this.fov)/this.zoom,r=2*t,i=this.aspect*r,s=-.5*i;const a=this.view;if(this.view!==null&&this.view.enabled){const u=a.fullWidth,c=a.fullHeight;s+=a.offsetX*i/u,t-=a.offsetY*r/c,i*=a.width/u,r*=a.height/c}const o=this.filmOffset;o!==0&&(s+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+i,t,t-r,e,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const nf=-90,rf=1;class pE extends Hn{constructor(e,t,r){super(),this.type="CubeCamera",this.renderTarget=r,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new Pr(nf,rf,e,t);i.layers=this.layers,this.add(i);const s=new Pr(nf,rf,e,t);s.layers=this.layers,this.add(s);const a=new Pr(nf,rf,e,t);a.layers=this.layers,this.add(a);const o=new Pr(nf,rf,e,t);o.layers=this.layers,this.add(o);const u=new Pr(nf,rf,e,t);u.layers=this.layers,this.add(u);const c=new Pr(nf,rf,e,t);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[r,i,s,a,o,u]=t;for(const c of t)this.remove(c);if(e===oa)r.up.set(0,1,0),r.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),u.up.set(0,1,0),u.lookAt(0,0,-1);else if(e===Uf)r.up.set(0,-1,0),r.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),u.up.set(0,-1,0),u.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const c of t)this.add(c),c.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:r,activeMipmapLevel:i}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,a,o,u,c,f]=this.children,m=e.getRenderTarget(),g=e.getActiveCubeFace(),y=e.getActiveMipmapLevel(),_=e.xr.enabled;e.xr.enabled=!1;const E=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0,i),e.render(t,s),e.setRenderTarget(r,1,i),e.render(t,a),e.setRenderTarget(r,2,i),e.render(t,o),e.setRenderTarget(r,3,i),e.render(t,u),e.setRenderTarget(r,4,i),e.render(t,c),r.texture.generateMipmaps=E,e.setRenderTarget(r,5,i),e.render(t,f),e.setRenderTarget(m,g,y),e.xr.enabled=_,r.texture.needsPMREMUpdate=!0}}class s0 extends ei{constructor(e=[],t=ho,r,i,s,a,o,u,c,f){super(e,t,r,i,s,a,o,u,c,f),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class Hv extends ws{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const r={width:e,height:e,depth:1},i=[r,r,r,r,r,r];this.texture=new s0(i),this._setTextureOptions(t),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new Qc(5,5,5),s=new Es({name:"CubemapFromEquirect",uniforms:kf(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:Ms,blending:uo});s.uniforms.tEquirect.value=t;const a=new pi(i,s),o=t.minFilter;return t.minFilter===Fo&&(t.minFilter=Dn),new pE(1,10,this).update(e,a),t.minFilter=o,a.geometry.dispose(),a.material.dispose(),this}clear(e,t=!0,r=!0,i=!0){const s=e.getRenderTarget();for(let a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(t,r,i);e.setRenderTarget(s)}}class Sf extends Hn{constructor(){super(),this.isGroup=!0,this.type="Group"}}const tC={type:"move"};class gg{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Sf,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Sf,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new X,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new X),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Sf,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new X,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new X),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const r of e.hand.values())this._getHandJoint(t,r)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,r){let i=null,s=null,a=null;const o=this._targetRay,u=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(c&&e.hand){a=!0;for(const E of e.hand.values()){const x=t.getJointPose(E,r),S=this._getHandJoint(c,E);x!==null&&(S.matrix.fromArray(x.transform.matrix),S.matrix.decompose(S.position,S.rotation,S.scale),S.matrixWorldNeedsUpdate=!0,S.jointRadius=x.radius),S.visible=x!==null}const f=c.joints["index-finger-tip"],m=c.joints["thumb-tip"],g=f.position.distanceTo(m.position),y=.02,_=.005;c.inputState.pinching&&g>y+_?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&g<=y-_&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else u!==null&&e.gripSpace&&(s=t.getPose(e.gripSpace,r),s!==null&&(u.matrix.fromArray(s.transform.matrix),u.matrix.decompose(u.position,u.rotation,u.scale),u.matrixWorldNeedsUpdate=!0,s.linearVelocity?(u.hasLinearVelocity=!0,u.linearVelocity.copy(s.linearVelocity)):u.hasLinearVelocity=!1,s.angularVelocity?(u.hasAngularVelocity=!0,u.angularVelocity.copy(s.angularVelocity)):u.hasAngularVelocity=!1));o!==null&&(i=t.getPose(e.targetRaySpace,r),i===null&&s!==null&&(i=s),i!==null&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,i.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(i.linearVelocity)):o.hasLinearVelocity=!1,i.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(i.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(tC)))}return o!==null&&(o.visible=i!==null),u!==null&&(u.visible=s!==null),c!==null&&(c.visible=a!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const r=new Sf;r.matrixAutoUpdate=!1,r.visible=!1,e.joints[t.jointName]=r,e.add(r)}return e.joints[t.jointName]}}class Wv{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new jt(e),this.density=t}clone(){return new Wv(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class jv{constructor(e,t=1,r=1e3){this.isFog=!0,this.name="",this.color=new jt(e),this.near=t,this.far=r}clone(){return new jv(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}let a0=class extends Hn{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Qi,this.environmentIntensity=1,this.environmentRotation=new Qi,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}};class Xv{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=Op,this.updateRanges=[],this.version=0,this.uuid=la()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,r){e*=this.stride,r*=t.stride;for(let i=0,s=this.stride;i<s;i++)this.array[e+i]=t.array[r+i];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=la()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),r=new this.constructor(t,this.stride);return r.setUsage(this.usage),r}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=la()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const ys=new X;class Xc{constructor(e,t,r,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=r,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,r=this.data.count;t<r;t++)ys.fromBufferAttribute(this,t),ys.applyMatrix4(e),this.setXYZ(t,ys.x,ys.y,ys.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)ys.fromBufferAttribute(this,t),ys.applyNormalMatrix(e),this.setXYZ(t,ys.x,ys.y,ys.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)ys.fromBufferAttribute(this,t),ys.transformDirection(e),this.setXYZ(t,ys.x,ys.y,ys.z);return this}getComponent(e,t){let r=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(r=xs(r,this.array)),r}setComponent(e,t,r){return this.normalized&&(r=Rn(r,this.array)),this.data.array[e*this.data.stride+this.offset+t]=r,this}setX(e,t){return this.normalized&&(t=Rn(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Rn(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Rn(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Rn(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=xs(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=xs(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=xs(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=xs(t,this.array)),t}setXY(e,t,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=Rn(t,this.array),r=Rn(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=r,this}setXYZ(e,t,r,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=Rn(t,this.array),r=Rn(r,this.array),i=Rn(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=i,this}setXYZW(e,t,r,i,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=Rn(t,this.array),r=Rn(r,this.array),i=Rn(i,this.array),s=Rn(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=i,this.data.array[e+3]=s,this}clone(e){if(e===void 0){zp("InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let r=0;r<this.count;r++){const i=r*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[i+s])}return new jn(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Xc(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){zp("InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let r=0;r<this.count;r++){const i=r*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[i+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class sx extends ss{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new jt(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let sf;const Xd=new X,af=new X,of=new X,lf=new ct,qd=new ct,mE=new vn,Cm=new X,Yd=new X,Pm=new X,aM=new ct,gy=new ct,oM=new ct;class gE extends Hn{constructor(e=new sx){if(super(),this.isSprite=!0,this.type="Sprite",sf===void 0){sf=new Sn;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),r=new Xv(t,5);sf.setIndex([0,1,2,0,2,3]),sf.setAttribute("position",new Xc(r,3,0,!1)),sf.setAttribute("uv",new Xc(r,2,3,!1))}this.geometry=sf,this.material=e,this.center=new ct(.5,.5),this.count=1}raycast(e,t){e.camera===null&&ln('Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),af.setFromMatrixScale(this.matrixWorld),mE.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),of.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&af.multiplyScalar(-of.z);const r=this.material.rotation;let i,s;r!==0&&(s=Math.cos(r),i=Math.sin(r));const a=this.center;Rm(Cm.set(-.5,-.5,0),of,a,af,i,s),Rm(Yd.set(.5,-.5,0),of,a,af,i,s),Rm(Pm.set(.5,.5,0),of,a,af,i,s),aM.set(0,0),gy.set(1,0),oM.set(1,1);let o=e.ray.intersectTriangle(Cm,Yd,Pm,!1,Xd);if(o===null&&(Rm(Yd.set(-.5,.5,0),of,a,af,i,s),gy.set(0,1),o=e.ray.intersectTriangle(Cm,Pm,Yd,!1,Xd),o===null))return;const u=e.ray.origin.distanceTo(Xd);u<e.near||u>e.far||t.push({distance:u,point:Xd.clone(),uv:Hs.getInterpolation(Xd,Cm,Yd,Pm,aM,gy,oM,new ct),face:null,object:this})}copy(e,t){return super.copy(e,t),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function Rm(n,e,t,r,i,s){lf.subVectors(n,t).addScalar(.5).multiply(r),i!==void 0?(qd.x=s*lf.x-i*lf.y,qd.y=i*lf.x+s*lf.y):qd.copy(lf),n.copy(e),n.x+=qd.x,n.y+=qd.y,n.applyMatrix4(mE)}const Im=new X,lM=new X;class vE extends Hn{constructor(){super(),this.isLOD=!0,this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let r=0,i=t.length;r<i;r++){const s=t[r];this.addLevel(s.object.clone(),s.distance,s.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,r=0){t=Math.abs(t);const i=this.levels;let s;for(s=0;s<i.length&&!(t<i[s].distance);s++);return i.splice(s,0,{distance:t,hysteresis:r,object:e}),this.add(e),this}removeLevel(e){const t=this.levels;for(let r=0;r<t.length;r++)if(t[r].distance===e){const i=t.splice(r,1);return this.remove(i[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let r,i;for(r=1,i=t.length;r<i;r++){let s=t[r].distance;if(t[r].object.visible&&(s-=s*t[r].hysteresis),e<s)break}return t[r-1].object}return null}raycast(e,t){if(this.levels.length>0){Im.setFromMatrixPosition(this.matrixWorld);const i=e.ray.origin.distanceTo(Im);this.getObjectForDistance(i).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){Im.setFromMatrixPosition(e.matrixWorld),lM.setFromMatrixPosition(this.matrixWorld);const r=Im.distanceTo(lM)/e.zoom;t[0].object.visible=!0;let i,s;for(i=1,s=t.length;i<s;i++){let a=t[i].distance;if(t[i].object.visible&&(a-=a*t[i].hysteresis),r>=a)t[i-1].object.visible=!1,t[i].object.visible=!0;else break}for(this._currentLevel=i-1;i<s;i++)t[i].object.visible=!1}}toJSON(e){const t=super.toJSON(e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];const r=this.levels;for(let i=0,s=r.length;i<s;i++){const a=r[i];t.object.levels.push({object:a.object.uuid,distance:a.distance,hysteresis:a.hysteresis})}return t}}const uM=new X,cM=new $n,hM=new $n,nC=new X,fM=new vn,Lm=new X,vy=new Dr,dM=new vn,yy=new jf;class yE extends pi{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=f_,this.bindMatrix=new vn,this.bindMatrixInverse=new vn,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new Nr),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let r=0;r<t.count;r++)this.getVertexPosition(r,Lm),this.boundingBox.expandByPoint(Lm)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Dr),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let r=0;r<t.count;r++)this.getVertexPosition(r,Lm),this.boundingSphere.expandByPoint(Lm)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const r=this.material,i=this.matrixWorld;r!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),vy.copy(this.boundingSphere),vy.applyMatrix4(i),e.ray.intersectsSphere(vy)!==!1&&(dM.copy(i).invert(),yy.copy(e.ray).applyMatrix4(dM),!(this.boundingBox!==null&&yy.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,t,yy)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new $n,t=this.geometry.attributes.skinWeight;for(let r=0,i=t.count;r<i;r++){e.fromBufferAttribute(t,r);const s=1/e.manhattanLength();s!==1/0?e.multiplyScalar(s):e.set(1,0,0,0),t.setXYZW(r,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===f_?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===Zw?this.bindMatrixInverse.copy(this.bindMatrix).invert():Ft("SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const r=this.skeleton,i=this.geometry;cM.fromBufferAttribute(i.attributes.skinIndex,e),hM.fromBufferAttribute(i.attributes.skinWeight,e),uM.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let s=0;s<4;s++){const a=hM.getComponent(s);if(a!==0){const o=cM.getComponent(s);fM.multiplyMatrices(r.bones[o].matrixWorld,r.boneInverses[o]),t.addScaledVector(nC.copy(uM).applyMatrix4(fM),a)}}return t.applyMatrix4(this.bindMatrixInverse)}}class ax extends Hn{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Aa extends ei{constructor(e=null,t=1,r=1,i,s,a,o,u,c=Ji,f=Ji,m,g){super(null,a,o,u,c,f,i,s,m,g),this.isDataTexture=!0,this.image={data:e,width:t,height:r},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const pM=new vn,iC=new vn;class qv{constructor(e=[],t=[]){this.uuid=la(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.previousBoneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){Ft("Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let r=0,i=this.bones.length;r<i;r++)this.boneInverses.push(new vn)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const r=new vn;this.bones[e]&&r.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(r)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const r=this.bones[e];r&&r.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const r=this.bones[e];r&&(r.parent&&r.parent.isBone?(r.matrix.copy(r.parent.matrixWorld).invert(),r.matrix.multiply(r.matrixWorld)):r.matrix.copy(r.matrixWorld),r.matrix.decompose(r.position,r.quaternion,r.scale))}}update(){const e=this.bones,t=this.boneInverses,r=this.boneMatrices,i=this.boneTexture;for(let s=0,a=e.length;s<a;s++){const o=e[s]?e[s].matrixWorld:iC;pM.multiplyMatrices(o,t[s]),pM.toArray(r,s*16)}i!==null&&(i.needsUpdate=!0)}clone(){return new qv(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const r=new Aa(t,e,e,Ki,bi);return r.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=r,this}getBoneByName(e){for(let t=0,r=this.bones.length;t<r;t++){const i=this.bones[t];if(i.name===e)return i}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let r=0,i=e.bones.length;r<i;r++){const s=e.bones[r];let a=t[s];a===void 0&&(Ft("Skeleton: No bone found with UUID:",s),a=new ax),this.bones.push(a),this.boneInverses.push(new vn().fromArray(e.boneInverses[r]))}return this.init(),this}toJSON(){const e={metadata:{version:4.7,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,r=this.boneInverses;for(let i=0,s=t.length;i<s;i++){const a=t[i];e.bones.push(a.uuid);const o=r[i];e.boneInverses.push(o.toArray())}return e}}class qc extends jn{constructor(e,t,r,i=1){super(e,t,r),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const uf=new vn,mM=new vn,Nm=[],gM=new Nr,rC=new vn,Zd=new pi,Jd=new Dr;class _E extends pi{constructor(e,t,r){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new qc(new Float32Array(r*16),16),this.instanceColor=null,this.morphTexture=null,this.count=r,this.boundingBox=null,this.boundingSphere=null;for(let i=0;i<r;i++)this.setMatrixAt(i,rC)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new Nr),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let r=0;r<t;r++)this.getMatrixAt(r,uf),gM.copy(e.boundingBox).applyMatrix4(uf),this.boundingBox.union(gM)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new Dr),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let r=0;r<t;r++)this.getMatrixAt(r,uf),Jd.copy(e.boundingSphere).applyMatrix4(uf),this.boundingSphere.union(Jd)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,t){const r=t.morphTargetInfluences,i=this.morphTexture.source.data.data,s=r.length+1,a=e*s+1;for(let o=0;o<r.length;o++)r[o]=i[a+o]}raycast(e,t){const r=this.matrixWorld,i=this.count;if(Zd.geometry=this.geometry,Zd.material=this.material,Zd.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Jd.copy(this.boundingSphere),Jd.applyMatrix4(r),e.ray.intersectsSphere(Jd)!==!1))for(let s=0;s<i;s++){this.getMatrixAt(s,uf),mM.multiplyMatrices(r,uf),Zd.matrixWorld=mM,Zd.raycast(e,Nm);for(let a=0,o=Nm.length;a<o;a++){const u=Nm[a];u.instanceId=s,u.object=this,t.push(u)}Nm.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new qc(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,t){const r=t.morphTargetInfluences,i=r.length+1;this.morphTexture===null&&(this.morphTexture=new Aa(new Float32Array(i*this.count),i,this.count,n0,bi));const s=this.morphTexture.source.data.data;let a=0;for(let c=0;c<r.length;c++)a+=r[c];const o=this.geometry.morphTargetsRelative?1:1-a,u=i*e;s[u]=o,s.set(r,u+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null)}}const _y=new X,sC=new X,aC=new Tn;class pu{constructor(e=new X(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,r,i){return this.normal.set(e,t,r),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,r){const i=_y.subVectors(r,t).cross(sC.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const r=e.delta(_y),i=this.normal.dot(r);if(i===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/i;return s<0||s>1?null:t.copy(e.start).addScaledVector(r,s)}intersectsLine(e){const t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const r=t||aC.getNormalMatrix(e),i=this.coplanarPoint(_y).applyMatrix4(e),s=this.normal.applyMatrix3(r).normalize();return this.constant=-i.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const yc=new Dr,oC=new ct(.5,.5),Dm=new X;class Xf{constructor(e=new pu,t=new pu,r=new pu,i=new pu,s=new pu,a=new pu){this.planes=[e,t,r,i,s,a]}set(e,t,r,i,s,a){const o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(r),o[3].copy(i),o[4].copy(s),o[5].copy(a),this}copy(e){const t=this.planes;for(let r=0;r<6;r++)t[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e,t=oa,r=!1){const i=this.planes,s=e.elements,a=s[0],o=s[1],u=s[2],c=s[3],f=s[4],m=s[5],g=s[6],y=s[7],_=s[8],E=s[9],x=s[10],S=s[11],T=s[12],A=s[13],P=s[14],L=s[15];if(i[0].setComponents(c-a,y-f,S-_,L-T).normalize(),i[1].setComponents(c+a,y+f,S+_,L+T).normalize(),i[2].setComponents(c+o,y+m,S+E,L+A).normalize(),i[3].setComponents(c-o,y-m,S-E,L-A).normalize(),r)i[4].setComponents(u,g,x,P).normalize(),i[5].setComponents(c-u,y-g,S-x,L-P).normalize();else if(i[4].setComponents(c-u,y-g,S-x,L-P).normalize(),t===oa)i[5].setComponents(c+u,y+g,S+x,L+P).normalize();else if(t===Uf)i[5].setComponents(u,g,x,P).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),yc.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),yc.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(yc)}intersectsSprite(e){yc.center.set(0,0,0);const t=oC.distanceTo(e.center);return yc.radius=.7071067811865476+t,yc.applyMatrix4(e.matrixWorld),this.intersectsSphere(yc)}intersectsSphere(e){const t=this.planes,r=e.center,i=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(r)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let r=0;r<6;r++){const i=t[r];if(Dm.x=i.normal.x>0?e.max.x:e.min.x,Dm.y=i.normal.y>0?e.max.y:e.min.y,Dm.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(Dm)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}const Lo=new vn,No=new Xf;class Yv{constructor(){this.coordinateSystem=oa}intersectsObject(e,t){if(!t.isArrayCamera||t.cameras.length===0)return!1;for(let r=0;r<t.cameras.length;r++){const i=t.cameras[r];if(Lo.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),No.setFromProjectionMatrix(Lo,i.coordinateSystem,i.reversedDepth),No.intersectsObject(e))return!0}return!1}intersectsSprite(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let r=0;r<t.cameras.length;r++){const i=t.cameras[r];if(Lo.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),No.setFromProjectionMatrix(Lo,i.coordinateSystem,i.reversedDepth),No.intersectsSprite(e))return!0}return!1}intersectsSphere(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let r=0;r<t.cameras.length;r++){const i=t.cameras[r];if(Lo.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),No.setFromProjectionMatrix(Lo,i.coordinateSystem,i.reversedDepth),No.intersectsSphere(e))return!0}return!1}intersectsBox(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let r=0;r<t.cameras.length;r++){const i=t.cameras[r];if(Lo.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),No.setFromProjectionMatrix(Lo,i.coordinateSystem,i.reversedDepth),No.intersectsBox(e))return!0}return!1}containsPoint(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let r=0;r<t.cameras.length;r++){const i=t.cameras[r];if(Lo.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),No.setFromProjectionMatrix(Lo,i.coordinateSystem,i.reversedDepth),No.containsPoint(e))return!0}return!1}clone(){return new Yv}}function xy(n,e){return n-e}function lC(n,e){return n.z-e.z}function uC(n,e){return e.z-n.z}class cC{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,t,r,i){const s=this.pool,a=this.list;this.index>=s.length&&s.push({start:-1,count:-1,z:-1,index:-1});const o=s[this.index];a.push(o),this.index++,o.start=e,o.count=t,o.z=r,o.index=i}reset(){this.list.length=0,this.index=0}}const Bs=new vn,hC=new jt(1,1,1),vM=new Xf,fC=new Yv,Um=new Nr,_c=new Dr,Kd=new X,yM=new X,dC=new X,Sy=new cC,ns=new pi,Fm=[];function pC(n,e,t=0){const r=e.itemSize;if(n.isInterleavedBufferAttribute||n.array.constructor!==e.array.constructor){const i=n.count;for(let s=0;s<i;s++)for(let a=0;a<r;a++)e.setComponent(s+t,a,n.getComponent(s,a))}else e.array.set(n.array,t*r);e.needsUpdate=!0}function xc(n,e){if(n.constructor!==e.constructor){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++)e[r]=n[r]}else{const t=Math.min(n.length,e.length);e.set(new n.constructor(n.buffer,0,t))}}class xE extends pi{constructor(e,t,r=t*2,i){super(new Sn,i),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=e,this._maxVertexCount=t,this._maxIndexCount=r,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}_initMatricesTexture(){let e=Math.sqrt(this._maxInstanceCount*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4),r=new Aa(t,e,e,Ki,bi);this._matricesTexture=r}_initIndirectTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Uint32Array(e*e),r=new Aa(t,e,e,i0,ca);this._indirectTexture=r}_initColorsTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Float32Array(e*e*4).fill(1),r=new Aa(t,e,e,Ki,bi);r.colorSpace=kn.workingColorSpace,this._colorsTexture=r}_initializeGeometry(e){const t=this.geometry,r=this._maxVertexCount,i=this._maxIndexCount;if(this._geometryInitialized===!1){for(const s in e.attributes){const a=e.getAttribute(s),{array:o,itemSize:u,normalized:c}=a,f=new o.constructor(r*u),m=new jn(f,u,c);t.setAttribute(s,m)}if(e.getIndex()!==null){const s=r>65535?new Uint32Array(i):new Uint16Array(i);t.setIndex(new jn(s,1))}this._geometryInitialized=!0}}_validateGeometry(e){const t=this.geometry;if(!!e.getIndex()!=!!t.getIndex())throw new Error('THREE.BatchedMesh: All geometries must consistently have "index".');for(const r in t.attributes){if(!e.hasAttribute(r))throw new Error(`THREE.BatchedMesh: Added geometry missing "${r}". All geometries must have consistent attributes.`);const i=e.getAttribute(r),s=t.getAttribute(r);if(i.itemSize!==s.itemSize||i.normalized!==s.normalized)throw new Error("THREE.BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}validateInstanceId(e){const t=this._instanceInfo;if(e<0||e>=t.length||t[e].active===!1)throw new Error(`THREE.BatchedMesh: Invalid instanceId ${e}. Instance is either out of range or has been deleted.`)}validateGeometryId(e){const t=this._geometryInfo;if(e<0||e>=t.length||t[e].active===!1)throw new Error(`THREE.BatchedMesh: Invalid geometryId ${e}. Geometry is either out of range or has been deleted.`)}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Nr);const e=this.boundingBox,t=this._instanceInfo;e.makeEmpty();for(let r=0,i=t.length;r<i;r++){if(t[r].active===!1)continue;const s=t[r].geometryIndex;this.getMatrixAt(r,Bs),this.getBoundingBoxAt(s,Um).applyMatrix4(Bs),e.union(Um)}}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Dr);const e=this.boundingSphere,t=this._instanceInfo;e.makeEmpty();for(let r=0,i=t.length;r<i;r++){if(t[r].active===!1)continue;const s=t[r].geometryIndex;this.getMatrixAt(r,Bs),this.getBoundingSphereAt(s,_c).applyMatrix4(Bs),e.union(_c)}}addInstance(e){if(this._instanceInfo.length>=this.maxInstanceCount&&this._availableInstanceIds.length===0)throw new Error("THREE.BatchedMesh: Maximum item count reached.");const r={visible:!0,active:!0,geometryIndex:e};let i=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(xy),i=this._availableInstanceIds.shift(),this._instanceInfo[i]=r):(i=this._instanceInfo.length,this._instanceInfo.push(r));const s=this._matricesTexture;Bs.identity().toArray(s.image.data,i*16),s.needsUpdate=!0;const a=this._colorsTexture;return a&&(hC.toArray(a.image.data,i*4),a.needsUpdate=!0),this._visibilityChanged=!0,i}addGeometry(e,t=-1,r=-1){this._initializeGeometry(e),this._validateGeometry(e);const i={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},s=this._geometryInfo;i.vertexStart=this._nextVertexStart,i.reservedVertexCount=t===-1?e.getAttribute("position").count:t;const a=e.getIndex();if(a!==null&&(i.indexStart=this._nextIndexStart,i.reservedIndexCount=r===-1?a.count:r),i.indexStart!==-1&&i.indexStart+i.reservedIndexCount>this._maxIndexCount||i.vertexStart+i.reservedVertexCount>this._maxVertexCount)throw new Error("THREE.BatchedMesh: Reserved space request exceeds the maximum buffer size.");let u;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(xy),u=this._availableGeometryIds.shift(),s[u]=i):(u=this._geometryCount,this._geometryCount++,s.push(i)),this.setGeometryAt(u,e),this._nextIndexStart=i.indexStart+i.reservedIndexCount,this._nextVertexStart=i.vertexStart+i.reservedVertexCount,u}setGeometryAt(e,t){if(e>=this._geometryCount)throw new Error("THREE.BatchedMesh: Maximum geometry count reached.");this._validateGeometry(t);const r=this.geometry,i=r.getIndex()!==null,s=r.getIndex(),a=t.getIndex(),o=this._geometryInfo[e];if(i&&a.count>o.reservedIndexCount||t.attributes.position.count>o.reservedVertexCount)throw new Error("THREE.BatchedMesh: Reserved space not large enough for provided geometry.");const u=o.vertexStart,c=o.reservedVertexCount;o.vertexCount=t.getAttribute("position").count;for(const f in r.attributes){const m=t.getAttribute(f),g=r.getAttribute(f);pC(m,g,u);const y=m.itemSize;for(let _=m.count,E=c;_<E;_++){const x=u+_;for(let S=0;S<y;S++)g.setComponent(x,S,0)}g.needsUpdate=!0,g.addUpdateRange(u*y,c*y)}if(i){const f=o.indexStart,m=o.reservedIndexCount;o.indexCount=t.getIndex().count;for(let g=0;g<a.count;g++)s.setX(f+g,u+a.getX(g));for(let g=a.count,y=m;g<y;g++)s.setX(f+g,u);s.needsUpdate=!0,s.addUpdateRange(f,o.reservedIndexCount)}return o.start=i?o.indexStart:o.vertexStart,o.count=i?o.indexCount:o.vertexCount,o.boundingBox=null,t.boundingBox!==null&&(o.boundingBox=t.boundingBox.clone()),o.boundingSphere=null,t.boundingSphere!==null&&(o.boundingSphere=t.boundingSphere.clone()),this._visibilityChanged=!0,e}deleteGeometry(e){const t=this._geometryInfo;if(e>=t.length||t[e].active===!1)return this;const r=this._instanceInfo;for(let i=0,s=r.length;i<s;i++)r[i].active&&r[i].geometryIndex===e&&this.deleteInstance(i);return t[e].active=!1,this._availableGeometryIds.push(e),this._visibilityChanged=!0,this}deleteInstance(e){return this.validateInstanceId(e),this._instanceInfo[e].active=!1,this._availableInstanceIds.push(e),this._visibilityChanged=!0,this}optimize(){let e=0,t=0;const r=this._geometryInfo,i=r.map((a,o)=>o).sort((a,o)=>r[a].vertexStart-r[o].vertexStart),s=this.geometry;for(let a=0,o=r.length;a<o;a++){const u=i[a],c=r[u];if(c.active!==!1){if(s.index!==null){if(c.indexStart!==t){const{indexStart:f,vertexStart:m,reservedIndexCount:g}=c,y=s.index,_=y.array,E=e-m;for(let x=f;x<f+g;x++)_[x]=_[x]+E;y.array.copyWithin(t,f,f+g),y.addUpdateRange(t,g),y.needsUpdate=!0,c.indexStart=t}t+=c.reservedIndexCount}if(c.vertexStart!==e){const{vertexStart:f,reservedVertexCount:m}=c,g=s.attributes;for(const y in g){const _=g[y],{array:E,itemSize:x}=_;E.copyWithin(e*x,f*x,(f+m)*x),_.addUpdateRange(e*x,m*x),_.needsUpdate=!0}c.vertexStart=e}e+=c.reservedVertexCount,c.start=s.index?c.indexStart:c.vertexStart,this._nextIndexStart=s.index?c.indexStart+c.reservedIndexCount:0,this._nextVertexStart=c.vertexStart+c.reservedVertexCount}}return this._visibilityChanged=!0,this}getBoundingBoxAt(e,t){if(e>=this._geometryCount)return null;const r=this.geometry,i=this._geometryInfo[e];if(i.boundingBox===null){const s=new Nr,a=r.index,o=r.attributes.position;for(let u=i.start,c=i.start+i.count;u<c;u++){let f=u;a&&(f=a.getX(f)),s.expandByPoint(Kd.fromBufferAttribute(o,f))}i.boundingBox=s}return t.copy(i.boundingBox),t}getBoundingSphereAt(e,t){if(e>=this._geometryCount)return null;const r=this.geometry,i=this._geometryInfo[e];if(i.boundingSphere===null){const s=new Dr;this.getBoundingBoxAt(e,Um),Um.getCenter(s.center);const a=r.index,o=r.attributes.position;let u=0;for(let c=i.start,f=i.start+i.count;c<f;c++){let m=c;a&&(m=a.getX(m)),Kd.fromBufferAttribute(o,m),u=Math.max(u,s.center.distanceToSquared(Kd))}s.radius=Math.sqrt(u),i.boundingSphere=s}return t.copy(i.boundingSphere),t}setMatrixAt(e,t){this.validateInstanceId(e);const r=this._matricesTexture,i=this._matricesTexture.image.data;return t.toArray(i,e*16),r.needsUpdate=!0,this}getMatrixAt(e,t){return this.validateInstanceId(e),t.fromArray(this._matricesTexture.image.data,e*16)}setColorAt(e,t){return this.validateInstanceId(e),this._colorsTexture===null&&this._initColorsTexture(),t.toArray(this._colorsTexture.image.data,e*4),this._colorsTexture.needsUpdate=!0,this}getColorAt(e,t){return this.validateInstanceId(e),t.fromArray(this._colorsTexture.image.data,e*4)}setVisibleAt(e,t){return this.validateInstanceId(e),this._instanceInfo[e].visible===t?this:(this._instanceInfo[e].visible=t,this._visibilityChanged=!0,this)}getVisibleAt(e){return this.validateInstanceId(e),this._instanceInfo[e].visible}setGeometryIdAt(e,t){return this.validateInstanceId(e),this.validateGeometryId(t),this._instanceInfo[e].geometryIndex=t,this}getGeometryIdAt(e){return this.validateInstanceId(e),this._instanceInfo[e].geometryIndex}getGeometryRangeAt(e,t={}){this.validateGeometryId(e);const r=this._geometryInfo[e];return t.vertexStart=r.vertexStart,t.vertexCount=r.vertexCount,t.reservedVertexCount=r.reservedVertexCount,t.indexStart=r.indexStart,t.indexCount=r.indexCount,t.reservedIndexCount=r.reservedIndexCount,t.start=r.start,t.count=r.count,t}setInstanceCount(e){const t=this._availableInstanceIds,r=this._instanceInfo;for(t.sort(xy);t[t.length-1]===r.length-1;)r.pop(),t.pop();if(e<r.length)throw new Error(`BatchedMesh: Instance ids outside the range ${e} are being used. Cannot shrink instance count.`);const i=new Int32Array(e),s=new Int32Array(e);xc(this._multiDrawCounts,i),xc(this._multiDrawStarts,s),this._multiDrawCounts=i,this._multiDrawStarts=s,this._maxInstanceCount=e;const a=this._indirectTexture,o=this._matricesTexture,u=this._colorsTexture;a.dispose(),this._initIndirectTexture(),xc(a.image.data,this._indirectTexture.image.data),o.dispose(),this._initMatricesTexture(),xc(o.image.data,this._matricesTexture.image.data),u&&(u.dispose(),this._initColorsTexture(),xc(u.image.data,this._colorsTexture.image.data))}setGeometrySize(e,t){const r=[...this._geometryInfo].filter(o=>o.active);if(Math.max(...r.map(o=>o.vertexStart+o.reservedVertexCount))>e)throw new Error(`BatchedMesh: Geometry vertex values are being used outside the range ${t}. Cannot shrink further.`);if(this.geometry.index&&Math.max(...r.map(u=>u.indexStart+u.reservedIndexCount))>t)throw new Error(`BatchedMesh: Geometry index values are being used outside the range ${t}. Cannot shrink further.`);const s=this.geometry;s.dispose(),this._maxVertexCount=e,this._maxIndexCount=t,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new Sn,this._initializeGeometry(s));const a=this.geometry;s.index&&xc(s.index.array,a.index.array);for(const o in s.attributes)xc(s.attributes[o].array,a.attributes[o].array)}raycast(e,t){const r=this._instanceInfo,i=this._geometryInfo,s=this.matrixWorld,a=this.geometry;ns.material=this.material,ns.geometry.index=a.index,ns.geometry.attributes=a.attributes,ns.geometry.boundingBox===null&&(ns.geometry.boundingBox=new Nr),ns.geometry.boundingSphere===null&&(ns.geometry.boundingSphere=new Dr);for(let o=0,u=r.length;o<u;o++){if(!r[o].visible||!r[o].active)continue;const c=r[o].geometryIndex,f=i[c];ns.geometry.setDrawRange(f.start,f.count),this.getMatrixAt(o,ns.matrixWorld).premultiply(s),this.getBoundingBoxAt(c,ns.geometry.boundingBox),this.getBoundingSphereAt(c,ns.geometry.boundingSphere),ns.raycast(e,Fm);for(let m=0,g=Fm.length;m<g;m++){const y=Fm[m];y.object=this,y.batchId=o,t.push(y)}Fm.length=0}ns.material=null,ns.geometry.index=null,ns.geometry.attributes={},ns.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=e.boundingBox!==null?e.boundingBox.clone():null,this.boundingSphere=e.boundingSphere!==null?e.boundingSphere.clone():null,this._geometryInfo=e._geometryInfo.map(t=>({...t,boundingBox:t.boundingBox!==null?t.boundingBox.clone():null,boundingSphere:t.boundingSphere!==null?t.boundingSphere.clone():null})),this._instanceInfo=e._instanceInfo.map(t=>({...t})),this._availableInstanceIds=e._availableInstanceIds.slice(),this._availableGeometryIds=e._availableGeometryIds.slice(),this._nextIndexStart=e._nextIndexStart,this._nextVertexStart=e._nextVertexStart,this._geometryCount=e._geometryCount,this._maxInstanceCount=e._maxInstanceCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._indirectTexture=e._indirectTexture.clone(),this._indirectTexture.image.data=this._indirectTexture.image.data.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),this._colorsTexture!==null&&(this._colorsTexture=e._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,this._colorsTexture!==null&&(this._colorsTexture.dispose(),this._colorsTexture=null)}onBeforeRender(e,t,r,i,s){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const a=i.getIndex(),o=a===null?1:a.array.BYTES_PER_ELEMENT,u=this._instanceInfo,c=this._multiDrawStarts,f=this._multiDrawCounts,m=this._geometryInfo,g=this.perObjectFrustumCulled,y=this._indirectTexture,_=y.image.data,E=r.isArrayCamera?fC:vM;g&&!r.isArrayCamera&&(Bs.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse).multiply(this.matrixWorld),vM.setFromProjectionMatrix(Bs,r.coordinateSystem,r.reversedDepth));let x=0;if(this.sortObjects){Bs.copy(this.matrixWorld).invert(),Kd.setFromMatrixPosition(r.matrixWorld).applyMatrix4(Bs),yM.set(0,0,-1).transformDirection(r.matrixWorld).transformDirection(Bs);for(let A=0,P=u.length;A<P;A++)if(u[A].visible&&u[A].active){const L=u[A].geometryIndex;this.getMatrixAt(A,Bs),this.getBoundingSphereAt(L,_c).applyMatrix4(Bs);let D=!1;if(g&&(D=!E.intersectsSphere(_c,r)),!D){const F=m[L],k=dC.subVectors(_c.center,Kd).dot(yM);Sy.push(F.start,F.count,k,A)}}const S=Sy.list,T=this.customSort;T===null?S.sort(s.transparent?uC:lC):T.call(this,S,r);for(let A=0,P=S.length;A<P;A++){const L=S[A];c[x]=L.start*o,f[x]=L.count,_[x]=L.index,x++}Sy.reset()}else for(let S=0,T=u.length;S<T;S++)if(u[S].visible&&u[S].active){const A=u[S].geometryIndex;let P=!1;if(g&&(this.getMatrixAt(S,Bs),this.getBoundingSphereAt(A,_c).applyMatrix4(Bs),P=!E.intersectsSphere(_c,r)),!P){const L=m[A];c[x]=L.start*o,f[x]=L.count,_[x]=S,x++}}y.needsUpdate=!0,this._multiDrawCount=x,this._visibilityChanged=!1}onBeforeShadow(e,t,r,i,s,a){this.onBeforeRender(e,null,i,s,a)}}class Ts extends ss{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new jt(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const pv=new X,mv=new X,_M=new vn,Qd=new jf,Om=new Dr,My=new X,xM=new X;class bu extends Hn{constructor(e=new Sn,t=new Ts){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,r=[0];for(let i=1,s=t.count;i<s;i++)pv.fromBufferAttribute(t,i-1),mv.fromBufferAttribute(t,i),r[i]=r[i-1],r[i]+=pv.distanceTo(mv);e.setAttribute("lineDistance",new Jt(r,1))}else Ft("Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const r=this.geometry,i=this.matrixWorld,s=e.params.Line.threshold,a=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),Om.copy(r.boundingSphere),Om.applyMatrix4(i),Om.radius+=s,e.ray.intersectsSphere(Om)===!1)return;_M.copy(i).invert(),Qd.copy(e.ray).applyMatrix4(_M);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),u=o*o,c=this.isLineSegments?2:1,f=r.index,g=r.attributes.position;if(f!==null){const y=Math.max(0,a.start),_=Math.min(f.count,a.start+a.count);for(let E=y,x=_-1;E<x;E+=c){const S=f.getX(E),T=f.getX(E+1),A=km(this,e,Qd,u,S,T,E);A&&t.push(A)}if(this.isLineLoop){const E=f.getX(_-1),x=f.getX(y),S=km(this,e,Qd,u,E,x,_-1);S&&t.push(S)}}else{const y=Math.max(0,a.start),_=Math.min(g.count,a.start+a.count);for(let E=y,x=_-1;E<x;E+=c){const S=km(this,e,Qd,u,E,E+1,E);S&&t.push(S)}if(this.isLineLoop){const E=km(this,e,Qd,u,_-1,y,_-1);E&&t.push(E)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,r=Object.keys(t);if(r.length>0){const i=t[r[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=i.length;s<a;s++){const o=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}}function km(n,e,t,r,i,s,a){const o=n.geometry.attributes.position;if(pv.fromBufferAttribute(o,i),mv.fromBufferAttribute(o,s),t.distanceSqToSegment(pv,mv,My,xM)>r)return;My.applyMatrix4(n.matrixWorld);const c=e.ray.origin.distanceTo(My);if(!(c<e.near||c>e.far))return{distance:c,point:xM.clone().applyMatrix4(n.matrixWorld),index:a,face:null,faceIndex:null,barycoord:null,object:n}}const SM=new X,MM=new X;class Wo extends bu{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,r=[];for(let i=0,s=t.count;i<s;i+=2)SM.fromBufferAttribute(t,i),MM.fromBufferAttribute(t,i+1),r[i]=i===0?0:r[i-1],r[i+1]=r[i]+SM.distanceTo(MM);e.setAttribute("lineDistance",new Jt(r,1))}else Ft("LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class SE extends bu{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class ox extends ss{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new jt(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const wM=new vn,g_=new jf,zm=new Dr,Bm=new X;class ME extends Hn{constructor(e=new Sn,t=new ox){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const r=this.geometry,i=this.matrixWorld,s=e.params.Points.threshold,a=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),zm.copy(r.boundingSphere),zm.applyMatrix4(i),zm.radius+=s,e.ray.intersectsSphere(zm)===!1)return;wM.copy(i).invert(),g_.copy(e.ray).applyMatrix4(wM);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),u=o*o,c=r.index,m=r.attributes.position;if(c!==null){const g=Math.max(0,a.start),y=Math.min(c.count,a.start+a.count);for(let _=g,E=y;_<E;_++){const x=c.getX(_);Bm.fromBufferAttribute(m,x),EM(Bm,x,u,i,e,t,this)}}else{const g=Math.max(0,a.start),y=Math.min(m.count,a.start+a.count);for(let _=g,E=y;_<E;_++)Bm.fromBufferAttribute(m,_),EM(Bm,_,u,i,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,r=Object.keys(t);if(r.length>0){const i=t[r[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=i.length;s<a;s++){const o=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}}function EM(n,e,t,r,i,s,a){const o=g_.distanceSqToPoint(n);if(o<t){const u=new X;g_.closestPointToPoint(n,u),u.applyMatrix4(r);const c=i.ray.origin.distanceTo(u);if(c<i.near||c>i.far)return;s.push({distance:c,distanceToRay:Math.sqrt(o),point:u,index:e,face:null,faceIndex:null,barycoord:null,object:a})}}class wE extends ei{constructor(e,t,r,i,s=Dn,a=Dn,o,u,c){super(e,t,r,i,s,a,o,u,c),this.isVideoTexture=!0,this.generateMipmaps=!1,this._requestVideoFrameCallbackId=0;const f=this;function m(){f.needsUpdate=!0,f._requestVideoFrameCallbackId=e.requestVideoFrameCallback(m)}"requestVideoFrameCallback"in e&&(this._requestVideoFrameCallbackId=e.requestVideoFrameCallback(m))}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}dispose(){this._requestVideoFrameCallbackId!==0&&(this.source.data.cancelVideoFrameCallback(this._requestVideoFrameCallbackId),this._requestVideoFrameCallbackId=0),super.dispose()}}class mC extends wE{constructor(e,t,r,i,s,a,o,u){super({},e,t,r,i,s,a,o,u),this.isVideoFrameTexture=!0}update(){}clone(){return new this.constructor().copy(this)}setFrame(e){this.image=e,this.needsUpdate=!0}}class gC extends ei{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=Ji,this.minFilter=Ji,this.generateMipmaps=!1,this.needsUpdate=!0}}class Zv extends ei{constructor(e,t,r,i,s,a,o,u,c,f,m,g){super(null,a,o,u,c,f,i,s,m,g),this.isCompressedTexture=!0,this.image={width:t,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class vC extends Zv{constructor(e,t,r,i,s,a){super(e,t,r,s,a),this.isCompressedArrayTexture=!0,this.image.depth=i,this.wrapR=Gi,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class yC extends Zv{constructor(e,t,r){super(void 0,e[0].width,e[0].height,t,r,ho),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class _C extends ei{constructor(e,t,r,i,s,a,o,u,c){super(e,t,r,i,s,a,o,u,c),this.isCanvasTexture=!0,this.needsUpdate=!0}}class zf extends ei{constructor(e,t,r=ca,i,s,a,o=Ji,u=Ji,c,f=ko,m=1){if(f!==ko&&f!==vu)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");const g={width:e,height:t,depth:m};super(g,i,s,a,o,u,f,r,c),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new yu(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}class EE extends zf{constructor(e,t=ca,r=ho,i,s,a=Ji,o=Ji,u,c=ko){const f={width:e,height:e,depth:1},m=[f,f,f,f,f,f];super(e,e,t,r,i,s,a,o,u,c),this.image=m,this.isCubeDepthTexture=!0,this.isCubeTexture=!0}get images(){return this.image}set images(e){this.image=e}}class lx extends ei{constructor(e=null){super(),this.sourceTexture=e,this.isExternalTexture=!0}copy(e){return super.copy(e),this.sourceTexture=e.sourceTexture,this}}class Jv extends Sn{constructor(e=1,t=1,r=4,i=8,s=1){super(),this.type="CapsuleGeometry",this.parameters={radius:e,height:t,capSegments:r,radialSegments:i,heightSegments:s},t=Math.max(0,t),r=Math.max(1,Math.floor(r)),i=Math.max(3,Math.floor(i)),s=Math.max(1,Math.floor(s));const a=[],o=[],u=[],c=[],f=t/2,m=Math.PI/2*e,g=t,y=2*m+g,_=r*2+s,E=i+1,x=new X,S=new X;for(let T=0;T<=_;T++){let A=0,P=0,L=0,D=0;if(T<=r){const R=T/r,U=R*Math.PI/2;P=-f-e*Math.cos(U),L=e*Math.sin(U),D=-e*Math.cos(U),A=R*m}else if(T<=r+s){const R=(T-r)/s;P=-f+R*t,L=e,D=0,A=m+R*g}else{const R=(T-r-s)/r,U=R*Math.PI/2;P=f+e*Math.sin(U),L=e*Math.cos(U),D=e*Math.sin(U),A=m+g+R*m}const F=Math.max(0,Math.min(1,A/y));let k=0;T===0?k=.5/i:T===_&&(k=-.5/i);for(let R=0;R<=i;R++){const U=R/i,V=U*Math.PI*2,H=Math.sin(V),J=Math.cos(V);S.x=-L*J,S.y=P,S.z=L*H,o.push(S.x,S.y,S.z),x.set(-L*J,D,L*H),x.normalize(),u.push(x.x,x.y,x.z),c.push(U+k,F)}if(T>0){const R=(T-1)*E;for(let U=0;U<i;U++){const V=R+U,H=R+U+1,J=T*E+U,$=T*E+U+1;a.push(V,H,J),a.push(H,$,J)}}}this.setIndex(a),this.setAttribute("position",new Jt(o,3)),this.setAttribute("normal",new Jt(u,3)),this.setAttribute("uv",new Jt(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Jv(e.radius,e.height,e.capSegments,e.radialSegments,e.heightSegments)}}class Kv extends Sn{constructor(e=1,t=32,r=0,i=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:i},t=Math.max(3,t);const s=[],a=[],o=[],u=[],c=new X,f=new ct;a.push(0,0,0),o.push(0,0,1),u.push(.5,.5);for(let m=0,g=3;m<=t;m++,g+=3){const y=r+m/t*i;c.x=e*Math.cos(y),c.y=e*Math.sin(y),a.push(c.x,c.y,c.z),o.push(0,0,1),f.x=(a[g]/e+1)/2,f.y=(a[g+1]/e+1)/2,u.push(f.x,f.y)}for(let m=1;m<=t;m++)s.push(m,m+1,0);this.setIndex(s),this.setAttribute("position",new Jt(a,3)),this.setAttribute("normal",new Jt(o,3)),this.setAttribute("uv",new Jt(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Kv(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class o0 extends Sn{constructor(e=1,t=1,r=1,i=32,s=1,a=!1,o=0,u=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:i,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:u};const c=this;i=Math.floor(i),s=Math.floor(s);const f=[],m=[],g=[],y=[];let _=0;const E=[],x=r/2;let S=0;T(),a===!1&&(e>0&&A(!0),t>0&&A(!1)),this.setIndex(f),this.setAttribute("position",new Jt(m,3)),this.setAttribute("normal",new Jt(g,3)),this.setAttribute("uv",new Jt(y,2));function T(){const P=new X,L=new X;let D=0;const F=(t-e)/r;for(let k=0;k<=s;k++){const R=[],U=k/s,V=U*(t-e)+e;for(let H=0;H<=i;H++){const J=H/i,$=J*u+o,ae=Math.sin($),ne=Math.cos($);L.x=V*ae,L.y=-U*r+x,L.z=V*ne,m.push(L.x,L.y,L.z),P.set(ae,F,ne).normalize(),g.push(P.x,P.y,P.z),y.push(J,1-U),R.push(_++)}E.push(R)}for(let k=0;k<i;k++)for(let R=0;R<s;R++){const U=E[R][k],V=E[R+1][k],H=E[R+1][k+1],J=E[R][k+1];(e>0||R!==0)&&(f.push(U,V,J),D+=3),(t>0||R!==s-1)&&(f.push(V,H,J),D+=3)}c.addGroup(S,D,0),S+=D}function A(P){const L=_,D=new ct,F=new X;let k=0;const R=P===!0?e:t,U=P===!0?1:-1;for(let H=1;H<=i;H++)m.push(0,x*U,0),g.push(0,U,0),y.push(.5,.5),_++;const V=_;for(let H=0;H<=i;H++){const $=H/i*u+o,ae=Math.cos($),ne=Math.sin($);F.x=R*ne,F.y=x*U,F.z=R*ae,m.push(F.x,F.y,F.z),g.push(0,U,0),D.x=ae*.5+.5,D.y=ne*.5*U+.5,y.push(D.x,D.y),_++}for(let H=0;H<i;H++){const J=L+H,$=V+H;P===!0?f.push($,$+1,J):f.push($+1,$,J),k+=3}c.addGroup(S,k,P===!0?1:2),S+=k}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new o0(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class l0 extends o0{constructor(e=1,t=1,r=32,i=1,s=!1,a=0,o=Math.PI*2){super(0,e,t,r,i,s,a,o),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:i,openEnded:s,thetaStart:a,thetaLength:o}}static fromJSON(e){return new l0(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Iu extends Sn{constructor(e=[],t=[],r=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:i};const s=[],a=[];o(i),c(r),f(),this.setAttribute("position",new Jt(s,3)),this.setAttribute("normal",new Jt(s.slice(),3)),this.setAttribute("uv",new Jt(a,2)),i===0?this.computeVertexNormals():this.normalizeNormals();function o(T){const A=new X,P=new X,L=new X;for(let D=0;D<t.length;D+=3)y(t[D+0],A),y(t[D+1],P),y(t[D+2],L),u(A,P,L,T)}function u(T,A,P,L){const D=L+1,F=[];for(let k=0;k<=D;k++){F[k]=[];const R=T.clone().lerp(P,k/D),U=A.clone().lerp(P,k/D),V=D-k;for(let H=0;H<=V;H++)H===0&&k===D?F[k][H]=R:F[k][H]=R.clone().lerp(U,H/V)}for(let k=0;k<D;k++)for(let R=0;R<2*(D-k)-1;R++){const U=Math.floor(R/2);R%2===0?(g(F[k][U+1]),g(F[k+1][U]),g(F[k][U])):(g(F[k][U+1]),g(F[k+1][U+1]),g(F[k+1][U]))}}function c(T){const A=new X;for(let P=0;P<s.length;P+=3)A.x=s[P+0],A.y=s[P+1],A.z=s[P+2],A.normalize().multiplyScalar(T),s[P+0]=A.x,s[P+1]=A.y,s[P+2]=A.z}function f(){const T=new X;for(let A=0;A<s.length;A+=3){T.x=s[A+0],T.y=s[A+1],T.z=s[A+2];const P=x(T)/2/Math.PI+.5,L=S(T)/Math.PI+.5;a.push(P,1-L)}_(),m()}function m(){for(let T=0;T<a.length;T+=6){const A=a[T+0],P=a[T+2],L=a[T+4],D=Math.max(A,P,L),F=Math.min(A,P,L);D>.9&&F<.1&&(A<.2&&(a[T+0]+=1),P<.2&&(a[T+2]+=1),L<.2&&(a[T+4]+=1))}}function g(T){s.push(T.x,T.y,T.z)}function y(T,A){const P=T*3;A.x=e[P+0],A.y=e[P+1],A.z=e[P+2]}function _(){const T=new X,A=new X,P=new X,L=new X,D=new ct,F=new ct,k=new ct;for(let R=0,U=0;R<s.length;R+=9,U+=6){T.set(s[R+0],s[R+1],s[R+2]),A.set(s[R+3],s[R+4],s[R+5]),P.set(s[R+6],s[R+7],s[R+8]),D.set(a[U+0],a[U+1]),F.set(a[U+2],a[U+3]),k.set(a[U+4],a[U+5]),L.copy(T).add(A).add(P).divideScalar(3);const V=x(L);E(D,U+0,T,V),E(F,U+2,A,V),E(k,U+4,P,V)}}function E(T,A,P,L){L<0&&T.x===1&&(a[A]=T.x-1),P.x===0&&P.z===0&&(a[A]=L/2/Math.PI+.5)}function x(T){return Math.atan2(T.z,-T.x)}function S(T){return Math.atan2(-T.y,Math.sqrt(T.x*T.x+T.z*T.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Iu(e.vertices,e.indices,e.radius,e.detail)}}class Qv extends Iu{constructor(e=1,t=0){const r=(1+Math.sqrt(5))/2,i=1/r,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-r,0,-i,r,0,i,-r,0,i,r,-i,-r,0,-i,r,0,i,-r,0,i,r,0,-r,0,-i,r,0,-i,-r,0,i,r,0,i],a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(s,a,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Qv(e.radius,e.detail)}}const Gm=new X,Vm=new X,wy=new X,Hm=new Hs;class TE extends Sn{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){const i=Math.pow(10,4),s=Math.cos(Bc*t),a=e.getIndex(),o=e.getAttribute("position"),u=a?a.count:o.count,c=[0,0,0],f=["a","b","c"],m=new Array(3),g={},y=[];for(let _=0;_<u;_+=3){a?(c[0]=a.getX(_),c[1]=a.getX(_+1),c[2]=a.getX(_+2)):(c[0]=_,c[1]=_+1,c[2]=_+2);const{a:E,b:x,c:S}=Hm;if(E.fromBufferAttribute(o,c[0]),x.fromBufferAttribute(o,c[1]),S.fromBufferAttribute(o,c[2]),Hm.getNormal(wy),m[0]=`${Math.round(E.x*i)},${Math.round(E.y*i)},${Math.round(E.z*i)}`,m[1]=`${Math.round(x.x*i)},${Math.round(x.y*i)},${Math.round(x.z*i)}`,m[2]=`${Math.round(S.x*i)},${Math.round(S.y*i)},${Math.round(S.z*i)}`,!(m[0]===m[1]||m[1]===m[2]||m[2]===m[0]))for(let T=0;T<3;T++){const A=(T+1)%3,P=m[T],L=m[A],D=Hm[f[T]],F=Hm[f[A]],k=`${P}_${L}`,R=`${L}_${P}`;R in g&&g[R]?(wy.dot(g[R].normal)<=s&&(y.push(D.x,D.y,D.z),y.push(F.x,F.y,F.z)),g[R]=null):k in g||(g[k]={index0:c[T],index1:c[A],normal:wy.clone()})}}for(const _ in g)if(g[_]){const{index0:E,index1:x}=g[_];Gm.fromBufferAttribute(o,E),Vm.fromBufferAttribute(o,x),y.push(Gm.x,Gm.y,Gm.z),y.push(Vm.x,Vm.y,Vm.z)}this.setAttribute("position",new Jt(y,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class fo{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){Ft("Curve: .getPoint() not implemented.")}getPointAt(e,t){const r=this.getUtoTmapping(e);return this.getPoint(r,t)}getPoints(e=5){const t=[];for(let r=0;r<=e;r++)t.push(this.getPoint(r/e));return t}getSpacedPoints(e=5){const t=[];for(let r=0;r<=e;r++)t.push(this.getPointAt(r/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let r,i=this.getPoint(0),s=0;t.push(0);for(let a=1;a<=e;a++)r=this.getPoint(a/e),s+=r.distanceTo(i),t.push(s),i=r;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t=null){const r=this.getLengths();let i=0;const s=r.length;let a;t?a=t:a=e*r[s-1];let o=0,u=s-1,c;for(;o<=u;)if(i=Math.floor(o+(u-o)/2),c=r[i]-a,c<0)o=i+1;else if(c>0)u=i-1;else{u=i;break}if(i=u,r[i]===a)return i/(s-1);const f=r[i],g=r[i+1]-f,y=(a-f)/g;return(i+y)/(s-1)}getTangent(e,t){let i=e-1e-4,s=e+1e-4;i<0&&(i=0),s>1&&(s=1);const a=this.getPoint(i),o=this.getPoint(s),u=t||(a.isVector2?new ct:new X);return u.copy(o).sub(a).normalize(),u}getTangentAt(e,t){const r=this.getUtoTmapping(e);return this.getTangent(r,t)}computeFrenetFrames(e,t=!1){const r=new X,i=[],s=[],a=[],o=new X,u=new vn;for(let y=0;y<=e;y++){const _=y/e;i[y]=this.getTangentAt(_,new X)}s[0]=new X,a[0]=new X;let c=Number.MAX_VALUE;const f=Math.abs(i[0].x),m=Math.abs(i[0].y),g=Math.abs(i[0].z);f<=c&&(c=f,r.set(1,0,0)),m<=c&&(c=m,r.set(0,1,0)),g<=c&&r.set(0,0,1),o.crossVectors(i[0],r).normalize(),s[0].crossVectors(i[0],o),a[0].crossVectors(i[0],s[0]);for(let y=1;y<=e;y++){if(s[y]=s[y-1].clone(),a[y]=a[y-1].clone(),o.crossVectors(i[y-1],i[y]),o.length()>Number.EPSILON){o.normalize();const _=Math.acos(gn(i[y-1].dot(i[y]),-1,1));s[y].applyMatrix4(u.makeRotationAxis(o,_))}a[y].crossVectors(i[y],s[y])}if(t===!0){let y=Math.acos(gn(s[0].dot(s[e]),-1,1));y/=e,i[0].dot(o.crossVectors(s[0],s[e]))>0&&(y=-y);for(let _=1;_<=e;_++)s[_].applyMatrix4(u.makeRotationAxis(i[_],y*_)),a[_].crossVectors(i[_],s[_])}return{tangents:i,normals:s,binormals:a}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.7,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class $v extends fo{constructor(e=0,t=0,r=1,i=1,s=0,a=Math.PI*2,o=!1,u=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=r,this.yRadius=i,this.aStartAngle=s,this.aEndAngle=a,this.aClockwise=o,this.aRotation=u}getPoint(e,t=new ct){const r=t,i=Math.PI*2;let s=this.aEndAngle-this.aStartAngle;const a=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=i;for(;s>i;)s-=i;s<Number.EPSILON&&(a?s=0:s=i),this.aClockwise===!0&&!a&&(s===i?s=-i:s=s-i);const o=this.aStartAngle+e*s;let u=this.aX+this.xRadius*Math.cos(o),c=this.aY+this.yRadius*Math.sin(o);if(this.aRotation!==0){const f=Math.cos(this.aRotation),m=Math.sin(this.aRotation),g=u-this.aX,y=c-this.aY;u=g*f-y*m+this.aX,c=g*m+y*f+this.aY}return r.set(u,c)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class bE extends $v{constructor(e,t,r,i,s,a){super(e,t,r,r,i,s,a),this.isArcCurve=!0,this.type="ArcCurve"}}function ux(){let n=0,e=0,t=0,r=0;function i(s,a,o,u){n=s,e=o,t=-3*s+3*a-2*o-u,r=2*s-2*a+o+u}return{initCatmullRom:function(s,a,o,u,c){i(a,o,c*(o-s),c*(u-a))},initNonuniformCatmullRom:function(s,a,o,u,c,f,m){let g=(a-s)/c-(o-s)/(c+f)+(o-a)/f,y=(o-a)/f-(u-a)/(f+m)+(u-o)/m;g*=f,y*=f,i(a,o,g,y)},calc:function(s){const a=s*s,o=a*s;return n+e*s+t*a+r*o}}}const Wm=new X,Ey=new ux,Ty=new ux,by=new ux;class AE extends fo{constructor(e=[],t=!1,r="centripetal",i=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=r,this.tension=i}getPoint(e,t=new X){const r=t,i=this.points,s=i.length,a=(s-(this.closed?0:1))*e;let o=Math.floor(a),u=a-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/s)+1)*s:u===0&&o===s-1&&(o=s-2,u=1);let c,f;this.closed||o>0?c=i[(o-1)%s]:(Wm.subVectors(i[0],i[1]).add(i[0]),c=Wm);const m=i[o%s],g=i[(o+1)%s];if(this.closed||o+2<s?f=i[(o+2)%s]:(Wm.subVectors(i[s-1],i[s-2]).add(i[s-1]),f=Wm),this.curveType==="centripetal"||this.curveType==="chordal"){const y=this.curveType==="chordal"?.5:.25;let _=Math.pow(c.distanceToSquared(m),y),E=Math.pow(m.distanceToSquared(g),y),x=Math.pow(g.distanceToSquared(f),y);E<1e-4&&(E=1),_<1e-4&&(_=E),x<1e-4&&(x=E),Ey.initNonuniformCatmullRom(c.x,m.x,g.x,f.x,_,E,x),Ty.initNonuniformCatmullRom(c.y,m.y,g.y,f.y,_,E,x),by.initNonuniformCatmullRom(c.z,m.z,g.z,f.z,_,E,x)}else this.curveType==="catmullrom"&&(Ey.initCatmullRom(c.x,m.x,g.x,f.x,this.tension),Ty.initCatmullRom(c.y,m.y,g.y,f.y,this.tension),by.initCatmullRom(c.z,m.z,g.z,f.z,this.tension));return r.set(Ey.calc(u),Ty.calc(u),by.calc(u)),r}copy(e){super.copy(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,r=this.points.length;t<r;t++){const i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const i=e.points[t];this.points.push(new X().fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function TM(n,e,t,r,i){const s=(r-e)*.5,a=(i-t)*.5,o=n*n,u=n*o;return(2*t-2*r+s+a)*u+(-3*t+3*r-2*s-a)*o+s*n+t}function xC(n,e){const t=1-n;return t*t*e}function SC(n,e){return 2*(1-n)*n*e}function MC(n,e){return n*n*e}function Sp(n,e,t,r){return xC(n,e)+SC(n,t)+MC(n,r)}function wC(n,e){const t=1-n;return t*t*t*e}function EC(n,e){const t=1-n;return 3*t*t*n*e}function TC(n,e){return 3*(1-n)*n*n*e}function bC(n,e){return n*n*n*e}function Mp(n,e,t,r,i){return wC(n,e)+EC(n,t)+TC(n,r)+bC(n,i)}class cx extends fo{constructor(e=new ct,t=new ct,r=new ct,i=new ct){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=r,this.v3=i}getPoint(e,t=new ct){const r=t,i=this.v0,s=this.v1,a=this.v2,o=this.v3;return r.set(Mp(e,i.x,s.x,a.x,o.x),Mp(e,i.y,s.y,a.y,o.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class CE extends fo{constructor(e=new X,t=new X,r=new X,i=new X){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=r,this.v3=i}getPoint(e,t=new X){const r=t,i=this.v0,s=this.v1,a=this.v2,o=this.v3;return r.set(Mp(e,i.x,s.x,a.x,o.x),Mp(e,i.y,s.y,a.y,o.y),Mp(e,i.z,s.z,a.z,o.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class hx extends fo{constructor(e=new ct,t=new ct){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new ct){const r=t;return e===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new ct){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class PE extends fo{constructor(e=new X,t=new X){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new X){const r=t;return e===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new X){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class fx extends fo{constructor(e=new ct,t=new ct,r=new ct){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=r}getPoint(e,t=new ct){const r=t,i=this.v0,s=this.v1,a=this.v2;return r.set(Sp(e,i.x,s.x,a.x),Sp(e,i.y,s.y,a.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class dx extends fo{constructor(e=new X,t=new X,r=new X){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=r}getPoint(e,t=new X){const r=t,i=this.v0,s=this.v1,a=this.v2;return r.set(Sp(e,i.x,s.x,a.x),Sp(e,i.y,s.y,a.y),Sp(e,i.z,s.z,a.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class px extends fo{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new ct){const r=t,i=this.points,s=(i.length-1)*e,a=Math.floor(s),o=s-a,u=i[a===0?a:a-1],c=i[a],f=i[a>i.length-2?i.length-1:a+1],m=i[a>i.length-3?i.length-1:a+2];return r.set(TM(o,u.x,c.x,f.x,m.x),TM(o,u.y,c.y,f.y,m.y)),r}copy(e){super.copy(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const i=e.points[t];this.points.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,r=this.points.length;t<r;t++){const i=this.points[t];e.points.push(i.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const i=e.points[t];this.points.push(new ct().fromArray(i))}return this}}var gv=Object.freeze({__proto__:null,ArcCurve:bE,CatmullRomCurve3:AE,CubicBezierCurve:cx,CubicBezierCurve3:CE,EllipseCurve:$v,LineCurve:hx,LineCurve3:PE,QuadraticBezierCurve:fx,QuadraticBezierCurve3:dx,SplineCurve:px});class RE extends fo{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const r=e.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new gv[r](t,e))}return this}getPoint(e,t){const r=e*this.getLength(),i=this.getCurveLengths();let s=0;for(;s<i.length;){if(i[s]>=r){const a=i[s]-r,o=this.curves[s],u=o.getLength(),c=u===0?0:1-a/u;return o.getPointAt(c,t)}s++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let r=0,i=this.curves.length;r<i;r++)t+=this.curves[r].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let r=0;r<=e;r++)t.push(this.getPoint(r/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let r;for(let i=0,s=this.curves;i<s.length;i++){const a=s[i],o=a.isEllipseCurve?e*2:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?e*a.points.length:e,u=a.getPoints(o);for(let c=0;c<u.length;c++){const f=u[c];r&&r.equals(f)||(t.push(f),r=f)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,r=e.curves.length;t<r;t++){const i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,r=this.curves.length;t<r;t++){const i=this.curves[t];e.curves.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,r=e.curves.length;t<r;t++){const i=e.curves[t];this.curves.push(new gv[i.type]().fromJSON(i))}return this}}class vv extends RE{constructor(e){super(),this.type="Path",this.currentPoint=new ct,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,r=e.length;t<r;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const r=new hx(this.currentPoint.clone(),new ct(e,t));return this.curves.push(r),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,r,i){const s=new fx(this.currentPoint.clone(),new ct(e,t),new ct(r,i));return this.curves.push(s),this.currentPoint.set(r,i),this}bezierCurveTo(e,t,r,i,s,a){const o=new cx(this.currentPoint.clone(),new ct(e,t),new ct(r,i),new ct(s,a));return this.curves.push(o),this.currentPoint.set(s,a),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),r=new px(t);return this.curves.push(r),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,r,i,s,a){const o=this.currentPoint.x,u=this.currentPoint.y;return this.absarc(e+o,t+u,r,i,s,a),this}absarc(e,t,r,i,s,a){return this.absellipse(e,t,r,r,i,s,a),this}ellipse(e,t,r,i,s,a,o,u){const c=this.currentPoint.x,f=this.currentPoint.y;return this.absellipse(e+c,t+f,r,i,s,a,o,u),this}absellipse(e,t,r,i,s,a,o,u){const c=new $v(e,t,r,i,s,a,o,u);if(this.curves.length>0){const m=c.getPoint(0);m.equals(this.currentPoint)||this.lineTo(m.x,m.y)}this.curves.push(c);const f=c.getPoint(1);return this.currentPoint.copy(f),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class Vc extends vv{constructor(e){super(e),this.uuid=la(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let r=0,i=this.holes.length;r<i;r++)t[r]=this.holes[r].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,r=e.holes.length;t<r;t++){const i=e.holes[t];this.holes.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,r=this.holes.length;t<r;t++){const i=this.holes[t];e.holes.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,r=e.holes.length;t<r;t++){const i=e.holes[t];this.holes.push(new vv().fromJSON(i))}return this}}function AC(n,e,t=2){const r=e&&e.length,i=r?e[0]*t:n.length;let s=IE(n,0,i,t,!0);const a=[];if(!s||s.next===s.prev)return a;let o,u,c;if(r&&(s=LC(n,e,s,t)),n.length>80*t){o=n[0],u=n[1];let f=o,m=u;for(let g=t;g<i;g+=t){const y=n[g],_=n[g+1];y<o&&(o=y),_<u&&(u=_),y>f&&(f=y),_>m&&(m=_)}c=Math.max(f-o,m-u),c=c!==0?32767/c:0}return Bp(s,a,t,o,u,c,0),a}function IE(n,e,t,r,i){let s;if(i===HC(n,e,t,r)>0)for(let a=e;a<t;a+=r)s=bM(a/r|0,n[a],n[a+1],s);else for(let a=t-r;a>=e;a-=r)s=bM(a/r|0,n[a],n[a+1],s);return s&&Bf(s,s.next)&&(Vp(s),s=s.next),s}function Yc(n,e){if(!n)return n;e||(e=n);let t=n,r;do if(r=!1,!t.steiner&&(Bf(t,t.next)||Ni(t.prev,t,t.next)===0)){if(Vp(t),t=e=t.prev,t===t.next)break;r=!0}else t=t.next;while(r||t!==e);return e}function Bp(n,e,t,r,i,s,a){if(!n)return;!a&&s&&OC(n,r,i,s);let o=n;for(;n.prev!==n.next;){const u=n.prev,c=n.next;if(s?PC(n,r,i,s):CC(n)){e.push(u.i,n.i,c.i),Vp(n),n=c.next,o=c.next;continue}if(n=c,n===o){a?a===1?(n=RC(Yc(n),e),Bp(n,e,t,r,i,s,2)):a===2&&IC(n,e,t,r,i,s):Bp(Yc(n),e,t,r,i,s,1);break}}}function CC(n){const e=n.prev,t=n,r=n.next;if(Ni(e,t,r)>=0)return!1;const i=e.x,s=t.x,a=r.x,o=e.y,u=t.y,c=r.y,f=Math.min(i,s,a),m=Math.min(o,u,c),g=Math.max(i,s,a),y=Math.max(o,u,c);let _=r.next;for(;_!==e;){if(_.x>=f&&_.x<=g&&_.y>=m&&_.y<=y&&lp(i,o,s,u,a,c,_.x,_.y)&&Ni(_.prev,_,_.next)>=0)return!1;_=_.next}return!0}function PC(n,e,t,r){const i=n.prev,s=n,a=n.next;if(Ni(i,s,a)>=0)return!1;const o=i.x,u=s.x,c=a.x,f=i.y,m=s.y,g=a.y,y=Math.min(o,u,c),_=Math.min(f,m,g),E=Math.max(o,u,c),x=Math.max(f,m,g),S=v_(y,_,e,t,r),T=v_(E,x,e,t,r);let A=n.prevZ,P=n.nextZ;for(;A&&A.z>=S&&P&&P.z<=T;){if(A.x>=y&&A.x<=E&&A.y>=_&&A.y<=x&&A!==i&&A!==a&&lp(o,f,u,m,c,g,A.x,A.y)&&Ni(A.prev,A,A.next)>=0||(A=A.prevZ,P.x>=y&&P.x<=E&&P.y>=_&&P.y<=x&&P!==i&&P!==a&&lp(o,f,u,m,c,g,P.x,P.y)&&Ni(P.prev,P,P.next)>=0))return!1;P=P.nextZ}for(;A&&A.z>=S;){if(A.x>=y&&A.x<=E&&A.y>=_&&A.y<=x&&A!==i&&A!==a&&lp(o,f,u,m,c,g,A.x,A.y)&&Ni(A.prev,A,A.next)>=0)return!1;A=A.prevZ}for(;P&&P.z<=T;){if(P.x>=y&&P.x<=E&&P.y>=_&&P.y<=x&&P!==i&&P!==a&&lp(o,f,u,m,c,g,P.x,P.y)&&Ni(P.prev,P,P.next)>=0)return!1;P=P.nextZ}return!0}function RC(n,e){let t=n;do{const r=t.prev,i=t.next.next;!Bf(r,i)&&NE(r,t,t.next,i)&&Gp(r,i)&&Gp(i,r)&&(e.push(r.i,t.i,i.i),Vp(t),Vp(t.next),t=n=i),t=t.next}while(t!==n);return Yc(t)}function IC(n,e,t,r,i,s){let a=n;do{let o=a.next.next;for(;o!==a.prev;){if(a.i!==o.i&&BC(a,o)){let u=DE(a,o);a=Yc(a,a.next),u=Yc(u,u.next),Bp(a,e,t,r,i,s,0),Bp(u,e,t,r,i,s,0);return}o=o.next}a=a.next}while(a!==n)}function LC(n,e,t,r){const i=[];for(let s=0,a=e.length;s<a;s++){const o=e[s]*r,u=s<a-1?e[s+1]*r:n.length,c=IE(n,o,u,r,!1);c===c.next&&(c.steiner=!0),i.push(zC(c))}i.sort(NC);for(let s=0;s<i.length;s++)t=DC(i[s],t);return t}function NC(n,e){let t=n.x-e.x;if(t===0&&(t=n.y-e.y,t===0)){const r=(n.next.y-n.y)/(n.next.x-n.x),i=(e.next.y-e.y)/(e.next.x-e.x);t=r-i}return t}function DC(n,e){const t=UC(n,e);if(!t)return e;const r=DE(t,n);return Yc(r,r.next),Yc(t,t.next)}function UC(n,e){let t=e;const r=n.x,i=n.y;let s=-1/0,a;if(Bf(n,t))return t;do{if(Bf(n,t.next))return t.next;if(i<=t.y&&i>=t.next.y&&t.next.y!==t.y){const m=t.x+(i-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(m<=r&&m>s&&(s=m,a=t.x<t.next.x?t:t.next,m===r))return a}t=t.next}while(t!==e);if(!a)return null;const o=a,u=a.x,c=a.y;let f=1/0;t=a;do{if(r>=t.x&&t.x>=u&&r!==t.x&&LE(i<c?r:s,i,u,c,i<c?s:r,i,t.x,t.y)){const m=Math.abs(i-t.y)/(r-t.x);Gp(t,n)&&(m<f||m===f&&(t.x>a.x||t.x===a.x&&FC(a,t)))&&(a=t,f=m)}t=t.next}while(t!==o);return a}function FC(n,e){return Ni(n.prev,n,e.prev)<0&&Ni(e.next,n,n.next)<0}function OC(n,e,t,r){let i=n;do i.z===0&&(i.z=v_(i.x,i.y,e,t,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==n);i.prevZ.nextZ=null,i.prevZ=null,kC(i)}function kC(n){let e,t=1;do{let r=n,i;n=null;let s=null;for(e=0;r;){e++;let a=r,o=0;for(let c=0;c<t&&(o++,a=a.nextZ,!!a);c++);let u=t;for(;o>0||u>0&&a;)o!==0&&(u===0||!a||r.z<=a.z)?(i=r,r=r.nextZ,o--):(i=a,a=a.nextZ,u--),s?s.nextZ=i:n=i,i.prevZ=s,s=i;r=a}s.nextZ=null,t*=2}while(e>1);return n}function v_(n,e,t,r,i){return n=(n-t)*i|0,e=(e-r)*i|0,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,n|e<<1}function zC(n){let e=n,t=n;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==n);return t}function LE(n,e,t,r,i,s,a,o){return(i-a)*(e-o)>=(n-a)*(s-o)&&(n-a)*(r-o)>=(t-a)*(e-o)&&(t-a)*(s-o)>=(i-a)*(r-o)}function lp(n,e,t,r,i,s,a,o){return!(n===a&&e===o)&&LE(n,e,t,r,i,s,a,o)}function BC(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!GC(n,e)&&(Gp(n,e)&&Gp(e,n)&&VC(n,e)&&(Ni(n.prev,n,e.prev)||Ni(n,e.prev,e))||Bf(n,e)&&Ni(n.prev,n,n.next)>0&&Ni(e.prev,e,e.next)>0)}function Ni(n,e,t){return(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y)}function Bf(n,e){return n.x===e.x&&n.y===e.y}function NE(n,e,t,r){const i=Xm(Ni(n,e,t)),s=Xm(Ni(n,e,r)),a=Xm(Ni(t,r,n)),o=Xm(Ni(t,r,e));return!!(i!==s&&a!==o||i===0&&jm(n,t,e)||s===0&&jm(n,r,e)||a===0&&jm(t,n,r)||o===0&&jm(t,e,r))}function jm(n,e,t){return e.x<=Math.max(n.x,t.x)&&e.x>=Math.min(n.x,t.x)&&e.y<=Math.max(n.y,t.y)&&e.y>=Math.min(n.y,t.y)}function Xm(n){return n>0?1:n<0?-1:0}function GC(n,e){let t=n;do{if(t.i!==n.i&&t.next.i!==n.i&&t.i!==e.i&&t.next.i!==e.i&&NE(t,t.next,n,e))return!0;t=t.next}while(t!==n);return!1}function Gp(n,e){return Ni(n.prev,n,n.next)<0?Ni(n,e,n.next)>=0&&Ni(n,n.prev,e)>=0:Ni(n,e,n.prev)<0||Ni(n,n.next,e)<0}function VC(n,e){let t=n,r=!1;const i=(n.x+e.x)/2,s=(n.y+e.y)/2;do t.y>s!=t.next.y>s&&t.next.y!==t.y&&i<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(r=!r),t=t.next;while(t!==n);return r}function DE(n,e){const t=y_(n.i,n.x,n.y),r=y_(e.i,e.x,e.y),i=n.next,s=e.prev;return n.next=e,e.prev=n,t.next=i,i.prev=t,r.next=t,t.prev=r,s.next=r,r.prev=s,r}function bM(n,e,t,r){const i=y_(n,e,t);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Vp(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function y_(n,e,t){return{i:n,x:e,y:t,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function HC(n,e,t,r){let i=0;for(let s=e,a=t-r;s<t;s+=r)i+=(n[a]-n[s])*(n[s+1]+n[a+1]),a=s;return i}class WC{static triangulate(e,t,r=2){return AC(e,t,r)}}class lo{static area(e){const t=e.length;let r=0;for(let i=t-1,s=0;s<t;i=s++)r+=e[i].x*e[s].y-e[s].x*e[i].y;return r*.5}static isClockWise(e){return lo.area(e)<0}static triangulateShape(e,t){const r=[],i=[],s=[];AM(e),CM(r,e);let a=e.length;t.forEach(AM);for(let u=0;u<t.length;u++)i.push(a),a+=t[u].length,CM(r,t[u]);const o=WC.triangulate(r,i);for(let u=0;u<o.length;u+=3)s.push(o.slice(u,u+3));return s}}function AM(n){const e=n.length;e>2&&n[e-1].equals(n[0])&&n.pop()}function CM(n,e){for(let t=0;t<e.length;t++)n.push(e[t].x),n.push(e[t].y)}class e1 extends Sn{constructor(e=new Vc([new ct(.5,.5),new ct(-.5,.5),new ct(-.5,-.5),new ct(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const r=this,i=[],s=[];for(let o=0,u=e.length;o<u;o++){const c=e[o];a(c)}this.setAttribute("position",new Jt(i,3)),this.setAttribute("uv",new Jt(s,2)),this.computeVertexNormals();function a(o){const u=[],c=t.curveSegments!==void 0?t.curveSegments:12,f=t.steps!==void 0?t.steps:1,m=t.depth!==void 0?t.depth:1;let g=t.bevelEnabled!==void 0?t.bevelEnabled:!0,y=t.bevelThickness!==void 0?t.bevelThickness:.2,_=t.bevelSize!==void 0?t.bevelSize:y-.1,E=t.bevelOffset!==void 0?t.bevelOffset:0,x=t.bevelSegments!==void 0?t.bevelSegments:3;const S=t.extrudePath,T=t.UVGenerator!==void 0?t.UVGenerator:jC;let A,P=!1,L,D,F,k;if(S){A=S.getSpacedPoints(f),P=!0,g=!1;const Ne=S.isCatmullRomCurve3?S.closed:!1;L=S.computeFrenetFrames(f,Ne),D=new X,F=new X,k=new X}g||(x=0,y=0,_=0,E=0);const R=o.extractPoints(c);let U=R.shape;const V=R.holes;if(!lo.isClockWise(U)){U=U.reverse();for(let Ne=0,Be=V.length;Ne<Be;Ne++){const De=V[Ne];lo.isClockWise(De)&&(V[Ne]=De.reverse())}}function J(Ne){const De=10000000000000001e-36;let it=Ne[0];for(let Q=1;Q<=Ne.length;Q++){const at=Q%Ne.length,je=Ne[at],Ce=je.x-it.x,He=je.y-it.y,q=Ce*Ce+He*He,B=Math.max(Math.abs(je.x),Math.abs(je.y),Math.abs(it.x),Math.abs(it.y)),ue=De*B*B;if(q<=ue){Ne.splice(at,1),Q--;continue}it=je}}J(U),V.forEach(J);const $=V.length,ae=U;for(let Ne=0;Ne<$;Ne++){const Be=V[Ne];U=U.concat(Be)}function ne(Ne,Be,De){return Be||ln("ExtrudeGeometry: vec does not exist"),Ne.clone().addScaledVector(Be,De)}const oe=U.length;function te(Ne,Be,De){let it,Q,at;const je=Ne.x-Be.x,Ce=Ne.y-Be.y,He=De.x-Ne.x,q=De.y-Ne.y,B=je*je+Ce*Ce,ue=je*q-Ce*He;if(Math.abs(ue)>Number.EPSILON){const Re=Math.sqrt(B),Pe=Math.sqrt(He*He+q*q),Te=Be.x-Ce/Re,ot=Be.y+je/Re,rt=De.x-q/Pe,mt=De.y+He/Pe,Rt=((rt-Te)*q-(mt-ot)*He)/(je*q-Ce*He);it=Te+je*Rt-Ne.x,Q=ot+Ce*Rt-Ne.y;const Ge=it*it+Q*Q;if(Ge<=2)return new ct(it,Q);at=Math.sqrt(Ge/2)}else{let Re=!1;je>Number.EPSILON?He>Number.EPSILON&&(Re=!0):je<-Number.EPSILON?He<-Number.EPSILON&&(Re=!0):Math.sign(Ce)===Math.sign(q)&&(Re=!0),Re?(it=-Ce,Q=je,at=Math.sqrt(B)):(it=je,Q=Ce,at=Math.sqrt(B/2))}return new ct(it/at,Q/at)}const ie=[];for(let Ne=0,Be=ae.length,De=Be-1,it=Ne+1;Ne<Be;Ne++,De++,it++)De===Be&&(De=0),it===Be&&(it=0),ie[Ne]=te(ae[Ne],ae[De],ae[it]);const Y=[];let z,K=ie.concat();for(let Ne=0,Be=$;Ne<Be;Ne++){const De=V[Ne];z=[];for(let it=0,Q=De.length,at=Q-1,je=it+1;it<Q;it++,at++,je++)at===Q&&(at=0),je===Q&&(je=0),z[it]=te(De[it],De[at],De[je]);Y.push(z),K=K.concat(z)}let le;if(x===0)le=lo.triangulateShape(ae,V);else{const Ne=[],Be=[];for(let De=0;De<x;De++){const it=De/x,Q=y*Math.cos(it*Math.PI/2),at=_*Math.sin(it*Math.PI/2)+E;for(let je=0,Ce=ae.length;je<Ce;je++){const He=ne(ae[je],ie[je],at);ze(He.x,He.y,-Q),it===0&&Ne.push(He)}for(let je=0,Ce=$;je<Ce;je++){const He=V[je];z=Y[je];const q=[];for(let B=0,ue=He.length;B<ue;B++){const Re=ne(He[B],z[B],at);ze(Re.x,Re.y,-Q),it===0&&q.push(Re)}it===0&&Be.push(q)}}le=lo.triangulateShape(Ne,Be)}const me=le.length,ve=_+E;for(let Ne=0;Ne<oe;Ne++){const Be=g?ne(U[Ne],K[Ne],ve):U[Ne];P?(F.copy(L.normals[0]).multiplyScalar(Be.x),D.copy(L.binormals[0]).multiplyScalar(Be.y),k.copy(A[0]).add(F).add(D),ze(k.x,k.y,k.z)):ze(Be.x,Be.y,0)}for(let Ne=1;Ne<=f;Ne++)for(let Be=0;Be<oe;Be++){const De=g?ne(U[Be],K[Be],ve):U[Be];P?(F.copy(L.normals[Ne]).multiplyScalar(De.x),D.copy(L.binormals[Ne]).multiplyScalar(De.y),k.copy(A[Ne]).add(F).add(D),ze(k.x,k.y,k.z)):ze(De.x,De.y,m/f*Ne)}for(let Ne=x-1;Ne>=0;Ne--){const Be=Ne/x,De=y*Math.cos(Be*Math.PI/2),it=_*Math.sin(Be*Math.PI/2)+E;for(let Q=0,at=ae.length;Q<at;Q++){const je=ne(ae[Q],ie[Q],it);ze(je.x,je.y,m+De)}for(let Q=0,at=V.length;Q<at;Q++){const je=V[Q];z=Y[Q];for(let Ce=0,He=je.length;Ce<He;Ce++){const q=ne(je[Ce],z[Ce],it);P?ze(q.x,q.y+A[f-1].y,A[f-1].x+De):ze(q.x,q.y,m+De)}}}re(),he();function re(){const Ne=i.length/3;if(g){let Be=0,De=oe*Be;for(let it=0;it<me;it++){const Q=le[it];Ve(Q[2]+De,Q[1]+De,Q[0]+De)}Be=f+x*2,De=oe*Be;for(let it=0;it<me;it++){const Q=le[it];Ve(Q[0]+De,Q[1]+De,Q[2]+De)}}else{for(let Be=0;Be<me;Be++){const De=le[Be];Ve(De[2],De[1],De[0])}for(let Be=0;Be<me;Be++){const De=le[Be];Ve(De[0]+oe*f,De[1]+oe*f,De[2]+oe*f)}}r.addGroup(Ne,i.length/3-Ne,0)}function he(){const Ne=i.length/3;let Be=0;ye(ae,Be),Be+=ae.length;for(let De=0,it=V.length;De<it;De++){const Q=V[De];ye(Q,Be),Be+=Q.length}r.addGroup(Ne,i.length/3-Ne,1)}function ye(Ne,Be){let De=Ne.length;for(;--De>=0;){const it=De;let Q=De-1;Q<0&&(Q=Ne.length-1);for(let at=0,je=f+x*2;at<je;at++){const Ce=oe*at,He=oe*(at+1),q=Be+it+Ce,B=Be+Q+Ce,ue=Be+Q+He,Re=Be+it+He;Ke(q,B,ue,Re)}}}function ze(Ne,Be,De){u.push(Ne),u.push(Be),u.push(De)}function Ve(Ne,Be,De){Qe(Ne),Qe(Be),Qe(De);const it=i.length/3,Q=T.generateTopUV(r,i,it-3,it-2,it-1);pt(Q[0]),pt(Q[1]),pt(Q[2])}function Ke(Ne,Be,De,it){Qe(Ne),Qe(Be),Qe(it),Qe(Be),Qe(De),Qe(it);const Q=i.length/3,at=T.generateSideWallUV(r,i,Q-6,Q-3,Q-2,Q-1);pt(at[0]),pt(at[1]),pt(at[3]),pt(at[1]),pt(at[2]),pt(at[3])}function Qe(Ne){i.push(u[Ne*3+0]),i.push(u[Ne*3+1]),i.push(u[Ne*3+2])}function pt(Ne){s.push(Ne.x),s.push(Ne.y)}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes,r=this.parameters.options;return XC(t,r,e)}static fromJSON(e,t){const r=[];for(let s=0,a=e.shapes.length;s<a;s++){const o=t[e.shapes[s]];r.push(o)}const i=e.options.extrudePath;return i!==void 0&&(e.options.extrudePath=new gv[i.type]().fromJSON(i)),new e1(r,e.options)}}const jC={generateTopUV:function(n,e,t,r,i){const s=e[t*3],a=e[t*3+1],o=e[r*3],u=e[r*3+1],c=e[i*3],f=e[i*3+1];return[new ct(s,a),new ct(o,u),new ct(c,f)]},generateSideWallUV:function(n,e,t,r,i,s){const a=e[t*3],o=e[t*3+1],u=e[t*3+2],c=e[r*3],f=e[r*3+1],m=e[r*3+2],g=e[i*3],y=e[i*3+1],_=e[i*3+2],E=e[s*3],x=e[s*3+1],S=e[s*3+2];return Math.abs(o-f)<Math.abs(a-c)?[new ct(a,1-u),new ct(c,1-m),new ct(g,1-_),new ct(E,1-S)]:[new ct(o,1-u),new ct(f,1-m),new ct(y,1-_),new ct(x,1-S)]}};function XC(n,e,t){if(t.shapes=[],Array.isArray(n))for(let r=0,i=n.length;r<i;r++){const s=n[r];t.shapes.push(s.uuid)}else t.shapes.push(n.uuid);return t.options=Object.assign({},e),e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}class u0 extends Iu{constructor(e=1,t=0){const r=(1+Math.sqrt(5))/2,i=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(i,s,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new u0(e.radius,e.detail)}}class t1 extends Sn{constructor(e=[new ct(0,-.5),new ct(.5,0),new ct(0,.5)],t=12,r=0,i=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:i},t=Math.floor(t),i=gn(i,0,Math.PI*2);const s=[],a=[],o=[],u=[],c=[],f=1/t,m=new X,g=new ct,y=new X,_=new X,E=new X;let x=0,S=0;for(let T=0;T<=e.length-1;T++)switch(T){case 0:x=e[T+1].x-e[T].x,S=e[T+1].y-e[T].y,y.x=S*1,y.y=-x,y.z=S*0,E.copy(y),y.normalize(),u.push(y.x,y.y,y.z);break;case e.length-1:u.push(E.x,E.y,E.z);break;default:x=e[T+1].x-e[T].x,S=e[T+1].y-e[T].y,y.x=S*1,y.y=-x,y.z=S*0,_.copy(y),y.x+=E.x,y.y+=E.y,y.z+=E.z,y.normalize(),u.push(y.x,y.y,y.z),E.copy(_)}for(let T=0;T<=t;T++){const A=r+T*f*i,P=Math.sin(A),L=Math.cos(A);for(let D=0;D<=e.length-1;D++){m.x=e[D].x*P,m.y=e[D].y,m.z=e[D].x*L,a.push(m.x,m.y,m.z),g.x=T/t,g.y=D/(e.length-1),o.push(g.x,g.y);const F=u[3*D+0]*P,k=u[3*D+1],R=u[3*D+0]*L;c.push(F,k,R)}}for(let T=0;T<t;T++)for(let A=0;A<e.length-1;A++){const P=A+T*e.length,L=P,D=P+e.length,F=P+e.length+1,k=P+1;s.push(L,D,k),s.push(F,k,D)}this.setIndex(s),this.setAttribute("position",new Jt(a,3)),this.setAttribute("uv",new Jt(o,2)),this.setAttribute("normal",new Jt(c,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new t1(e.points,e.segments,e.phiStart,e.phiLength)}}class c0 extends Iu{constructor(e=1,t=0){const r=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],i=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(r,i,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new c0(e.radius,e.detail)}}class po extends Sn{constructor(e=1,t=1,r=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:i};const s=e/2,a=t/2,o=Math.floor(r),u=Math.floor(i),c=o+1,f=u+1,m=e/o,g=t/u,y=[],_=[],E=[],x=[];for(let S=0;S<f;S++){const T=S*g-a;for(let A=0;A<c;A++){const P=A*m-s;_.push(P,-T,0),E.push(0,0,1),x.push(A/o),x.push(1-S/u)}}for(let S=0;S<u;S++)for(let T=0;T<o;T++){const A=T+c*S,P=T+c*(S+1),L=T+1+c*(S+1),D=T+1+c*S;y.push(A,P,D),y.push(P,L,D)}this.setIndex(y),this.setAttribute("position",new Jt(_,3)),this.setAttribute("normal",new Jt(E,3)),this.setAttribute("uv",new Jt(x,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new po(e.width,e.height,e.widthSegments,e.heightSegments)}}class n1 extends Sn{constructor(e=.5,t=1,r=32,i=1,s=0,a=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:i,thetaStart:s,thetaLength:a},r=Math.max(3,r),i=Math.max(1,i);const o=[],u=[],c=[],f=[];let m=e;const g=(t-e)/i,y=new X,_=new ct;for(let E=0;E<=i;E++){for(let x=0;x<=r;x++){const S=s+x/r*a;y.x=m*Math.cos(S),y.y=m*Math.sin(S),u.push(y.x,y.y,y.z),c.push(0,0,1),_.x=(y.x/t+1)/2,_.y=(y.y/t+1)/2,f.push(_.x,_.y)}m+=g}for(let E=0;E<i;E++){const x=E*(r+1);for(let S=0;S<r;S++){const T=S+x,A=T,P=T+r+1,L=T+r+2,D=T+1;o.push(A,P,D),o.push(P,L,D)}}this.setIndex(o),this.setAttribute("position",new Jt(u,3)),this.setAttribute("normal",new Jt(c,3)),this.setAttribute("uv",new Jt(f,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new n1(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class i1 extends Sn{constructor(e=new Vc([new ct(0,.5),new ct(-.5,-.5),new ct(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const r=[],i=[],s=[],a=[];let o=0,u=0;if(Array.isArray(e)===!1)c(e);else for(let f=0;f<e.length;f++)c(e[f]),this.addGroup(o,u,f),o+=u,u=0;this.setIndex(r),this.setAttribute("position",new Jt(i,3)),this.setAttribute("normal",new Jt(s,3)),this.setAttribute("uv",new Jt(a,2));function c(f){const m=i.length/3,g=f.extractPoints(t);let y=g.shape;const _=g.holes;lo.isClockWise(y)===!1&&(y=y.reverse());for(let x=0,S=_.length;x<S;x++){const T=_[x];lo.isClockWise(T)===!0&&(_[x]=T.reverse())}const E=lo.triangulateShape(y,_);for(let x=0,S=_.length;x<S;x++){const T=_[x];y=y.concat(T)}for(let x=0,S=y.length;x<S;x++){const T=y[x];i.push(T.x,T.y,0),s.push(0,0,1),a.push(T.x,T.y)}for(let x=0,S=E.length;x<S;x++){const T=E[x],A=T[0]+m,P=T[1]+m,L=T[2]+m;r.push(A,P,L),u+=3}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes;return qC(t,e)}static fromJSON(e,t){const r=[];for(let i=0,s=e.shapes.length;i<s;i++){const a=t[e.shapes[i]];r.push(a)}return new i1(r,e.curveSegments)}}function qC(n,e){if(e.shapes=[],Array.isArray(n))for(let t=0,r=n.length;t<r;t++){const i=n[t];e.shapes.push(i.uuid)}else e.shapes.push(n.uuid);return e}class h0 extends Sn{constructor(e=1,t=32,r=16,i=0,s=Math.PI*2,a=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:i,phiLength:s,thetaStart:a,thetaLength:o},t=Math.max(3,Math.floor(t)),r=Math.max(2,Math.floor(r));const u=Math.min(a+o,Math.PI);let c=0;const f=[],m=new X,g=new X,y=[],_=[],E=[],x=[];for(let S=0;S<=r;S++){const T=[],A=S/r;let P=0;S===0&&a===0?P=.5/t:S===r&&u===Math.PI&&(P=-.5/t);for(let L=0;L<=t;L++){const D=L/t;m.x=-e*Math.cos(i+D*s)*Math.sin(a+A*o),m.y=e*Math.cos(a+A*o),m.z=e*Math.sin(i+D*s)*Math.sin(a+A*o),_.push(m.x,m.y,m.z),g.copy(m).normalize(),E.push(g.x,g.y,g.z),x.push(D+P,1-A),T.push(c++)}f.push(T)}for(let S=0;S<r;S++)for(let T=0;T<t;T++){const A=f[S][T+1],P=f[S][T],L=f[S+1][T],D=f[S+1][T+1];(S!==0||a>0)&&y.push(A,P,D),(S!==r-1||u<Math.PI)&&y.push(P,L,D)}this.setIndex(y),this.setAttribute("position",new Jt(_,3)),this.setAttribute("normal",new Jt(E,3)),this.setAttribute("uv",new Jt(x,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new h0(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class r1 extends Iu{constructor(e=1,t=0){const r=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],i=[2,1,0,0,3,2,1,3,0,2,3,1];super(r,i,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new r1(e.radius,e.detail)}}class s1 extends Sn{constructor(e=1,t=.4,r=12,i=48,s=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:i,arc:s},r=Math.floor(r),i=Math.floor(i);const a=[],o=[],u=[],c=[],f=new X,m=new X,g=new X;for(let y=0;y<=r;y++)for(let _=0;_<=i;_++){const E=_/i*s,x=y/r*Math.PI*2;m.x=(e+t*Math.cos(x))*Math.cos(E),m.y=(e+t*Math.cos(x))*Math.sin(E),m.z=t*Math.sin(x),o.push(m.x,m.y,m.z),f.x=e*Math.cos(E),f.y=e*Math.sin(E),g.subVectors(m,f).normalize(),u.push(g.x,g.y,g.z),c.push(_/i),c.push(y/r)}for(let y=1;y<=r;y++)for(let _=1;_<=i;_++){const E=(i+1)*y+_-1,x=(i+1)*(y-1)+_-1,S=(i+1)*(y-1)+_,T=(i+1)*y+_;a.push(E,x,T),a.push(x,S,T)}this.setIndex(a),this.setAttribute("position",new Jt(o,3)),this.setAttribute("normal",new Jt(u,3)),this.setAttribute("uv",new Jt(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new s1(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class a1 extends Sn{constructor(e=1,t=.4,r=64,i=8,s=2,a=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:i,p:s,q:a},r=Math.floor(r),i=Math.floor(i);const o=[],u=[],c=[],f=[],m=new X,g=new X,y=new X,_=new X,E=new X,x=new X,S=new X;for(let A=0;A<=r;++A){const P=A/r*s*Math.PI*2;T(P,s,a,e,y),T(P+.01,s,a,e,_),x.subVectors(_,y),S.addVectors(_,y),E.crossVectors(x,S),S.crossVectors(E,x),E.normalize(),S.normalize();for(let L=0;L<=i;++L){const D=L/i*Math.PI*2,F=-t*Math.cos(D),k=t*Math.sin(D);m.x=y.x+(F*S.x+k*E.x),m.y=y.y+(F*S.y+k*E.y),m.z=y.z+(F*S.z+k*E.z),u.push(m.x,m.y,m.z),g.subVectors(m,y).normalize(),c.push(g.x,g.y,g.z),f.push(A/r),f.push(L/i)}}for(let A=1;A<=r;A++)for(let P=1;P<=i;P++){const L=(i+1)*(A-1)+(P-1),D=(i+1)*A+(P-1),F=(i+1)*A+P,k=(i+1)*(A-1)+P;o.push(L,D,k),o.push(D,F,k)}this.setIndex(o),this.setAttribute("position",new Jt(u,3)),this.setAttribute("normal",new Jt(c,3)),this.setAttribute("uv",new Jt(f,2));function T(A,P,L,D,F){const k=Math.cos(A),R=Math.sin(A),U=L/P*A,V=Math.cos(U);F.x=D*(2+V)*.5*k,F.y=D*(2+V)*R*.5,F.z=D*Math.sin(U)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new a1(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class o1 extends Sn{constructor(e=new dx(new X(-1,-1,0),new X(-1,1,0),new X(1,1,0)),t=64,r=1,i=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:r,radialSegments:i,closed:s};const a=e.computeFrenetFrames(t,s);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;const o=new X,u=new X,c=new ct;let f=new X;const m=[],g=[],y=[],_=[];E(),this.setIndex(_),this.setAttribute("position",new Jt(m,3)),this.setAttribute("normal",new Jt(g,3)),this.setAttribute("uv",new Jt(y,2));function E(){for(let A=0;A<t;A++)x(A);x(s===!1?t:0),T(),S()}function x(A){f=e.getPointAt(A/t,f);const P=a.normals[A],L=a.binormals[A];for(let D=0;D<=i;D++){const F=D/i*Math.PI*2,k=Math.sin(F),R=-Math.cos(F);u.x=R*P.x+k*L.x,u.y=R*P.y+k*L.y,u.z=R*P.z+k*L.z,u.normalize(),g.push(u.x,u.y,u.z),o.x=f.x+r*u.x,o.y=f.y+r*u.y,o.z=f.z+r*u.z,m.push(o.x,o.y,o.z)}}function S(){for(let A=1;A<=t;A++)for(let P=1;P<=i;P++){const L=(i+1)*(A-1)+(P-1),D=(i+1)*A+(P-1),F=(i+1)*A+P,k=(i+1)*(A-1)+P;_.push(L,D,k),_.push(D,F,k)}}function T(){for(let A=0;A<=t;A++)for(let P=0;P<=i;P++)c.x=A/t,c.y=P/i,y.push(c.x,c.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new o1(new gv[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class UE extends Sn{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const t=[],r=new Set,i=new X,s=new X;if(e.index!==null){const a=e.attributes.position,o=e.index;let u=e.groups;u.length===0&&(u=[{start:0,count:o.count,materialIndex:0}]);for(let c=0,f=u.length;c<f;++c){const m=u[c],g=m.start,y=m.count;for(let _=g,E=g+y;_<E;_+=3)for(let x=0;x<3;x++){const S=o.getX(_+x),T=o.getX(_+(x+1)%3);i.fromBufferAttribute(a,S),s.fromBufferAttribute(a,T),PM(i,s,r)===!0&&(t.push(i.x,i.y,i.z),t.push(s.x,s.y,s.z))}}}else{const a=e.attributes.position;for(let o=0,u=a.count/3;o<u;o++)for(let c=0;c<3;c++){const f=3*o+c,m=3*o+(c+1)%3;i.fromBufferAttribute(a,f),s.fromBufferAttribute(a,m),PM(i,s,r)===!0&&(t.push(i.x,i.y,i.z),t.push(s.x,s.y,s.z))}}this.setAttribute("position",new Jt(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function PM(n,e,t){const r=`${n.x},${n.y},${n.z}-${e.x},${e.y},${e.z}`,i=`${e.x},${e.y},${e.z}-${n.x},${n.y},${n.z}`;return t.has(r)===!0||t.has(i)===!0?!1:(t.add(r),t.add(i),!0)}var RM=Object.freeze({__proto__:null,BoxGeometry:Qc,CapsuleGeometry:Jv,CircleGeometry:Kv,ConeGeometry:l0,CylinderGeometry:o0,DodecahedronGeometry:Qv,EdgesGeometry:TE,ExtrudeGeometry:e1,IcosahedronGeometry:u0,LatheGeometry:t1,OctahedronGeometry:c0,PlaneGeometry:po,PolyhedronGeometry:Iu,RingGeometry:n1,ShapeGeometry:i1,SphereGeometry:h0,TetrahedronGeometry:r1,TorusGeometry:s1,TorusKnotGeometry:a1,TubeGeometry:o1,WireframeGeometry:UE});class FE extends ss{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new jt(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class mx extends Es{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class gx extends ss{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new jt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new jt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ru,this.normalScale=new ct(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Qi,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class OE extends gx{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new ct(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return gn(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new jt(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new jt(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new jt(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class kE extends ss{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new jt(16777215),this.specular=new jt(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new jt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ru,this.normalScale=new ct(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Qi,this.combine=e0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class zE extends ss{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new jt(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new jt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ru,this.normalScale=new ct(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class BE extends ss{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ru,this.normalScale=new ct(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class GE extends ss{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new jt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new jt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ru,this.normalScale=new ct(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Qi,this.combine=e0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class l1 extends ss{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=$w,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class u1 extends ss{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class VE extends ss{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new jt(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ru,this.normalScale=new ct(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this.fog=e.fog,this}}class HE extends Ts{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function Oc(n,e){return!n||n.constructor===e?n:typeof e.BYTES_PER_ELEMENT=="number"?new e(n):Array.prototype.slice.call(n)}function WE(n){function e(i,s){return n[i]-n[s]}const t=n.length,r=new Array(t);for(let i=0;i!==t;++i)r[i]=i;return r.sort(e),r}function __(n,e,t){const r=n.length,i=new n.constructor(r);for(let s=0,a=0;a!==r;++s){const o=t[s]*e;for(let u=0;u!==e;++u)i[a++]=n[o+u]}return i}function vx(n,e,t,r){let i=1,s=n[0];for(;s!==void 0&&s[r]===void 0;)s=n[i++];if(s===void 0)return;let a=s[r];if(a!==void 0)if(Array.isArray(a))do a=s[r],a!==void 0&&(e.push(s.time),t.push(...a)),s=n[i++];while(s!==void 0);else if(a.toArray!==void 0)do a=s[r],a!==void 0&&(e.push(s.time),a.toArray(t,t.length)),s=n[i++];while(s!==void 0);else do a=s[r],a!==void 0&&(e.push(s.time),t.push(a)),s=n[i++];while(s!==void 0)}function YC(n,e,t,r,i=30){const s=n.clone();s.name=e;const a=[];for(let u=0;u<s.tracks.length;++u){const c=s.tracks[u],f=c.getValueSize(),m=[],g=[];for(let y=0;y<c.times.length;++y){const _=c.times[y]*i;if(!(_<t||_>=r)){m.push(c.times[y]);for(let E=0;E<f;++E)g.push(c.values[y*f+E])}}m.length!==0&&(c.times=Oc(m,c.times.constructor),c.values=Oc(g,c.values.constructor),a.push(c))}s.tracks=a;let o=1/0;for(let u=0;u<s.tracks.length;++u)o>s.tracks[u].times[0]&&(o=s.tracks[u].times[0]);for(let u=0;u<s.tracks.length;++u)s.tracks[u].shift(-1*o);return s.resetDuration(),s}function ZC(n,e=0,t=n,r=30){r<=0&&(r=30);const i=t.tracks.length,s=e/r;for(let a=0;a<i;++a){const o=t.tracks[a],u=o.ValueTypeName;if(u==="bool"||u==="string")continue;const c=n.tracks.find(function(S){return S.name===o.name&&S.ValueTypeName===u});if(c===void 0)continue;let f=0;const m=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(f=m/3);let g=0;const y=c.getValueSize();c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(g=y/3);const _=o.times.length-1;let E;if(s<=o.times[0]){const S=f,T=m-f;E=o.values.slice(S,T)}else if(s>=o.times[_]){const S=_*m+f,T=S+m-f;E=o.values.slice(S,T)}else{const S=o.createInterpolant(),T=f,A=m-f;S.evaluate(s),E=S.resultBuffer.slice(T,A)}u==="quaternion"&&new xn().fromArray(E).normalize().conjugate().toArray(E);const x=c.times.length;for(let S=0;S<x;++S){const T=S*y+g;if(u==="quaternion")xn.multiplyQuaternionsFlat(c.values,T,E,0,c.values,T);else{const A=y-g*2;for(let P=0;P<A;++P)c.values[T+P]-=E[P]}}}return n.blendMode=$_,n}class JC{static convertArray(e,t){return Oc(e,t)}static isTypedArray(e){return uE(e)}static getKeyframeOrder(e){return WE(e)}static sortedArray(e,t,r){return __(e,t,r)}static flattenJSON(e,t,r,i){vx(e,t,r,i)}static subclip(e,t,r,i,s=30){return YC(e,t,r,i,s)}static makeClipAdditive(e,t=0,r=e,i=30){return ZC(e,t,r,i)}}class f0{constructor(e,t,r,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=i!==void 0?i:new t.constructor(r),this.sampleValues=t,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let r=this._cachedIndex,i=t[r],s=t[r-1];e:{t:{let a;n:{i:if(!(e<i)){for(let o=r+2;;){if(i===void 0){if(e<s)break i;return r=t.length,this._cachedIndex=r,this.copySampleValue_(r-1)}if(r===o)break;if(s=i,i=t[++r],e<i)break t}a=t.length;break n}if(!(e>=s)){const o=t[1];e<o&&(r=2,s=o);for(let u=r-2;;){if(s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===u)break;if(i=s,s=t[--r-1],e>=s)break t}a=r,r=0;break n}break e}for(;r<a;){const o=r+a>>>1;e<t[o]?a=o:r=o+1}if(i=t[r],s=t[r-1],s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===void 0)return r=t.length,this._cachedIndex=r,this.copySampleValue_(r-1)}this._cachedIndex=r,this.intervalChanged_(r,s,i)}return this.interpolate_(r,s,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,r=this.sampleValues,i=this.valueSize,s=e*i;for(let a=0;a!==i;++a)t[a]=r[s+a];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class jE extends f0{constructor(e,t,r,i){super(e,t,r,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Dc,endingEnd:Dc}}intervalChanged_(e,t,r){const i=this.parameterPositions;let s=e-2,a=e+1,o=i[s],u=i[a];if(o===void 0)switch(this.getSettings_().endingStart){case Uc:s=e,o=2*t-r;break;case Up:s=i.length-2,o=t+i[s]-i[s+1];break;default:s=e,o=r}if(u===void 0)switch(this.getSettings_().endingEnd){case Uc:a=e,u=2*r-t;break;case Up:a=1,u=r+i[1]-i[0];break;default:a=e-1,u=t}const c=(r-t)*.5,f=this.valueSize;this._weightPrev=c/(t-o),this._weightNext=c/(u-r),this._offsetPrev=s*f,this._offsetNext=a*f}interpolate_(e,t,r,i){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,u=e*o,c=u-o,f=this._offsetPrev,m=this._offsetNext,g=this._weightPrev,y=this._weightNext,_=(r-t)/(i-t),E=_*_,x=E*_,S=-g*x+2*g*E-g*_,T=(1+g)*x+(-1.5-2*g)*E+(-.5+g)*_+1,A=(-1-y)*x+(1.5+y)*E+.5*_,P=y*x-y*E;for(let L=0;L!==o;++L)s[L]=S*a[f+L]+T*a[c+L]+A*a[u+L]+P*a[m+L];return s}}class yx extends f0{constructor(e,t,r,i){super(e,t,r,i)}interpolate_(e,t,r,i){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,u=e*o,c=u-o,f=(r-t)/(i-t),m=1-f;for(let g=0;g!==o;++g)s[g]=a[c+g]*m+a[u+g]*f;return s}}class XE extends f0{constructor(e,t,r,i){super(e,t,r,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class Pa{constructor(e,t,r,i){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Oc(t,this.TimeBufferType),this.values=Oc(r,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let r;if(t.toJSON!==this.toJSON)r=t.toJSON(e);else{r={name:e.name,times:Oc(e.times,Array),values:Oc(e.values,Array)};const i=e.getInterpolation();i!==e.DefaultInterpolation&&(r.interpolation=i)}return r.type=e.ValueTypeName,r}InterpolantFactoryMethodDiscrete(e){return new XE(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new yx(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new jE(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Dp:t=this.InterpolantFactoryMethodDiscrete;break;case dv:t=this.InterpolantFactoryMethodLinear;break;case mg:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(r);return Ft("KeyframeTrack:",r),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Dp;case this.InterpolantFactoryMethodLinear:return dv;case this.InterpolantFactoryMethodSmooth:return mg}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let r=0,i=t.length;r!==i;++r)t[r]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let r=0,i=t.length;r!==i;++r)t[r]*=e}return this}trim(e,t){const r=this.times,i=r.length;let s=0,a=i-1;for(;s!==i&&r[s]<e;)++s;for(;a!==-1&&r[a]>t;)--a;if(++a,s!==0||a!==i){s>=a&&(a=Math.max(a,1),s=a-1);const o=this.getValueSize();this.times=r.slice(s,a),this.values=this.values.slice(s*o,a*o)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(ln("KeyframeTrack: Invalid value size in track.",this),e=!1);const r=this.times,i=this.values,s=r.length;s===0&&(ln("KeyframeTrack: Track is empty.",this),e=!1);let a=null;for(let o=0;o!==s;o++){const u=r[o];if(typeof u=="number"&&isNaN(u)){ln("KeyframeTrack: Time is not a valid number.",this,o,u),e=!1;break}if(a!==null&&a>u){ln("KeyframeTrack: Out of order keys.",this,o,u,a),e=!1;break}a=u}if(i!==void 0&&uE(i))for(let o=0,u=i.length;o!==u;++o){const c=i[o];if(isNaN(c)){ln("KeyframeTrack: Value is not a valid number.",this,o,c),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),r=this.getValueSize(),i=this.getInterpolation()===mg,s=e.length-1;let a=1;for(let o=1;o<s;++o){let u=!1;const c=e[o],f=e[o+1];if(c!==f&&(o!==1||c!==e[0]))if(i)u=!0;else{const m=o*r,g=m-r,y=m+r;for(let _=0;_!==r;++_){const E=t[m+_];if(E!==t[g+_]||E!==t[y+_]){u=!0;break}}}if(u){if(o!==a){e[a]=e[o];const m=o*r,g=a*r;for(let y=0;y!==r;++y)t[g+y]=t[m+y]}++a}}if(s>0){e[a]=e[s];for(let o=s*r,u=a*r,c=0;c!==r;++c)t[u+c]=t[o+c];++a}return a!==e.length?(this.times=e.slice(0,a),this.values=t.slice(0,a*r)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),r=this.constructor,i=new r(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}}Pa.prototype.ValueTypeName="";Pa.prototype.TimeBufferType=Float32Array;Pa.prototype.ValueBufferType=Float32Array;Pa.prototype.DefaultInterpolation=dv;class $c extends Pa{constructor(e,t,r){super(e,t,r)}}$c.prototype.ValueTypeName="bool";$c.prototype.ValueBufferType=Array;$c.prototype.DefaultInterpolation=Dp;$c.prototype.InterpolantFactoryMethodLinear=void 0;$c.prototype.InterpolantFactoryMethodSmooth=void 0;class _x extends Pa{constructor(e,t,r,i){super(e,t,r,i)}}_x.prototype.ValueTypeName="color";class Hp extends Pa{constructor(e,t,r,i){super(e,t,r,i)}}Hp.prototype.ValueTypeName="number";class qE extends f0{constructor(e,t,r,i){super(e,t,r,i)}interpolate_(e,t,r,i){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,u=(r-t)/(i-t);let c=e*o;for(let f=c+o;c!==f;c+=4)xn.slerpFlat(s,0,a,c-o,a,c,u);return s}}class d0 extends Pa{constructor(e,t,r,i){super(e,t,r,i)}InterpolantFactoryMethodLinear(e){return new qE(this.times,this.values,this.getValueSize(),e)}}d0.prototype.ValueTypeName="quaternion";d0.prototype.InterpolantFactoryMethodSmooth=void 0;class eh extends Pa{constructor(e,t,r){super(e,t,r)}}eh.prototype.ValueTypeName="string";eh.prototype.ValueBufferType=Array;eh.prototype.DefaultInterpolation=Dp;eh.prototype.InterpolantFactoryMethodLinear=void 0;eh.prototype.InterpolantFactoryMethodSmooth=void 0;class Wp extends Pa{constructor(e,t,r,i){super(e,t,r,i)}}Wp.prototype.ValueTypeName="vector";class jp{constructor(e="",t=-1,r=[],i=kv){this.name=e,this.tracks=r,this.duration=t,this.blendMode=i,this.uuid=la(),this.userData={},this.duration<0&&this.resetDuration()}static parse(e){const t=[],r=e.tracks,i=1/(e.fps||1);for(let a=0,o=r.length;a!==o;++a)t.push(QC(r[a]).scale(i));const s=new this(e.name,e.duration,t,e.blendMode);return s.uuid=e.uuid,s.userData=JSON.parse(e.userData||"{}"),s}static toJSON(e){const t=[],r=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode,userData:JSON.stringify(e.userData)};for(let s=0,a=r.length;s!==a;++s)t.push(Pa.toJSON(r[s]));return i}static CreateFromMorphTargetSequence(e,t,r,i){const s=t.length,a=[];for(let o=0;o<s;o++){let u=[],c=[];u.push((o+s-1)%s,o,(o+1)%s),c.push(0,1,0);const f=WE(u);u=__(u,1,f),c=__(c,1,f),!i&&u[0]===0&&(u.push(s),c.push(c[0])),a.push(new Hp(".morphTargetInfluences["+t[o].name+"]",u,c).scale(1/r))}return new this(e,-1,a)}static findByName(e,t){let r=e;if(!Array.isArray(e)){const i=e;r=i.geometry&&i.geometry.animations||i.animations}for(let i=0;i<r.length;i++)if(r[i].name===t)return r[i];return null}static CreateClipsFromMorphTargetSequences(e,t,r){const i={},s=/^([\w-]*?)([\d]+)$/;for(let o=0,u=e.length;o<u;o++){const c=e[o],f=c.name.match(s);if(f&&f.length>1){const m=f[1];let g=i[m];g||(i[m]=g=[]),g.push(c)}}const a=[];for(const o in i)a.push(this.CreateFromMorphTargetSequence(o,i[o],t,r));return a}static parseAnimation(e,t){if(Ft("AnimationClip: parseAnimation() is deprecated and will be removed with r185"),!e)return ln("AnimationClip: No animation in JSONLoader data."),null;const r=function(m,g,y,_,E){if(y.length!==0){const x=[],S=[];vx(y,x,S,_),x.length!==0&&E.push(new m(g,x,S))}},i=[],s=e.name||"default",a=e.fps||30,o=e.blendMode;let u=e.length||-1;const c=e.hierarchy||[];for(let m=0;m<c.length;m++){const g=c[m].keys;if(!(!g||g.length===0))if(g[0].morphTargets){const y={};let _;for(_=0;_<g.length;_++)if(g[_].morphTargets)for(let E=0;E<g[_].morphTargets.length;E++)y[g[_].morphTargets[E]]=-1;for(const E in y){const x=[],S=[];for(let T=0;T!==g[_].morphTargets.length;++T){const A=g[_];x.push(A.time),S.push(A.morphTarget===E?1:0)}i.push(new Hp(".morphTargetInfluence["+E+"]",x,S))}u=y.length*a}else{const y=".bones["+t[m].name+"]";r(Wp,y+".position",g,"pos",i),r(d0,y+".quaternion",g,"rot",i),r(Wp,y+".scale",g,"scl",i)}}return i.length===0?null:new this(s,u,i,o)}resetDuration(){const e=this.tracks;let t=0;for(let r=0,i=e.length;r!==i;++r){const s=this.tracks[r];t=Math.max(t,s.times[s.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let r=0;r<this.tracks.length;r++)e.push(this.tracks[r].clone());const t=new this.constructor(this.name,this.duration,e,this.blendMode);return t.userData=JSON.parse(JSON.stringify(this.userData)),t}toJSON(){return this.constructor.toJSON(this)}}function KC(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Hp;case"vector":case"vector2":case"vector3":case"vector4":return Wp;case"color":return _x;case"quaternion":return d0;case"bool":case"boolean":return $c;case"string":return eh}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}function QC(n){if(n.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=KC(n.type);if(n.times===void 0){const t=[],r=[];vx(n.keys,t,r,"value"),n.times=t,n.values=r}return e.parse!==void 0?e.parse(n):new e(n.name,n.times,n.values,n.interpolation)}const Oo={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class c1{constructor(e,t,r){const i=this;let s=!1,a=0,o=0,u;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this._abortController=null,this.itemStart=function(f){o++,s===!1&&i.onStart!==void 0&&i.onStart(f,a,o),s=!0},this.itemEnd=function(f){a++,i.onProgress!==void 0&&i.onProgress(f,a,o),a===o&&(s=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(f){i.onError!==void 0&&i.onError(f)},this.resolveURL=function(f){return u?u(f):f},this.setURLModifier=function(f){return u=f,this},this.addHandler=function(f,m){return c.push(f,m),this},this.removeHandler=function(f){const m=c.indexOf(f);return m!==-1&&c.splice(m,2),this},this.getHandler=function(f){for(let m=0,g=c.length;m<g;m+=2){const y=c[m],_=c[m+1];if(y.global&&(y.lastIndex=0),y.test(f))return _}return null},this.abort=function(){return this.abortController.abort(),this._abortController=null,this}}get abortController(){return this._abortController||(this._abortController=new AbortController),this._abortController}}const YE=new c1;class bs{constructor(e){this.manager=e!==void 0?e:YE,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const r=this;return new Promise(function(i,s){r.load(e,i,t,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}abort(){return this}}bs.DEFAULT_MATERIAL_NAME="__DEFAULT";const El={};class $C extends Error{constructor(e,t){super(e),this.response=t}}class ua extends bs{constructor(e){super(e),this.mimeType="",this.responseType="",this._abortController=new AbortController}load(e,t,r,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=Oo.get(`file:${e}`);if(s!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(s),this.manager.itemEnd(e)},0),s;if(El[e]!==void 0){El[e].push({onLoad:t,onProgress:r,onError:i});return}El[e]=[],El[e].push({onLoad:t,onProgress:r,onError:i});const a=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin",signal:typeof AbortSignal.any=="function"?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal}),o=this.mimeType,u=this.responseType;fetch(a).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&Ft("FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||c.body===void 0||c.body.getReader===void 0)return c;const f=El[e],m=c.body.getReader(),g=c.headers.get("X-File-Size")||c.headers.get("Content-Length"),y=g?parseInt(g):0,_=y!==0;let E=0;const x=new ReadableStream({start(S){T();function T(){m.read().then(({done:A,value:P})=>{if(A)S.close();else{E+=P.byteLength;const L=new ProgressEvent("progress",{lengthComputable:_,loaded:E,total:y});for(let D=0,F=f.length;D<F;D++){const k=f[D];k.onProgress&&k.onProgress(L)}S.enqueue(P),T()}},A=>{S.error(A)})}}});return new Response(x)}else throw new $C(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(u){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(f=>new DOMParser().parseFromString(f,o));case"json":return c.json();default:if(o==="")return c.text();{const m=/charset="?([^;"\s]*)"?/i.exec(o),g=m&&m[1]?m[1].toLowerCase():void 0,y=new TextDecoder(g);return c.arrayBuffer().then(_=>y.decode(_))}}}).then(c=>{Oo.add(`file:${e}`,c);const f=El[e];delete El[e];for(let m=0,g=f.length;m<g;m++){const y=f[m];y.onLoad&&y.onLoad(c)}}).catch(c=>{const f=El[e];if(f===void 0)throw this.manager.itemError(e),c;delete El[e];for(let m=0,g=f.length;m<g;m++){const y=f[m];y.onError&&y.onError(c)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}class e4 extends bs{constructor(e){super(e)}load(e,t,r,i){const s=this,a=new ua(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(o){try{t(s.parse(JSON.parse(o)))}catch(u){i?i(u):ln(u),s.manager.itemError(e)}},r,i)}parse(e){const t=[];for(let r=0;r<e.length;r++){const i=jp.parse(e[r]);t.push(i)}return t}}class t4 extends bs{constructor(e){super(e)}load(e,t,r,i){const s=this,a=[],o=new Zv,u=new ua(this.manager);u.setPath(this.path),u.setResponseType("arraybuffer"),u.setRequestHeader(this.requestHeader),u.setWithCredentials(s.withCredentials);let c=0;function f(m){u.load(e[m],function(g){const y=s.parse(g,!0);a[m]={width:y.width,height:y.height,format:y.format,mipmaps:y.mipmaps},c+=1,c===6&&(y.mipmapCount===1&&(o.minFilter=Dn),o.image=a,o.format=y.format,o.needsUpdate=!0,t&&t(o))},r,i)}if(Array.isArray(e))for(let m=0,g=e.length;m<g;++m)f(m);else u.load(e,function(m){const g=s.parse(m,!0);if(g.isCubemap){const y=g.mipmaps.length/g.mipmapCount;for(let _=0;_<y;_++){a[_]={mipmaps:[]};for(let E=0;E<g.mipmapCount;E++)a[_].mipmaps.push(g.mipmaps[_*g.mipmapCount+E]),a[_].format=g.format,a[_].width=g.width,a[_].height=g.height}o.image=a}else o.image.width=g.width,o.image.height=g.height,o.mipmaps=g.mipmaps;g.mipmapCount===1&&(o.minFilter=Dn),o.format=g.format,o.needsUpdate=!0,t&&t(o)},r,i);return o}}const cf=new WeakMap;class Xp extends bs{constructor(e){super(e)}load(e,t,r,i){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,a=Oo.get(`image:${e}`);if(a!==void 0){if(a.complete===!0)s.manager.itemStart(e),setTimeout(function(){t&&t(a),s.manager.itemEnd(e)},0);else{let m=cf.get(a);m===void 0&&(m=[],cf.set(a,m)),m.push({onLoad:t,onError:i})}return a}const o=kp("img");function u(){f(),t&&t(this);const m=cf.get(this)||[];for(let g=0;g<m.length;g++){const y=m[g];y.onLoad&&y.onLoad(this)}cf.delete(this),s.manager.itemEnd(e)}function c(m){f(),i&&i(m),Oo.remove(`image:${e}`);const g=cf.get(this)||[];for(let y=0;y<g.length;y++){const _=g[y];_.onError&&_.onError(m)}cf.delete(this),s.manager.itemError(e),s.manager.itemEnd(e)}function f(){o.removeEventListener("load",u,!1),o.removeEventListener("error",c,!1)}return o.addEventListener("load",u,!1),o.addEventListener("error",c,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(o.crossOrigin=this.crossOrigin),Oo.add(`image:${e}`,o),s.manager.itemStart(e),o.src=e,o}}class ZE extends bs{constructor(e){super(e)}load(e,t,r,i){const s=new s0;s.colorSpace=rs;const a=new Xp(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let o=0;function u(c){a.load(e[c],function(f){s.images[c]=f,o++,o===6&&(s.needsUpdate=!0,t&&t(s))},void 0,i)}for(let c=0;c<e.length;++c)u(c);return s}}class xx extends bs{constructor(e){super(e)}load(e,t,r,i){const s=this,a=new Aa,o=new ua(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(s.withCredentials),o.load(e,function(u){let c;try{c=s.parse(u)}catch(f){if(i!==void 0)i(f);else{f(f);return}}c.image!==void 0?a.image=c.image:c.data!==void 0&&(a.image.width=c.width,a.image.height=c.height,a.image.data=c.data),a.wrapS=c.wrapS!==void 0?c.wrapS:Gi,a.wrapT=c.wrapT!==void 0?c.wrapT:Gi,a.magFilter=c.magFilter!==void 0?c.magFilter:Dn,a.minFilter=c.minFilter!==void 0?c.minFilter:Dn,a.anisotropy=c.anisotropy!==void 0?c.anisotropy:1,c.colorSpace!==void 0&&(a.colorSpace=c.colorSpace),c.flipY!==void 0&&(a.flipY=c.flipY),c.format!==void 0&&(a.format=c.format),c.type!==void 0&&(a.type=c.type),c.mipmaps!==void 0&&(a.mipmaps=c.mipmaps,a.minFilter=Fo),c.mipmapCount===1&&(a.minFilter=Dn),c.generateMipmaps!==void 0&&(a.generateMipmaps=c.generateMipmaps),a.needsUpdate=!0,t&&t(a,c)},r,i),a}}class Sx extends bs{constructor(e){super(e)}load(e,t,r,i){const s=new ei,a=new Xp(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(o){s.image=o,s.needsUpdate=!0,t!==void 0&&t(s)},r,i),s}}class Lu extends Hn{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new jt(e),this.intensity=t}dispose(){this.dispatchEvent({type:"dispose"})}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,t}}class JE extends Lu{constructor(e,t,r){super(e,r),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Hn.DEFAULT_UP),this.updateMatrix(),this.groundColor=new jt(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}toJSON(e){const t=super.toJSON(e);return t.object.groundColor=this.groundColor.getHex(),t}}const Ay=new vn,IM=new X,LM=new X;class Mx{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new ct(512,512),this.mapType=Rr,this.map=null,this.mapPass=null,this.matrix=new vn,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Xf,this._frameExtents=new ct(1,1),this._viewportCount=1,this._viewports=[new $n(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,r=this.matrix;IM.setFromMatrixPosition(e.matrixWorld),t.position.copy(IM),LM.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(LM),t.updateMatrixWorld(),Ay.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Ay,t.coordinateSystem,t.reversedDepth),t.reversedDepth?r.set(.5,0,0,.5,0,.5,0,.5,0,0,1,0,0,0,0,1):r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(Ay)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.autoUpdate=e.autoUpdate,this.needsUpdate=e.needsUpdate,this.normalBias=e.normalBias,this.blurSamples=e.blurSamples,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class n4 extends Mx{constructor(){super(new Pr(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1,this.aspect=1}updateMatrices(e){const t=this.camera,r=Of*2*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height*this.aspect,s=e.distance||t.far;(r!==t.fov||i!==t.aspect||s!==t.far)&&(t.fov=r,t.aspect=i,t.far=s,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class KE extends Lu{constructor(e,t,r=0,i=Math.PI/3,s=0,a=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Hn.DEFAULT_UP),this.updateMatrix(),this.target=new Hn,this.distance=r,this.angle=i,this.penumbra=s,this.decay=a,this.map=null,this.shadow=new n4}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){super.dispose(),this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.map=e.map,this.shadow=e.shadow.clone(),this}toJSON(e){const t=super.toJSON(e);return t.object.distance=this.distance,t.object.angle=this.angle,t.object.decay=this.decay,t.object.penumbra=this.penumbra,t.object.target=this.target.uuid,this.map&&this.map.isTexture&&(t.object.map=this.map.toJSON(e).uuid),t.object.shadow=this.shadow.toJSON(),t}}class i4 extends Mx{constructor(){super(new Pr(90,1,.5,500)),this.isPointLightShadow=!0}}class QE extends Lu{constructor(e,t,r=0,i=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=r,this.decay=i,this.shadow=new i4}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){super.dispose(),this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}toJSON(e){const t=super.toJSON(e);return t.object.distance=this.distance,t.object.decay=this.decay,t.object.shadow=this.shadow.toJSON(),t}}class th extends r0{constructor(e=-1,t=1,r=1,i=-1,s=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=r,this.bottom=i,this.near=s,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,r,i,s,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let s=r-e,a=r+e,o=i+t,u=i-t;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,f=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=c*this.view.offsetX,a=s+c*this.view.width,o-=f*this.view.offsetY,u=o-f*this.view.height}this.projectionMatrix.makeOrthographic(s,a,o,u,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}class r4 extends Mx{constructor(){super(new th(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class $E extends Lu{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Hn.DEFAULT_UP),this.updateMatrix(),this.target=new Hn,this.shadow=new r4}dispose(){super.dispose(),this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}toJSON(e){const t=super.toJSON(e);return t.object.shadow=this.shadow.toJSON(),t.object.target=this.target.uuid,t}}class e3 extends Lu{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class t3 extends Lu{constructor(e,t,r=10,i=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=r,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class wx{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new X)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const r=e.x,i=e.y,s=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.282095),t.addScaledVector(a[1],.488603*i),t.addScaledVector(a[2],.488603*s),t.addScaledVector(a[3],.488603*r),t.addScaledVector(a[4],1.092548*(r*i)),t.addScaledVector(a[5],1.092548*(i*s)),t.addScaledVector(a[6],.315392*(3*s*s-1)),t.addScaledVector(a[7],1.092548*(r*s)),t.addScaledVector(a[8],.546274*(r*r-i*i)),t}getIrradianceAt(e,t){const r=e.x,i=e.y,s=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.886227),t.addScaledVector(a[1],2*.511664*i),t.addScaledVector(a[2],2*.511664*s),t.addScaledVector(a[3],2*.511664*r),t.addScaledVector(a[4],2*.429043*r*i),t.addScaledVector(a[5],2*.429043*i*s),t.addScaledVector(a[6],.743125*s*s-.247708),t.addScaledVector(a[7],2*.429043*r*s),t.addScaledVector(a[8],.429043*(r*r-i*i)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let r=0;r<9;r++)this.coefficients[r].addScaledVector(e.coefficients[r],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let r=0;r<9;r++)this.coefficients[r].lerp(e.coefficients[r],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const r=this.coefficients;for(let i=0;i<9;i++)r[i].fromArray(e,t+i*3);return this}toArray(e=[],t=0){const r=this.coefficients;for(let i=0;i<9;i++)r[i].toArray(e,t+i*3);return e}static getBasisAt(e,t){const r=e.x,i=e.y,s=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*s,t[3]=.488603*r,t[4]=1.092548*r*i,t[5]=1.092548*i*s,t[6]=.315392*(3*s*s-1),t[7]=1.092548*r*s,t[8]=.546274*(r*r-i*i)}}class n3 extends Lu{constructor(e=new wx,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class h1 extends bs{constructor(e){super(e),this.textures={}}load(e,t,r,i){const s=this,a=new ua(s.manager);a.setPath(s.path),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(e,function(o){try{t(s.parse(JSON.parse(o)))}catch(u){i?i(u):ln(u),s.manager.itemError(e)}},r,i)}parse(e){const t=this.textures;function r(s){return t[s]===void 0&&Ft("MaterialLoader: Undefined texture",s),t[s]}const i=this.createMaterialFromType(e.type);if(e.uuid!==void 0&&(i.uuid=e.uuid),e.name!==void 0&&(i.name=e.name),e.color!==void 0&&i.color!==void 0&&i.color.setHex(e.color),e.roughness!==void 0&&(i.roughness=e.roughness),e.metalness!==void 0&&(i.metalness=e.metalness),e.sheen!==void 0&&(i.sheen=e.sheen),e.sheenColor!==void 0&&(i.sheenColor=new jt().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(i.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&i.emissive!==void 0&&i.emissive.setHex(e.emissive),e.specular!==void 0&&i.specular!==void 0&&i.specular.setHex(e.specular),e.specularIntensity!==void 0&&(i.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&i.specularColor!==void 0&&i.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(i.shininess=e.shininess),e.clearcoat!==void 0&&(i.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=e.clearcoatRoughness),e.dispersion!==void 0&&(i.dispersion=e.dispersion),e.iridescence!==void 0&&(i.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(i.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(i.transmission=e.transmission),e.thickness!==void 0&&(i.thickness=e.thickness),e.attenuationDistance!==void 0&&(i.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&i.attenuationColor!==void 0&&i.attenuationColor.setHex(e.attenuationColor),e.anisotropy!==void 0&&(i.anisotropy=e.anisotropy),e.anisotropyRotation!==void 0&&(i.anisotropyRotation=e.anisotropyRotation),e.fog!==void 0&&(i.fog=e.fog),e.flatShading!==void 0&&(i.flatShading=e.flatShading),e.blending!==void 0&&(i.blending=e.blending),e.combine!==void 0&&(i.combine=e.combine),e.side!==void 0&&(i.side=e.side),e.shadowSide!==void 0&&(i.shadowSide=e.shadowSide),e.opacity!==void 0&&(i.opacity=e.opacity),e.transparent!==void 0&&(i.transparent=e.transparent),e.alphaTest!==void 0&&(i.alphaTest=e.alphaTest),e.alphaHash!==void 0&&(i.alphaHash=e.alphaHash),e.depthFunc!==void 0&&(i.depthFunc=e.depthFunc),e.depthTest!==void 0&&(i.depthTest=e.depthTest),e.depthWrite!==void 0&&(i.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(i.colorWrite=e.colorWrite),e.blendSrc!==void 0&&(i.blendSrc=e.blendSrc),e.blendDst!==void 0&&(i.blendDst=e.blendDst),e.blendEquation!==void 0&&(i.blendEquation=e.blendEquation),e.blendSrcAlpha!==void 0&&(i.blendSrcAlpha=e.blendSrcAlpha),e.blendDstAlpha!==void 0&&(i.blendDstAlpha=e.blendDstAlpha),e.blendEquationAlpha!==void 0&&(i.blendEquationAlpha=e.blendEquationAlpha),e.blendColor!==void 0&&i.blendColor!==void 0&&i.blendColor.setHex(e.blendColor),e.blendAlpha!==void 0&&(i.blendAlpha=e.blendAlpha),e.stencilWriteMask!==void 0&&(i.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(i.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(i.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(i.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(i.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(i.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(i.stencilZPass=e.stencilZPass),e.stencilWrite!==void 0&&(i.stencilWrite=e.stencilWrite),e.wireframe!==void 0&&(i.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(i.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(i.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(i.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(i.rotation=e.rotation),e.linewidth!==void 0&&(i.linewidth=e.linewidth),e.dashSize!==void 0&&(i.dashSize=e.dashSize),e.gapSize!==void 0&&(i.gapSize=e.gapSize),e.scale!==void 0&&(i.scale=e.scale),e.polygonOffset!==void 0&&(i.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(i.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(i.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(i.dithering=e.dithering),e.alphaToCoverage!==void 0&&(i.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(i.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(i.forceSinglePass=e.forceSinglePass),e.allowOverride!==void 0&&(i.allowOverride=e.allowOverride),e.visible!==void 0&&(i.visible=e.visible),e.toneMapped!==void 0&&(i.toneMapped=e.toneMapped),e.userData!==void 0&&(i.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?i.vertexColors=e.vertexColors>0:i.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const s in e.uniforms){const a=e.uniforms[s];switch(i.uniforms[s]={},a.type){case"t":i.uniforms[s].value=r(a.value);break;case"c":i.uniforms[s].value=new jt().setHex(a.value);break;case"v2":i.uniforms[s].value=new ct().fromArray(a.value);break;case"v3":i.uniforms[s].value=new X().fromArray(a.value);break;case"v4":i.uniforms[s].value=new $n().fromArray(a.value);break;case"m3":i.uniforms[s].value=new Tn().fromArray(a.value);break;case"m4":i.uniforms[s].value=new vn().fromArray(a.value);break;default:i.uniforms[s].value=a.value}}if(e.defines!==void 0&&(i.defines=e.defines),e.vertexShader!==void 0&&(i.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(i.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(i.glslVersion=e.glslVersion),e.extensions!==void 0)for(const s in e.extensions)i.extensions[s]=e.extensions[s];if(e.lights!==void 0&&(i.lights=e.lights),e.clipping!==void 0&&(i.clipping=e.clipping),e.size!==void 0&&(i.size=e.size),e.sizeAttenuation!==void 0&&(i.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(i.map=r(e.map)),e.matcap!==void 0&&(i.matcap=r(e.matcap)),e.alphaMap!==void 0&&(i.alphaMap=r(e.alphaMap)),e.bumpMap!==void 0&&(i.bumpMap=r(e.bumpMap)),e.bumpScale!==void 0&&(i.bumpScale=e.bumpScale),e.normalMap!==void 0&&(i.normalMap=r(e.normalMap)),e.normalMapType!==void 0&&(i.normalMapType=e.normalMapType),e.normalScale!==void 0){let s=e.normalScale;Array.isArray(s)===!1&&(s=[s,s]),i.normalScale=new ct().fromArray(s)}return e.displacementMap!==void 0&&(i.displacementMap=r(e.displacementMap)),e.displacementScale!==void 0&&(i.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(i.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(i.roughnessMap=r(e.roughnessMap)),e.metalnessMap!==void 0&&(i.metalnessMap=r(e.metalnessMap)),e.emissiveMap!==void 0&&(i.emissiveMap=r(e.emissiveMap)),e.emissiveIntensity!==void 0&&(i.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(i.specularMap=r(e.specularMap)),e.specularIntensityMap!==void 0&&(i.specularIntensityMap=r(e.specularIntensityMap)),e.specularColorMap!==void 0&&(i.specularColorMap=r(e.specularColorMap)),e.envMap!==void 0&&(i.envMap=r(e.envMap)),e.envMapRotation!==void 0&&i.envMapRotation.fromArray(e.envMapRotation),e.envMapIntensity!==void 0&&(i.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(i.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(i.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(i.lightMap=r(e.lightMap)),e.lightMapIntensity!==void 0&&(i.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(i.aoMap=r(e.aoMap)),e.aoMapIntensity!==void 0&&(i.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(i.gradientMap=r(e.gradientMap)),e.clearcoatMap!==void 0&&(i.clearcoatMap=r(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(i.clearcoatRoughnessMap=r(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(i.clearcoatNormalMap=r(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(i.clearcoatNormalScale=new ct().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(i.iridescenceMap=r(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(i.iridescenceThicknessMap=r(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(i.transmissionMap=r(e.transmissionMap)),e.thicknessMap!==void 0&&(i.thicknessMap=r(e.thicknessMap)),e.anisotropyMap!==void 0&&(i.anisotropyMap=r(e.anisotropyMap)),e.sheenColorMap!==void 0&&(i.sheenColorMap=r(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(i.sheenRoughnessMap=r(e.sheenRoughnessMap)),i}setTextures(e){return this.textures=e,this}createMaterialFromType(e){return h1.createMaterialFromType(e)}static createMaterialFromType(e){const t={ShadowMaterial:FE,SpriteMaterial:sx,RawShaderMaterial:mx,ShaderMaterial:Es,PointsMaterial:ox,MeshPhysicalMaterial:OE,MeshStandardMaterial:gx,MeshPhongMaterial:kE,MeshToonMaterial:zE,MeshNormalMaterial:BE,MeshLambertMaterial:GE,MeshDepthMaterial:l1,MeshDistanceMaterial:u1,MeshBasicMaterial:Ho,MeshMatcapMaterial:VE,LineDashedMaterial:HE,LineBasicMaterial:Ts,Material:ss};return new t[e]}}class x_{static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class Ex extends Sn{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class i3 extends bs{constructor(e){super(e)}load(e,t,r,i){const s=this,a=new ua(s.manager);a.setPath(s.path),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(e,function(o){try{t(s.parse(JSON.parse(o)))}catch(u){i?i(u):ln(u),s.manager.itemError(e)}},r,i)}parse(e){const t={},r={};function i(y,_){if(t[_]!==void 0)return t[_];const x=y.interleavedBuffers[_],S=s(y,x.buffer),T=xf(x.type,S),A=new Xv(T,x.stride);return A.uuid=x.uuid,t[_]=A,A}function s(y,_){if(r[_]!==void 0)return r[_];const x=y.arrayBuffers[_],S=new Uint32Array(x).buffer;return r[_]=S,S}const a=e.isInstancedBufferGeometry?new Ex:new Sn,o=e.data.index;if(o!==void 0){const y=xf(o.type,o.array);a.setIndex(new jn(y,1))}const u=e.data.attributes;for(const y in u){const _=u[y];let E;if(_.isInterleavedBufferAttribute){const x=i(e.data,_.data);E=new Xc(x,_.itemSize,_.offset,_.normalized)}else{const x=xf(_.type,_.array),S=_.isInstancedBufferAttribute?qc:jn;E=new S(x,_.itemSize,_.normalized)}_.name!==void 0&&(E.name=_.name),_.usage!==void 0&&E.setUsage(_.usage),a.setAttribute(y,E)}const c=e.data.morphAttributes;if(c)for(const y in c){const _=c[y],E=[];for(let x=0,S=_.length;x<S;x++){const T=_[x];let A;if(T.isInterleavedBufferAttribute){const P=i(e.data,T.data);A=new Xc(P,T.itemSize,T.offset,T.normalized)}else{const P=xf(T.type,T.array);A=new jn(P,T.itemSize,T.normalized)}T.name!==void 0&&(A.name=T.name),E.push(A)}a.morphAttributes[y]=E}e.data.morphTargetsRelative&&(a.morphTargetsRelative=!0);const m=e.data.groups||e.data.drawcalls||e.data.offsets;if(m!==void 0)for(let y=0,_=m.length;y!==_;++y){const E=m[y];a.addGroup(E.start,E.count,E.materialIndex)}const g=e.data.boundingSphere;return g!==void 0&&(a.boundingSphere=new Dr().fromJSON(g)),e.name&&(a.name=e.name),e.userData&&(a.userData=e.userData),a}}class s4 extends bs{constructor(e){super(e)}load(e,t,r,i){const s=this,a=this.path===""?x_.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||a;const o=new ua(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(u){let c=null;try{c=JSON.parse(u)}catch(m){i!==void 0&&i(m),m("ObjectLoader: Can't parse "+e+".",m.message);return}const f=c.metadata;if(f===void 0||f.type===void 0||f.type.toLowerCase()==="geometry"){i!==void 0&&i(new Error("THREE.ObjectLoader: Can't load "+e)),ln("ObjectLoader: Can't load "+e);return}s.parse(c,t)},r,i)}async loadAsync(e,t){const r=this,i=this.path===""?x_.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||i;const s=new ua(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials);const a=await s.loadAsync(e,t),o=JSON.parse(a),u=o.metadata;if(u===void 0||u.type===void 0||u.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await r.parseAsync(o)}parse(e,t){const r=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),s=this.parseGeometries(e.geometries,i),a=this.parseImages(e.images,function(){t!==void 0&&t(c)}),o=this.parseTextures(e.textures,a),u=this.parseMaterials(e.materials,o),c=this.parseObject(e.object,s,u,o,r),f=this.parseSkeletons(e.skeletons,c);if(this.bindSkeletons(c,f),this.bindLightTargets(c),t!==void 0){let m=!1;for(const g in a)if(a[g].data instanceof HTMLImageElement){m=!0;break}m===!1&&t(c)}return c}async parseAsync(e){const t=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,r),s=await this.parseImagesAsync(e.images),a=this.parseTextures(e.textures,s),o=this.parseMaterials(e.materials,a),u=this.parseObject(e.object,i,o,a,t),c=this.parseSkeletons(e.skeletons,u);return this.bindSkeletons(u,c),this.bindLightTargets(u),u}parseShapes(e){const t={};if(e!==void 0)for(let r=0,i=e.length;r<i;r++){const s=new Vc().fromJSON(e[r]);t[s.uuid]=s}return t}parseSkeletons(e,t){const r={},i={};if(t.traverse(function(s){s.isBone&&(i[s.uuid]=s)}),e!==void 0)for(let s=0,a=e.length;s<a;s++){const o=new qv().fromJSON(e[s],i);r[o.uuid]=o}return r}parseGeometries(e,t){const r={};if(e!==void 0){const i=new i3;for(let s=0,a=e.length;s<a;s++){let o;const u=e[s];switch(u.type){case"BufferGeometry":case"InstancedBufferGeometry":o=i.parse(u);break;default:u.type in RM?o=RM[u.type].fromJSON(u,t):Ft(`ObjectLoader: Unsupported geometry type "${u.type}"`)}o.uuid=u.uuid,u.name!==void 0&&(o.name=u.name),u.userData!==void 0&&(o.userData=u.userData),r[u.uuid]=o}}return r}parseMaterials(e,t){const r={},i={};if(e!==void 0){const s=new h1;s.setTextures(t);for(let a=0,o=e.length;a<o;a++){const u=e[a];r[u.uuid]===void 0&&(r[u.uuid]=s.parse(u)),i[u.uuid]=r[u.uuid]}}return i}parseAnimations(e){const t={};if(e!==void 0)for(let r=0;r<e.length;r++){const i=e[r],s=jp.parse(i);t[s.uuid]=s}return t}parseImages(e,t){const r=this,i={};let s;function a(u){return r.manager.itemStart(u),s.load(u,function(){r.manager.itemEnd(u)},void 0,function(){r.manager.itemError(u),r.manager.itemEnd(u)})}function o(u){if(typeof u=="string"){const c=u,f=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c)?c:r.resourcePath+c;return a(f)}else return u.data?{data:xf(u.type,u.data),width:u.width,height:u.height}:null}if(e!==void 0&&e.length>0){const u=new c1(t);s=new Xp(u),s.setCrossOrigin(this.crossOrigin);for(let c=0,f=e.length;c<f;c++){const m=e[c],g=m.url;if(Array.isArray(g)){const y=[];for(let _=0,E=g.length;_<E;_++){const x=g[_],S=o(x);S!==null&&(S instanceof HTMLImageElement?y.push(S):y.push(new Aa(S.data,S.width,S.height)))}i[m.uuid]=new yu(y)}else{const y=o(m.url);i[m.uuid]=new yu(y)}}}return i}async parseImagesAsync(e){const t=this,r={};let i;async function s(a){if(typeof a=="string"){const o=a,u=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(o)?o:t.resourcePath+o;return await i.loadAsync(u)}else return a.data?{data:xf(a.type,a.data),width:a.width,height:a.height}:null}if(e!==void 0&&e.length>0){i=new Xp(this.manager),i.setCrossOrigin(this.crossOrigin);for(let a=0,o=e.length;a<o;a++){const u=e[a],c=u.url;if(Array.isArray(c)){const f=[];for(let m=0,g=c.length;m<g;m++){const y=c[m],_=await s(y);_!==null&&(_ instanceof HTMLImageElement?f.push(_):f.push(new Aa(_.data,_.width,_.height)))}r[u.uuid]=new yu(f)}else{const f=await s(u.url);r[u.uuid]=new yu(f)}}}return r}parseTextures(e,t){function r(s,a){return typeof s=="number"?s:(Ft("ObjectLoader.parseTexture: Constant should be in numeric form.",s),a[s])}const i={};if(e!==void 0)for(let s=0,a=e.length;s<a;s++){const o=e[s];o.image===void 0&&Ft('ObjectLoader: No "image" specified for',o.uuid),t[o.image]===void 0&&Ft("ObjectLoader: Undefined image",o.image);const u=t[o.image],c=u.data;let f;Array.isArray(c)?(f=new s0,c.length===6&&(f.needsUpdate=!0)):(c&&c.data?f=new Aa:f=new ei,c&&(f.needsUpdate=!0)),f.source=u,f.uuid=o.uuid,o.name!==void 0&&(f.name=o.name),o.mapping!==void 0&&(f.mapping=r(o.mapping,a4)),o.channel!==void 0&&(f.channel=o.channel),o.offset!==void 0&&f.offset.fromArray(o.offset),o.repeat!==void 0&&f.repeat.fromArray(o.repeat),o.center!==void 0&&f.center.fromArray(o.center),o.rotation!==void 0&&(f.rotation=o.rotation),o.wrap!==void 0&&(f.wrapS=r(o.wrap[0],NM),f.wrapT=r(o.wrap[1],NM)),o.format!==void 0&&(f.format=o.format),o.internalFormat!==void 0&&(f.internalFormat=o.internalFormat),o.type!==void 0&&(f.type=o.type),o.colorSpace!==void 0&&(f.colorSpace=o.colorSpace),o.minFilter!==void 0&&(f.minFilter=r(o.minFilter,DM)),o.magFilter!==void 0&&(f.magFilter=r(o.magFilter,DM)),o.anisotropy!==void 0&&(f.anisotropy=o.anisotropy),o.flipY!==void 0&&(f.flipY=o.flipY),o.generateMipmaps!==void 0&&(f.generateMipmaps=o.generateMipmaps),o.premultiplyAlpha!==void 0&&(f.premultiplyAlpha=o.premultiplyAlpha),o.unpackAlignment!==void 0&&(f.unpackAlignment=o.unpackAlignment),o.compareFunction!==void 0&&(f.compareFunction=o.compareFunction),o.userData!==void 0&&(f.userData=o.userData),i[o.uuid]=f}return i}parseObject(e,t,r,i,s){let a;function o(g){return t[g]===void 0&&Ft("ObjectLoader: Undefined geometry",g),t[g]}function u(g){if(g!==void 0){if(Array.isArray(g)){const y=[];for(let _=0,E=g.length;_<E;_++){const x=g[_];r[x]===void 0&&Ft("ObjectLoader: Undefined material",x),y.push(r[x])}return y}return r[g]===void 0&&Ft("ObjectLoader: Undefined material",g),r[g]}}function c(g){return i[g]===void 0&&Ft("ObjectLoader: Undefined texture",g),i[g]}let f,m;switch(e.type){case"Scene":a=new a0,e.background!==void 0&&(Number.isInteger(e.background)?a.background=new jt(e.background):a.background=c(e.background)),e.environment!==void 0&&(a.environment=c(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?a.fog=new jv(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(a.fog=new Wv(e.fog.color,e.fog.density)),e.fog.name!==""&&(a.fog.name=e.fog.name)),e.backgroundBlurriness!==void 0&&(a.backgroundBlurriness=e.backgroundBlurriness),e.backgroundIntensity!==void 0&&(a.backgroundIntensity=e.backgroundIntensity),e.backgroundRotation!==void 0&&a.backgroundRotation.fromArray(e.backgroundRotation),e.environmentIntensity!==void 0&&(a.environmentIntensity=e.environmentIntensity),e.environmentRotation!==void 0&&a.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":a=new Pr(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(a.focus=e.focus),e.zoom!==void 0&&(a.zoom=e.zoom),e.filmGauge!==void 0&&(a.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(a.filmOffset=e.filmOffset),e.view!==void 0&&(a.view=Object.assign({},e.view));break;case"OrthographicCamera":a=new th(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(a.zoom=e.zoom),e.view!==void 0&&(a.view=Object.assign({},e.view));break;case"AmbientLight":a=new e3(e.color,e.intensity);break;case"DirectionalLight":a=new $E(e.color,e.intensity),a.target=e.target||"";break;case"PointLight":a=new QE(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":a=new t3(e.color,e.intensity,e.width,e.height);break;case"SpotLight":a=new KE(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay),a.target=e.target||"";break;case"HemisphereLight":a=new JE(e.color,e.groundColor,e.intensity);break;case"LightProbe":const g=new wx().fromArray(e.sh);a=new n3(g,e.intensity);break;case"SkinnedMesh":f=o(e.geometry),m=u(e.material),a=new yE(f,m),e.bindMode!==void 0&&(a.bindMode=e.bindMode),e.bindMatrix!==void 0&&a.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(a.skeleton=e.skeleton);break;case"Mesh":f=o(e.geometry),m=u(e.material),a=new pi(f,m);break;case"InstancedMesh":f=o(e.geometry),m=u(e.material);const y=e.count,_=e.instanceMatrix,E=e.instanceColor;a=new _E(f,m,y),a.instanceMatrix=new qc(new Float32Array(_.array),16),E!==void 0&&(a.instanceColor=new qc(new Float32Array(E.array),E.itemSize));break;case"BatchedMesh":f=o(e.geometry),m=u(e.material),a=new xE(e.maxInstanceCount,e.maxVertexCount,e.maxIndexCount,m),a.geometry=f,a.perObjectFrustumCulled=e.perObjectFrustumCulled,a.sortObjects=e.sortObjects,a._drawRanges=e.drawRanges,a._reservedRanges=e.reservedRanges,a._geometryInfo=e.geometryInfo.map(x=>{let S=null,T=null;return x.boundingBox!==void 0&&(S=new Nr().fromJSON(x.boundingBox)),x.boundingSphere!==void 0&&(T=new Dr().fromJSON(x.boundingSphere)),{...x,boundingBox:S,boundingSphere:T}}),a._instanceInfo=e.instanceInfo,a._availableInstanceIds=e._availableInstanceIds,a._availableGeometryIds=e._availableGeometryIds,a._nextIndexStart=e.nextIndexStart,a._nextVertexStart=e.nextVertexStart,a._geometryCount=e.geometryCount,a._maxInstanceCount=e.maxInstanceCount,a._maxVertexCount=e.maxVertexCount,a._maxIndexCount=e.maxIndexCount,a._geometryInitialized=e.geometryInitialized,a._matricesTexture=c(e.matricesTexture.uuid),a._indirectTexture=c(e.indirectTexture.uuid),e.colorsTexture!==void 0&&(a._colorsTexture=c(e.colorsTexture.uuid)),e.boundingSphere!==void 0&&(a.boundingSphere=new Dr().fromJSON(e.boundingSphere)),e.boundingBox!==void 0&&(a.boundingBox=new Nr().fromJSON(e.boundingBox));break;case"LOD":a=new vE;break;case"Line":a=new bu(o(e.geometry),u(e.material));break;case"LineLoop":a=new SE(o(e.geometry),u(e.material));break;case"LineSegments":a=new Wo(o(e.geometry),u(e.material));break;case"PointCloud":case"Points":a=new ME(o(e.geometry),u(e.material));break;case"Sprite":a=new gE(u(e.material));break;case"Group":a=new Sf;break;case"Bone":a=new ax;break;default:a=new Hn}if(a.uuid=e.uuid,e.name!==void 0&&(a.name=e.name),e.matrix!==void 0?(a.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(a.matrixAutoUpdate=e.matrixAutoUpdate),a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(e.position!==void 0&&a.position.fromArray(e.position),e.rotation!==void 0&&a.rotation.fromArray(e.rotation),e.quaternion!==void 0&&a.quaternion.fromArray(e.quaternion),e.scale!==void 0&&a.scale.fromArray(e.scale)),e.up!==void 0&&a.up.fromArray(e.up),e.castShadow!==void 0&&(a.castShadow=e.castShadow),e.receiveShadow!==void 0&&(a.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.intensity!==void 0&&(a.shadow.intensity=e.shadow.intensity),e.shadow.bias!==void 0&&(a.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(a.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(a.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&a.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(a.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(a.visible=e.visible),e.frustumCulled!==void 0&&(a.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(a.renderOrder=e.renderOrder),e.userData!==void 0&&(a.userData=e.userData),e.layers!==void 0&&(a.layers.mask=e.layers),e.children!==void 0){const g=e.children;for(let y=0;y<g.length;y++)a.add(this.parseObject(g[y],t,r,i,s))}if(e.animations!==void 0){const g=e.animations;for(let y=0;y<g.length;y++){const _=g[y];a.animations.push(s[_])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(a.autoUpdate=e.autoUpdate);const g=e.levels;for(let y=0;y<g.length;y++){const _=g[y],E=a.getObjectByProperty("uuid",_.object);E!==void 0&&a.addLevel(E,_.distance,_.hysteresis)}}return a}bindSkeletons(e,t){Object.keys(t).length!==0&&e.traverse(function(r){if(r.isSkinnedMesh===!0&&r.skeleton!==void 0){const i=t[r.skeleton];i===void 0?Ft("ObjectLoader: No skeleton found with UUID:",r.skeleton):r.bind(i,r.bindMatrix)}})}bindLightTargets(e){e.traverse(function(t){if(t.isDirectionalLight||t.isSpotLight){const r=t.target,i=e.getObjectByProperty("uuid",r);i!==void 0?t.target=i:t.target=new Hn}})}}const a4={UVMapping:wu,CubeReflectionMapping:ho,CubeRefractionMapping:Eu,EquirectangularReflectionMapping:Lf,EquirectangularRefractionMapping:Ip,CubeUVReflectionMapping:Wf},NM={RepeatWrapping:Lp,ClampToEdgeWrapping:Gi,MirroredRepeatWrapping:Np},DM={NearestFilter:Ji,NearestMipmapNearestFilter:Y_,NearestMipmapLinearFilter:_f,LinearFilter:Dn,LinearMipmapNearestFilter:mp,LinearMipmapLinearFilter:Fo},Cy=new WeakMap;class o4 extends bs{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&Ft("ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&Ft("ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"},this._abortController=new AbortController}setOptions(e){return this.options=e,this}load(e,t,r,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,a=Oo.get(`image-bitmap:${e}`);if(a!==void 0){if(s.manager.itemStart(e),a.then){a.then(c=>{if(Cy.has(a)===!0)i&&i(Cy.get(a)),s.manager.itemError(e),s.manager.itemEnd(e);else return t&&t(c),s.manager.itemEnd(e),c});return}return setTimeout(function(){t&&t(a),s.manager.itemEnd(e)},0),a}const o={};o.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",o.headers=this.requestHeader,o.signal=typeof AbortSignal.any=="function"?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal;const u=fetch(e,o).then(function(c){return c.blob()}).then(function(c){return createImageBitmap(c,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(c){return Oo.add(`image-bitmap:${e}`,c),t&&t(c),s.manager.itemEnd(e),c}).catch(function(c){i&&i(c),Cy.set(u,c),Oo.remove(`image-bitmap:${e}`),s.manager.itemError(e),s.manager.itemEnd(e)});Oo.add(`image-bitmap:${e}`,u),s.manager.itemStart(e)}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}let qm;class Tx{static getContext(){return qm===void 0&&(qm=new(window.AudioContext||window.webkitAudioContext)),qm}static setContext(e){qm=e}}class l4 extends bs{constructor(e){super(e)}load(e,t,r,i){const s=this,a=new ua(this.manager);a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(u){try{const c=u.slice(0);Tx.getContext().decodeAudioData(c,function(m){t(m)}).catch(o)}catch(c){o(c)}},r,i);function o(u){i?i(u):ln(u),s.manager.itemError(e)}}}const UM=new vn,FM=new vn,Sc=new vn;class u4{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Pr,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Pr,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,Sc.copy(e.projectionMatrix);const i=t.eyeSep/2,s=i*t.near/t.focus,a=t.near*Math.tan(Bc*t.fov*.5)/t.zoom;let o,u;FM.elements[12]=-i,UM.elements[12]=i,o=-a*t.aspect+s,u=a*t.aspect+s,Sc.elements[0]=2*t.near/(u-o),Sc.elements[8]=(u+o)/(u-o),this.cameraL.projectionMatrix.copy(Sc),o=-a*t.aspect-s,u=a*t.aspect-s,Sc.elements[0]=2*t.near/(u-o),Sc.elements[8]=(u+o)/(u-o),this.cameraR.projectionMatrix.copy(Sc)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(FM),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(UM)}}class r3 extends Pr{constructor(e=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=e}}class bx{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=performance.now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=performance.now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}const Mc=new X,Py=new xn,c4=new X,wc=new X,Ec=new X;class h4 extends Hn{constructor(){super(),this.type="AudioListener",this.context=Tx.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new bx}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Mc,Py,c4),wc.set(0,0,-1).applyQuaternion(Py),Ec.set(0,1,0).applyQuaternion(Py),t.positionX){const r=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(Mc.x,r),t.positionY.linearRampToValueAtTime(Mc.y,r),t.positionZ.linearRampToValueAtTime(Mc.z,r),t.forwardX.linearRampToValueAtTime(wc.x,r),t.forwardY.linearRampToValueAtTime(wc.y,r),t.forwardZ.linearRampToValueAtTime(wc.z,r),t.upX.linearRampToValueAtTime(Ec.x,r),t.upY.linearRampToValueAtTime(Ec.y,r),t.upZ.linearRampToValueAtTime(Ec.z,r)}else t.setPosition(Mc.x,Mc.y,Mc.z),t.setOrientation(wc.x,wc.y,wc.z,Ec.x,Ec.y,Ec.z)}}class s3 extends Hn{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){Ft("Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){Ft("Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){Ft("Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(e=0){if(this.hasPlaybackControl===!1){Ft("Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(this.context.currentTime+e),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){return this.detune=e,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){Ft("Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1,this._progress=0}getLoop(){return this.hasPlaybackControl===!1?(Ft("Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){Ft("Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}copy(e,t){return super.copy(e,t),e.sourceType!=="buffer"?(Ft("Audio: Audio source type cannot be copied."),this):(this.autoplay=e.autoplay,this.buffer=e.buffer,this.detune=e.detune,this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this.offset=e.offset,this.duration=e.duration,this.playbackRate=e.playbackRate,this.hasPlaybackControl=e.hasPlaybackControl,this.sourceType=e.sourceType,this.filters=e.filters.slice(),this)}clone(e){return new this.constructor(this.listener).copy(this,e)}}const Tc=new X,OM=new xn,f4=new X,bc=new X;class d4 extends s3{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){return super.connect(),this.panner.connect(this.gain),this}disconnect(){return super.disconnect(),this.panner.disconnect(this.gain),this}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,r){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=r,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(Tc,OM,f4),bc.set(0,0,1).applyQuaternion(OM);const t=this.panner;if(t.positionX){const r=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(Tc.x,r),t.positionY.linearRampToValueAtTime(Tc.y,r),t.positionZ.linearRampToValueAtTime(Tc.z,r),t.orientationX.linearRampToValueAtTime(bc.x,r),t.orientationY.linearRampToValueAtTime(bc.y,r),t.orientationZ.linearRampToValueAtTime(bc.z,r)}else t.setPosition(Tc.x,Tc.y,Tc.z),t.setOrientation(bc.x,bc.y,bc.z)}}class p4{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let r=0;r<t.length;r++)e+=t[r];return e/t.length}}class a3{constructor(e,t,r){this.binding=e,this.valueSize=r;let i,s,a;switch(t){case"quaternion":i=this._slerp,s=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(r*6),this._workIndex=5;break;case"string":case"bool":i=this._select,s=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(r*5);break;default:i=this._lerp,s=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(r*5)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=s,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const r=this.buffer,i=this.valueSize,s=e*i+i;let a=this.cumulativeWeight;if(a===0){for(let o=0;o!==i;++o)r[s+o]=r[o];a=t}else{a+=t;const o=t/a;this._mixBufferRegion(r,s,0,o,i)}this.cumulativeWeight=a}accumulateAdditive(e){const t=this.buffer,r=this.valueSize,i=r*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,r),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,r=this.buffer,i=e*t+t,s=this.cumulativeWeight,a=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const u=t*this._origIndex;this._mixBufferRegion(r,i,u,1-s,t)}a>0&&this._mixBufferRegionAdditive(r,i,this._addIndex*t,1,t);for(let u=t,c=t+t;u!==c;++u)if(r[u]!==r[u+t]){o.setValue(r,i);break}}saveOriginalState(){const e=this.binding,t=this.buffer,r=this.valueSize,i=r*this._origIndex;e.getValue(t,i);for(let s=r,a=i;s!==a;++s)t[s]=t[i+s%r];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let r=e;r<t;r++)this.buffer[r]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let r=0;r<this.valueSize;r++)this.buffer[t+r]=this.buffer[e+r]}_select(e,t,r,i,s){if(i>=.5)for(let a=0;a!==s;++a)e[t+a]=e[r+a]}_slerp(e,t,r,i){xn.slerpFlat(e,t,e,t,e,r,i)}_slerpAdditive(e,t,r,i,s){const a=this._workIndex*s;xn.multiplyQuaternionsFlat(e,a,e,t,e,r),xn.slerpFlat(e,t,e,t,e,a,i)}_lerp(e,t,r,i,s){const a=1-i;for(let o=0;o!==s;++o){const u=t+o;e[u]=e[u]*a+e[r+o]*i}}_lerpAdditive(e,t,r,i,s){for(let a=0;a!==s;++a){const o=t+a;e[o]=e[o]+e[r+a]*i}}}const Ax="\\[\\]\\.:\\/",m4=new RegExp("["+Ax+"]","g"),Cx="[^"+Ax+"]",g4="[^"+Ax.replace("\\.","")+"]",v4=/((?:WC+[\/:])*)/.source.replace("WC",Cx),y4=/(WCOD+)?/.source.replace("WCOD",g4),_4=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Cx),x4=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Cx),S4=new RegExp("^"+v4+y4+_4+x4+"$"),M4=["material","materials","bones","map"];class w4{constructor(e,t,r){const i=r||Vn.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();const r=this._targetGroup.nCachedObjects_,i=this._bindings[r];i!==void 0&&i.getValue(e,t)}setValue(e,t){const r=this._bindings;for(let i=this._targetGroup.nCachedObjects_,s=r.length;i!==s;++i)r[i].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].unbind()}}class Vn{constructor(e,t,r){this.path=t,this.parsedPath=r||Vn.parseTrackName(t),this.node=Vn.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,r){return e&&e.isAnimationObjectGroup?new Vn.Composite(e,t,r):new Vn(e,t,r)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(m4,"")}static parseTrackName(e){const t=S4.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const r={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=r.nodeName&&r.nodeName.lastIndexOf(".");if(i!==void 0&&i!==-1){const s=r.nodeName.substring(i+1);M4.indexOf(s)!==-1&&(r.nodeName=r.nodeName.substring(0,i),r.objectName=s)}if(r.propertyName===null||r.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const r=e.skeleton.getBoneByName(t);if(r!==void 0)return r}if(e.children){const r=function(s){for(let a=0;a<s.length;a++){const o=s[a];if(o.name===t||o.uuid===t)return o;const u=r(o.children);if(u)return u}return null},i=r(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const r=this.resolvedProperty;for(let i=0,s=r.length;i!==s;++i)e[t++]=r[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const r=this.resolvedProperty;for(let i=0,s=r.length;i!==s;++i)r[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const r=this.resolvedProperty;for(let i=0,s=r.length;i!==s;++i)r[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const r=this.resolvedProperty;for(let i=0,s=r.length;i!==s;++i)r[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,r=t.objectName,i=t.propertyName;let s=t.propertyIndex;if(e||(e=Vn.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){Ft("PropertyBinding: No target node found for track: "+this.path+".");return}if(r){let c=t.objectIndex;switch(r){case"materials":if(!e.material){ln("PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){ln("PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){ln("PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let f=0;f<e.length;f++)if(e[f].name===c){c=f;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){ln("PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){ln("PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[r]===void 0){ln("PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[r]}if(c!==void 0){if(e[c]===void 0){ln("PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[c]}}const a=e[i];if(a===void 0){const c=t.nodeName;ln("PropertyBinding: Trying to update property for track: "+c+"."+i+" but it wasn't found.",e);return}let o=this.Versioning.None;this.targetObject=e,e.isMaterial===!0?o=this.Versioning.NeedsUpdate:e.isObject3D===!0&&(o=this.Versioning.MatrixWorldNeedsUpdate);let u=this.BindingType.Direct;if(s!==void 0){if(i==="morphTargetInfluences"){if(!e.geometry){ln("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){ln("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[s]!==void 0&&(s=e.morphTargetDictionary[s])}u=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=s}else a.fromArray!==void 0&&a.toArray!==void 0?(u=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(u=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=i;this.getValue=this.GetterByBindingType[u],this.setValue=this.SetterByBindingTypeAndVersioning[u][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Vn.Composite=w4;Vn.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Vn.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Vn.prototype.GetterByBindingType=[Vn.prototype._getValue_direct,Vn.prototype._getValue_array,Vn.prototype._getValue_arrayElement,Vn.prototype._getValue_toArray];Vn.prototype.SetterByBindingTypeAndVersioning=[[Vn.prototype._setValue_direct,Vn.prototype._setValue_direct_setNeedsUpdate,Vn.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Vn.prototype._setValue_array,Vn.prototype._setValue_array_setNeedsUpdate,Vn.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Vn.prototype._setValue_arrayElement,Vn.prototype._setValue_arrayElement_setNeedsUpdate,Vn.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Vn.prototype._setValue_fromArray,Vn.prototype._setValue_fromArray_setNeedsUpdate,Vn.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class E4{constructor(){this.isAnimationObjectGroup=!0,this.uuid=la(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let r=0,i=arguments.length;r!==i;++r)e[arguments[r].uuid]=r;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,r=this._paths,i=this._parsedPaths,s=this._bindings,a=s.length;let o,u=e.length,c=this.nCachedObjects_;for(let f=0,m=arguments.length;f!==m;++f){const g=arguments[f],y=g.uuid;let _=t[y];if(_===void 0){_=u++,t[y]=_,e.push(g);for(let E=0,x=a;E!==x;++E)s[E].push(new Vn(g,r[E],i[E]))}else if(_<c){o=e[_];const E=--c,x=e[E];t[x.uuid]=_,e[_]=x,t[y]=E,e[E]=g;for(let S=0,T=a;S!==T;++S){const A=s[S],P=A[E];let L=A[_];A[_]=P,L===void 0&&(L=new Vn(g,r[S],i[S])),A[E]=L}}else e[_]!==o&&ln("AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c}remove(){const e=this._objects,t=this._indicesByUUID,r=this._bindings,i=r.length;let s=this.nCachedObjects_;for(let a=0,o=arguments.length;a!==o;++a){const u=arguments[a],c=u.uuid,f=t[c];if(f!==void 0&&f>=s){const m=s++,g=e[m];t[g.uuid]=f,e[f]=g,t[c]=m,e[m]=u;for(let y=0,_=i;y!==_;++y){const E=r[y],x=E[m],S=E[f];E[f]=x,E[m]=S}}}this.nCachedObjects_=s}uncache(){const e=this._objects,t=this._indicesByUUID,r=this._bindings,i=r.length;let s=this.nCachedObjects_,a=e.length;for(let o=0,u=arguments.length;o!==u;++o){const c=arguments[o],f=c.uuid,m=t[f];if(m!==void 0)if(delete t[f],m<s){const g=--s,y=e[g],_=--a,E=e[_];t[y.uuid]=m,e[m]=y,t[E.uuid]=g,e[g]=E,e.pop();for(let x=0,S=i;x!==S;++x){const T=r[x],A=T[g],P=T[_];T[m]=A,T[g]=P,T.pop()}}else{const g=--a,y=e[g];g>0&&(t[y.uuid]=m),e[m]=y,e.pop();for(let _=0,E=i;_!==E;++_){const x=r[_];x[m]=x[g],x.pop()}}}this.nCachedObjects_=s}subscribe_(e,t){const r=this._bindingsIndicesByPath;let i=r[e];const s=this._bindings;if(i!==void 0)return s[i];const a=this._paths,o=this._parsedPaths,u=this._objects,c=u.length,f=this.nCachedObjects_,m=new Array(c);i=s.length,r[e]=i,a.push(e),o.push(t),s.push(m);for(let g=f,y=u.length;g!==y;++g){const _=u[g];m[g]=new Vn(_,e,t)}return m}unsubscribe_(e){const t=this._bindingsIndicesByPath,r=t[e];if(r!==void 0){const i=this._paths,s=this._parsedPaths,a=this._bindings,o=a.length-1,u=a[o],c=e[o];t[c]=r,a[r]=u,a.pop(),s[r]=s[o],s.pop(),i[r]=i[o],i.pop()}}}class o3{constructor(e,t,r=null,i=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=r,this.blendMode=i;const s=t.tracks,a=s.length,o=new Array(a),u={endingStart:Dc,endingEnd:Dc};for(let c=0;c!==a;++c){const f=s[c].createInterpolant(null);o[c]=f,f.settings=u}this._interpolantSettings=u,this._interpolants=o,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Kw,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,r=!1){if(e.fadeOut(t),this.fadeIn(t),r===!0){const i=this._clip.duration,s=e._clip.duration,a=s/i,o=i/s;e.warp(1,a,t),this.warp(o,1,t)}return this}crossFadeTo(e,t,r=!1){return e.crossFadeFrom(this,t,r)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,r){const i=this._mixer,s=i.time,a=this.timeScale;let o=this._timeScaleInterpolant;o===null&&(o=i._lendControlInterpolant(),this._timeScaleInterpolant=o);const u=o.parameterPositions,c=o.sampleValues;return u[0]=s,u[1]=s+r,c[0]=e/a,c[1]=t/a,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,r,i){if(!this.enabled){this._updateWeight(e);return}const s=this._startTime;if(s!==null){const u=(e-s)*r;u<0||r===0?t=0:(this._startTime=null,t=r*u)}t*=this._updateTimeScale(e);const a=this._updateTime(t),o=this._updateWeight(e);if(o>0){const u=this._interpolants,c=this._propertyBindings;switch(this.blendMode){case $_:for(let f=0,m=u.length;f!==m;++f)u[f].evaluate(a),c[f].accumulateAdditive(o);break;case kv:default:for(let f=0,m=u.length;f!==m;++f)u[f].evaluate(a),c[f].accumulate(i,o)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const r=this._weightInterpolant;if(r!==null){const i=r.evaluate(e)[0];t*=i,e>r.parameterPositions[1]&&(this.stopFading(),i===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const r=this._timeScaleInterpolant;if(r!==null){const i=r.evaluate(e)[0];t*=i,e>r.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,r=this.loop;let i=this.time+e,s=this._loopCount;const a=r===Qw;if(e===0)return s===-1?i:a&&(s&1)===1?t-i:i;if(r===Jw){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else if(i<0)i=0;else{this.time=i;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(s===-1&&(e>=0?(s=0,this._setEndings(!0,this.repetitions===0,a)):this._setEndings(this.repetitions===0,!0,a)),i>=t||i<0){const o=Math.floor(i/t);i-=t*o,s+=Math.abs(o);const u=this.repetitions-s;if(u<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(u===1){const c=e<0;this._setEndings(c,!c,a)}else this._setEndings(!1,!1,a);this._loopCount=s,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=i;if(a&&(s&1)===1)return t-i}return i}_setEndings(e,t,r){const i=this._interpolantSettings;r?(i.endingStart=Uc,i.endingEnd=Uc):(e?i.endingStart=this.zeroSlopeAtStart?Uc:Dc:i.endingStart=Up,t?i.endingEnd=this.zeroSlopeAtEnd?Uc:Dc:i.endingEnd=Up)}_scheduleFading(e,t,r){const i=this._mixer,s=i.time;let a=this._weightInterpolant;a===null&&(a=i._lendControlInterpolant(),this._weightInterpolant=a);const o=a.parameterPositions,u=a.sampleValues;return o[0]=s,u[0]=t,o[1]=s+e,u[1]=r,this}}const T4=new Float32Array(1);class b4 extends Vo{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const r=e._localRoot||this._root,i=e._clip.tracks,s=i.length,a=e._propertyBindings,o=e._interpolants,u=r.uuid,c=this._bindingsByRootAndName;let f=c[u];f===void 0&&(f={},c[u]=f);for(let m=0;m!==s;++m){const g=i[m],y=g.name;let _=f[y];if(_!==void 0)++_.referenceCount,a[m]=_;else{if(_=a[m],_!==void 0){_._cacheIndex===null&&(++_.referenceCount,this._addInactiveBinding(_,u,y));continue}const E=t&&t._propertyBindings[m].binding.parsedPath;_=new a3(Vn.create(r,y,E),g.ValueTypeName,g.getValueSize()),++_.referenceCount,this._addInactiveBinding(_,u,y),a[m]=_}o[m].resultBuffer=_.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const r=(e._localRoot||this._root).uuid,i=e._clip.uuid,s=this._actionsByClip[i];this._bindAction(e,s&&s.knownActions[0]),this._addInactiveAction(e,i,r)}const t=e._propertyBindings;for(let r=0,i=t.length;r!==i;++r){const s=t[r];s.useCount++===0&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let r=0,i=t.length;r!==i;++r){const s=t[r];--s.useCount===0&&(s.restoreOriginalState(),this._takeBackBinding(s))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,r){const i=this._actions,s=this._actionsByClip;let a=s[t];if(a===void 0)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,s[t]=a;else{const o=a.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=i.length,i.push(e),a.actionByRoot[r]=e}_removeInactiveAction(e){const t=this._actions,r=t[t.length-1],i=e._cacheIndex;r._cacheIndex=i,t[i]=r,t.pop(),e._cacheIndex=null;const s=e._clip.uuid,a=this._actionsByClip,o=a[s],u=o.knownActions,c=u[u.length-1],f=e._byClipCacheIndex;c._byClipCacheIndex=f,u[f]=c,u.pop(),e._byClipCacheIndex=null;const m=o.actionByRoot,g=(e._localRoot||this._root).uuid;delete m[g],u.length===0&&delete a[s],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let r=0,i=t.length;r!==i;++r){const s=t[r];--s.referenceCount===0&&this._removeInactiveBinding(s)}}_lendAction(e){const t=this._actions,r=e._cacheIndex,i=this._nActiveActions++,s=t[i];e._cacheIndex=i,t[i]=e,s._cacheIndex=r,t[r]=s}_takeBackAction(e){const t=this._actions,r=e._cacheIndex,i=--this._nActiveActions,s=t[i];e._cacheIndex=i,t[i]=e,s._cacheIndex=r,t[r]=s}_addInactiveBinding(e,t,r){const i=this._bindingsByRootAndName,s=this._bindings;let a=i[t];a===void 0&&(a={},i[t]=a),a[r]=e,e._cacheIndex=s.length,s.push(e)}_removeInactiveBinding(e){const t=this._bindings,r=e.binding,i=r.rootNode.uuid,s=r.path,a=this._bindingsByRootAndName,o=a[i],u=t[t.length-1],c=e._cacheIndex;u._cacheIndex=c,t[c]=u,t.pop(),delete o[s],Object.keys(o).length===0&&delete a[i]}_lendBinding(e){const t=this._bindings,r=e._cacheIndex,i=this._nActiveBindings++,s=t[i];e._cacheIndex=i,t[i]=e,s._cacheIndex=r,t[r]=s}_takeBackBinding(e){const t=this._bindings,r=e._cacheIndex,i=--this._nActiveBindings,s=t[i];e._cacheIndex=i,t[i]=e,s._cacheIndex=r,t[r]=s}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let r=e[t];return r===void 0&&(r=new yx(new Float32Array(2),new Float32Array(2),1,T4),r.__cacheIndex=t,e[t]=r),r}_takeBackControlInterpolant(e){const t=this._controlInterpolants,r=e.__cacheIndex,i=--this._nActiveControlInterpolants,s=t[i];e.__cacheIndex=i,t[i]=e,s.__cacheIndex=r,t[r]=s}clipAction(e,t,r){const i=t||this._root,s=i.uuid;let a=typeof e=="string"?jp.findByName(i,e):e;const o=a!==null?a.uuid:e,u=this._actionsByClip[o];let c=null;if(r===void 0&&(a!==null?r=a.blendMode:r=kv),u!==void 0){const m=u.actionByRoot[s];if(m!==void 0&&m.blendMode===r)return m;c=u.knownActions[0],a===null&&(a=c._clip)}if(a===null)return null;const f=new o3(this,a,t,r);return this._bindAction(f,c),this._addInactiveAction(f,o,s),f}existingAction(e,t){const r=t||this._root,i=r.uuid,s=typeof e=="string"?jp.findByName(r,e):e,a=s?s.uuid:e,o=this._actionsByClip[a];return o!==void 0&&o.actionByRoot[i]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let r=t-1;r>=0;--r)e[r].stop();return this}update(e){e*=this.timeScale;const t=this._actions,r=this._nActiveActions,i=this.time+=e,s=Math.sign(e),a=this._accuIndex^=1;for(let c=0;c!==r;++c)t[c]._update(i,e,s,a);const o=this._bindings,u=this._nActiveBindings;for(let c=0;c!==u;++c)o[c].apply(a);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,r=e.uuid,i=this._actionsByClip,s=i[r];if(s!==void 0){const a=s.knownActions;for(let o=0,u=a.length;o!==u;++o){const c=a[o];this._deactivateAction(c);const f=c._cacheIndex,m=t[t.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,m._cacheIndex=f,t[f]=m,t.pop(),this._removeInactiveBindingsForAction(c)}delete i[r]}}uncacheRoot(e){const t=e.uuid,r=this._actionsByClip;for(const a in r){const o=r[a].actionByRoot,u=o[t];u!==void 0&&(this._deactivateAction(u),this._removeInactiveAction(u))}const i=this._bindingsByRootAndName,s=i[t];if(s!==void 0)for(const a in s){const o=s[a];o.restoreOriginalState(),this._removeInactiveBinding(o)}}uncacheAction(e,t){const r=this.existingAction(e,t);r!==null&&(this._deactivateAction(r),this._removeInactiveAction(r))}}class A4 extends tx{constructor(e=1,t=1,r=1,i={}){super(e,t,i),this.isRenderTarget3D=!0,this.depth=r,this.texture=new Vv(null,e,t,r),this._setTextureOptions(i),this.texture.isRenderTargetTexture=!0}}class Px{constructor(e){this.value=e}clone(){return new Px(this.value.clone===void 0?this.value:this.value.clone())}}let C4=0;class P4 extends Vo{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:C4++}),this.name="",this.usage=Op,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){this.dispatchEvent({type:"dispose"})}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let r=0,i=t.length;r<i;r++){const s=Array.isArray(t[r])?t[r]:[t[r]];for(let a=0;a<s.length;a++)this.uniforms.push(s[a].clone())}return this}clone(){return new this.constructor().copy(this)}}class R4 extends Xv{constructor(e,t,r=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class I4{constructor(e,t,r,i,s,a=!1){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=r,this.elementSize=i,this.count=s,this.normalized=a,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}const kM=new vn;class Rx{constructor(e,t,r=0,i=1/0){this.ray=new jf(e,t),this.near=r,this.far=i,this.camera=null,this.layers=new Gc,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):ln("Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return kM.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(kM),this}intersectObject(e,t=!0,r=[]){return S_(e,this,r,t),r.sort(zM),r}intersectObjects(e,t=!0,r=[]){for(let i=0,s=e.length;i<s;i++)S_(e[i],this,r,t);return r.sort(zM),r}}function zM(n,e){return n.distance-e.distance}function S_(n,e,t,r){let i=!0;if(n.layers.test(e.layers)&&n.raycast(e,t)===!1&&(i=!1),i===!0&&r===!0){const s=n.children;for(let a=0,o=s.length;a<o;a++)S_(s[a],e,t,!0)}}class L4{constructor(){this._previousTime=0,this._currentTime=0,this._startTime=performance.now(),this._delta=0,this._elapsed=0,this._timescale=1,this._document=null,this._pageVisibilityHandler=null}connect(e){this._document=e,e.hidden!==void 0&&(this._pageVisibilityHandler=N4.bind(this),e.addEventListener("visibilitychange",this._pageVisibilityHandler,!1))}disconnect(){this._pageVisibilityHandler!==null&&(this._document.removeEventListener("visibilitychange",this._pageVisibilityHandler),this._pageVisibilityHandler=null),this._document=null}getDelta(){return this._delta/1e3}getElapsed(){return this._elapsed/1e3}getTimescale(){return this._timescale}setTimescale(e){return this._timescale=e,this}reset(){return this._currentTime=performance.now()-this._startTime,this}dispose(){this.disconnect()}update(e){return this._pageVisibilityHandler!==null&&this._document.hidden===!0?this._delta=0:(this._previousTime=this._currentTime,this._currentTime=(e!==void 0?e:performance.now())-this._startTime,this._delta=(this._currentTime-this._previousTime)*this._timescale,this._elapsed+=this._delta),this}}function N4(){this._document.hidden===!1&&this.reset()}class D4{constructor(e=1,t=0,r=0){this.radius=e,this.phi=t,this.theta=r}set(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=gn(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,r){return this.radius=Math.sqrt(e*e+t*t+r*r),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(gn(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class U4{constructor(e=1,t=0,r=0){this.radius=e,this.theta=t,this.y=r}set(e,t,r){return this.radius=e,this.theta=t,this.y=r,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,r){return this.radius=Math.sqrt(e*e+r*r),this.theta=Math.atan2(e,r),this.y=t,this}clone(){return new this.constructor().copy(this)}}class Ix{constructor(e,t,r,i){Ix.prototype.isMatrix2=!0,this.elements=[1,0,0,1],e!==void 0&&this.set(e,t,r,i)}identity(){return this.set(1,0,0,1),this}fromArray(e,t=0){for(let r=0;r<4;r++)this.elements[r]=e[r+t];return this}set(e,t,r,i){const s=this.elements;return s[0]=e,s[2]=t,s[1]=r,s[3]=i,this}}const BM=new ct;class F4{constructor(e=new ct(1/0,1/0),t=new ct(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const r=BM.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,BM).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const GM=new X,Ym=new X,hf=new X,ff=new X,Ry=new X,O4=new X,k4=new X;class z4{constructor(e=new X,t=new X){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){GM.subVectors(e,this.start),Ym.subVectors(this.end,this.start);const r=Ym.dot(Ym);let s=Ym.dot(GM)/r;return t&&(s=gn(s,0,1)),s}closestPointToPoint(e,t,r){const i=this.closestPointToPointParameter(e,t);return this.delta(r).multiplyScalar(i).add(this.start)}distanceSqToLine3(e,t=O4,r=k4){const i=10000000000000001e-32;let s,a;const o=this.start,u=e.start,c=this.end,f=e.end;hf.subVectors(c,o),ff.subVectors(f,u),Ry.subVectors(o,u);const m=hf.dot(hf),g=ff.dot(ff),y=ff.dot(Ry);if(m<=i&&g<=i)return t.copy(o),r.copy(u),t.sub(r),t.dot(t);if(m<=i)s=0,a=y/g,a=gn(a,0,1);else{const _=hf.dot(Ry);if(g<=i)a=0,s=gn(-_/m,0,1);else{const E=hf.dot(ff),x=m*g-E*E;x!==0?s=gn((E*y-_*g)/x,0,1):s=0,a=(E*s+y)/g,a<0?(a=0,s=gn(-_/m,0,1)):a>1&&(a=1,s=gn((E-_)/m,0,1))}}return t.copy(o).add(hf.multiplyScalar(s)),r.copy(u).add(ff.multiplyScalar(a)),t.sub(r),t.dot(t)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const VM=new X;class B4 extends Hn{constructor(e,t){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const r=new Sn,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let a=0,o=1,u=32;a<u;a++,o++){const c=a/u*Math.PI*2,f=o/u*Math.PI*2;i.push(Math.cos(c),Math.sin(c),1,Math.cos(f),Math.sin(f),1)}r.setAttribute("position",new Jt(i,3));const s=new Ts({fog:!1,toneMapped:!1});this.cone=new Wo(r,s),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),VM.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(VM),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const hu=new X,Zm=new vn,Iy=new vn;class G4 extends Wo{constructor(e){const t=l3(e),r=new Sn,i=[],s=[];for(let c=0;c<t.length;c++){const f=t[c];f.parent&&f.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),s.push(0,0,0),s.push(0,0,0))}r.setAttribute("position",new Jt(i,3)),r.setAttribute("color",new Jt(s,3));const a=new Ts({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(r,a),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1;const o=new jt(255),u=new jt(65280);this.setColors(o,u)}updateMatrixWorld(e){const t=this.bones,r=this.geometry,i=r.getAttribute("position");Iy.copy(this.root.matrixWorld).invert();for(let s=0,a=0;s<t.length;s++){const o=t[s];o.parent&&o.parent.isBone&&(Zm.multiplyMatrices(Iy,o.matrixWorld),hu.setFromMatrixPosition(Zm),i.setXYZ(a,hu.x,hu.y,hu.z),Zm.multiplyMatrices(Iy,o.parent.matrixWorld),hu.setFromMatrixPosition(Zm),i.setXYZ(a+1,hu.x,hu.y,hu.z),a+=2)}r.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}setColors(e,t){const i=this.geometry.getAttribute("color");for(let s=0;s<i.count;s+=2)i.setXYZ(s,e.r,e.g,e.b),i.setXYZ(s+1,t.r,t.g,t.b);return i.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}function l3(n){const e=[];n.isBone===!0&&e.push(n);for(let t=0;t<n.children.length;t++)e.push(...l3(n.children[t]));return e}class V4 extends pi{constructor(e,t,r){const i=new h0(t,4,2),s=new Ho({wireframe:!0,fog:!1,toneMapped:!1});super(i,s),this.light=e,this.color=r,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const H4=new X,HM=new jt,WM=new jt;class W4 extends Hn{constructor(e,t,r){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,this.type="HemisphereLightHelper";const i=new c0(t);i.rotateY(Math.PI*.5),this.material=new Ho({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const s=i.getAttribute("position"),a=new Float32Array(s.count*3);i.setAttribute("color",new jn(a,3)),this.add(new pi(i,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");HM.copy(this.light.color),WM.copy(this.light.groundColor);for(let r=0,i=t.count;r<i;r++){const s=r<i/2?HM:WM;t.setXYZ(r,s.r,s.g,s.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(H4.setFromMatrixPosition(this.light.matrixWorld).negate())}}class j4 extends Wo{constructor(e=10,t=10,r=4473924,i=8947848){r=new jt(r),i=new jt(i);const s=t/2,a=e/t,o=e/2,u=[],c=[];for(let g=0,y=0,_=-o;g<=t;g++,_+=a){u.push(-o,0,_,o,0,_),u.push(_,0,-o,_,0,o);const E=g===s?r:i;E.toArray(c,y),y+=3,E.toArray(c,y),y+=3,E.toArray(c,y),y+=3,E.toArray(c,y),y+=3}const f=new Sn;f.setAttribute("position",new Jt(u,3)),f.setAttribute("color",new Jt(c,3));const m=new Ts({vertexColors:!0,toneMapped:!1});super(f,m),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class X4 extends Wo{constructor(e=10,t=16,r=8,i=64,s=4473924,a=8947848){s=new jt(s),a=new jt(a);const o=[],u=[];if(t>1)for(let m=0;m<t;m++){const g=m/t*(Math.PI*2),y=Math.sin(g)*e,_=Math.cos(g)*e;o.push(0,0,0),o.push(y,0,_);const E=m&1?s:a;u.push(E.r,E.g,E.b),u.push(E.r,E.g,E.b)}for(let m=0;m<r;m++){const g=m&1?s:a,y=e-e/r*m;for(let _=0;_<i;_++){let E=_/i*(Math.PI*2),x=Math.sin(E)*y,S=Math.cos(E)*y;o.push(x,0,S),u.push(g.r,g.g,g.b),E=(_+1)/i*(Math.PI*2),x=Math.sin(E)*y,S=Math.cos(E)*y,o.push(x,0,S),u.push(g.r,g.g,g.b)}}const c=new Sn;c.setAttribute("position",new Jt(o,3)),c.setAttribute("color",new Jt(u,3));const f=new Ts({vertexColors:!0,toneMapped:!1});super(c,f),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const jM=new X,Jm=new X,XM=new X;class q4 extends Hn{constructor(e,t,r){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,this.type="DirectionalLightHelper",t===void 0&&(t=1);let i=new Sn;i.setAttribute("position",new Jt([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const s=new Ts({fog:!1,toneMapped:!1});this.lightPlane=new bu(i,s),this.add(this.lightPlane),i=new Sn,i.setAttribute("position",new Jt([0,0,0,0,0,1],3)),this.targetLine=new bu(i,s),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),jM.setFromMatrixPosition(this.light.matrixWorld),Jm.setFromMatrixPosition(this.light.target.matrixWorld),XM.subVectors(Jm,jM),this.lightPlane.lookAt(Jm),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Jm),this.targetLine.scale.z=XM.length()}}const Km=new X,zi=new r0;class Y4 extends Wo{constructor(e){const t=new Sn,r=new Ts({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],s=[],a={};o("n1","n2"),o("n2","n4"),o("n4","n3"),o("n3","n1"),o("f1","f2"),o("f2","f4"),o("f4","f3"),o("f3","f1"),o("n1","f1"),o("n2","f2"),o("n3","f3"),o("n4","f4"),o("p","n1"),o("p","n2"),o("p","n3"),o("p","n4"),o("u1","u2"),o("u2","u3"),o("u3","u1"),o("c","t"),o("p","c"),o("cn1","cn2"),o("cn3","cn4"),o("cf1","cf2"),o("cf3","cf4");function o(_,E){u(_),u(E)}function u(_){i.push(0,0,0),s.push(0,0,0),a[_]===void 0&&(a[_]=[]),a[_].push(i.length/3-1)}t.setAttribute("position",new Jt(i,3)),t.setAttribute("color",new Jt(s,3)),super(t,r),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update();const c=new jt(16755200),f=new jt(16711680),m=new jt(43775),g=new jt(16777215),y=new jt(3355443);this.setColors(c,f,m,g,y)}setColors(e,t,r,i,s){const o=this.geometry.getAttribute("color");return o.setXYZ(0,e.r,e.g,e.b),o.setXYZ(1,e.r,e.g,e.b),o.setXYZ(2,e.r,e.g,e.b),o.setXYZ(3,e.r,e.g,e.b),o.setXYZ(4,e.r,e.g,e.b),o.setXYZ(5,e.r,e.g,e.b),o.setXYZ(6,e.r,e.g,e.b),o.setXYZ(7,e.r,e.g,e.b),o.setXYZ(8,e.r,e.g,e.b),o.setXYZ(9,e.r,e.g,e.b),o.setXYZ(10,e.r,e.g,e.b),o.setXYZ(11,e.r,e.g,e.b),o.setXYZ(12,e.r,e.g,e.b),o.setXYZ(13,e.r,e.g,e.b),o.setXYZ(14,e.r,e.g,e.b),o.setXYZ(15,e.r,e.g,e.b),o.setXYZ(16,e.r,e.g,e.b),o.setXYZ(17,e.r,e.g,e.b),o.setXYZ(18,e.r,e.g,e.b),o.setXYZ(19,e.r,e.g,e.b),o.setXYZ(20,e.r,e.g,e.b),o.setXYZ(21,e.r,e.g,e.b),o.setXYZ(22,e.r,e.g,e.b),o.setXYZ(23,e.r,e.g,e.b),o.setXYZ(24,t.r,t.g,t.b),o.setXYZ(25,t.r,t.g,t.b),o.setXYZ(26,t.r,t.g,t.b),o.setXYZ(27,t.r,t.g,t.b),o.setXYZ(28,t.r,t.g,t.b),o.setXYZ(29,t.r,t.g,t.b),o.setXYZ(30,t.r,t.g,t.b),o.setXYZ(31,t.r,t.g,t.b),o.setXYZ(32,r.r,r.g,r.b),o.setXYZ(33,r.r,r.g,r.b),o.setXYZ(34,r.r,r.g,r.b),o.setXYZ(35,r.r,r.g,r.b),o.setXYZ(36,r.r,r.g,r.b),o.setXYZ(37,r.r,r.g,r.b),o.setXYZ(38,i.r,i.g,i.b),o.setXYZ(39,i.r,i.g,i.b),o.setXYZ(40,s.r,s.g,s.b),o.setXYZ(41,s.r,s.g,s.b),o.setXYZ(42,s.r,s.g,s.b),o.setXYZ(43,s.r,s.g,s.b),o.setXYZ(44,s.r,s.g,s.b),o.setXYZ(45,s.r,s.g,s.b),o.setXYZ(46,s.r,s.g,s.b),o.setXYZ(47,s.r,s.g,s.b),o.setXYZ(48,s.r,s.g,s.b),o.setXYZ(49,s.r,s.g,s.b),o.needsUpdate=!0,this}update(){const e=this.geometry,t=this.pointMap,r=1,i=1;let s,a;if(zi.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),this.camera.reversedDepth===!0)s=1,a=0;else if(this.camera.coordinateSystem===oa)s=-1,a=1;else if(this.camera.coordinateSystem===Uf)s=0,a=1;else throw new Error("THREE.CameraHelper.update(): Invalid coordinate system: "+this.camera.coordinateSystem);Yi("c",t,e,zi,0,0,s),Yi("t",t,e,zi,0,0,a),Yi("n1",t,e,zi,-r,-i,s),Yi("n2",t,e,zi,r,-i,s),Yi("n3",t,e,zi,-r,i,s),Yi("n4",t,e,zi,r,i,s),Yi("f1",t,e,zi,-r,-i,a),Yi("f2",t,e,zi,r,-i,a),Yi("f3",t,e,zi,-r,i,a),Yi("f4",t,e,zi,r,i,a),Yi("u1",t,e,zi,r*.7,i*1.1,s),Yi("u2",t,e,zi,-r*.7,i*1.1,s),Yi("u3",t,e,zi,0,i*2,s),Yi("cf1",t,e,zi,-r,0,a),Yi("cf2",t,e,zi,r,0,a),Yi("cf3",t,e,zi,0,-i,a),Yi("cf4",t,e,zi,0,i,a),Yi("cn1",t,e,zi,-r,0,s),Yi("cn2",t,e,zi,r,0,s),Yi("cn3",t,e,zi,0,-i,s),Yi("cn4",t,e,zi,0,i,s),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Yi(n,e,t,r,i,s,a){Km.set(i,s,a).unproject(r);const o=e[n];if(o!==void 0){const u=t.getAttribute("position");for(let c=0,f=o.length;c<f;c++)u.setXYZ(o[c],Km.x,Km.y,Km.z)}}const Qm=new Nr;class Z4 extends Wo{constructor(e,t=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),s=new Sn;s.setIndex(new jn(r,1)),s.setAttribute("position",new jn(i,3)),super(s,new Ts({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(){if(this.object!==void 0&&Qm.setFromObject(this.object),Qm.isEmpty())return;const e=Qm.min,t=Qm.max,r=this.geometry.attributes.position,i=r.array;i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=e.x,i[4]=t.y,i[5]=t.z,i[6]=e.x,i[7]=e.y,i[8]=t.z,i[9]=t.x,i[10]=e.y,i[11]=t.z,i[12]=t.x,i[13]=t.y,i[14]=e.z,i[15]=e.x,i[16]=t.y,i[17]=e.z,i[18]=e.x,i[19]=e.y,i[20]=e.z,i[21]=t.x,i[22]=e.y,i[23]=e.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class J4 extends Wo{constructor(e,t=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],s=new Sn;s.setIndex(new jn(r,1)),s.setAttribute("position",new Jt(i,3)),super(s,new Ts({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class K4 extends bu{constructor(e,t=1,r=16776960){const i=r,s=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],a=new Sn;a.setAttribute("position",new Jt(s,3)),a.computeBoundingSphere(),super(a,new Ts({color:i,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const o=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],u=new Sn;u.setAttribute("position",new Jt(o,3)),u.computeBoundingSphere(),this.add(new pi(u,new Ho({color:i,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const qM=new X;let $m,Ly;class Q4 extends Hn{constructor(e=new X(0,0,1),t=new X(0,0,0),r=1,i=16776960,s=r*.2,a=s*.2){super(),this.type="ArrowHelper",$m===void 0&&($m=new Sn,$m.setAttribute("position",new Jt([0,0,0,0,1,0],3)),Ly=new l0(.5,1,5,1),Ly.translate(0,-.5,0)),this.position.copy(t),this.line=new bu($m,new Ts({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new pi(Ly,new Ho({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(r,s,a)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{qM.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(qM,t)}}setLength(e,t=e*.2,r=t*.2){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(r,t,r),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class $4 extends Wo{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],r=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],i=new Sn;i.setAttribute("position",new Jt(t,3)),i.setAttribute("color",new Jt(r,3));const s=new Ts({vertexColors:!0,toneMapped:!1});super(i,s),this.type="AxesHelper"}setColors(e,t,r){const i=new jt,s=this.geometry.attributes.color.array;return i.set(e),i.toArray(s,0),i.toArray(s,3),i.set(t),i.toArray(s,6),i.toArray(s,9),i.set(r),i.toArray(s,12),i.toArray(s,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class eP{constructor(){this.type="ShapePath",this.color=new jt,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new vv,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,r,i){return this.currentPath.quadraticCurveTo(e,t,r,i),this}bezierCurveTo(e,t,r,i,s,a){return this.currentPath.bezierCurveTo(e,t,r,i,s,a),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(S){const T=[];for(let A=0,P=S.length;A<P;A++){const L=S[A],D=new Vc;D.curves=L.curves,T.push(D)}return T}function r(S,T){const A=T.length;let P=!1;for(let L=A-1,D=0;D<A;L=D++){let F=T[L],k=T[D],R=k.x-F.x,U=k.y-F.y;if(Math.abs(U)>Number.EPSILON){if(U<0&&(F=T[D],R=-R,k=T[L],U=-U),S.y<F.y||S.y>k.y)continue;if(S.y===F.y){if(S.x===F.x)return!0}else{const V=U*(S.x-F.x)-R*(S.y-F.y);if(V===0)return!0;if(V<0)continue;P=!P}}else{if(S.y!==F.y)continue;if(k.x<=S.x&&S.x<=F.x||F.x<=S.x&&S.x<=k.x)return!0}}return P}const i=lo.isClockWise,s=this.subPaths;if(s.length===0)return[];let a,o,u;const c=[];if(s.length===1)return o=s[0],u=new Vc,u.curves=o.curves,c.push(u),c;let f=!i(s[0].getPoints());f=e?!f:f;const m=[],g=[];let y=[],_=0,E;g[_]=void 0,y[_]=[];for(let S=0,T=s.length;S<T;S++)o=s[S],E=o.getPoints(),a=i(E),a=e?!a:a,a?(!f&&g[_]&&_++,g[_]={s:new Vc,p:E},g[_].s.curves=o.curves,f&&_++,y[_]=[]):y[_].push({h:o,p:E[0]});if(!g[0])return t(s);if(g.length>1){let S=!1,T=0;for(let A=0,P=g.length;A<P;A++)m[A]=[];for(let A=0,P=g.length;A<P;A++){const L=y[A];for(let D=0;D<L.length;D++){const F=L[D];let k=!0;for(let R=0;R<g.length;R++)r(F.p,g[R].p)&&(A!==R&&T++,k?(k=!1,m[R].push(F)):S=!0);k&&m[A].push(F)}}T>0&&S===!1&&(y=m)}let x;for(let S=0,T=g.length;S<T;S++){u=g[S].s,c.push(u),x=y[S];for(let A=0,P=x.length;A<P;A++)u.holes.push(x[A].h)}return c}}class tP extends Vo{constructor(e,t=null){super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(e){if(e===void 0){Ft("Controls: connect() now requires an element.");return}this.domElement!==null&&this.disconnect(),this.domElement=e}disconnect(){}dispose(){}update(){}}function nP(n,e){const t=n.image&&n.image.width?n.image.width/n.image.height:1;return t>e?(n.repeat.x=1,n.repeat.y=t/e,n.offset.x=0,n.offset.y=(1-n.repeat.y)/2):(n.repeat.x=e/t,n.repeat.y=1,n.offset.x=(1-n.repeat.x)/2,n.offset.y=0),n}function iP(n,e){const t=n.image&&n.image.width?n.image.width/n.image.height:1;return t>e?(n.repeat.x=e/t,n.repeat.y=1,n.offset.x=(1-n.repeat.x)/2,n.offset.y=0):(n.repeat.x=1,n.repeat.y=t/e,n.offset.x=0,n.offset.y=(1-n.repeat.y)/2),n}function rP(n){return n.repeat.x=1,n.repeat.y=1,n.offset.x=0,n.offset.y=0,n}function M_(n,e,t,r){const i=sP(r);switch(t){case K_:return n*e;case n0:return n*e/i.components*i.byteLength;case i0:return n*e/i.components*i.byteLength;case jc:return n*e*2/i.components*i.byteLength;case Fv:return n*e*2/i.components*i.byteLength;case Q_:return n*e*3/i.components*i.byteLength;case Ki:return n*e*4/i.components*i.byteLength;case Ov:return n*e*4/i.components*i.byteLength;case gp:case vp:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case yp:case _p:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case Fg:case kg:return Math.max(n,16)*Math.max(e,8)/4;case Ug:case Og:return Math.max(n,8)*Math.max(e,8)/2;case zg:case Bg:case Vg:case Hg:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case Gg:case Wg:case jg:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case Xg:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case qg:return Math.floor((n+4)/5)*Math.floor((e+3)/4)*16;case Yg:return Math.floor((n+4)/5)*Math.floor((e+4)/5)*16;case Zg:return Math.floor((n+5)/6)*Math.floor((e+4)/5)*16;case Jg:return Math.floor((n+5)/6)*Math.floor((e+5)/6)*16;case Kg:return Math.floor((n+7)/8)*Math.floor((e+4)/5)*16;case Qg:return Math.floor((n+7)/8)*Math.floor((e+5)/6)*16;case $g:return Math.floor((n+7)/8)*Math.floor((e+7)/8)*16;case ev:return Math.floor((n+9)/10)*Math.floor((e+4)/5)*16;case tv:return Math.floor((n+9)/10)*Math.floor((e+5)/6)*16;case nv:return Math.floor((n+9)/10)*Math.floor((e+7)/8)*16;case iv:return Math.floor((n+9)/10)*Math.floor((e+9)/10)*16;case rv:return Math.floor((n+11)/12)*Math.floor((e+9)/10)*16;case sv:return Math.floor((n+11)/12)*Math.floor((e+11)/12)*16;case av:case ov:case lv:return Math.ceil(n/4)*Math.ceil(e/4)*16;case uv:case cv:return Math.ceil(n/4)*Math.ceil(e/4)*8;case hv:case fv:return Math.ceil(n/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function sP(n){switch(n){case Rr:case Lv:return{byteLength:1,components:1};case Nf:case Nv:case Vi:return{byteLength:2,components:1};case Dv:case Uv:return{byteLength:2,components:4};case ca:case t0:case bi:return{byteLength:4,components:1};case Z_:case J_:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${n}.`)}class aP{static contain(e,t){return nP(e,t)}static cover(e,t){return iP(e,t)}static fill(e){return rP(e)}static getByteLength(e,t,r,i){return M_(e,t,r,i)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:$p}}));typeof window<"u"&&(window.__THREE__?Ft("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=$p);function u3(){let n=null,e=!1,t=null,r=null;function i(s,a){t(s,a),r=n.requestAnimationFrame(i)}return{start:function(){e!==!0&&t!==null&&(r=n.requestAnimationFrame(i),e=!0)},stop:function(){n.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){n=s}}}function oP(n){const e=new WeakMap;function t(o,u){const c=o.array,f=o.usage,m=c.byteLength,g=n.createBuffer();n.bindBuffer(u,g),n.bufferData(u,c,f),o.onUploadCallback();let y;if(c instanceof Float32Array)y=n.FLOAT;else if(typeof Float16Array<"u"&&c instanceof Float16Array)y=n.HALF_FLOAT;else if(c instanceof Uint16Array)o.isFloat16BufferAttribute?y=n.HALF_FLOAT:y=n.UNSIGNED_SHORT;else if(c instanceof Int16Array)y=n.SHORT;else if(c instanceof Uint32Array)y=n.UNSIGNED_INT;else if(c instanceof Int32Array)y=n.INT;else if(c instanceof Int8Array)y=n.BYTE;else if(c instanceof Uint8Array)y=n.UNSIGNED_BYTE;else if(c instanceof Uint8ClampedArray)y=n.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+c);return{buffer:g,type:y,bytesPerElement:c.BYTES_PER_ELEMENT,version:o.version,size:m}}function r(o,u,c){const f=u.array,m=u.updateRanges;if(n.bindBuffer(c,o),m.length===0)n.bufferSubData(c,0,f);else{m.sort((y,_)=>y.start-_.start);let g=0;for(let y=1;y<m.length;y++){const _=m[g],E=m[y];E.start<=_.start+_.count+1?_.count=Math.max(_.count,E.start+E.count-_.start):(++g,m[g]=E)}m.length=g+1;for(let y=0,_=m.length;y<_;y++){const E=m[y];n.bufferSubData(c,E.start*f.BYTES_PER_ELEMENT,f,E.start,E.count)}u.clearUpdateRanges()}u.onUploadCallback()}function i(o){return o.isInterleavedBufferAttribute&&(o=o.data),e.get(o)}function s(o){o.isInterleavedBufferAttribute&&(o=o.data);const u=e.get(o);u&&(n.deleteBuffer(u.buffer),e.delete(o))}function a(o,u){if(o.isInterleavedBufferAttribute&&(o=o.data),o.isGLBufferAttribute){const f=e.get(o);(!f||f.version<o.version)&&e.set(o,{buffer:o.buffer,type:o.type,bytesPerElement:o.elementSize,version:o.version});return}const c=e.get(o);if(c===void 0)e.set(o,t(o,u));else if(c.version<o.version){if(c.size!==o.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");r(c.buffer,o,u),c.version=o.version}}return{get:i,remove:s,update:a}}var lP=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,uP=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,cP=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,hP=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,fP=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,dP=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,pP=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,mP=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,gP=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,vP=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,yP=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,_P=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,xP=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,SP=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,MP=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,wP=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,EP=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,TP=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,bP=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,AP=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,CP=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,PP=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,RP=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,IP=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,LP=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,NP=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,DP=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,UP=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,FP=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,OP=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,kP="gl_FragColor = linearToOutputTexel( gl_FragColor );",zP=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,BP=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,GP=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
#endif`,VP=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,HP=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,WP=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,jP=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,XP=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,qP=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,YP=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,ZP=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,JP=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,KP=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,QP=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,$P=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,eR=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, pow4( roughness ) ) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,tR=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,nR=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,iR=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,rR=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,sR=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.diffuseContribution = diffuseColor.rgb * ( 1.0 - metalnessFactor );
material.metalness = metalnessFactor;
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor;
	material.specularColorBlended = mix( material.specularColor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = vec3( 0.04 );
	material.specularColorBlended = mix( material.specularColor, diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.0001, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,aR=`uniform sampler2D dfgLUT;
struct PhysicalMaterial {
	vec3 diffuseColor;
	vec3 diffuseContribution;
	vec3 specularColor;
	vec3 specularColorBlended;
	float roughness;
	float metalness;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
		vec3 iridescenceFresnelDielectric;
		vec3 iridescenceFresnelMetallic;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return v;
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColorBlended;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transpose( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float rInv = 1.0 / ( roughness + 0.1 );
	float a = -1.9362 + 1.0678 * roughness + 0.4573 * r2 - 0.8469 * rInv;
	float b = -0.6014 + 0.5538 * roughness - 0.4670 * r2 - 0.1255 * rInv;
	float DG = exp( a * dotNV + b );
	return saturate( DG );
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 fab = texture2D( dfgLUT, vec2( roughness, dotNV ) ).rg;
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 fab = texture2D( dfgLUT, vec2( roughness, dotNV ) ).rg;
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
vec3 BRDF_GGX_Multiscatter( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 singleScatter = BRDF_GGX( lightDir, viewDir, normal, material );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 dfgV = texture2D( dfgLUT, vec2( material.roughness, dotNV ) ).rg;
	vec2 dfgL = texture2D( dfgLUT, vec2( material.roughness, dotNL ) ).rg;
	vec3 FssEss_V = material.specularColorBlended * dfgV.x + material.specularF90 * dfgV.y;
	vec3 FssEss_L = material.specularColorBlended * dfgL.x + material.specularF90 * dfgL.y;
	float Ess_V = dfgV.x + dfgV.y;
	float Ess_L = dfgL.x + dfgL.y;
	float Ems_V = 1.0 - Ess_V;
	float Ems_L = 1.0 - Ess_L;
	vec3 Favg = material.specularColorBlended + ( 1.0 - material.specularColorBlended ) * 0.047619;
	vec3 Fms = FssEss_V * FssEss_L * Favg / ( 1.0 - Ems_V * Ems_L * Favg + EPSILON );
	float compensationFactor = Ems_V * Ems_L;
	vec3 multiScatter = Fms * compensationFactor;
	return singleScatter + multiScatter;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColorBlended * t2.x + ( vec3( 1.0 ) - material.specularColorBlended ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseContribution * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
 
 		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
 
 		float sheenAlbedoV = IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
 		float sheenAlbedoL = IBLSheenBRDF( geometryNormal, directLight.direction, material.sheenRoughness );
 
 		float sheenEnergyComp = 1.0 - max3( material.sheenColor ) * max( sheenAlbedoV, sheenAlbedoL );
 
 		irradiance *= sheenEnergyComp;
 
 	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX_Multiscatter( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseContribution );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 diffuse = irradiance * BRDF_Lambert( material.diffuseContribution );
	#ifdef USE_SHEEN
		float sheenAlbedo = IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
		float sheenEnergyComp = 1.0 - max3( material.sheenColor ) * sheenAlbedo;
		diffuse *= sheenEnergyComp;
	#endif
	reflectedLight.indirectDiffuse += diffuse;
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness ) * RECIPROCAL_PI;
 	#endif
	vec3 singleScatteringDielectric = vec3( 0.0 );
	vec3 multiScatteringDielectric = vec3( 0.0 );
	vec3 singleScatteringMetallic = vec3( 0.0 );
	vec3 multiScatteringMetallic = vec3( 0.0 );
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnelDielectric, material.roughness, singleScatteringDielectric, multiScatteringDielectric );
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.diffuseColor, material.specularF90, material.iridescence, material.iridescenceFresnelMetallic, material.roughness, singleScatteringMetallic, multiScatteringMetallic );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScatteringDielectric, multiScatteringDielectric );
		computeMultiscattering( geometryNormal, geometryViewDir, material.diffuseColor, material.specularF90, material.roughness, singleScatteringMetallic, multiScatteringMetallic );
	#endif
	vec3 singleScattering = mix( singleScatteringDielectric, singleScatteringMetallic, material.metalness );
	vec3 multiScattering = mix( multiScatteringDielectric, multiScatteringMetallic, material.metalness );
	vec3 totalScatteringDielectric = singleScatteringDielectric + multiScatteringDielectric;
	vec3 diffuse = material.diffuseContribution * ( 1.0 - totalScatteringDielectric );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	vec3 indirectSpecular = radiance * singleScattering;
	indirectSpecular += multiScattering * cosineWeightedIrradiance;
	vec3 indirectDiffuse = diffuse * cosineWeightedIrradiance;
	#ifdef USE_SHEEN
		float sheenAlbedo = IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
		float sheenEnergyComp = 1.0 - max3( material.sheenColor ) * sheenAlbedo;
		indirectSpecular *= sheenEnergyComp;
		indirectDiffuse *= sheenEnergyComp;
	#endif
	reflectedLight.indirectSpecular += indirectSpecular;
	reflectedLight.indirectDiffuse += indirectDiffuse;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,oR=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnelDielectric = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceFresnelMetallic = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.diffuseColor );
		material.iridescenceFresnel = mix( material.iridescenceFresnelDielectric, material.iridescenceFresnelMetallic, material.metalness );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS ) && ( defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_BASIC ) )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lR=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,uR=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,cR=`#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,hR=`#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,fR=`#ifdef USE_LOGARITHMIC_DEPTH_BUFFER
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,dR=`#ifdef USE_LOGARITHMIC_DEPTH_BUFFER
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,pR=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,mR=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,gR=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,vR=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,yR=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,_R=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,xR=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,SR=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,MR=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,wR=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,ER=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,TR=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,bR=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,AR=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,CR=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,PR=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,RR=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,IR=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,LR=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,NR=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,DR=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,UR=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,FR=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,OR=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,kR=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,zR=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,BR=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,GR=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,VR=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,HR=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#if defined( SHADOWMAP_TYPE_PCF )
			uniform sampler2DShadow directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		#else
			uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		#endif
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		#if defined( SHADOWMAP_TYPE_PCF )
			uniform sampler2DShadow spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		#else
			uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		#endif
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#if defined( SHADOWMAP_TYPE_PCF )
			uniform samplerCubeShadow pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		#elif defined( SHADOWMAP_TYPE_BASIC )
			uniform samplerCube pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		#endif
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	#if defined( SHADOWMAP_TYPE_PCF )
		float interleavedGradientNoise( vec2 position ) {
			return fract( 52.9829189 * fract( dot( position, vec2( 0.06711056, 0.00583715 ) ) ) );
		}
		vec2 vogelDiskSample( int sampleIndex, int samplesCount, float phi ) {
			const float goldenAngle = 2.399963229728653;
			float r = sqrt( ( float( sampleIndex ) + 0.5 ) / float( samplesCount ) );
			float theta = float( sampleIndex ) * goldenAngle + phi;
			return vec2( cos( theta ), sin( theta ) ) * r;
		}
	#endif
	#if defined( SHADOWMAP_TYPE_PCF )
		float getShadow( sampler2DShadow shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
			float shadow = 1.0;
			shadowCoord.xyz /= shadowCoord.w;
			shadowCoord.z += shadowBias;
			bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
			bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
			if ( frustumTest ) {
				vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
				float radius = shadowRadius * texelSize.x;
				float phi = interleavedGradientNoise( gl_FragCoord.xy ) * 6.28318530718;
				shadow = (
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 0, 5, phi ) * radius, shadowCoord.z ) ) +
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 1, 5, phi ) * radius, shadowCoord.z ) ) +
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 2, 5, phi ) * radius, shadowCoord.z ) ) +
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 3, 5, phi ) * radius, shadowCoord.z ) ) +
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 4, 5, phi ) * radius, shadowCoord.z ) )
				) * 0.2;
			}
			return mix( 1.0, shadow, shadowIntensity );
		}
	#elif defined( SHADOWMAP_TYPE_VSM )
		float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
			float shadow = 1.0;
			shadowCoord.xyz /= shadowCoord.w;
			shadowCoord.z += shadowBias;
			bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
			bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
			if ( frustumTest ) {
				vec2 distribution = texture2D( shadowMap, shadowCoord.xy ).rg;
				float mean = distribution.x;
				float variance = distribution.y * distribution.y;
				#ifdef USE_REVERSED_DEPTH_BUFFER
					float hard_shadow = step( mean, shadowCoord.z );
				#else
					float hard_shadow = step( shadowCoord.z, mean );
				#endif
				if ( hard_shadow == 1.0 ) {
					shadow = 1.0;
				} else {
					variance = max( variance, 0.0000001 );
					float d = shadowCoord.z - mean;
					float p_max = variance / ( variance + d * d );
					p_max = clamp( ( p_max - 0.3 ) / 0.65, 0.0, 1.0 );
					shadow = max( hard_shadow, p_max );
				}
			}
			return mix( 1.0, shadow, shadowIntensity );
		}
	#else
		float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
			float shadow = 1.0;
			shadowCoord.xyz /= shadowCoord.w;
			shadowCoord.z += shadowBias;
			bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
			bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
			if ( frustumTest ) {
				float depth = texture2D( shadowMap, shadowCoord.xy ).r;
				#ifdef USE_REVERSED_DEPTH_BUFFER
					shadow = step( depth, shadowCoord.z );
				#else
					shadow = step( shadowCoord.z, depth );
				#endif
			}
			return mix( 1.0, shadow, shadowIntensity );
		}
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#if defined( SHADOWMAP_TYPE_PCF )
	float getPointShadow( samplerCubeShadow shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		vec3 bd3D = normalize( lightToPosition );
		vec3 absVec = abs( lightToPosition );
		float viewSpaceZ = max( max( absVec.x, absVec.y ), absVec.z );
		if ( viewSpaceZ - shadowCameraFar <= 0.0 && viewSpaceZ - shadowCameraNear >= 0.0 ) {
			float dp = ( shadowCameraFar * ( viewSpaceZ - shadowCameraNear ) ) / ( viewSpaceZ * ( shadowCameraFar - shadowCameraNear ) );
			dp += shadowBias;
			float texelSize = shadowRadius / shadowMapSize.x;
			vec3 absDir = abs( bd3D );
			vec3 tangent = absDir.x > absDir.z ? vec3( 0.0, 1.0, 0.0 ) : vec3( 1.0, 0.0, 0.0 );
			tangent = normalize( cross( bd3D, tangent ) );
			vec3 bitangent = cross( bd3D, tangent );
			float phi = interleavedGradientNoise( gl_FragCoord.xy ) * 6.28318530718;
			shadow = (
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 0, 5, phi ).x + bitangent * vogelDiskSample( 0, 5, phi ).y ) * texelSize, dp ) ) +
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 1, 5, phi ).x + bitangent * vogelDiskSample( 1, 5, phi ).y ) * texelSize, dp ) ) +
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 2, 5, phi ).x + bitangent * vogelDiskSample( 2, 5, phi ).y ) * texelSize, dp ) ) +
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 3, 5, phi ).x + bitangent * vogelDiskSample( 3, 5, phi ).y ) * texelSize, dp ) ) +
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 4, 5, phi ).x + bitangent * vogelDiskSample( 4, 5, phi ).y ) * texelSize, dp ) )
			) * 0.2;
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	#elif defined( SHADOWMAP_TYPE_BASIC )
	float getPointShadow( samplerCube shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		vec3 bd3D = normalize( lightToPosition );
		vec3 absVec = abs( lightToPosition );
		float viewSpaceZ = max( max( absVec.x, absVec.y ), absVec.z );
		if ( viewSpaceZ - shadowCameraFar <= 0.0 && viewSpaceZ - shadowCameraNear >= 0.0 ) {
			float dp = ( shadowCameraFar * ( viewSpaceZ - shadowCameraNear ) ) / ( viewSpaceZ * ( shadowCameraFar - shadowCameraNear ) );
			dp += shadowBias;
			float depth = textureCube( shadowMap, bd3D ).r;
			#ifdef USE_REVERSED_DEPTH_BUFFER
				shadow = step( depth, dp );
			#else
				shadow = step( dp, depth );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	#endif
	#endif
#endif`,WR=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,jR=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,XR=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0 && ( defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_BASIC ) )
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,qR=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,YR=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,ZR=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,JR=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,KR=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,QR=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,$R=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,eI=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,tI=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseContribution, material.specularColorBlended, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,nI=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,iI=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,rI=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,sI=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,aI=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const oI=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,lI=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,uI=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,cI=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,hI=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,fI=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,dI=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,pI=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	#ifdef USE_REVERSED_DEPTH_BUFFER
		float fragCoordZ = vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ];
	#else
		float fragCoordZ = 0.5 * vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ] + 0.5;
	#endif
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,mI=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,gI=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = vec4( dist, 0.0, 0.0, 1.0 );
}`,vI=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,yI=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,_I=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,xI=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,SI=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,MI=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,wI=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,EI=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,TI=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,bI=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,AI=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,CI=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( normalize( normal ) * 0.5 + 0.5, diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,PI=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,RI=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,II=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,LI=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
 
		outgoingLight = outgoingLight + sheenSpecularDirect + sheenSpecularIndirect;
 
 	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,NI=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,DI=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,UI=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,FI=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,OI=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,kI=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,zI=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,BI=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Pn={alphahash_fragment:lP,alphahash_pars_fragment:uP,alphamap_fragment:cP,alphamap_pars_fragment:hP,alphatest_fragment:fP,alphatest_pars_fragment:dP,aomap_fragment:pP,aomap_pars_fragment:mP,batching_pars_vertex:gP,batching_vertex:vP,begin_vertex:yP,beginnormal_vertex:_P,bsdfs:xP,iridescence_fragment:SP,bumpmap_pars_fragment:MP,clipping_planes_fragment:wP,clipping_planes_pars_fragment:EP,clipping_planes_pars_vertex:TP,clipping_planes_vertex:bP,color_fragment:AP,color_pars_fragment:CP,color_pars_vertex:PP,color_vertex:RP,common:IP,cube_uv_reflection_fragment:LP,defaultnormal_vertex:NP,displacementmap_pars_vertex:DP,displacementmap_vertex:UP,emissivemap_fragment:FP,emissivemap_pars_fragment:OP,colorspace_fragment:kP,colorspace_pars_fragment:zP,envmap_fragment:BP,envmap_common_pars_fragment:GP,envmap_pars_fragment:VP,envmap_pars_vertex:HP,envmap_physical_pars_fragment:eR,envmap_vertex:WP,fog_vertex:jP,fog_pars_vertex:XP,fog_fragment:qP,fog_pars_fragment:YP,gradientmap_pars_fragment:ZP,lightmap_pars_fragment:JP,lights_lambert_fragment:KP,lights_lambert_pars_fragment:QP,lights_pars_begin:$P,lights_toon_fragment:tR,lights_toon_pars_fragment:nR,lights_phong_fragment:iR,lights_phong_pars_fragment:rR,lights_physical_fragment:sR,lights_physical_pars_fragment:aR,lights_fragment_begin:oR,lights_fragment_maps:lR,lights_fragment_end:uR,logdepthbuf_fragment:cR,logdepthbuf_pars_fragment:hR,logdepthbuf_pars_vertex:fR,logdepthbuf_vertex:dR,map_fragment:pR,map_pars_fragment:mR,map_particle_fragment:gR,map_particle_pars_fragment:vR,metalnessmap_fragment:yR,metalnessmap_pars_fragment:_R,morphinstance_vertex:xR,morphcolor_vertex:SR,morphnormal_vertex:MR,morphtarget_pars_vertex:wR,morphtarget_vertex:ER,normal_fragment_begin:TR,normal_fragment_maps:bR,normal_pars_fragment:AR,normal_pars_vertex:CR,normal_vertex:PR,normalmap_pars_fragment:RR,clearcoat_normal_fragment_begin:IR,clearcoat_normal_fragment_maps:LR,clearcoat_pars_fragment:NR,iridescence_pars_fragment:DR,opaque_fragment:UR,packing:FR,premultiplied_alpha_fragment:OR,project_vertex:kR,dithering_fragment:zR,dithering_pars_fragment:BR,roughnessmap_fragment:GR,roughnessmap_pars_fragment:VR,shadowmap_pars_fragment:HR,shadowmap_pars_vertex:WR,shadowmap_vertex:jR,shadowmask_pars_fragment:XR,skinbase_vertex:qR,skinning_pars_vertex:YR,skinning_vertex:ZR,skinnormal_vertex:JR,specularmap_fragment:KR,specularmap_pars_fragment:QR,tonemapping_fragment:$R,tonemapping_pars_fragment:eI,transmission_fragment:tI,transmission_pars_fragment:nI,uv_pars_fragment:iI,uv_pars_vertex:rI,uv_vertex:sI,worldpos_vertex:aI,background_vert:oI,background_frag:lI,backgroundCube_vert:uI,backgroundCube_frag:cI,cube_vert:hI,cube_frag:fI,depth_vert:dI,depth_frag:pI,distance_vert:mI,distance_frag:gI,equirect_vert:vI,equirect_frag:yI,linedashed_vert:_I,linedashed_frag:xI,meshbasic_vert:SI,meshbasic_frag:MI,meshlambert_vert:wI,meshlambert_frag:EI,meshmatcap_vert:TI,meshmatcap_frag:bI,meshnormal_vert:AI,meshnormal_frag:CI,meshphong_vert:PI,meshphong_frag:RI,meshphysical_vert:II,meshphysical_frag:LI,meshtoon_vert:NI,meshtoon_frag:DI,points_vert:UI,points_frag:FI,shadow_vert:OI,shadow_frag:kI,sprite_vert:zI,sprite_frag:BI},Gt={common:{diffuse:{value:new jt(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Tn},alphaMap:{value:null},alphaMapTransform:{value:new Tn},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Tn}},envmap:{envMap:{value:null},envMapRotation:{value:new Tn},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98},dfgLUT:{value:null}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Tn}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Tn}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Tn},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Tn},normalScale:{value:new ct(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Tn},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Tn}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Tn}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Tn}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new jt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new jt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Tn},alphaTest:{value:0},uvTransform:{value:new Tn}},sprite:{diffuse:{value:new jt(16777215)},opacity:{value:1},center:{value:new ct(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Tn},alphaMap:{value:null},alphaMapTransform:{value:new Tn},alphaTest:{value:0}}},oo={basic:{uniforms:_s([Gt.common,Gt.specularmap,Gt.envmap,Gt.aomap,Gt.lightmap,Gt.fog]),vertexShader:Pn.meshbasic_vert,fragmentShader:Pn.meshbasic_frag},lambert:{uniforms:_s([Gt.common,Gt.specularmap,Gt.envmap,Gt.aomap,Gt.lightmap,Gt.emissivemap,Gt.bumpmap,Gt.normalmap,Gt.displacementmap,Gt.fog,Gt.lights,{emissive:{value:new jt(0)}}]),vertexShader:Pn.meshlambert_vert,fragmentShader:Pn.meshlambert_frag},phong:{uniforms:_s([Gt.common,Gt.specularmap,Gt.envmap,Gt.aomap,Gt.lightmap,Gt.emissivemap,Gt.bumpmap,Gt.normalmap,Gt.displacementmap,Gt.fog,Gt.lights,{emissive:{value:new jt(0)},specular:{value:new jt(1118481)},shininess:{value:30}}]),vertexShader:Pn.meshphong_vert,fragmentShader:Pn.meshphong_frag},standard:{uniforms:_s([Gt.common,Gt.envmap,Gt.aomap,Gt.lightmap,Gt.emissivemap,Gt.bumpmap,Gt.normalmap,Gt.displacementmap,Gt.roughnessmap,Gt.metalnessmap,Gt.fog,Gt.lights,{emissive:{value:new jt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Pn.meshphysical_vert,fragmentShader:Pn.meshphysical_frag},toon:{uniforms:_s([Gt.common,Gt.aomap,Gt.lightmap,Gt.emissivemap,Gt.bumpmap,Gt.normalmap,Gt.displacementmap,Gt.gradientmap,Gt.fog,Gt.lights,{emissive:{value:new jt(0)}}]),vertexShader:Pn.meshtoon_vert,fragmentShader:Pn.meshtoon_frag},matcap:{uniforms:_s([Gt.common,Gt.bumpmap,Gt.normalmap,Gt.displacementmap,Gt.fog,{matcap:{value:null}}]),vertexShader:Pn.meshmatcap_vert,fragmentShader:Pn.meshmatcap_frag},points:{uniforms:_s([Gt.points,Gt.fog]),vertexShader:Pn.points_vert,fragmentShader:Pn.points_frag},dashed:{uniforms:_s([Gt.common,Gt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Pn.linedashed_vert,fragmentShader:Pn.linedashed_frag},depth:{uniforms:_s([Gt.common,Gt.displacementmap]),vertexShader:Pn.depth_vert,fragmentShader:Pn.depth_frag},normal:{uniforms:_s([Gt.common,Gt.bumpmap,Gt.normalmap,Gt.displacementmap,{opacity:{value:1}}]),vertexShader:Pn.meshnormal_vert,fragmentShader:Pn.meshnormal_frag},sprite:{uniforms:_s([Gt.sprite,Gt.fog]),vertexShader:Pn.sprite_vert,fragmentShader:Pn.sprite_frag},background:{uniforms:{uvTransform:{value:new Tn},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Pn.background_vert,fragmentShader:Pn.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Tn}},vertexShader:Pn.backgroundCube_vert,fragmentShader:Pn.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Pn.cube_vert,fragmentShader:Pn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Pn.equirect_vert,fragmentShader:Pn.equirect_frag},distance:{uniforms:_s([Gt.common,Gt.displacementmap,{referencePosition:{value:new X},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Pn.distance_vert,fragmentShader:Pn.distance_frag},shadow:{uniforms:_s([Gt.lights,Gt.fog,{color:{value:new jt(0)},opacity:{value:1}}]),vertexShader:Pn.shadow_vert,fragmentShader:Pn.shadow_frag}};oo.physical={uniforms:_s([oo.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Tn},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Tn},clearcoatNormalScale:{value:new ct(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Tn},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Tn},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Tn},sheen:{value:0},sheenColor:{value:new jt(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Tn},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Tn},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Tn},transmissionSamplerSize:{value:new ct},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Tn},attenuationDistance:{value:0},attenuationColor:{value:new jt(0)},specularColor:{value:new jt(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Tn},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Tn},anisotropyVector:{value:new ct},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Tn}}]),vertexShader:Pn.meshphysical_vert,fragmentShader:Pn.meshphysical_frag};const eg={r:0,b:0,g:0},Ac=new Qi,GI=new vn;function VI(n,e,t,r,i,s,a){const o=new jt(0);let u=s===!0?0:1,c,f,m=null,g=0,y=null;function _(A){let P=A.isScene===!0?A.background:null;return P&&P.isTexture&&(P=(A.backgroundBlurriness>0?t:e).get(P)),P}function E(A){let P=!1;const L=_(A);L===null?S(o,u):L&&L.isColor&&(S(L,1),P=!0);const D=n.xr.getEnvironmentBlendMode();D==="additive"?r.buffers.color.setClear(0,0,0,1,a):D==="alpha-blend"&&r.buffers.color.setClear(0,0,0,0,a),(n.autoClear||P)&&(r.buffers.depth.setTest(!0),r.buffers.depth.setMask(!0),r.buffers.color.setMask(!0),n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil))}function x(A,P){const L=_(P);L&&(L.isCubeTexture||L.mapping===Wf)?(f===void 0&&(f=new pi(new Qc(1,1,1),new Es({name:"BackgroundCubeMaterial",uniforms:kf(oo.backgroundCube.uniforms),vertexShader:oo.backgroundCube.vertexShader,fragmentShader:oo.backgroundCube.fragmentShader,side:Ms,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),f.geometry.deleteAttribute("normal"),f.geometry.deleteAttribute("uv"),f.onBeforeRender=function(D,F,k){this.matrixWorld.copyPosition(k.matrixWorld)},Object.defineProperty(f.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(f)),Ac.copy(P.backgroundRotation),Ac.x*=-1,Ac.y*=-1,Ac.z*=-1,L.isCubeTexture&&L.isRenderTargetTexture===!1&&(Ac.y*=-1,Ac.z*=-1),f.material.uniforms.envMap.value=L,f.material.uniforms.flipEnvMap.value=L.isCubeTexture&&L.isRenderTargetTexture===!1?-1:1,f.material.uniforms.backgroundBlurriness.value=P.backgroundBlurriness,f.material.uniforms.backgroundIntensity.value=P.backgroundIntensity,f.material.uniforms.backgroundRotation.value.setFromMatrix4(GI.makeRotationFromEuler(Ac)),f.material.toneMapped=kn.getTransfer(L.colorSpace)!==Yn,(m!==L||g!==L.version||y!==n.toneMapping)&&(f.material.needsUpdate=!0,m=L,g=L.version,y=n.toneMapping),f.layers.enableAll(),A.unshift(f,f.geometry,f.material,0,0,null)):L&&L.isTexture&&(c===void 0&&(c=new pi(new po(2,2),new Es({name:"BackgroundMaterial",uniforms:kf(oo.background.uniforms),vertexShader:oo.background.vertexShader,fragmentShader:oo.background.fragmentShader,side:Pl,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(c)),c.material.uniforms.t2D.value=L,c.material.uniforms.backgroundIntensity.value=P.backgroundIntensity,c.material.toneMapped=kn.getTransfer(L.colorSpace)!==Yn,L.matrixAutoUpdate===!0&&L.updateMatrix(),c.material.uniforms.uvTransform.value.copy(L.matrix),(m!==L||g!==L.version||y!==n.toneMapping)&&(c.material.needsUpdate=!0,m=L,g=L.version,y=n.toneMapping),c.layers.enableAll(),A.unshift(c,c.geometry,c.material,0,0,null))}function S(A,P){A.getRGB(eg,dE(n)),r.buffers.color.setClear(eg.r,eg.g,eg.b,P,a)}function T(){f!==void 0&&(f.geometry.dispose(),f.material.dispose(),f=void 0),c!==void 0&&(c.geometry.dispose(),c.material.dispose(),c=void 0)}return{getClearColor:function(){return o},setClearColor:function(A,P=1){o.set(A),u=P,S(o,u)},getClearAlpha:function(){return u},setClearAlpha:function(A){u=A,S(o,u)},render:E,addToRenderList:x,dispose:T}}function HI(n,e){const t=n.getParameter(n.MAX_VERTEX_ATTRIBS),r={},i=g(null);let s=i,a=!1;function o(U,V,H,J,$){let ae=!1;const ne=m(J,H,V);s!==ne&&(s=ne,c(s.object)),ae=y(U,J,H,$),ae&&_(U,J,H,$),$!==null&&e.update($,n.ELEMENT_ARRAY_BUFFER),(ae||a)&&(a=!1,P(U,V,H,J),$!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.get($).buffer))}function u(){return n.createVertexArray()}function c(U){return n.bindVertexArray(U)}function f(U){return n.deleteVertexArray(U)}function m(U,V,H){const J=H.wireframe===!0;let $=r[U.id];$===void 0&&($={},r[U.id]=$);let ae=$[V.id];ae===void 0&&(ae={},$[V.id]=ae);let ne=ae[J];return ne===void 0&&(ne=g(u()),ae[J]=ne),ne}function g(U){const V=[],H=[],J=[];for(let $=0;$<t;$++)V[$]=0,H[$]=0,J[$]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:V,enabledAttributes:H,attributeDivisors:J,object:U,attributes:{},index:null}}function y(U,V,H,J){const $=s.attributes,ae=V.attributes;let ne=0;const oe=H.getAttributes();for(const te in oe)if(oe[te].location>=0){const Y=$[te];let z=ae[te];if(z===void 0&&(te==="instanceMatrix"&&U.instanceMatrix&&(z=U.instanceMatrix),te==="instanceColor"&&U.instanceColor&&(z=U.instanceColor)),Y===void 0||Y.attribute!==z||z&&Y.data!==z.data)return!0;ne++}return s.attributesNum!==ne||s.index!==J}function _(U,V,H,J){const $={},ae=V.attributes;let ne=0;const oe=H.getAttributes();for(const te in oe)if(oe[te].location>=0){let Y=ae[te];Y===void 0&&(te==="instanceMatrix"&&U.instanceMatrix&&(Y=U.instanceMatrix),te==="instanceColor"&&U.instanceColor&&(Y=U.instanceColor));const z={};z.attribute=Y,Y&&Y.data&&(z.data=Y.data),$[te]=z,ne++}s.attributes=$,s.attributesNum=ne,s.index=J}function E(){const U=s.newAttributes;for(let V=0,H=U.length;V<H;V++)U[V]=0}function x(U){S(U,0)}function S(U,V){const H=s.newAttributes,J=s.enabledAttributes,$=s.attributeDivisors;H[U]=1,J[U]===0&&(n.enableVertexAttribArray(U),J[U]=1),$[U]!==V&&(n.vertexAttribDivisor(U,V),$[U]=V)}function T(){const U=s.newAttributes,V=s.enabledAttributes;for(let H=0,J=V.length;H<J;H++)V[H]!==U[H]&&(n.disableVertexAttribArray(H),V[H]=0)}function A(U,V,H,J,$,ae,ne){ne===!0?n.vertexAttribIPointer(U,V,H,$,ae):n.vertexAttribPointer(U,V,H,J,$,ae)}function P(U,V,H,J){E();const $=J.attributes,ae=H.getAttributes(),ne=V.defaultAttributeValues;for(const oe in ae){const te=ae[oe];if(te.location>=0){let ie=$[oe];if(ie===void 0&&(oe==="instanceMatrix"&&U.instanceMatrix&&(ie=U.instanceMatrix),oe==="instanceColor"&&U.instanceColor&&(ie=U.instanceColor)),ie!==void 0){const Y=ie.normalized,z=ie.itemSize,K=e.get(ie);if(K===void 0)continue;const le=K.buffer,me=K.type,ve=K.bytesPerElement,re=me===n.INT||me===n.UNSIGNED_INT||ie.gpuType===t0;if(ie.isInterleavedBufferAttribute){const he=ie.data,ye=he.stride,ze=ie.offset;if(he.isInstancedInterleavedBuffer){for(let Ve=0;Ve<te.locationSize;Ve++)S(te.location+Ve,he.meshPerAttribute);U.isInstancedMesh!==!0&&J._maxInstanceCount===void 0&&(J._maxInstanceCount=he.meshPerAttribute*he.count)}else for(let Ve=0;Ve<te.locationSize;Ve++)x(te.location+Ve);n.bindBuffer(n.ARRAY_BUFFER,le);for(let Ve=0;Ve<te.locationSize;Ve++)A(te.location+Ve,z/te.locationSize,me,Y,ye*ve,(ze+z/te.locationSize*Ve)*ve,re)}else{if(ie.isInstancedBufferAttribute){for(let he=0;he<te.locationSize;he++)S(te.location+he,ie.meshPerAttribute);U.isInstancedMesh!==!0&&J._maxInstanceCount===void 0&&(J._maxInstanceCount=ie.meshPerAttribute*ie.count)}else for(let he=0;he<te.locationSize;he++)x(te.location+he);n.bindBuffer(n.ARRAY_BUFFER,le);for(let he=0;he<te.locationSize;he++)A(te.location+he,z/te.locationSize,me,Y,z*ve,z/te.locationSize*he*ve,re)}}else if(ne!==void 0){const Y=ne[oe];if(Y!==void 0)switch(Y.length){case 2:n.vertexAttrib2fv(te.location,Y);break;case 3:n.vertexAttrib3fv(te.location,Y);break;case 4:n.vertexAttrib4fv(te.location,Y);break;default:n.vertexAttrib1fv(te.location,Y)}}}}T()}function L(){k();for(const U in r){const V=r[U];for(const H in V){const J=V[H];for(const $ in J)f(J[$].object),delete J[$];delete V[H]}delete r[U]}}function D(U){if(r[U.id]===void 0)return;const V=r[U.id];for(const H in V){const J=V[H];for(const $ in J)f(J[$].object),delete J[$];delete V[H]}delete r[U.id]}function F(U){for(const V in r){const H=r[V];if(H[U.id]===void 0)continue;const J=H[U.id];for(const $ in J)f(J[$].object),delete J[$];delete H[U.id]}}function k(){R(),a=!0,s!==i&&(s=i,c(s.object))}function R(){i.geometry=null,i.program=null,i.wireframe=!1}return{setup:o,reset:k,resetDefaultState:R,dispose:L,releaseStatesOfGeometry:D,releaseStatesOfProgram:F,initAttributes:E,enableAttribute:x,disableUnusedAttributes:T}}function WI(n,e,t){let r;function i(c){r=c}function s(c,f){n.drawArrays(r,c,f),t.update(f,r,1)}function a(c,f,m){m!==0&&(n.drawArraysInstanced(r,c,f,m),t.update(f,r,m))}function o(c,f,m){if(m===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(r,c,0,f,0,m);let y=0;for(let _=0;_<m;_++)y+=f[_];t.update(y,r,1)}function u(c,f,m,g){if(m===0)return;const y=e.get("WEBGL_multi_draw");if(y===null)for(let _=0;_<c.length;_++)a(c[_],f[_],g[_]);else{y.multiDrawArraysInstancedWEBGL(r,c,0,f,0,g,0,m);let _=0;for(let E=0;E<m;E++)_+=f[E]*g[E];t.update(_,r,1)}}this.setMode=i,this.render=s,this.renderInstances=a,this.renderMultiDraw=o,this.renderMultiDrawInstances=u}function jI(n,e,t,r){let i;function s(){if(i!==void 0)return i;if(e.has("EXT_texture_filter_anisotropic")===!0){const F=e.get("EXT_texture_filter_anisotropic");i=n.getParameter(F.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function a(F){return!(F!==Ki&&r.convert(F)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_FORMAT))}function o(F){const k=F===Vi&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(F!==Rr&&r.convert(F)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_TYPE)&&F!==bi&&!k)}function u(F){if(F==="highp"){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";F="mediump"}return F==="mediump"&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let c=t.precision!==void 0?t.precision:"highp";const f=u(c);f!==c&&(Ft("WebGLRenderer:",c,"not supported, using",f,"instead."),c=f);const m=t.logarithmicDepthBuffer===!0,g=t.reversedDepthBuffer===!0&&e.has("EXT_clip_control"),y=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),_=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),E=n.getParameter(n.MAX_TEXTURE_SIZE),x=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),S=n.getParameter(n.MAX_VERTEX_ATTRIBS),T=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),A=n.getParameter(n.MAX_VARYING_VECTORS),P=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),L=n.getParameter(n.MAX_SAMPLES),D=n.getParameter(n.SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:s,getMaxPrecision:u,textureFormatReadable:a,textureTypeReadable:o,precision:c,logarithmicDepthBuffer:m,reversedDepthBuffer:g,maxTextures:y,maxVertexTextures:_,maxTextureSize:E,maxCubemapSize:x,maxAttributes:S,maxVertexUniforms:T,maxVaryings:A,maxFragmentUniforms:P,maxSamples:L,samples:D}}function XI(n){const e=this;let t=null,r=0,i=!1,s=!1;const a=new pu,o=new Tn,u={value:null,needsUpdate:!1};this.uniform=u,this.numPlanes=0,this.numIntersection=0,this.init=function(m,g){const y=m.length!==0||g||r!==0||i;return i=g,r=m.length,y},this.beginShadows=function(){s=!0,f(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(m,g){t=f(m,g,0)},this.setState=function(m,g,y){const _=m.clippingPlanes,E=m.clipIntersection,x=m.clipShadows,S=n.get(m);if(!i||_===null||_.length===0||s&&!x)s?f(null):c();else{const T=s?0:r,A=T*4;let P=S.clippingState||null;u.value=P,P=f(_,g,A,y);for(let L=0;L!==A;++L)P[L]=t[L];S.clippingState=P,this.numIntersection=E?this.numPlanes:0,this.numPlanes+=T}};function c(){u.value!==t&&(u.value=t,u.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function f(m,g,y,_){const E=m!==null?m.length:0;let x=null;if(E!==0){if(x=u.value,_!==!0||x===null){const S=y+E*4,T=g.matrixWorldInverse;o.getNormalMatrix(T),(x===null||x.length<S)&&(x=new Float32Array(S));for(let A=0,P=y;A!==E;++A,P+=4)a.copy(m[A]).applyMatrix4(T,o),a.normal.toArray(x,P),x[P+3]=a.constant}u.value=x,u.needsUpdate=!0}return e.numPlanes=E,e.numIntersection=0,x}}function qI(n){let e=new WeakMap;function t(a,o){return o===Lf?a.mapping=ho:o===Ip&&(a.mapping=Eu),a}function r(a){if(a&&a.isTexture){const o=a.mapping;if(o===Lf||o===Ip)if(e.has(a)){const u=e.get(a).texture;return t(u,a.mapping)}else{const u=a.image;if(u&&u.height>0){const c=new Hv(u.height);return c.fromEquirectangularTexture(n,a),e.set(a,c),a.addEventListener("dispose",i),t(c.texture,a.mapping)}else return null}}return a}function i(a){const o=a.target;o.removeEventListener("dispose",i);const u=e.get(o);u!==void 0&&(e.delete(o),u.dispose())}function s(){e=new WeakMap}return{get:r,dispose:s}}const _u=4,YM=[.125,.215,.35,.446,.526,.582],Lc=20,YI=256,$d=new th,ZM=new jt;let Ny=null,Dy=0,Uy=0,Fy=!1;const ZI=new X;class w_{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._backgroundBox=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._blurMaterial=null,this._ggxMaterial=null}fromScene(e,t=0,r=.1,i=100,s={}){const{size:a=256,position:o=ZI}=s;Ny=this._renderer.getRenderTarget(),Dy=this._renderer.getActiveCubeFace(),Uy=this._renderer.getActiveMipmapLevel(),Fy=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(a);const u=this._allocateTargets();return u.depthBuffer=!0,this._sceneToCubeUV(e,r,i,u,o),t>0&&this._blur(u,0,0,t),this._applyPMREM(u),this._cleanup(u),u}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=QM(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=KM(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._ggxMaterial!==null&&this._ggxMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodMeshes.length;e++)this._lodMeshes[e].geometry.dispose()}_cleanup(e){this._renderer.setRenderTarget(Ny,Dy,Uy),this._renderer.xr.enabled=Fy,e.scissorTest=!1,df(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===ho||e.mapping===Eu?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Ny=this._renderer.getRenderTarget(),Dy=this._renderer.getActiveCubeFace(),Uy=this._renderer.getActiveMipmapLevel(),Fy=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const r=t||this._allocateTargets();return this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,r={magFilter:Dn,minFilter:Dn,generateMipmaps:!1,type:Vi,format:Ki,colorSpace:zo,depthBuffer:!1},i=JM(e,t,r);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=JM(e,t,r);const{_lodMax:s}=this;({lodMeshes:this._lodMeshes,sizeLods:this._sizeLods,sigmas:this._sigmas}=JI(s)),this._blurMaterial=QI(s,e,t),this._ggxMaterial=KI(s,e,t)}return i}_compileMaterial(e){const t=new pi(new Sn,e);this._renderer.compile(t,$d)}_sceneToCubeUV(e,t,r,i,s){const u=new Pr(90,1,t,r),c=[1,-1,1,1,1,1],f=[1,1,1,-1,-1,-1],m=this._renderer,g=m.autoClear,y=m.toneMapping;m.getClearColor(ZM),m.toneMapping=ba,m.autoClear=!1,m.state.buffers.depth.getReversed()&&(m.setRenderTarget(i),m.clearDepth(),m.setRenderTarget(null)),this._backgroundBox===null&&(this._backgroundBox=new pi(new Qc,new Ho({name:"PMREM.Background",side:Ms,depthWrite:!1,depthTest:!1})));const E=this._backgroundBox,x=E.material;let S=!1;const T=e.background;T?T.isColor&&(x.color.copy(T),e.background=null,S=!0):(x.color.copy(ZM),S=!0);for(let A=0;A<6;A++){const P=A%3;P===0?(u.up.set(0,c[A],0),u.position.set(s.x,s.y,s.z),u.lookAt(s.x+f[A],s.y,s.z)):P===1?(u.up.set(0,0,c[A]),u.position.set(s.x,s.y,s.z),u.lookAt(s.x,s.y+f[A],s.z)):(u.up.set(0,c[A],0),u.position.set(s.x,s.y,s.z),u.lookAt(s.x,s.y,s.z+f[A]));const L=this._cubeSize;df(i,P*L,A>2?L:0,L,L),m.setRenderTarget(i),S&&m.render(E,u),m.render(e,u)}m.toneMapping=y,m.autoClear=g,e.background=T}_textureToCubeUV(e,t){const r=this._renderer,i=e.mapping===ho||e.mapping===Eu;i?(this._cubemapMaterial===null&&(this._cubemapMaterial=QM()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=KM());const s=i?this._cubemapMaterial:this._equirectMaterial,a=this._lodMeshes[0];a.material=s;const o=s.uniforms;o.envMap.value=e;const u=this._cubeSize;df(t,0,0,3*u,2*u),r.setRenderTarget(t),r.render(a,$d)}_applyPMREM(e){const t=this._renderer,r=t.autoClear;t.autoClear=!1;const i=this._lodMeshes.length;for(let s=1;s<i;s++)this._applyGGXFilter(e,s-1,s);t.autoClear=r}_applyGGXFilter(e,t,r){const i=this._renderer,s=this._pingPongRenderTarget,a=this._ggxMaterial,o=this._lodMeshes[r];o.material=a;const u=a.uniforms,c=r/(this._lodMeshes.length-1),f=t/(this._lodMeshes.length-1),m=Math.sqrt(c*c-f*f),g=0+c*1.25,y=m*g,{_lodMax:_}=this,E=this._sizeLods[r],x=3*E*(r>_-_u?r-_+_u:0),S=4*(this._cubeSize-E);u.envMap.value=e.texture,u.roughness.value=y,u.mipInt.value=_-t,df(s,x,S,3*E,2*E),i.setRenderTarget(s),i.render(o,$d),u.envMap.value=s.texture,u.roughness.value=0,u.mipInt.value=_-r,df(e,x,S,3*E,2*E),i.setRenderTarget(e),i.render(o,$d)}_blur(e,t,r,i,s){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,r,i,"latitudinal",s),this._halfBlur(a,e,r,r,i,"longitudinal",s)}_halfBlur(e,t,r,i,s,a,o){const u=this._renderer,c=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&ln("blur direction must be either latitudinal or longitudinal!");const f=3,m=this._lodMeshes[i];m.material=c;const g=c.uniforms,y=this._sizeLods[r]-1,_=isFinite(s)?Math.PI/(2*y):2*Math.PI/(2*Lc-1),E=s/_,x=isFinite(s)?1+Math.floor(f*E):Lc;x>Lc&&Ft(`sigmaRadians, ${s}, is too large and will clip, as it requested ${x} samples when the maximum is set to ${Lc}`);const S=[];let T=0;for(let F=0;F<Lc;++F){const k=F/E,R=Math.exp(-k*k/2);S.push(R),F===0?T+=R:F<x&&(T+=2*R)}for(let F=0;F<S.length;F++)S[F]=S[F]/T;g.envMap.value=e.texture,g.samples.value=x,g.weights.value=S,g.latitudinal.value=a==="latitudinal",o&&(g.poleAxis.value=o);const{_lodMax:A}=this;g.dTheta.value=_,g.mipInt.value=A-r;const P=this._sizeLods[i],L=3*P*(i>A-_u?i-A+_u:0),D=4*(this._cubeSize-P);df(t,L,D,3*P,2*P),u.setRenderTarget(t),u.render(m,$d)}}function JI(n){const e=[],t=[],r=[];let i=n;const s=n-_u+1+YM.length;for(let a=0;a<s;a++){const o=Math.pow(2,i);e.push(o);let u=1/o;a>n-_u?u=YM[a-n+_u-1]:a===0&&(u=0),t.push(u);const c=1/(o-2),f=-c,m=1+c,g=[f,f,m,f,m,m,f,f,m,m,f,m],y=6,_=6,E=3,x=2,S=1,T=new Float32Array(E*_*y),A=new Float32Array(x*_*y),P=new Float32Array(S*_*y);for(let D=0;D<y;D++){const F=D%3*2/3-1,k=D>2?0:-1,R=[F,k,0,F+2/3,k,0,F+2/3,k+1,0,F,k,0,F+2/3,k+1,0,F,k+1,0];T.set(R,E*_*D),A.set(g,x*_*D);const U=[D,D,D,D,D,D];P.set(U,S*_*D)}const L=new Sn;L.setAttribute("position",new jn(T,E)),L.setAttribute("uv",new jn(A,x)),L.setAttribute("faceIndex",new jn(P,S)),r.push(new pi(L,null)),i>_u&&i--}return{lodMeshes:r,sizeLods:e,sigmas:t}}function JM(n,e,t){const r=new ws(n,e,t);return r.texture.mapping=Wf,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function df(n,e,t,r,i){n.viewport.set(e,t,r,i),n.scissor.set(e,t,r,i)}function KI(n,e,t){return new Es({name:"PMREMGGXConvolution",defines:{GGX_SAMPLES:YI,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},roughness:{value:0},mipInt:{value:0}},vertexShader:f1(),fragmentShader:`

			precision highp float;
			precision highp int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform float roughness;
			uniform float mipInt;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			#define PI 3.14159265359

			// Van der Corput radical inverse
			float radicalInverse_VdC(uint bits) {
				bits = (bits << 16u) | (bits >> 16u);
				bits = ((bits & 0x55555555u) << 1u) | ((bits & 0xAAAAAAAAu) >> 1u);
				bits = ((bits & 0x33333333u) << 2u) | ((bits & 0xCCCCCCCCu) >> 2u);
				bits = ((bits & 0x0F0F0F0Fu) << 4u) | ((bits & 0xF0F0F0F0u) >> 4u);
				bits = ((bits & 0x00FF00FFu) << 8u) | ((bits & 0xFF00FF00u) >> 8u);
				return float(bits) * 2.3283064365386963e-10; // / 0x100000000
			}

			// Hammersley sequence
			vec2 hammersley(uint i, uint N) {
				return vec2(float(i) / float(N), radicalInverse_VdC(i));
			}

			// GGX VNDF importance sampling (Eric Heitz 2018)
			// "Sampling the GGX Distribution of Visible Normals"
			// https://jcgt.org/published/0007/04/01/
			vec3 importanceSampleGGX_VNDF(vec2 Xi, vec3 V, float roughness) {
				float alpha = roughness * roughness;

				// Section 3.2: Transform view direction to hemisphere configuration
				vec3 Vh = normalize(vec3(alpha * V.x, alpha * V.y, V.z));

				// Section 4.1: Orthonormal basis
				float lensq = Vh.x * Vh.x + Vh.y * Vh.y;
				vec3 T1 = lensq > 0.0 ? vec3(-Vh.y, Vh.x, 0.0) / sqrt(lensq) : vec3(1.0, 0.0, 0.0);
				vec3 T2 = cross(Vh, T1);

				// Section 4.2: Parameterization of projected area
				float r = sqrt(Xi.x);
				float phi = 2.0 * PI * Xi.y;
				float t1 = r * cos(phi);
				float t2 = r * sin(phi);
				float s = 0.5 * (1.0 + Vh.z);
				t2 = (1.0 - s) * sqrt(1.0 - t1 * t1) + s * t2;

				// Section 4.3: Reprojection onto hemisphere
				vec3 Nh = t1 * T1 + t2 * T2 + sqrt(max(0.0, 1.0 - t1 * t1 - t2 * t2)) * Vh;

				// Section 3.4: Transform back to ellipsoid configuration
				return normalize(vec3(alpha * Nh.x, alpha * Nh.y, max(0.0, Nh.z)));
			}

			void main() {
				vec3 N = normalize(vOutputDirection);
				vec3 V = N; // Assume view direction equals normal for pre-filtering

				vec3 prefilteredColor = vec3(0.0);
				float totalWeight = 0.0;

				// For very low roughness, just sample the environment directly
				if (roughness < 0.001) {
					gl_FragColor = vec4(bilinearCubeUV(envMap, N, mipInt), 1.0);
					return;
				}

				// Tangent space basis for VNDF sampling
				vec3 up = abs(N.z) < 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0);
				vec3 tangent = normalize(cross(up, N));
				vec3 bitangent = cross(N, tangent);

				for(uint i = 0u; i < uint(GGX_SAMPLES); i++) {
					vec2 Xi = hammersley(i, uint(GGX_SAMPLES));

					// For PMREM, V = N, so in tangent space V is always (0, 0, 1)
					vec3 H_tangent = importanceSampleGGX_VNDF(Xi, vec3(0.0, 0.0, 1.0), roughness);

					// Transform H back to world space
					vec3 H = normalize(tangent * H_tangent.x + bitangent * H_tangent.y + N * H_tangent.z);
					vec3 L = normalize(2.0 * dot(V, H) * H - V);

					float NdotL = max(dot(N, L), 0.0);

					if(NdotL > 0.0) {
						// Sample environment at fixed mip level
						// VNDF importance sampling handles the distribution filtering
						vec3 sampleColor = bilinearCubeUV(envMap, L, mipInt);

						// Weight by NdotL for the split-sum approximation
						// VNDF PDF naturally accounts for the visible microfacet distribution
						prefilteredColor += sampleColor * NdotL;
						totalWeight += NdotL;
					}
				}

				if (totalWeight > 0.0) {
					prefilteredColor = prefilteredColor / totalWeight;
				}

				gl_FragColor = vec4(prefilteredColor, 1.0);
			}
		`,blending:uo,depthTest:!1,depthWrite:!1})}function QI(n,e,t){const r=new Float32Array(Lc),i=new X(0,1,0);return new Es({name:"SphericalGaussianBlur",defines:{n:Lc,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:f1(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:uo,depthTest:!1,depthWrite:!1})}function KM(){return new Es({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:f1(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:uo,depthTest:!1,depthWrite:!1})}function QM(){return new Es({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:f1(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:uo,depthTest:!1,depthWrite:!1})}function f1(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function $I(n){let e=new WeakMap,t=null;function r(o){if(o&&o.isTexture){const u=o.mapping,c=u===Lf||u===Ip,f=u===ho||u===Eu;if(c||f){let m=e.get(o);const g=m!==void 0?m.texture.pmremVersion:0;if(o.isRenderTargetTexture&&o.pmremVersion!==g)return t===null&&(t=new w_(n)),m=c?t.fromEquirectangular(o,m):t.fromCubemap(o,m),m.texture.pmremVersion=o.pmremVersion,e.set(o,m),m.texture;if(m!==void 0)return m.texture;{const y=o.image;return c&&y&&y.height>0||f&&y&&i(y)?(t===null&&(t=new w_(n)),m=c?t.fromEquirectangular(o):t.fromCubemap(o),m.texture.pmremVersion=o.pmremVersion,e.set(o,m),o.addEventListener("dispose",s),m.texture):null}}}return o}function i(o){let u=0;const c=6;for(let f=0;f<c;f++)o[f]!==void 0&&u++;return u===c}function s(o){const u=o.target;u.removeEventListener("dispose",s);const c=e.get(u);c!==void 0&&(e.delete(u),c.dispose())}function a(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:r,dispose:a}}function eL(n){const e={};function t(r){if(e[r]!==void 0)return e[r];const i=n.getExtension(r);return e[r]=i,i}return{has:function(r){return t(r)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(r){const i=t(r);return i===null&&Ff("WebGLRenderer: "+r+" extension not supported."),i}}}function tL(n,e,t,r){const i={},s=new WeakMap;function a(m){const g=m.target;g.index!==null&&e.remove(g.index);for(const _ in g.attributes)e.remove(g.attributes[_]);g.removeEventListener("dispose",a),delete i[g.id];const y=s.get(g);y&&(e.remove(y),s.delete(g)),r.releaseStatesOfGeometry(g),g.isInstancedBufferGeometry===!0&&delete g._maxInstanceCount,t.memory.geometries--}function o(m,g){return i[g.id]===!0||(g.addEventListener("dispose",a),i[g.id]=!0,t.memory.geometries++),g}function u(m){const g=m.attributes;for(const y in g)e.update(g[y],n.ARRAY_BUFFER)}function c(m){const g=[],y=m.index,_=m.attributes.position;let E=0;if(y!==null){const T=y.array;E=y.version;for(let A=0,P=T.length;A<P;A+=3){const L=T[A+0],D=T[A+1],F=T[A+2];g.push(L,D,D,F,F,L)}}else if(_!==void 0){const T=_.array;E=_.version;for(let A=0,P=T.length/3-1;A<P;A+=3){const L=A+0,D=A+1,F=A+2;g.push(L,D,D,F,F,L)}}else return;const x=new(lE(g)?ix:nx)(g,1);x.version=E;const S=s.get(m);S&&e.remove(S),s.set(m,x)}function f(m){const g=s.get(m);if(g){const y=m.index;y!==null&&g.version<y.version&&c(m)}else c(m);return s.get(m)}return{get:o,update:u,getWireframeAttribute:f}}function nL(n,e,t){let r;function i(g){r=g}let s,a;function o(g){s=g.type,a=g.bytesPerElement}function u(g,y){n.drawElements(r,y,s,g*a),t.update(y,r,1)}function c(g,y,_){_!==0&&(n.drawElementsInstanced(r,y,s,g*a,_),t.update(y,r,_))}function f(g,y,_){if(_===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(r,y,0,s,g,0,_);let x=0;for(let S=0;S<_;S++)x+=y[S];t.update(x,r,1)}function m(g,y,_,E){if(_===0)return;const x=e.get("WEBGL_multi_draw");if(x===null)for(let S=0;S<g.length;S++)c(g[S]/a,y[S],E[S]);else{x.multiDrawElementsInstancedWEBGL(r,y,0,s,g,0,E,0,_);let S=0;for(let T=0;T<_;T++)S+=y[T]*E[T];t.update(S,r,1)}}this.setMode=i,this.setIndex=o,this.render=u,this.renderInstances=c,this.renderMultiDraw=f,this.renderMultiDrawInstances=m}function iL(n){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function r(s,a,o){switch(t.calls++,a){case n.TRIANGLES:t.triangles+=o*(s/3);break;case n.LINES:t.lines+=o*(s/2);break;case n.LINE_STRIP:t.lines+=o*(s-1);break;case n.LINE_LOOP:t.lines+=o*s;break;case n.POINTS:t.points+=o*s;break;default:ln("WebGLInfo: Unknown draw mode:",a);break}}function i(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:i,update:r}}function rL(n,e,t){const r=new WeakMap,i=new $n;function s(a,o,u){const c=a.morphTargetInfluences,f=o.morphAttributes.position||o.morphAttributes.normal||o.morphAttributes.color,m=f!==void 0?f.length:0;let g=r.get(o);if(g===void 0||g.count!==m){let U=function(){k.dispose(),r.delete(o),o.removeEventListener("dispose",U)};var y=U;g!==void 0&&g.texture.dispose();const _=o.morphAttributes.position!==void 0,E=o.morphAttributes.normal!==void 0,x=o.morphAttributes.color!==void 0,S=o.morphAttributes.position||[],T=o.morphAttributes.normal||[],A=o.morphAttributes.color||[];let P=0;_===!0&&(P=1),E===!0&&(P=2),x===!0&&(P=3);let L=o.attributes.position.count*P,D=1;L>e.maxTextureSize&&(D=Math.ceil(L/e.maxTextureSize),L=e.maxTextureSize);const F=new Float32Array(L*D*4*m),k=new Gv(F,L,D,m);k.type=bi,k.needsUpdate=!0;const R=P*4;for(let V=0;V<m;V++){const H=S[V],J=T[V],$=A[V],ae=L*D*4*V;for(let ne=0;ne<H.count;ne++){const oe=ne*R;_===!0&&(i.fromBufferAttribute(H,ne),F[ae+oe+0]=i.x,F[ae+oe+1]=i.y,F[ae+oe+2]=i.z,F[ae+oe+3]=0),E===!0&&(i.fromBufferAttribute(J,ne),F[ae+oe+4]=i.x,F[ae+oe+5]=i.y,F[ae+oe+6]=i.z,F[ae+oe+7]=0),x===!0&&(i.fromBufferAttribute($,ne),F[ae+oe+8]=i.x,F[ae+oe+9]=i.y,F[ae+oe+10]=i.z,F[ae+oe+11]=$.itemSize===4?i.w:1)}}g={count:m,texture:k,size:new ct(L,D)},r.set(o,g),o.addEventListener("dispose",U)}if(a.isInstancedMesh===!0&&a.morphTexture!==null)u.getUniforms().setValue(n,"morphTexture",a.morphTexture,t);else{let _=0;for(let x=0;x<c.length;x++)_+=c[x];const E=o.morphTargetsRelative?1:1-_;u.getUniforms().setValue(n,"morphTargetBaseInfluence",E),u.getUniforms().setValue(n,"morphTargetInfluences",c)}u.getUniforms().setValue(n,"morphTargetsTexture",g.texture,t),u.getUniforms().setValue(n,"morphTargetsTextureSize",g.size)}return{update:s}}function sL(n,e,t,r){let i=new WeakMap;function s(u){const c=r.render.frame,f=u.geometry,m=e.get(u,f);if(i.get(m)!==c&&(e.update(m),i.set(m,c)),u.isInstancedMesh&&(u.hasEventListener("dispose",o)===!1&&u.addEventListener("dispose",o),i.get(u)!==c&&(t.update(u.instanceMatrix,n.ARRAY_BUFFER),u.instanceColor!==null&&t.update(u.instanceColor,n.ARRAY_BUFFER),i.set(u,c))),u.isSkinnedMesh){const g=u.skeleton;i.get(g)!==c&&(g.update(),i.set(g,c))}return m}function a(){i=new WeakMap}function o(u){const c=u.target;c.removeEventListener("dispose",o),t.remove(c.instanceMatrix),c.instanceColor!==null&&t.remove(c.instanceColor)}return{update:s,dispose:a}}const aL={[V_]:"LINEAR_TONE_MAPPING",[H_]:"REINHARD_TONE_MAPPING",[W_]:"CINEON_TONE_MAPPING",[Iv]:"ACES_FILMIC_TONE_MAPPING",[X_]:"AGX_TONE_MAPPING",[q_]:"NEUTRAL_TONE_MAPPING",[j_]:"CUSTOM_TONE_MAPPING"};function oL(n,e,t,r,i){const s=new ws(e,t,{type:n,depthBuffer:r,stencilBuffer:i}),a=new ws(e,t,{type:Vi,depthBuffer:!1,stencilBuffer:!1}),o=new Sn;o.setAttribute("position",new Jt([-1,3,0,-1,-1,0,3,-1,0],3)),o.setAttribute("uv",new Jt([0,2,0,0,2,0],2));const u=new mx({uniforms:{tDiffuse:{value:null}},vertexShader:`
			precision highp float;

			uniform mat4 modelViewMatrix;
			uniform mat4 projectionMatrix;

			attribute vec3 position;
			attribute vec2 uv;

			varying vec2 vUv;

			void main() {
				vUv = uv;
				gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
			}`,fragmentShader:`
			precision highp float;

			uniform sampler2D tDiffuse;

			varying vec2 vUv;

			#include <tonemapping_pars_fragment>
			#include <colorspace_pars_fragment>

			void main() {
				gl_FragColor = texture2D( tDiffuse, vUv );

				#ifdef LINEAR_TONE_MAPPING
					gl_FragColor.rgb = LinearToneMapping( gl_FragColor.rgb );
				#elif defined( REINHARD_TONE_MAPPING )
					gl_FragColor.rgb = ReinhardToneMapping( gl_FragColor.rgb );
				#elif defined( CINEON_TONE_MAPPING )
					gl_FragColor.rgb = CineonToneMapping( gl_FragColor.rgb );
				#elif defined( ACES_FILMIC_TONE_MAPPING )
					gl_FragColor.rgb = ACESFilmicToneMapping( gl_FragColor.rgb );
				#elif defined( AGX_TONE_MAPPING )
					gl_FragColor.rgb = AgXToneMapping( gl_FragColor.rgb );
				#elif defined( NEUTRAL_TONE_MAPPING )
					gl_FragColor.rgb = NeutralToneMapping( gl_FragColor.rgb );
				#elif defined( CUSTOM_TONE_MAPPING )
					gl_FragColor.rgb = CustomToneMapping( gl_FragColor.rgb );
				#endif

				#ifdef SRGB_TRANSFER
					gl_FragColor = sRGBTransferOETF( gl_FragColor );
				#endif
			}`,depthTest:!1,depthWrite:!1}),c=new pi(o,u),f=new th(-1,1,1,-1,0,1);let m=null,g=null,y=!1,_,E=null,x=[],S=!1;this.setSize=function(T,A){s.setSize(T,A),a.setSize(T,A);for(let P=0;P<x.length;P++){const L=x[P];L.setSize&&L.setSize(T,A)}},this.setEffects=function(T){x=T,S=x.length>0&&x[0].isRenderPass===!0;const A=s.width,P=s.height;for(let L=0;L<x.length;L++){const D=x[L];D.setSize&&D.setSize(A,P)}},this.begin=function(T,A){if(y||T.toneMapping===ba&&x.length===0)return!1;if(E=A,A!==null){const P=A.width,L=A.height;(s.width!==P||s.height!==L)&&this.setSize(P,L)}return S===!1&&T.setRenderTarget(s),_=T.toneMapping,T.toneMapping=ba,!0},this.hasRenderPass=function(){return S},this.end=function(T,A){T.toneMapping=_,y=!0;let P=s,L=a;for(let D=0;D<x.length;D++){const F=x[D];if(F.enabled!==!1&&(F.render(T,L,P,A),F.needsSwap!==!1)){const k=P;P=L,L=k}}if(m!==T.outputColorSpace||g!==T.toneMapping){m=T.outputColorSpace,g=T.toneMapping,u.defines={},kn.getTransfer(m)===Yn&&(u.defines.SRGB_TRANSFER="");const D=aL[g];D&&(u.defines[D]=""),u.needsUpdate=!0}u.uniforms.tDiffuse.value=P.texture,T.setRenderTarget(E),T.render(c,f),E=null,y=!1},this.isCompositing=function(){return y},this.dispose=function(){s.dispose(),a.dispose(),o.dispose(),u.dispose()}}const c3=new ei,E_=new zf(1,1),h3=new Gv,f3=new Vv,d3=new s0,$M=[],e2=[],t2=new Float32Array(16),n2=new Float32Array(9),i2=new Float32Array(4);function qf(n,e,t){const r=n[0];if(r<=0||r>0)return n;const i=e*t;let s=$M[i];if(s===void 0&&(s=new Float32Array(i),$M[i]=s),e!==0){r.toArray(s,0);for(let a=1,o=0;a!==e;++a)o+=t,n[a].toArray(s,o)}return s}function _r(n,e){if(n.length!==e.length)return!1;for(let t=0,r=n.length;t<r;t++)if(n[t]!==e[t])return!1;return!0}function xr(n,e){for(let t=0,r=e.length;t<r;t++)n[t]=e[t]}function d1(n,e){let t=e2[e];t===void 0&&(t=new Int32Array(e),e2[e]=t);for(let r=0;r!==e;++r)t[r]=n.allocateTextureUnit();return t}function lL(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function uL(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(_r(t,e))return;n.uniform2fv(this.addr,e),xr(t,e)}}function cL(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(_r(t,e))return;n.uniform3fv(this.addr,e),xr(t,e)}}function hL(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(_r(t,e))return;n.uniform4fv(this.addr,e),xr(t,e)}}function fL(n,e){const t=this.cache,r=e.elements;if(r===void 0){if(_r(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),xr(t,e)}else{if(_r(t,r))return;i2.set(r),n.uniformMatrix2fv(this.addr,!1,i2),xr(t,r)}}function dL(n,e){const t=this.cache,r=e.elements;if(r===void 0){if(_r(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),xr(t,e)}else{if(_r(t,r))return;n2.set(r),n.uniformMatrix3fv(this.addr,!1,n2),xr(t,r)}}function pL(n,e){const t=this.cache,r=e.elements;if(r===void 0){if(_r(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),xr(t,e)}else{if(_r(t,r))return;t2.set(r),n.uniformMatrix4fv(this.addr,!1,t2),xr(t,r)}}function mL(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function gL(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(_r(t,e))return;n.uniform2iv(this.addr,e),xr(t,e)}}function vL(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(_r(t,e))return;n.uniform3iv(this.addr,e),xr(t,e)}}function yL(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(_r(t,e))return;n.uniform4iv(this.addr,e),xr(t,e)}}function _L(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function xL(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(_r(t,e))return;n.uniform2uiv(this.addr,e),xr(t,e)}}function SL(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(_r(t,e))return;n.uniform3uiv(this.addr,e),xr(t,e)}}function ML(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(_r(t,e))return;n.uniform4uiv(this.addr,e),xr(t,e)}}function wL(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i);let s;this.type===n.SAMPLER_2D_SHADOW?(E_.compareFunction=t.isReversedDepthBuffer()?Bv:zv,s=E_):s=c3,t.setTexture2D(e||s,i)}function EL(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTexture3D(e||f3,i)}function TL(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTextureCube(e||d3,i)}function bL(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTexture2DArray(e||h3,i)}function AL(n){switch(n){case 5126:return lL;case 35664:return uL;case 35665:return cL;case 35666:return hL;case 35674:return fL;case 35675:return dL;case 35676:return pL;case 5124:case 35670:return mL;case 35667:case 35671:return gL;case 35668:case 35672:return vL;case 35669:case 35673:return yL;case 5125:return _L;case 36294:return xL;case 36295:return SL;case 36296:return ML;case 35678:case 36198:case 36298:case 36306:case 35682:return wL;case 35679:case 36299:case 36307:return EL;case 35680:case 36300:case 36308:case 36293:return TL;case 36289:case 36303:case 36311:case 36292:return bL}}function CL(n,e){n.uniform1fv(this.addr,e)}function PL(n,e){const t=qf(e,this.size,2);n.uniform2fv(this.addr,t)}function RL(n,e){const t=qf(e,this.size,3);n.uniform3fv(this.addr,t)}function IL(n,e){const t=qf(e,this.size,4);n.uniform4fv(this.addr,t)}function LL(n,e){const t=qf(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function NL(n,e){const t=qf(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function DL(n,e){const t=qf(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function UL(n,e){n.uniform1iv(this.addr,e)}function FL(n,e){n.uniform2iv(this.addr,e)}function OL(n,e){n.uniform3iv(this.addr,e)}function kL(n,e){n.uniform4iv(this.addr,e)}function zL(n,e){n.uniform1uiv(this.addr,e)}function BL(n,e){n.uniform2uiv(this.addr,e)}function GL(n,e){n.uniform3uiv(this.addr,e)}function VL(n,e){n.uniform4uiv(this.addr,e)}function HL(n,e,t){const r=this.cache,i=e.length,s=d1(t,i);_r(r,s)||(n.uniform1iv(this.addr,s),xr(r,s));let a;this.type===n.SAMPLER_2D_SHADOW?a=E_:a=c3;for(let o=0;o!==i;++o)t.setTexture2D(e[o]||a,s[o])}function WL(n,e,t){const r=this.cache,i=e.length,s=d1(t,i);_r(r,s)||(n.uniform1iv(this.addr,s),xr(r,s));for(let a=0;a!==i;++a)t.setTexture3D(e[a]||f3,s[a])}function jL(n,e,t){const r=this.cache,i=e.length,s=d1(t,i);_r(r,s)||(n.uniform1iv(this.addr,s),xr(r,s));for(let a=0;a!==i;++a)t.setTextureCube(e[a]||d3,s[a])}function XL(n,e,t){const r=this.cache,i=e.length,s=d1(t,i);_r(r,s)||(n.uniform1iv(this.addr,s),xr(r,s));for(let a=0;a!==i;++a)t.setTexture2DArray(e[a]||h3,s[a])}function qL(n){switch(n){case 5126:return CL;case 35664:return PL;case 35665:return RL;case 35666:return IL;case 35674:return LL;case 35675:return NL;case 35676:return DL;case 5124:case 35670:return UL;case 35667:case 35671:return FL;case 35668:case 35672:return OL;case 35669:case 35673:return kL;case 5125:return zL;case 36294:return BL;case 36295:return GL;case 36296:return VL;case 35678:case 36198:case 36298:case 36306:case 35682:return HL;case 35679:case 36299:case 36307:return WL;case 35680:case 36300:case 36308:case 36293:return jL;case 36289:case 36303:case 36311:case 36292:return XL}}class YL{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.type=t.type,this.setValue=AL(t.type)}}class ZL{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=qL(t.type)}}class JL{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,r){const i=this.seq;for(let s=0,a=i.length;s!==a;++s){const o=i[s];o.setValue(e,t[o.id],r)}}}const Oy=/(\w+)(\])?(\[|\.)?/g;function r2(n,e){n.seq.push(e),n.map[e.id]=e}function KL(n,e,t){const r=n.name,i=r.length;for(Oy.lastIndex=0;;){const s=Oy.exec(r),a=Oy.lastIndex;let o=s[1];const u=s[2]==="]",c=s[3];if(u&&(o=o|0),c===void 0||c==="["&&a+2===i){r2(t,c===void 0?new YL(o,n,e):new ZL(o,n,e));break}else{let m=t.map[o];m===void 0&&(m=new JL(o),r2(t,m)),t=m}}}class vg{constructor(e,t){this.seq=[],this.map={};const r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let a=0;a<r;++a){const o=e.getActiveUniform(t,a),u=e.getUniformLocation(t,o.name);KL(o,u,this)}const i=[],s=[];for(const a of this.seq)a.type===e.SAMPLER_2D_SHADOW||a.type===e.SAMPLER_CUBE_SHADOW||a.type===e.SAMPLER_2D_ARRAY_SHADOW?i.push(a):s.push(a);i.length>0&&(this.seq=i.concat(s))}setValue(e,t,r,i){const s=this.map[t];s!==void 0&&s.setValue(e,r,i)}setOptional(e,t,r){const i=t[r];i!==void 0&&this.setValue(e,r,i)}static upload(e,t,r,i){for(let s=0,a=t.length;s!==a;++s){const o=t[s],u=r[o.id];u.needsUpdate!==!1&&o.setValue(e,u.value,i)}}static seqWithValue(e,t){const r=[];for(let i=0,s=e.length;i!==s;++i){const a=e[i];a.id in t&&r.push(a)}return r}}function s2(n,e,t){const r=n.createShader(e);return n.shaderSource(r,t),n.compileShader(r),r}const QL=37297;let $L=0;function e5(n,e){const t=n.split(`
`),r=[],i=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let a=i;a<s;a++){const o=a+1;r.push(`${o===e?">":" "} ${o}: ${t[a]}`)}return r.join(`
`)}const a2=new Tn;function t5(n){kn._getMatrix(a2,kn.workingColorSpace,n);const e=`mat3( ${a2.elements.map(t=>t.toFixed(4))} )`;switch(kn.getTransfer(n)){case Fp:return[e,"LinearTransferOETF"];case Yn:return[e,"sRGBTransferOETF"];default:return Ft("WebGLProgram: Unsupported color space: ",n),[e,"LinearTransferOETF"]}}function o2(n,e,t){const r=n.getShaderParameter(e,n.COMPILE_STATUS),s=(n.getShaderInfoLog(e)||"").trim();if(r&&s==="")return"";const a=/ERROR: 0:(\d+)/.exec(s);if(a){const o=parseInt(a[1]);return t.toUpperCase()+`

`+s+`

`+e5(n.getShaderSource(e),o)}else return s}function n5(n,e){const t=t5(e);return[`vec4 ${n}( vec4 value ) {`,`	return ${t[1]}( vec4( value.rgb * ${t[0]}, value.a ) );`,"}"].join(`
`)}const i5={[V_]:"Linear",[H_]:"Reinhard",[W_]:"Cineon",[Iv]:"ACESFilmic",[X_]:"AgX",[q_]:"Neutral",[j_]:"Custom"};function r5(n,e){const t=i5[e];return t===void 0?(Ft("WebGLProgram: Unsupported toneMapping:",e),"vec3 "+n+"( vec3 color ) { return LinearToneMapping( color ); }"):"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}const tg=new X;function s5(){kn.getLuminanceCoefficients(tg);const n=tg.x.toFixed(4),e=tg.y.toFixed(4),t=tg.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${n}, ${e}, ${t} );`,"	return dot( weights, rgb );","}"].join(`
`)}function a5(n){return[n.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",n.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(up).join(`
`)}function o5(n){const e=[];for(const t in n){const r=n[t];r!==!1&&e.push("#define "+t+" "+r)}return e.join(`
`)}function l5(n,e){const t={},r=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const s=n.getActiveAttrib(e,i),a=s.name;let o=1;s.type===n.FLOAT_MAT2&&(o=2),s.type===n.FLOAT_MAT3&&(o=3),s.type===n.FLOAT_MAT4&&(o=4),t[a]={type:s.type,location:n.getAttribLocation(e,a),locationSize:o}}return t}function up(n){return n!==""}function l2(n,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function u2(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const u5=/^[ \t]*#include +<([\w\d./]+)>/gm;function T_(n){return n.replace(u5,h5)}const c5=new Map;function h5(n,e){let t=Pn[e];if(t===void 0){const r=c5.get(e);if(r!==void 0)t=Pn[r],Ft('WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,r);else throw new Error("Can not resolve #include <"+e+">")}return T_(t)}const f5=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function c2(n){return n.replace(f5,d5)}function d5(n,e,t,r){let i="";for(let s=parseInt(e);s<parseInt(t);s++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return i}function h2(n){let e=`precision ${n.precision} float;
	precision ${n.precision} int;
	precision ${n.precision} sampler2D;
	precision ${n.precision} samplerCube;
	precision ${n.precision} sampler3D;
	precision ${n.precision} sampler2DArray;
	precision ${n.precision} sampler2DShadow;
	precision ${n.precision} samplerCubeShadow;
	precision ${n.precision} sampler2DArrayShadow;
	precision ${n.precision} isampler2D;
	precision ${n.precision} isampler3D;
	precision ${n.precision} isamplerCube;
	precision ${n.precision} isampler2DArray;
	precision ${n.precision} usampler2D;
	precision ${n.precision} usampler3D;
	precision ${n.precision} usamplerCube;
	precision ${n.precision} usampler2DArray;
	`;return n.precision==="highp"?e+=`
#define HIGH_PRECISION`:n.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}const p5={[Af]:"SHADOWMAP_TYPE_PCF",[Nc]:"SHADOWMAP_TYPE_VSM"};function m5(n){return p5[n.shadowMapType]||"SHADOWMAP_TYPE_BASIC"}const g5={[ho]:"ENVMAP_TYPE_CUBE",[Eu]:"ENVMAP_TYPE_CUBE",[Wf]:"ENVMAP_TYPE_CUBE_UV"};function v5(n){return n.envMap===!1?"ENVMAP_TYPE_CUBE":g5[n.envMapMode]||"ENVMAP_TYPE_CUBE"}const y5={[Eu]:"ENVMAP_MODE_REFRACTION"};function _5(n){return n.envMap===!1?"ENVMAP_MODE_REFLECTION":y5[n.envMapMode]||"ENVMAP_MODE_REFLECTION"}const x5={[e0]:"ENVMAP_BLENDING_MULTIPLY",[qw]:"ENVMAP_BLENDING_MIX",[Yw]:"ENVMAP_BLENDING_ADD"};function S5(n){return n.envMap===!1?"ENVMAP_BLENDING_NONE":x5[n.combine]||"ENVMAP_BLENDING_NONE"}function M5(n){const e=n.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,r=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),112)),texelHeight:r,maxMip:t}}function w5(n,e,t,r){const i=n.getContext(),s=t.defines;let a=t.vertexShader,o=t.fragmentShader;const u=m5(t),c=v5(t),f=_5(t),m=S5(t),g=M5(t),y=a5(t),_=o5(s),E=i.createProgram();let x,S,T=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(x=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,_].filter(up).join(`
`),x.length>0&&(x+=`
`),S=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,_].filter(up).join(`
`),S.length>0&&(S+=`
`)):(x=[h2(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,_,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+f:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+u:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",t.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(up).join(`
`),S=[h2(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,_,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+f:"",t.envMap?"#define "+m:"",g?"#define CUBEUV_TEXEL_WIDTH "+g.texelWidth:"",g?"#define CUBEUV_TEXEL_HEIGHT "+g.texelHeight:"",g?"#define CUBEUV_MAX_MIP "+g.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+u:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",t.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",t.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==ba?"#define TONE_MAPPING":"",t.toneMapping!==ba?Pn.tonemapping_pars_fragment:"",t.toneMapping!==ba?r5("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",Pn.colorspace_pars_fragment,n5("linearToOutputTexel",t.outputColorSpace),s5(),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(up).join(`
`)),a=T_(a),a=l2(a,t),a=u2(a,t),o=T_(o),o=l2(o,t),o=u2(o,t),a=c2(a),o=c2(o),t.isRawShaderMaterial!==!0&&(T=`#version 300 es
`,x=[y,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+x,S=["#define varying in",t.glslVersion===m_?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===m_?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+S);const A=T+x+a,P=T+S+o,L=s2(i,i.VERTEX_SHADER,A),D=s2(i,i.FRAGMENT_SHADER,P);i.attachShader(E,L),i.attachShader(E,D),t.index0AttributeName!==void 0?i.bindAttribLocation(E,0,t.index0AttributeName):t.morphTargets===!0&&i.bindAttribLocation(E,0,"position"),i.linkProgram(E);function F(V){if(n.debug.checkShaderErrors){const H=i.getProgramInfoLog(E)||"",J=i.getShaderInfoLog(L)||"",$=i.getShaderInfoLog(D)||"",ae=H.trim(),ne=J.trim(),oe=$.trim();let te=!0,ie=!0;if(i.getProgramParameter(E,i.LINK_STATUS)===!1)if(te=!1,typeof n.debug.onShaderError=="function")n.debug.onShaderError(i,E,L,D);else{const Y=o2(i,L,"vertex"),z=o2(i,D,"fragment");ln("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(E,i.VALIDATE_STATUS)+`

Material Name: `+V.name+`
Material Type: `+V.type+`

Program Info Log: `+ae+`
`+Y+`
`+z)}else ae!==""?Ft("WebGLProgram: Program Info Log:",ae):(ne===""||oe==="")&&(ie=!1);ie&&(V.diagnostics={runnable:te,programLog:ae,vertexShader:{log:ne,prefix:x},fragmentShader:{log:oe,prefix:S}})}i.deleteShader(L),i.deleteShader(D),k=new vg(i,E),R=l5(i,E)}let k;this.getUniforms=function(){return k===void 0&&F(this),k};let R;this.getAttributes=function(){return R===void 0&&F(this),R};let U=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return U===!1&&(U=i.getProgramParameter(E,QL)),U},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(E),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=$L++,this.cacheKey=e,this.usedTimes=1,this.program=E,this.vertexShader=L,this.fragmentShader=D,this}let E5=0;class T5{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,r=e.fragmentShader,i=this._getShaderStage(t),s=this._getShaderStage(r),a=this._getShaderCacheForMaterial(e);return a.has(i)===!1&&(a.add(i),i.usedTimes++),a.has(s)===!1&&(a.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const r of t)r.usedTimes--,r.usedTimes===0&&this.shaderCache.delete(r.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let r=t.get(e);return r===void 0&&(r=new Set,t.set(e,r)),r}_getShaderStage(e){const t=this.shaderCache;let r=t.get(e);return r===void 0&&(r=new b5(e),t.set(e,r)),r}}class b5{constructor(e){this.id=E5++,this.code=e,this.usedTimes=0}}function A5(n,e,t,r,i,s,a){const o=new Gc,u=new T5,c=new Set,f=[],m=new Map,g=i.logarithmicDepthBuffer;let y=i.precision;const _={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distance",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function E(R){return c.add(R),R===0?"uv":`uv${R}`}function x(R,U,V,H,J){const $=H.fog,ae=J.geometry,ne=R.isMeshStandardMaterial?H.environment:null,oe=(R.isMeshStandardMaterial?t:e).get(R.envMap||ne),te=oe&&oe.mapping===Wf?oe.image.height:null,ie=_[R.type];R.precision!==null&&(y=i.getMaxPrecision(R.precision),y!==R.precision&&Ft("WebGLProgram.getParameters:",R.precision,"not supported, using",y,"instead."));const Y=ae.morphAttributes.position||ae.morphAttributes.normal||ae.morphAttributes.color,z=Y!==void 0?Y.length:0;let K=0;ae.morphAttributes.position!==void 0&&(K=1),ae.morphAttributes.normal!==void 0&&(K=2),ae.morphAttributes.color!==void 0&&(K=3);let le,me,ve,re;if(ie){const nn=oo[ie];le=nn.vertexShader,me=nn.fragmentShader}else le=R.vertexShader,me=R.fragmentShader,u.update(R),ve=u.getVertexShaderID(R),re=u.getFragmentShaderID(R);const he=n.getRenderTarget(),ye=n.state.buffers.depth.getReversed(),ze=J.isInstancedMesh===!0,Ve=J.isBatchedMesh===!0,Ke=!!R.map,Qe=!!R.matcap,pt=!!oe,Ne=!!R.aoMap,Be=!!R.lightMap,De=!!R.bumpMap,it=!!R.normalMap,Q=!!R.displacementMap,at=!!R.emissiveMap,je=!!R.metalnessMap,Ce=!!R.roughnessMap,He=R.anisotropy>0,q=R.clearcoat>0,B=R.dispersion>0,ue=R.iridescence>0,Re=R.sheen>0,Pe=R.transmission>0,Te=He&&!!R.anisotropyMap,ot=q&&!!R.clearcoatMap,rt=q&&!!R.clearcoatNormalMap,mt=q&&!!R.clearcoatRoughnessMap,Rt=ue&&!!R.iridescenceMap,Ge=ue&&!!R.iridescenceThicknessMap,Xe=Re&&!!R.sheenColorMap,nt=Re&&!!R.sheenRoughnessMap,gt=!!R.specularMap,st=!!R.specularColorMap,Ot=!!R.specularIntensityMap,pe=Pe&&!!R.transmissionMap,Ee=Pe&&!!R.thicknessMap,et=!!R.gradientMap,Pt=!!R.alphaMap,tt=R.alphaTest>0,ke=!!R.alphaHash,dt=!!R.extensions;let kt=ba;R.toneMapped&&(he===null||he.isXRRenderTarget===!0)&&(kt=n.toneMapping);const zt={shaderID:ie,shaderType:R.type,shaderName:R.name,vertexShader:le,fragmentShader:me,defines:R.defines,customVertexShaderID:ve,customFragmentShaderID:re,isRawShaderMaterial:R.isRawShaderMaterial===!0,glslVersion:R.glslVersion,precision:y,batching:Ve,batchingColor:Ve&&J._colorsTexture!==null,instancing:ze,instancingColor:ze&&J.instanceColor!==null,instancingMorph:ze&&J.morphTexture!==null,outputColorSpace:he===null?n.outputColorSpace:he.isXRRenderTarget===!0?he.texture.colorSpace:zo,alphaToCoverage:!!R.alphaToCoverage,map:Ke,matcap:Qe,envMap:pt,envMapMode:pt&&oe.mapping,envMapCubeUVHeight:te,aoMap:Ne,lightMap:Be,bumpMap:De,normalMap:it,displacementMap:Q,emissiveMap:at,normalMapObjectSpace:it&&R.normalMapType===tE,normalMapTangentSpace:it&&R.normalMapType===Ru,metalnessMap:je,roughnessMap:Ce,anisotropy:He,anisotropyMap:Te,clearcoat:q,clearcoatMap:ot,clearcoatNormalMap:rt,clearcoatRoughnessMap:mt,dispersion:B,iridescence:ue,iridescenceMap:Rt,iridescenceThicknessMap:Ge,sheen:Re,sheenColorMap:Xe,sheenRoughnessMap:nt,specularMap:gt,specularColorMap:st,specularIntensityMap:Ot,transmission:Pe,transmissionMap:pe,thicknessMap:Ee,gradientMap:et,opaque:R.transparent===!1&&R.blending===zc&&R.alphaToCoverage===!1,alphaMap:Pt,alphaTest:tt,alphaHash:ke,combine:R.combine,mapUv:Ke&&E(R.map.channel),aoMapUv:Ne&&E(R.aoMap.channel),lightMapUv:Be&&E(R.lightMap.channel),bumpMapUv:De&&E(R.bumpMap.channel),normalMapUv:it&&E(R.normalMap.channel),displacementMapUv:Q&&E(R.displacementMap.channel),emissiveMapUv:at&&E(R.emissiveMap.channel),metalnessMapUv:je&&E(R.metalnessMap.channel),roughnessMapUv:Ce&&E(R.roughnessMap.channel),anisotropyMapUv:Te&&E(R.anisotropyMap.channel),clearcoatMapUv:ot&&E(R.clearcoatMap.channel),clearcoatNormalMapUv:rt&&E(R.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:mt&&E(R.clearcoatRoughnessMap.channel),iridescenceMapUv:Rt&&E(R.iridescenceMap.channel),iridescenceThicknessMapUv:Ge&&E(R.iridescenceThicknessMap.channel),sheenColorMapUv:Xe&&E(R.sheenColorMap.channel),sheenRoughnessMapUv:nt&&E(R.sheenRoughnessMap.channel),specularMapUv:gt&&E(R.specularMap.channel),specularColorMapUv:st&&E(R.specularColorMap.channel),specularIntensityMapUv:Ot&&E(R.specularIntensityMap.channel),transmissionMapUv:pe&&E(R.transmissionMap.channel),thicknessMapUv:Ee&&E(R.thicknessMap.channel),alphaMapUv:Pt&&E(R.alphaMap.channel),vertexTangents:!!ae.attributes.tangent&&(it||He),vertexColors:R.vertexColors,vertexAlphas:R.vertexColors===!0&&!!ae.attributes.color&&ae.attributes.color.itemSize===4,pointsUvs:J.isPoints===!0&&!!ae.attributes.uv&&(Ke||Pt),fog:!!$,useFog:R.fog===!0,fogExp2:!!$&&$.isFogExp2,flatShading:R.flatShading===!0&&R.wireframe===!1,sizeAttenuation:R.sizeAttenuation===!0,logarithmicDepthBuffer:g,reversedDepthBuffer:ye,skinning:J.isSkinnedMesh===!0,morphTargets:ae.morphAttributes.position!==void 0,morphNormals:ae.morphAttributes.normal!==void 0,morphColors:ae.morphAttributes.color!==void 0,morphTargetsCount:z,morphTextureStride:K,numDirLights:U.directional.length,numPointLights:U.point.length,numSpotLights:U.spot.length,numSpotLightMaps:U.spotLightMap.length,numRectAreaLights:U.rectArea.length,numHemiLights:U.hemi.length,numDirLightShadows:U.directionalShadowMap.length,numPointLightShadows:U.pointShadowMap.length,numSpotLightShadows:U.spotShadowMap.length,numSpotLightShadowsWithMaps:U.numSpotLightShadowsWithMaps,numLightProbes:U.numLightProbes,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:R.dithering,shadowMapEnabled:n.shadowMap.enabled&&V.length>0,shadowMapType:n.shadowMap.type,toneMapping:kt,decodeVideoTexture:Ke&&R.map.isVideoTexture===!0&&kn.getTransfer(R.map.colorSpace)===Yn,decodeVideoTextureEmissive:at&&R.emissiveMap.isVideoTexture===!0&&kn.getTransfer(R.emissiveMap.colorSpace)===Yn,premultipliedAlpha:R.premultipliedAlpha,doubleSided:R.side===Ea,flipSided:R.side===Ms,useDepthPacking:R.depthPacking>=0,depthPacking:R.depthPacking||0,index0AttributeName:R.index0AttributeName,extensionClipCullDistance:dt&&R.extensions.clipCullDistance===!0&&r.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(dt&&R.extensions.multiDraw===!0||Ve)&&r.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:R.customProgramCacheKey()};return zt.vertexUv1s=c.has(1),zt.vertexUv2s=c.has(2),zt.vertexUv3s=c.has(3),c.clear(),zt}function S(R){const U=[];if(R.shaderID?U.push(R.shaderID):(U.push(R.customVertexShaderID),U.push(R.customFragmentShaderID)),R.defines!==void 0)for(const V in R.defines)U.push(V),U.push(R.defines[V]);return R.isRawShaderMaterial===!1&&(T(U,R),A(U,R),U.push(n.outputColorSpace)),U.push(R.customProgramCacheKey),U.join()}function T(R,U){R.push(U.precision),R.push(U.outputColorSpace),R.push(U.envMapMode),R.push(U.envMapCubeUVHeight),R.push(U.mapUv),R.push(U.alphaMapUv),R.push(U.lightMapUv),R.push(U.aoMapUv),R.push(U.bumpMapUv),R.push(U.normalMapUv),R.push(U.displacementMapUv),R.push(U.emissiveMapUv),R.push(U.metalnessMapUv),R.push(U.roughnessMapUv),R.push(U.anisotropyMapUv),R.push(U.clearcoatMapUv),R.push(U.clearcoatNormalMapUv),R.push(U.clearcoatRoughnessMapUv),R.push(U.iridescenceMapUv),R.push(U.iridescenceThicknessMapUv),R.push(U.sheenColorMapUv),R.push(U.sheenRoughnessMapUv),R.push(U.specularMapUv),R.push(U.specularColorMapUv),R.push(U.specularIntensityMapUv),R.push(U.transmissionMapUv),R.push(U.thicknessMapUv),R.push(U.combine),R.push(U.fogExp2),R.push(U.sizeAttenuation),R.push(U.morphTargetsCount),R.push(U.morphAttributeCount),R.push(U.numDirLights),R.push(U.numPointLights),R.push(U.numSpotLights),R.push(U.numSpotLightMaps),R.push(U.numHemiLights),R.push(U.numRectAreaLights),R.push(U.numDirLightShadows),R.push(U.numPointLightShadows),R.push(U.numSpotLightShadows),R.push(U.numSpotLightShadowsWithMaps),R.push(U.numLightProbes),R.push(U.shadowMapType),R.push(U.toneMapping),R.push(U.numClippingPlanes),R.push(U.numClipIntersection),R.push(U.depthPacking)}function A(R,U){o.disableAll(),U.instancing&&o.enable(0),U.instancingColor&&o.enable(1),U.instancingMorph&&o.enable(2),U.matcap&&o.enable(3),U.envMap&&o.enable(4),U.normalMapObjectSpace&&o.enable(5),U.normalMapTangentSpace&&o.enable(6),U.clearcoat&&o.enable(7),U.iridescence&&o.enable(8),U.alphaTest&&o.enable(9),U.vertexColors&&o.enable(10),U.vertexAlphas&&o.enable(11),U.vertexUv1s&&o.enable(12),U.vertexUv2s&&o.enable(13),U.vertexUv3s&&o.enable(14),U.vertexTangents&&o.enable(15),U.anisotropy&&o.enable(16),U.alphaHash&&o.enable(17),U.batching&&o.enable(18),U.dispersion&&o.enable(19),U.batchingColor&&o.enable(20),U.gradientMap&&o.enable(21),R.push(o.mask),o.disableAll(),U.fog&&o.enable(0),U.useFog&&o.enable(1),U.flatShading&&o.enable(2),U.logarithmicDepthBuffer&&o.enable(3),U.reversedDepthBuffer&&o.enable(4),U.skinning&&o.enable(5),U.morphTargets&&o.enable(6),U.morphNormals&&o.enable(7),U.morphColors&&o.enable(8),U.premultipliedAlpha&&o.enable(9),U.shadowMapEnabled&&o.enable(10),U.doubleSided&&o.enable(11),U.flipSided&&o.enable(12),U.useDepthPacking&&o.enable(13),U.dithering&&o.enable(14),U.transmission&&o.enable(15),U.sheen&&o.enable(16),U.opaque&&o.enable(17),U.pointsUvs&&o.enable(18),U.decodeVideoTexture&&o.enable(19),U.decodeVideoTextureEmissive&&o.enable(20),U.alphaToCoverage&&o.enable(21),R.push(o.mask)}function P(R){const U=_[R.type];let V;if(U){const H=oo[U];V=rx.clone(H.uniforms)}else V=R.uniforms;return V}function L(R,U){let V=m.get(U);return V!==void 0?++V.usedTimes:(V=new w5(n,U,R,s),f.push(V),m.set(U,V)),V}function D(R){if(--R.usedTimes===0){const U=f.indexOf(R);f[U]=f[f.length-1],f.pop(),m.delete(R.cacheKey),R.destroy()}}function F(R){u.remove(R)}function k(){u.dispose()}return{getParameters:x,getProgramCacheKey:S,getUniforms:P,acquireProgram:L,releaseProgram:D,releaseShaderCache:F,programs:f,dispose:k}}function C5(){let n=new WeakMap;function e(a){return n.has(a)}function t(a){let o=n.get(a);return o===void 0&&(o={},n.set(a,o)),o}function r(a){n.delete(a)}function i(a,o,u){n.get(a)[o]=u}function s(){n=new WeakMap}return{has:e,get:t,remove:r,update:i,dispose:s}}function P5(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function f2(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function d2(){const n=[];let e=0;const t=[],r=[],i=[];function s(){e=0,t.length=0,r.length=0,i.length=0}function a(m,g,y,_,E,x){let S=n[e];return S===void 0?(S={id:m.id,object:m,geometry:g,material:y,groupOrder:_,renderOrder:m.renderOrder,z:E,group:x},n[e]=S):(S.id=m.id,S.object=m,S.geometry=g,S.material=y,S.groupOrder=_,S.renderOrder=m.renderOrder,S.z=E,S.group=x),e++,S}function o(m,g,y,_,E,x){const S=a(m,g,y,_,E,x);y.transmission>0?r.push(S):y.transparent===!0?i.push(S):t.push(S)}function u(m,g,y,_,E,x){const S=a(m,g,y,_,E,x);y.transmission>0?r.unshift(S):y.transparent===!0?i.unshift(S):t.unshift(S)}function c(m,g){t.length>1&&t.sort(m||P5),r.length>1&&r.sort(g||f2),i.length>1&&i.sort(g||f2)}function f(){for(let m=e,g=n.length;m<g;m++){const y=n[m];if(y.id===null)break;y.id=null,y.object=null,y.geometry=null,y.material=null,y.group=null}}return{opaque:t,transmissive:r,transparent:i,init:s,push:o,unshift:u,finish:f,sort:c}}function R5(){let n=new WeakMap;function e(r,i){const s=n.get(r);let a;return s===void 0?(a=new d2,n.set(r,[a])):i>=s.length?(a=new d2,s.push(a)):a=s[i],a}function t(){n=new WeakMap}return{get:e,dispose:t}}function I5(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new X,color:new jt};break;case"SpotLight":t={position:new X,direction:new X,color:new jt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new X,color:new jt,distance:0,decay:0};break;case"HemisphereLight":t={direction:new X,skyColor:new jt,groundColor:new jt};break;case"RectAreaLight":t={color:new jt,position:new X,halfWidth:new X,halfHeight:new X};break}return n[e.id]=t,t}}}function L5(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ct};break;case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ct};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ct,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[e.id]=t,t}}}let N5=0;function D5(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function U5(n){const e=new I5,t=L5(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let c=0;c<9;c++)r.probe.push(new X);const i=new X,s=new vn,a=new vn;function o(c){let f=0,m=0,g=0;for(let R=0;R<9;R++)r.probe[R].set(0,0,0);let y=0,_=0,E=0,x=0,S=0,T=0,A=0,P=0,L=0,D=0,F=0;c.sort(D5);for(let R=0,U=c.length;R<U;R++){const V=c[R],H=V.color,J=V.intensity,$=V.distance;let ae=null;if(V.shadow&&V.shadow.map&&(V.shadow.map.texture.format===jc?ae=V.shadow.map.texture:ae=V.shadow.map.depthTexture||V.shadow.map.texture),V.isAmbientLight)f+=H.r*J,m+=H.g*J,g+=H.b*J;else if(V.isLightProbe){for(let ne=0;ne<9;ne++)r.probe[ne].addScaledVector(V.sh.coefficients[ne],J);F++}else if(V.isDirectionalLight){const ne=e.get(V);if(ne.color.copy(V.color).multiplyScalar(V.intensity),V.castShadow){const oe=V.shadow,te=t.get(V);te.shadowIntensity=oe.intensity,te.shadowBias=oe.bias,te.shadowNormalBias=oe.normalBias,te.shadowRadius=oe.radius,te.shadowMapSize=oe.mapSize,r.directionalShadow[y]=te,r.directionalShadowMap[y]=ae,r.directionalShadowMatrix[y]=V.shadow.matrix,T++}r.directional[y]=ne,y++}else if(V.isSpotLight){const ne=e.get(V);ne.position.setFromMatrixPosition(V.matrixWorld),ne.color.copy(H).multiplyScalar(J),ne.distance=$,ne.coneCos=Math.cos(V.angle),ne.penumbraCos=Math.cos(V.angle*(1-V.penumbra)),ne.decay=V.decay,r.spot[E]=ne;const oe=V.shadow;if(V.map&&(r.spotLightMap[L]=V.map,L++,oe.updateMatrices(V),V.castShadow&&D++),r.spotLightMatrix[E]=oe.matrix,V.castShadow){const te=t.get(V);te.shadowIntensity=oe.intensity,te.shadowBias=oe.bias,te.shadowNormalBias=oe.normalBias,te.shadowRadius=oe.radius,te.shadowMapSize=oe.mapSize,r.spotShadow[E]=te,r.spotShadowMap[E]=ae,P++}E++}else if(V.isRectAreaLight){const ne=e.get(V);ne.color.copy(H).multiplyScalar(J),ne.halfWidth.set(V.width*.5,0,0),ne.halfHeight.set(0,V.height*.5,0),r.rectArea[x]=ne,x++}else if(V.isPointLight){const ne=e.get(V);if(ne.color.copy(V.color).multiplyScalar(V.intensity),ne.distance=V.distance,ne.decay=V.decay,V.castShadow){const oe=V.shadow,te=t.get(V);te.shadowIntensity=oe.intensity,te.shadowBias=oe.bias,te.shadowNormalBias=oe.normalBias,te.shadowRadius=oe.radius,te.shadowMapSize=oe.mapSize,te.shadowCameraNear=oe.camera.near,te.shadowCameraFar=oe.camera.far,r.pointShadow[_]=te,r.pointShadowMap[_]=ae,r.pointShadowMatrix[_]=V.shadow.matrix,A++}r.point[_]=ne,_++}else if(V.isHemisphereLight){const ne=e.get(V);ne.skyColor.copy(V.color).multiplyScalar(J),ne.groundColor.copy(V.groundColor).multiplyScalar(J),r.hemi[S]=ne,S++}}x>0&&(n.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=Gt.LTC_FLOAT_1,r.rectAreaLTC2=Gt.LTC_FLOAT_2):(r.rectAreaLTC1=Gt.LTC_HALF_1,r.rectAreaLTC2=Gt.LTC_HALF_2)),r.ambient[0]=f,r.ambient[1]=m,r.ambient[2]=g;const k=r.hash;(k.directionalLength!==y||k.pointLength!==_||k.spotLength!==E||k.rectAreaLength!==x||k.hemiLength!==S||k.numDirectionalShadows!==T||k.numPointShadows!==A||k.numSpotShadows!==P||k.numSpotMaps!==L||k.numLightProbes!==F)&&(r.directional.length=y,r.spot.length=E,r.rectArea.length=x,r.point.length=_,r.hemi.length=S,r.directionalShadow.length=T,r.directionalShadowMap.length=T,r.pointShadow.length=A,r.pointShadowMap.length=A,r.spotShadow.length=P,r.spotShadowMap.length=P,r.directionalShadowMatrix.length=T,r.pointShadowMatrix.length=A,r.spotLightMatrix.length=P+L-D,r.spotLightMap.length=L,r.numSpotLightShadowsWithMaps=D,r.numLightProbes=F,k.directionalLength=y,k.pointLength=_,k.spotLength=E,k.rectAreaLength=x,k.hemiLength=S,k.numDirectionalShadows=T,k.numPointShadows=A,k.numSpotShadows=P,k.numSpotMaps=L,k.numLightProbes=F,r.version=N5++)}function u(c,f){let m=0,g=0,y=0,_=0,E=0;const x=f.matrixWorldInverse;for(let S=0,T=c.length;S<T;S++){const A=c[S];if(A.isDirectionalLight){const P=r.directional[m];P.direction.setFromMatrixPosition(A.matrixWorld),i.setFromMatrixPosition(A.target.matrixWorld),P.direction.sub(i),P.direction.transformDirection(x),m++}else if(A.isSpotLight){const P=r.spot[y];P.position.setFromMatrixPosition(A.matrixWorld),P.position.applyMatrix4(x),P.direction.setFromMatrixPosition(A.matrixWorld),i.setFromMatrixPosition(A.target.matrixWorld),P.direction.sub(i),P.direction.transformDirection(x),y++}else if(A.isRectAreaLight){const P=r.rectArea[_];P.position.setFromMatrixPosition(A.matrixWorld),P.position.applyMatrix4(x),a.identity(),s.copy(A.matrixWorld),s.premultiply(x),a.extractRotation(s),P.halfWidth.set(A.width*.5,0,0),P.halfHeight.set(0,A.height*.5,0),P.halfWidth.applyMatrix4(a),P.halfHeight.applyMatrix4(a),_++}else if(A.isPointLight){const P=r.point[g];P.position.setFromMatrixPosition(A.matrixWorld),P.position.applyMatrix4(x),g++}else if(A.isHemisphereLight){const P=r.hemi[E];P.direction.setFromMatrixPosition(A.matrixWorld),P.direction.transformDirection(x),E++}}}return{setup:o,setupView:u,state:r}}function p2(n){const e=new U5(n),t=[],r=[];function i(f){c.camera=f,t.length=0,r.length=0}function s(f){t.push(f)}function a(f){r.push(f)}function o(){e.setup(t)}function u(f){e.setupView(t,f)}const c={lightsArray:t,shadowsArray:r,camera:null,lights:e,transmissionRenderTarget:{}};return{init:i,state:c,setupLights:o,setupLightsView:u,pushLight:s,pushShadow:a}}function F5(n){let e=new WeakMap;function t(i,s=0){const a=e.get(i);let o;return a===void 0?(o=new p2(n),e.set(i,[o])):s>=a.length?(o=new p2(n),a.push(o)):o=a[s],o}function r(){e=new WeakMap}return{get:t,dispose:r}}const O5=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,k5=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ).rg;
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ).r;
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( max( 0.0, squared_mean - mean * mean ) );
	gl_FragColor = vec4( mean, std_dev, 0.0, 1.0 );
}`,z5=[new X(1,0,0),new X(-1,0,0),new X(0,1,0),new X(0,-1,0),new X(0,0,1),new X(0,0,-1)],B5=[new X(0,-1,0),new X(0,-1,0),new X(0,0,1),new X(0,0,-1),new X(0,-1,0),new X(0,-1,0)],m2=new vn,ep=new X,ky=new X;function G5(n,e,t){let r=new Xf;const i=new ct,s=new ct,a=new $n,o=new l1,u=new u1,c={},f=t.maxTextureSize,m={[Pl]:Ms,[Ms]:Pl,[Ea]:Ea},g=new Es({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new ct},radius:{value:4}},vertexShader:O5,fragmentShader:k5}),y=g.clone();y.defines.HORIZONTAL_PASS=1;const _=new Sn;_.setAttribute("position",new jn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const E=new pi(_,g),x=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Af;let S=this.type;this.render=function(D,F,k){if(x.enabled===!1||x.autoUpdate===!1&&x.needsUpdate===!1||D.length===0)return;D.type===pp&&(Ft("WebGLShadowMap: PCFSoftShadowMap has been deprecated. Using PCFShadowMap instead."),D.type=Af);const R=n.getRenderTarget(),U=n.getActiveCubeFace(),V=n.getActiveMipmapLevel(),H=n.state;H.setBlending(uo),H.buffers.depth.getReversed()===!0?H.buffers.color.setClear(0,0,0,0):H.buffers.color.setClear(1,1,1,1),H.buffers.depth.setTest(!0),H.setScissorTest(!1);const J=S!==this.type;J&&F.traverse(function($){$.material&&(Array.isArray($.material)?$.material.forEach(ae=>ae.needsUpdate=!0):$.material.needsUpdate=!0)});for(let $=0,ae=D.length;$<ae;$++){const ne=D[$],oe=ne.shadow;if(oe===void 0){Ft("WebGLShadowMap:",ne,"has no shadow.");continue}if(oe.autoUpdate===!1&&oe.needsUpdate===!1)continue;i.copy(oe.mapSize);const te=oe.getFrameExtents();if(i.multiply(te),s.copy(oe.mapSize),(i.x>f||i.y>f)&&(i.x>f&&(s.x=Math.floor(f/te.x),i.x=s.x*te.x,oe.mapSize.x=s.x),i.y>f&&(s.y=Math.floor(f/te.y),i.y=s.y*te.y,oe.mapSize.y=s.y)),oe.map===null||J===!0){if(oe.map!==null&&(oe.map.depthTexture!==null&&(oe.map.depthTexture.dispose(),oe.map.depthTexture=null),oe.map.dispose()),this.type===Nc){if(ne.isPointLight){Ft("WebGLShadowMap: VSM shadow maps are not supported for PointLights. Use PCF or BasicShadowMap instead.");continue}oe.map=new ws(i.x,i.y,{format:jc,type:Vi,minFilter:Dn,magFilter:Dn,generateMipmaps:!1}),oe.map.texture.name=ne.name+".shadowMap",oe.map.depthTexture=new zf(i.x,i.y,bi),oe.map.depthTexture.name=ne.name+".shadowMapDepth",oe.map.depthTexture.format=ko,oe.map.depthTexture.compareFunction=null,oe.map.depthTexture.minFilter=Ji,oe.map.depthTexture.magFilter=Ji}else{ne.isPointLight?(oe.map=new Hv(i.x),oe.map.depthTexture=new EE(i.x,ca)):(oe.map=new ws(i.x,i.y),oe.map.depthTexture=new zf(i.x,i.y,ca)),oe.map.depthTexture.name=ne.name+".shadowMap",oe.map.depthTexture.format=ko;const Y=n.state.buffers.depth.getReversed();this.type===Af?(oe.map.depthTexture.compareFunction=Y?Bv:zv,oe.map.depthTexture.minFilter=Dn,oe.map.depthTexture.magFilter=Dn):(oe.map.depthTexture.compareFunction=null,oe.map.depthTexture.minFilter=Ji,oe.map.depthTexture.magFilter=Ji)}oe.camera.updateProjectionMatrix()}const ie=oe.map.isWebGLCubeRenderTarget?6:1;for(let Y=0;Y<ie;Y++){if(oe.map.isWebGLCubeRenderTarget)n.setRenderTarget(oe.map,Y),n.clear();else{Y===0&&(n.setRenderTarget(oe.map),n.clear());const z=oe.getViewport(Y);a.set(s.x*z.x,s.y*z.y,s.x*z.z,s.y*z.w),H.viewport(a)}if(ne.isPointLight){const z=oe.camera,K=oe.matrix,le=ne.distance||z.far;le!==z.far&&(z.far=le,z.updateProjectionMatrix()),ep.setFromMatrixPosition(ne.matrixWorld),z.position.copy(ep),ky.copy(z.position),ky.add(z5[Y]),z.up.copy(B5[Y]),z.lookAt(ky),z.updateMatrixWorld(),K.makeTranslation(-ep.x,-ep.y,-ep.z),m2.multiplyMatrices(z.projectionMatrix,z.matrixWorldInverse),oe._frustum.setFromProjectionMatrix(m2,z.coordinateSystem,z.reversedDepth)}else oe.updateMatrices(ne);r=oe.getFrustum(),P(F,k,oe.camera,ne,this.type)}oe.isPointLightShadow!==!0&&this.type===Nc&&T(oe,k),oe.needsUpdate=!1}S=this.type,x.needsUpdate=!1,n.setRenderTarget(R,U,V)};function T(D,F){const k=e.update(E);g.defines.VSM_SAMPLES!==D.blurSamples&&(g.defines.VSM_SAMPLES=D.blurSamples,y.defines.VSM_SAMPLES=D.blurSamples,g.needsUpdate=!0,y.needsUpdate=!0),D.mapPass===null&&(D.mapPass=new ws(i.x,i.y,{format:jc,type:Vi})),g.uniforms.shadow_pass.value=D.map.depthTexture,g.uniforms.resolution.value=D.mapSize,g.uniforms.radius.value=D.radius,n.setRenderTarget(D.mapPass),n.clear(),n.renderBufferDirect(F,null,k,g,E,null),y.uniforms.shadow_pass.value=D.mapPass.texture,y.uniforms.resolution.value=D.mapSize,y.uniforms.radius.value=D.radius,n.setRenderTarget(D.map),n.clear(),n.renderBufferDirect(F,null,k,y,E,null)}function A(D,F,k,R){let U=null;const V=k.isPointLight===!0?D.customDistanceMaterial:D.customDepthMaterial;if(V!==void 0)U=V;else if(U=k.isPointLight===!0?u:o,n.localClippingEnabled&&F.clipShadows===!0&&Array.isArray(F.clippingPlanes)&&F.clippingPlanes.length!==0||F.displacementMap&&F.displacementScale!==0||F.alphaMap&&F.alphaTest>0||F.map&&F.alphaTest>0||F.alphaToCoverage===!0){const H=U.uuid,J=F.uuid;let $=c[H];$===void 0&&($={},c[H]=$);let ae=$[J];ae===void 0&&(ae=U.clone(),$[J]=ae,F.addEventListener("dispose",L)),U=ae}if(U.visible=F.visible,U.wireframe=F.wireframe,R===Nc?U.side=F.shadowSide!==null?F.shadowSide:F.side:U.side=F.shadowSide!==null?F.shadowSide:m[F.side],U.alphaMap=F.alphaMap,U.alphaTest=F.alphaToCoverage===!0?.5:F.alphaTest,U.map=F.map,U.clipShadows=F.clipShadows,U.clippingPlanes=F.clippingPlanes,U.clipIntersection=F.clipIntersection,U.displacementMap=F.displacementMap,U.displacementScale=F.displacementScale,U.displacementBias=F.displacementBias,U.wireframeLinewidth=F.wireframeLinewidth,U.linewidth=F.linewidth,k.isPointLight===!0&&U.isMeshDistanceMaterial===!0){const H=n.properties.get(U);H.light=k}return U}function P(D,F,k,R,U){if(D.visible===!1)return;if(D.layers.test(F.layers)&&(D.isMesh||D.isLine||D.isPoints)&&(D.castShadow||D.receiveShadow&&U===Nc)&&(!D.frustumCulled||r.intersectsObject(D))){D.modelViewMatrix.multiplyMatrices(k.matrixWorldInverse,D.matrixWorld);const J=e.update(D),$=D.material;if(Array.isArray($)){const ae=J.groups;for(let ne=0,oe=ae.length;ne<oe;ne++){const te=ae[ne],ie=$[te.materialIndex];if(ie&&ie.visible){const Y=A(D,ie,R,U);D.onBeforeShadow(n,D,F,k,J,Y,te),n.renderBufferDirect(k,null,J,Y,D,te),D.onAfterShadow(n,D,F,k,J,Y,te)}}}else if($.visible){const ae=A(D,$,R,U);D.onBeforeShadow(n,D,F,k,J,ae,null),n.renderBufferDirect(k,null,J,ae,D,null),D.onAfterShadow(n,D,F,k,J,ae,null)}}const H=D.children;for(let J=0,$=H.length;J<$;J++)P(H[J],F,k,R,U)}function L(D){D.target.removeEventListener("dispose",L);for(const k in c){const R=c[k],U=D.target.uuid;U in R&&(R[U].dispose(),delete R[U])}}}const V5={[Cg]:Pg,[Rg]:Ng,[Ig]:Dg,[Wc]:Lg,[Pg]:Cg,[Ng]:Rg,[Dg]:Ig,[Lg]:Wc};function H5(n,e){function t(){let pe=!1;const Ee=new $n;let et=null;const Pt=new $n(0,0,0,0);return{setMask:function(tt){et!==tt&&!pe&&(n.colorMask(tt,tt,tt,tt),et=tt)},setLocked:function(tt){pe=tt},setClear:function(tt,ke,dt,kt,zt){zt===!0&&(tt*=kt,ke*=kt,dt*=kt),Ee.set(tt,ke,dt,kt),Pt.equals(Ee)===!1&&(n.clearColor(tt,ke,dt,kt),Pt.copy(Ee))},reset:function(){pe=!1,et=null,Pt.set(-1,0,0,0)}}}function r(){let pe=!1,Ee=!1,et=null,Pt=null,tt=null;return{setReversed:function(ke){if(Ee!==ke){const dt=e.get("EXT_clip_control");ke?dt.clipControlEXT(dt.LOWER_LEFT_EXT,dt.ZERO_TO_ONE_EXT):dt.clipControlEXT(dt.LOWER_LEFT_EXT,dt.NEGATIVE_ONE_TO_ONE_EXT),Ee=ke;const kt=tt;tt=null,this.setClear(kt)}},getReversed:function(){return Ee},setTest:function(ke){ke?he(n.DEPTH_TEST):ye(n.DEPTH_TEST)},setMask:function(ke){et!==ke&&!pe&&(n.depthMask(ke),et=ke)},setFunc:function(ke){if(Ee&&(ke=V5[ke]),Pt!==ke){switch(ke){case Cg:n.depthFunc(n.NEVER);break;case Pg:n.depthFunc(n.ALWAYS);break;case Rg:n.depthFunc(n.LESS);break;case Wc:n.depthFunc(n.LEQUAL);break;case Ig:n.depthFunc(n.EQUAL);break;case Lg:n.depthFunc(n.GEQUAL);break;case Ng:n.depthFunc(n.GREATER);break;case Dg:n.depthFunc(n.NOTEQUAL);break;default:n.depthFunc(n.LEQUAL)}Pt=ke}},setLocked:function(ke){pe=ke},setClear:function(ke){tt!==ke&&(Ee&&(ke=1-ke),n.clearDepth(ke),tt=ke)},reset:function(){pe=!1,et=null,Pt=null,tt=null,Ee=!1}}}function i(){let pe=!1,Ee=null,et=null,Pt=null,tt=null,ke=null,dt=null,kt=null,zt=null;return{setTest:function(nn){pe||(nn?he(n.STENCIL_TEST):ye(n.STENCIL_TEST))},setMask:function(nn){Ee!==nn&&!pe&&(n.stencilMask(nn),Ee=nn)},setFunc:function(nn,zn,Un){(et!==nn||Pt!==zn||tt!==Un)&&(n.stencilFunc(nn,zn,Un),et=nn,Pt=zn,tt=Un)},setOp:function(nn,zn,Un){(ke!==nn||dt!==zn||kt!==Un)&&(n.stencilOp(nn,zn,Un),ke=nn,dt=zn,kt=Un)},setLocked:function(nn){pe=nn},setClear:function(nn){zt!==nn&&(n.clearStencil(nn),zt=nn)},reset:function(){pe=!1,Ee=null,et=null,Pt=null,tt=null,ke=null,dt=null,kt=null,zt=null}}}const s=new t,a=new r,o=new i,u=new WeakMap,c=new WeakMap;let f={},m={},g=new WeakMap,y=[],_=null,E=!1,x=null,S=null,T=null,A=null,P=null,L=null,D=null,F=new jt(0,0,0),k=0,R=!1,U=null,V=null,H=null,J=null,$=null;const ae=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let ne=!1,oe=0;const te=n.getParameter(n.VERSION);te.indexOf("WebGL")!==-1?(oe=parseFloat(/^WebGL (\d)/.exec(te)[1]),ne=oe>=1):te.indexOf("OpenGL ES")!==-1&&(oe=parseFloat(/^OpenGL ES (\d)/.exec(te)[1]),ne=oe>=2);let ie=null,Y={};const z=n.getParameter(n.SCISSOR_BOX),K=n.getParameter(n.VIEWPORT),le=new $n().fromArray(z),me=new $n().fromArray(K);function ve(pe,Ee,et,Pt){const tt=new Uint8Array(4),ke=n.createTexture();n.bindTexture(pe,ke),n.texParameteri(pe,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(pe,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let dt=0;dt<et;dt++)pe===n.TEXTURE_3D||pe===n.TEXTURE_2D_ARRAY?n.texImage3D(Ee,0,n.RGBA,1,1,Pt,0,n.RGBA,n.UNSIGNED_BYTE,tt):n.texImage2D(Ee+dt,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,tt);return ke}const re={};re[n.TEXTURE_2D]=ve(n.TEXTURE_2D,n.TEXTURE_2D,1),re[n.TEXTURE_CUBE_MAP]=ve(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),re[n.TEXTURE_2D_ARRAY]=ve(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),re[n.TEXTURE_3D]=ve(n.TEXTURE_3D,n.TEXTURE_3D,1,1),s.setClear(0,0,0,1),a.setClear(1),o.setClear(0),he(n.DEPTH_TEST),a.setFunc(Wc),De(!1),it(l_),he(n.CULL_FACE),Ne(uo);function he(pe){f[pe]!==!0&&(n.enable(pe),f[pe]=!0)}function ye(pe){f[pe]!==!1&&(n.disable(pe),f[pe]=!1)}function ze(pe,Ee){return m[pe]!==Ee?(n.bindFramebuffer(pe,Ee),m[pe]=Ee,pe===n.DRAW_FRAMEBUFFER&&(m[n.FRAMEBUFFER]=Ee),pe===n.FRAMEBUFFER&&(m[n.DRAW_FRAMEBUFFER]=Ee),!0):!1}function Ve(pe,Ee){let et=y,Pt=!1;if(pe){et=g.get(Ee),et===void 0&&(et=[],g.set(Ee,et));const tt=pe.textures;if(et.length!==tt.length||et[0]!==n.COLOR_ATTACHMENT0){for(let ke=0,dt=tt.length;ke<dt;ke++)et[ke]=n.COLOR_ATTACHMENT0+ke;et.length=tt.length,Pt=!0}}else et[0]!==n.BACK&&(et[0]=n.BACK,Pt=!0);Pt&&n.drawBuffers(et)}function Ke(pe){return _!==pe?(n.useProgram(pe),_=pe,!0):!1}const Qe={[gu]:n.FUNC_ADD,[Rw]:n.FUNC_SUBTRACT,[Iw]:n.FUNC_REVERSE_SUBTRACT};Qe[Lw]=n.MIN,Qe[Nw]=n.MAX;const pt={[Dw]:n.ZERO,[Uw]:n.ONE,[Fw]:n.SRC_COLOR,[bg]:n.SRC_ALPHA,[Vw]:n.SRC_ALPHA_SATURATE,[Bw]:n.DST_COLOR,[kw]:n.DST_ALPHA,[Ow]:n.ONE_MINUS_SRC_COLOR,[Ag]:n.ONE_MINUS_SRC_ALPHA,[Gw]:n.ONE_MINUS_DST_COLOR,[zw]:n.ONE_MINUS_DST_ALPHA,[Hw]:n.CONSTANT_COLOR,[Ww]:n.ONE_MINUS_CONSTANT_COLOR,[jw]:n.CONSTANT_ALPHA,[Xw]:n.ONE_MINUS_CONSTANT_ALPHA};function Ne(pe,Ee,et,Pt,tt,ke,dt,kt,zt,nn){if(pe===uo){E===!0&&(ye(n.BLEND),E=!1);return}if(E===!1&&(he(n.BLEND),E=!0),pe!==Pw){if(pe!==x||nn!==R){if((S!==gu||P!==gu)&&(n.blendEquation(n.FUNC_ADD),S=gu,P=gu),nn)switch(pe){case zc:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case u_:n.blendFunc(n.ONE,n.ONE);break;case c_:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case h_:n.blendFuncSeparate(n.DST_COLOR,n.ONE_MINUS_SRC_ALPHA,n.ZERO,n.ONE);break;default:ln("WebGLState: Invalid blending: ",pe);break}else switch(pe){case zc:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case u_:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE,n.ONE,n.ONE);break;case c_:ln("WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case h_:ln("WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:ln("WebGLState: Invalid blending: ",pe);break}T=null,A=null,L=null,D=null,F.set(0,0,0),k=0,x=pe,R=nn}return}tt=tt||Ee,ke=ke||et,dt=dt||Pt,(Ee!==S||tt!==P)&&(n.blendEquationSeparate(Qe[Ee],Qe[tt]),S=Ee,P=tt),(et!==T||Pt!==A||ke!==L||dt!==D)&&(n.blendFuncSeparate(pt[et],pt[Pt],pt[ke],pt[dt]),T=et,A=Pt,L=ke,D=dt),(kt.equals(F)===!1||zt!==k)&&(n.blendColor(kt.r,kt.g,kt.b,zt),F.copy(kt),k=zt),x=pe,R=!1}function Be(pe,Ee){pe.side===Ea?ye(n.CULL_FACE):he(n.CULL_FACE);let et=pe.side===Ms;Ee&&(et=!et),De(et),pe.blending===zc&&pe.transparent===!1?Ne(uo):Ne(pe.blending,pe.blendEquation,pe.blendSrc,pe.blendDst,pe.blendEquationAlpha,pe.blendSrcAlpha,pe.blendDstAlpha,pe.blendColor,pe.blendAlpha,pe.premultipliedAlpha),a.setFunc(pe.depthFunc),a.setTest(pe.depthTest),a.setMask(pe.depthWrite),s.setMask(pe.colorWrite);const Pt=pe.stencilWrite;o.setTest(Pt),Pt&&(o.setMask(pe.stencilWriteMask),o.setFunc(pe.stencilFunc,pe.stencilRef,pe.stencilFuncMask),o.setOp(pe.stencilFail,pe.stencilZFail,pe.stencilZPass)),at(pe.polygonOffset,pe.polygonOffsetFactor,pe.polygonOffsetUnits),pe.alphaToCoverage===!0?he(n.SAMPLE_ALPHA_TO_COVERAGE):ye(n.SAMPLE_ALPHA_TO_COVERAGE)}function De(pe){U!==pe&&(pe?n.frontFace(n.CW):n.frontFace(n.CCW),U=pe)}function it(pe){pe!==bw?(he(n.CULL_FACE),pe!==V&&(pe===l_?n.cullFace(n.BACK):pe===Aw?n.cullFace(n.FRONT):n.cullFace(n.FRONT_AND_BACK))):ye(n.CULL_FACE),V=pe}function Q(pe){pe!==H&&(ne&&n.lineWidth(pe),H=pe)}function at(pe,Ee,et){pe?(he(n.POLYGON_OFFSET_FILL),(J!==Ee||$!==et)&&(n.polygonOffset(Ee,et),J=Ee,$=et)):ye(n.POLYGON_OFFSET_FILL)}function je(pe){pe?he(n.SCISSOR_TEST):ye(n.SCISSOR_TEST)}function Ce(pe){pe===void 0&&(pe=n.TEXTURE0+ae-1),ie!==pe&&(n.activeTexture(pe),ie=pe)}function He(pe,Ee,et){et===void 0&&(ie===null?et=n.TEXTURE0+ae-1:et=ie);let Pt=Y[et];Pt===void 0&&(Pt={type:void 0,texture:void 0},Y[et]=Pt),(Pt.type!==pe||Pt.texture!==Ee)&&(ie!==et&&(n.activeTexture(et),ie=et),n.bindTexture(pe,Ee||re[pe]),Pt.type=pe,Pt.texture=Ee)}function q(){const pe=Y[ie];pe!==void 0&&pe.type!==void 0&&(n.bindTexture(pe.type,null),pe.type=void 0,pe.texture=void 0)}function B(){try{n.compressedTexImage2D(...arguments)}catch(pe){ln("WebGLState:",pe)}}function ue(){try{n.compressedTexImage3D(...arguments)}catch(pe){ln("WebGLState:",pe)}}function Re(){try{n.texSubImage2D(...arguments)}catch(pe){ln("WebGLState:",pe)}}function Pe(){try{n.texSubImage3D(...arguments)}catch(pe){ln("WebGLState:",pe)}}function Te(){try{n.compressedTexSubImage2D(...arguments)}catch(pe){ln("WebGLState:",pe)}}function ot(){try{n.compressedTexSubImage3D(...arguments)}catch(pe){ln("WebGLState:",pe)}}function rt(){try{n.texStorage2D(...arguments)}catch(pe){ln("WebGLState:",pe)}}function mt(){try{n.texStorage3D(...arguments)}catch(pe){ln("WebGLState:",pe)}}function Rt(){try{n.texImage2D(...arguments)}catch(pe){ln("WebGLState:",pe)}}function Ge(){try{n.texImage3D(...arguments)}catch(pe){ln("WebGLState:",pe)}}function Xe(pe){le.equals(pe)===!1&&(n.scissor(pe.x,pe.y,pe.z,pe.w),le.copy(pe))}function nt(pe){me.equals(pe)===!1&&(n.viewport(pe.x,pe.y,pe.z,pe.w),me.copy(pe))}function gt(pe,Ee){let et=c.get(Ee);et===void 0&&(et=new WeakMap,c.set(Ee,et));let Pt=et.get(pe);Pt===void 0&&(Pt=n.getUniformBlockIndex(Ee,pe.name),et.set(pe,Pt))}function st(pe,Ee){const Pt=c.get(Ee).get(pe);u.get(Ee)!==Pt&&(n.uniformBlockBinding(Ee,Pt,pe.__bindingPointIndex),u.set(Ee,Pt))}function Ot(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.blendColor(0,0,0,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),a.setReversed(!1),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),f={},ie=null,Y={},m={},g=new WeakMap,y=[],_=null,E=!1,x=null,S=null,T=null,A=null,P=null,L=null,D=null,F=new jt(0,0,0),k=0,R=!1,U=null,V=null,H=null,J=null,$=null,le.set(0,0,n.canvas.width,n.canvas.height),me.set(0,0,n.canvas.width,n.canvas.height),s.reset(),a.reset(),o.reset()}return{buffers:{color:s,depth:a,stencil:o},enable:he,disable:ye,bindFramebuffer:ze,drawBuffers:Ve,useProgram:Ke,setBlending:Ne,setMaterial:Be,setFlipSided:De,setCullFace:it,setLineWidth:Q,setPolygonOffset:at,setScissorTest:je,activeTexture:Ce,bindTexture:He,unbindTexture:q,compressedTexImage2D:B,compressedTexImage3D:ue,texImage2D:Rt,texImage3D:Ge,updateUBOMapping:gt,uniformBlockBinding:st,texStorage2D:rt,texStorage3D:mt,texSubImage2D:Re,texSubImage3D:Pe,compressedTexSubImage2D:Te,compressedTexSubImage3D:ot,scissor:Xe,viewport:nt,reset:Ot}}function W5(n,e,t,r,i,s,a){const o=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,u=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),c=new ct,f=new WeakMap;let m;const g=new WeakMap;let y=!1;try{y=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function _(q,B){return y?new OffscreenCanvas(q,B):kp("canvas")}function E(q,B,ue){let Re=1;const Pe=He(q);if((Pe.width>ue||Pe.height>ue)&&(Re=ue/Math.max(Pe.width,Pe.height)),Re<1)if(typeof HTMLImageElement<"u"&&q instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&q instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&q instanceof ImageBitmap||typeof VideoFrame<"u"&&q instanceof VideoFrame){const Te=Math.floor(Re*Pe.width),ot=Math.floor(Re*Pe.height);m===void 0&&(m=_(Te,ot));const rt=B?_(Te,ot):m;return rt.width=Te,rt.height=ot,rt.getContext("2d").drawImage(q,0,0,Te,ot),Ft("WebGLRenderer: Texture has been resized from ("+Pe.width+"x"+Pe.height+") to ("+Te+"x"+ot+")."),rt}else return"data"in q&&Ft("WebGLRenderer: Image in DataTexture is too big ("+Pe.width+"x"+Pe.height+")."),q;return q}function x(q){return q.generateMipmaps}function S(q){n.generateMipmap(q)}function T(q){return q.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:q.isWebGL3DRenderTarget?n.TEXTURE_3D:q.isWebGLArrayRenderTarget||q.isCompressedArrayTexture?n.TEXTURE_2D_ARRAY:n.TEXTURE_2D}function A(q,B,ue,Re,Pe=!1){if(q!==null){if(n[q]!==void 0)return n[q];Ft("WebGLRenderer: Attempt to use non-existing WebGL internal format '"+q+"'")}let Te=B;if(B===n.RED&&(ue===n.FLOAT&&(Te=n.R32F),ue===n.HALF_FLOAT&&(Te=n.R16F),ue===n.UNSIGNED_BYTE&&(Te=n.R8)),B===n.RED_INTEGER&&(ue===n.UNSIGNED_BYTE&&(Te=n.R8UI),ue===n.UNSIGNED_SHORT&&(Te=n.R16UI),ue===n.UNSIGNED_INT&&(Te=n.R32UI),ue===n.BYTE&&(Te=n.R8I),ue===n.SHORT&&(Te=n.R16I),ue===n.INT&&(Te=n.R32I)),B===n.RG&&(ue===n.FLOAT&&(Te=n.RG32F),ue===n.HALF_FLOAT&&(Te=n.RG16F),ue===n.UNSIGNED_BYTE&&(Te=n.RG8)),B===n.RG_INTEGER&&(ue===n.UNSIGNED_BYTE&&(Te=n.RG8UI),ue===n.UNSIGNED_SHORT&&(Te=n.RG16UI),ue===n.UNSIGNED_INT&&(Te=n.RG32UI),ue===n.BYTE&&(Te=n.RG8I),ue===n.SHORT&&(Te=n.RG16I),ue===n.INT&&(Te=n.RG32I)),B===n.RGB_INTEGER&&(ue===n.UNSIGNED_BYTE&&(Te=n.RGB8UI),ue===n.UNSIGNED_SHORT&&(Te=n.RGB16UI),ue===n.UNSIGNED_INT&&(Te=n.RGB32UI),ue===n.BYTE&&(Te=n.RGB8I),ue===n.SHORT&&(Te=n.RGB16I),ue===n.INT&&(Te=n.RGB32I)),B===n.RGBA_INTEGER&&(ue===n.UNSIGNED_BYTE&&(Te=n.RGBA8UI),ue===n.UNSIGNED_SHORT&&(Te=n.RGBA16UI),ue===n.UNSIGNED_INT&&(Te=n.RGBA32UI),ue===n.BYTE&&(Te=n.RGBA8I),ue===n.SHORT&&(Te=n.RGBA16I),ue===n.INT&&(Te=n.RGBA32I)),B===n.RGB&&(ue===n.UNSIGNED_INT_5_9_9_9_REV&&(Te=n.RGB9_E5),ue===n.UNSIGNED_INT_10F_11F_11F_REV&&(Te=n.R11F_G11F_B10F)),B===n.RGBA){const ot=Pe?Fp:kn.getTransfer(Re);ue===n.FLOAT&&(Te=n.RGBA32F),ue===n.HALF_FLOAT&&(Te=n.RGBA16F),ue===n.UNSIGNED_BYTE&&(Te=ot===Yn?n.SRGB8_ALPHA8:n.RGBA8),ue===n.UNSIGNED_SHORT_4_4_4_4&&(Te=n.RGBA4),ue===n.UNSIGNED_SHORT_5_5_5_1&&(Te=n.RGB5_A1)}return(Te===n.R16F||Te===n.R32F||Te===n.RG16F||Te===n.RG32F||Te===n.RGBA16F||Te===n.RGBA32F)&&e.get("EXT_color_buffer_float"),Te}function P(q,B){let ue;return q?B===null||B===ca||B===Df?ue=n.DEPTH24_STENCIL8:B===bi?ue=n.DEPTH32F_STENCIL8:B===Nf&&(ue=n.DEPTH24_STENCIL8,Ft("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):B===null||B===ca||B===Df?ue=n.DEPTH_COMPONENT24:B===bi?ue=n.DEPTH_COMPONENT32F:B===Nf&&(ue=n.DEPTH_COMPONENT16),ue}function L(q,B){return x(q)===!0||q.isFramebufferTexture&&q.minFilter!==Ji&&q.minFilter!==Dn?Math.log2(Math.max(B.width,B.height))+1:q.mipmaps!==void 0&&q.mipmaps.length>0?q.mipmaps.length:q.isCompressedTexture&&Array.isArray(q.image)?B.mipmaps.length:1}function D(q){const B=q.target;B.removeEventListener("dispose",D),k(B),B.isVideoTexture&&f.delete(B)}function F(q){const B=q.target;B.removeEventListener("dispose",F),U(B)}function k(q){const B=r.get(q);if(B.__webglInit===void 0)return;const ue=q.source,Re=g.get(ue);if(Re){const Pe=Re[B.__cacheKey];Pe.usedTimes--,Pe.usedTimes===0&&R(q),Object.keys(Re).length===0&&g.delete(ue)}r.remove(q)}function R(q){const B=r.get(q);n.deleteTexture(B.__webglTexture);const ue=q.source,Re=g.get(ue);delete Re[B.__cacheKey],a.memory.textures--}function U(q){const B=r.get(q);if(q.depthTexture&&(q.depthTexture.dispose(),r.remove(q.depthTexture)),q.isWebGLCubeRenderTarget)for(let Re=0;Re<6;Re++){if(Array.isArray(B.__webglFramebuffer[Re]))for(let Pe=0;Pe<B.__webglFramebuffer[Re].length;Pe++)n.deleteFramebuffer(B.__webglFramebuffer[Re][Pe]);else n.deleteFramebuffer(B.__webglFramebuffer[Re]);B.__webglDepthbuffer&&n.deleteRenderbuffer(B.__webglDepthbuffer[Re])}else{if(Array.isArray(B.__webglFramebuffer))for(let Re=0;Re<B.__webglFramebuffer.length;Re++)n.deleteFramebuffer(B.__webglFramebuffer[Re]);else n.deleteFramebuffer(B.__webglFramebuffer);if(B.__webglDepthbuffer&&n.deleteRenderbuffer(B.__webglDepthbuffer),B.__webglMultisampledFramebuffer&&n.deleteFramebuffer(B.__webglMultisampledFramebuffer),B.__webglColorRenderbuffer)for(let Re=0;Re<B.__webglColorRenderbuffer.length;Re++)B.__webglColorRenderbuffer[Re]&&n.deleteRenderbuffer(B.__webglColorRenderbuffer[Re]);B.__webglDepthRenderbuffer&&n.deleteRenderbuffer(B.__webglDepthRenderbuffer)}const ue=q.textures;for(let Re=0,Pe=ue.length;Re<Pe;Re++){const Te=r.get(ue[Re]);Te.__webglTexture&&(n.deleteTexture(Te.__webglTexture),a.memory.textures--),r.remove(ue[Re])}r.remove(q)}let V=0;function H(){V=0}function J(){const q=V;return q>=i.maxTextures&&Ft("WebGLTextures: Trying to use "+q+" texture units while this GPU supports only "+i.maxTextures),V+=1,q}function $(q){const B=[];return B.push(q.wrapS),B.push(q.wrapT),B.push(q.wrapR||0),B.push(q.magFilter),B.push(q.minFilter),B.push(q.anisotropy),B.push(q.internalFormat),B.push(q.format),B.push(q.type),B.push(q.generateMipmaps),B.push(q.premultiplyAlpha),B.push(q.flipY),B.push(q.unpackAlignment),B.push(q.colorSpace),B.join()}function ae(q,B){const ue=r.get(q);if(q.isVideoTexture&&je(q),q.isRenderTargetTexture===!1&&q.isExternalTexture!==!0&&q.version>0&&ue.__version!==q.version){const Re=q.image;if(Re===null)Ft("WebGLRenderer: Texture marked for update but no image data found.");else if(Re.complete===!1)Ft("WebGLRenderer: Texture marked for update but image is incomplete");else{re(ue,q,B);return}}else q.isExternalTexture&&(ue.__webglTexture=q.sourceTexture?q.sourceTexture:null);t.bindTexture(n.TEXTURE_2D,ue.__webglTexture,n.TEXTURE0+B)}function ne(q,B){const ue=r.get(q);if(q.isRenderTargetTexture===!1&&q.version>0&&ue.__version!==q.version){re(ue,q,B);return}else q.isExternalTexture&&(ue.__webglTexture=q.sourceTexture?q.sourceTexture:null);t.bindTexture(n.TEXTURE_2D_ARRAY,ue.__webglTexture,n.TEXTURE0+B)}function oe(q,B){const ue=r.get(q);if(q.isRenderTargetTexture===!1&&q.version>0&&ue.__version!==q.version){re(ue,q,B);return}t.bindTexture(n.TEXTURE_3D,ue.__webglTexture,n.TEXTURE0+B)}function te(q,B){const ue=r.get(q);if(q.isCubeDepthTexture!==!0&&q.version>0&&ue.__version!==q.version){he(ue,q,B);return}t.bindTexture(n.TEXTURE_CUBE_MAP,ue.__webglTexture,n.TEXTURE0+B)}const ie={[Lp]:n.REPEAT,[Gi]:n.CLAMP_TO_EDGE,[Np]:n.MIRRORED_REPEAT},Y={[Ji]:n.NEAREST,[Y_]:n.NEAREST_MIPMAP_NEAREST,[_f]:n.NEAREST_MIPMAP_LINEAR,[Dn]:n.LINEAR,[mp]:n.LINEAR_MIPMAP_NEAREST,[Fo]:n.LINEAR_MIPMAP_LINEAR},z={[nE]:n.NEVER,[oE]:n.ALWAYS,[iE]:n.LESS,[zv]:n.LEQUAL,[rE]:n.EQUAL,[Bv]:n.GEQUAL,[sE]:n.GREATER,[aE]:n.NOTEQUAL};function K(q,B){if(B.type===bi&&e.has("OES_texture_float_linear")===!1&&(B.magFilter===Dn||B.magFilter===mp||B.magFilter===_f||B.magFilter===Fo||B.minFilter===Dn||B.minFilter===mp||B.minFilter===_f||B.minFilter===Fo)&&Ft("WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),n.texParameteri(q,n.TEXTURE_WRAP_S,ie[B.wrapS]),n.texParameteri(q,n.TEXTURE_WRAP_T,ie[B.wrapT]),(q===n.TEXTURE_3D||q===n.TEXTURE_2D_ARRAY)&&n.texParameteri(q,n.TEXTURE_WRAP_R,ie[B.wrapR]),n.texParameteri(q,n.TEXTURE_MAG_FILTER,Y[B.magFilter]),n.texParameteri(q,n.TEXTURE_MIN_FILTER,Y[B.minFilter]),B.compareFunction&&(n.texParameteri(q,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(q,n.TEXTURE_COMPARE_FUNC,z[B.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(B.magFilter===Ji||B.minFilter!==_f&&B.minFilter!==Fo||B.type===bi&&e.has("OES_texture_float_linear")===!1)return;if(B.anisotropy>1||r.get(B).__currentAnisotropy){const ue=e.get("EXT_texture_filter_anisotropic");n.texParameterf(q,ue.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(B.anisotropy,i.getMaxAnisotropy())),r.get(B).__currentAnisotropy=B.anisotropy}}}function le(q,B){let ue=!1;q.__webglInit===void 0&&(q.__webglInit=!0,B.addEventListener("dispose",D));const Re=B.source;let Pe=g.get(Re);Pe===void 0&&(Pe={},g.set(Re,Pe));const Te=$(B);if(Te!==q.__cacheKey){Pe[Te]===void 0&&(Pe[Te]={texture:n.createTexture(),usedTimes:0},a.memory.textures++,ue=!0),Pe[Te].usedTimes++;const ot=Pe[q.__cacheKey];ot!==void 0&&(Pe[q.__cacheKey].usedTimes--,ot.usedTimes===0&&R(B)),q.__cacheKey=Te,q.__webglTexture=Pe[Te].texture}return ue}function me(q,B,ue){return Math.floor(Math.floor(q/ue)/B)}function ve(q,B,ue,Re){const Te=q.updateRanges;if(Te.length===0)t.texSubImage2D(n.TEXTURE_2D,0,0,0,B.width,B.height,ue,Re,B.data);else{Te.sort((Ge,Xe)=>Ge.start-Xe.start);let ot=0;for(let Ge=1;Ge<Te.length;Ge++){const Xe=Te[ot],nt=Te[Ge],gt=Xe.start+Xe.count,st=me(nt.start,B.width,4),Ot=me(Xe.start,B.width,4);nt.start<=gt+1&&st===Ot&&me(nt.start+nt.count-1,B.width,4)===st?Xe.count=Math.max(Xe.count,nt.start+nt.count-Xe.start):(++ot,Te[ot]=nt)}Te.length=ot+1;const rt=n.getParameter(n.UNPACK_ROW_LENGTH),mt=n.getParameter(n.UNPACK_SKIP_PIXELS),Rt=n.getParameter(n.UNPACK_SKIP_ROWS);n.pixelStorei(n.UNPACK_ROW_LENGTH,B.width);for(let Ge=0,Xe=Te.length;Ge<Xe;Ge++){const nt=Te[Ge],gt=Math.floor(nt.start/4),st=Math.ceil(nt.count/4),Ot=gt%B.width,pe=Math.floor(gt/B.width),Ee=st,et=1;n.pixelStorei(n.UNPACK_SKIP_PIXELS,Ot),n.pixelStorei(n.UNPACK_SKIP_ROWS,pe),t.texSubImage2D(n.TEXTURE_2D,0,Ot,pe,Ee,et,ue,Re,B.data)}q.clearUpdateRanges(),n.pixelStorei(n.UNPACK_ROW_LENGTH,rt),n.pixelStorei(n.UNPACK_SKIP_PIXELS,mt),n.pixelStorei(n.UNPACK_SKIP_ROWS,Rt)}}function re(q,B,ue){let Re=n.TEXTURE_2D;(B.isDataArrayTexture||B.isCompressedArrayTexture)&&(Re=n.TEXTURE_2D_ARRAY),B.isData3DTexture&&(Re=n.TEXTURE_3D);const Pe=le(q,B),Te=B.source;t.bindTexture(Re,q.__webglTexture,n.TEXTURE0+ue);const ot=r.get(Te);if(Te.version!==ot.__version||Pe===!0){t.activeTexture(n.TEXTURE0+ue);const rt=kn.getPrimaries(kn.workingColorSpace),mt=B.colorSpace===bl?null:kn.getPrimaries(B.colorSpace),Rt=B.colorSpace===bl||rt===mt?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,B.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,B.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,B.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,Rt);let Ge=E(B.image,!1,i.maxTextureSize);Ge=Ce(B,Ge);const Xe=s.convert(B.format,B.colorSpace),nt=s.convert(B.type);let gt=A(B.internalFormat,Xe,nt,B.colorSpace,B.isVideoTexture);K(Re,B);let st;const Ot=B.mipmaps,pe=B.isVideoTexture!==!0,Ee=ot.__version===void 0||Pe===!0,et=Te.dataReady,Pt=L(B,Ge);if(B.isDepthTexture)gt=P(B.format===vu,B.type),Ee&&(pe?t.texStorage2D(n.TEXTURE_2D,1,gt,Ge.width,Ge.height):t.texImage2D(n.TEXTURE_2D,0,gt,Ge.width,Ge.height,0,Xe,nt,null));else if(B.isDataTexture)if(Ot.length>0){pe&&Ee&&t.texStorage2D(n.TEXTURE_2D,Pt,gt,Ot[0].width,Ot[0].height);for(let tt=0,ke=Ot.length;tt<ke;tt++)st=Ot[tt],pe?et&&t.texSubImage2D(n.TEXTURE_2D,tt,0,0,st.width,st.height,Xe,nt,st.data):t.texImage2D(n.TEXTURE_2D,tt,gt,st.width,st.height,0,Xe,nt,st.data);B.generateMipmaps=!1}else pe?(Ee&&t.texStorage2D(n.TEXTURE_2D,Pt,gt,Ge.width,Ge.height),et&&ve(B,Ge,Xe,nt)):t.texImage2D(n.TEXTURE_2D,0,gt,Ge.width,Ge.height,0,Xe,nt,Ge.data);else if(B.isCompressedTexture)if(B.isCompressedArrayTexture){pe&&Ee&&t.texStorage3D(n.TEXTURE_2D_ARRAY,Pt,gt,Ot[0].width,Ot[0].height,Ge.depth);for(let tt=0,ke=Ot.length;tt<ke;tt++)if(st=Ot[tt],B.format!==Ki)if(Xe!==null)if(pe){if(et)if(B.layerUpdates.size>0){const dt=M_(st.width,st.height,B.format,B.type);for(const kt of B.layerUpdates){const zt=st.data.subarray(kt*dt/st.data.BYTES_PER_ELEMENT,(kt+1)*dt/st.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,tt,0,0,kt,st.width,st.height,1,Xe,zt)}B.clearLayerUpdates()}else t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,tt,0,0,0,st.width,st.height,Ge.depth,Xe,st.data)}else t.compressedTexImage3D(n.TEXTURE_2D_ARRAY,tt,gt,st.width,st.height,Ge.depth,0,st.data,0,0);else Ft("WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else pe?et&&t.texSubImage3D(n.TEXTURE_2D_ARRAY,tt,0,0,0,st.width,st.height,Ge.depth,Xe,nt,st.data):t.texImage3D(n.TEXTURE_2D_ARRAY,tt,gt,st.width,st.height,Ge.depth,0,Xe,nt,st.data)}else{pe&&Ee&&t.texStorage2D(n.TEXTURE_2D,Pt,gt,Ot[0].width,Ot[0].height);for(let tt=0,ke=Ot.length;tt<ke;tt++)st=Ot[tt],B.format!==Ki?Xe!==null?pe?et&&t.compressedTexSubImage2D(n.TEXTURE_2D,tt,0,0,st.width,st.height,Xe,st.data):t.compressedTexImage2D(n.TEXTURE_2D,tt,gt,st.width,st.height,0,st.data):Ft("WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):pe?et&&t.texSubImage2D(n.TEXTURE_2D,tt,0,0,st.width,st.height,Xe,nt,st.data):t.texImage2D(n.TEXTURE_2D,tt,gt,st.width,st.height,0,Xe,nt,st.data)}else if(B.isDataArrayTexture)if(pe){if(Ee&&t.texStorage3D(n.TEXTURE_2D_ARRAY,Pt,gt,Ge.width,Ge.height,Ge.depth),et)if(B.layerUpdates.size>0){const tt=M_(Ge.width,Ge.height,B.format,B.type);for(const ke of B.layerUpdates){const dt=Ge.data.subarray(ke*tt/Ge.data.BYTES_PER_ELEMENT,(ke+1)*tt/Ge.data.BYTES_PER_ELEMENT);t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,ke,Ge.width,Ge.height,1,Xe,nt,dt)}B.clearLayerUpdates()}else t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,Ge.width,Ge.height,Ge.depth,Xe,nt,Ge.data)}else t.texImage3D(n.TEXTURE_2D_ARRAY,0,gt,Ge.width,Ge.height,Ge.depth,0,Xe,nt,Ge.data);else if(B.isData3DTexture)pe?(Ee&&t.texStorage3D(n.TEXTURE_3D,Pt,gt,Ge.width,Ge.height,Ge.depth),et&&t.texSubImage3D(n.TEXTURE_3D,0,0,0,0,Ge.width,Ge.height,Ge.depth,Xe,nt,Ge.data)):t.texImage3D(n.TEXTURE_3D,0,gt,Ge.width,Ge.height,Ge.depth,0,Xe,nt,Ge.data);else if(B.isFramebufferTexture){if(Ee)if(pe)t.texStorage2D(n.TEXTURE_2D,Pt,gt,Ge.width,Ge.height);else{let tt=Ge.width,ke=Ge.height;for(let dt=0;dt<Pt;dt++)t.texImage2D(n.TEXTURE_2D,dt,gt,tt,ke,0,Xe,nt,null),tt>>=1,ke>>=1}}else if(Ot.length>0){if(pe&&Ee){const tt=He(Ot[0]);t.texStorage2D(n.TEXTURE_2D,Pt,gt,tt.width,tt.height)}for(let tt=0,ke=Ot.length;tt<ke;tt++)st=Ot[tt],pe?et&&t.texSubImage2D(n.TEXTURE_2D,tt,0,0,Xe,nt,st):t.texImage2D(n.TEXTURE_2D,tt,gt,Xe,nt,st);B.generateMipmaps=!1}else if(pe){if(Ee){const tt=He(Ge);t.texStorage2D(n.TEXTURE_2D,Pt,gt,tt.width,tt.height)}et&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,Xe,nt,Ge)}else t.texImage2D(n.TEXTURE_2D,0,gt,Xe,nt,Ge);x(B)&&S(Re),ot.__version=Te.version,B.onUpdate&&B.onUpdate(B)}q.__version=B.version}function he(q,B,ue){if(B.image.length!==6)return;const Re=le(q,B),Pe=B.source;t.bindTexture(n.TEXTURE_CUBE_MAP,q.__webglTexture,n.TEXTURE0+ue);const Te=r.get(Pe);if(Pe.version!==Te.__version||Re===!0){t.activeTexture(n.TEXTURE0+ue);const ot=kn.getPrimaries(kn.workingColorSpace),rt=B.colorSpace===bl?null:kn.getPrimaries(B.colorSpace),mt=B.colorSpace===bl||ot===rt?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,B.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,B.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,B.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,mt);const Rt=B.isCompressedTexture||B.image[0].isCompressedTexture,Ge=B.image[0]&&B.image[0].isDataTexture,Xe=[];for(let ke=0;ke<6;ke++)!Rt&&!Ge?Xe[ke]=E(B.image[ke],!0,i.maxCubemapSize):Xe[ke]=Ge?B.image[ke].image:B.image[ke],Xe[ke]=Ce(B,Xe[ke]);const nt=Xe[0],gt=s.convert(B.format,B.colorSpace),st=s.convert(B.type),Ot=A(B.internalFormat,gt,st,B.colorSpace),pe=B.isVideoTexture!==!0,Ee=Te.__version===void 0||Re===!0,et=Pe.dataReady;let Pt=L(B,nt);K(n.TEXTURE_CUBE_MAP,B);let tt;if(Rt){pe&&Ee&&t.texStorage2D(n.TEXTURE_CUBE_MAP,Pt,Ot,nt.width,nt.height);for(let ke=0;ke<6;ke++){tt=Xe[ke].mipmaps;for(let dt=0;dt<tt.length;dt++){const kt=tt[dt];B.format!==Ki?gt!==null?pe?et&&t.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ke,dt,0,0,kt.width,kt.height,gt,kt.data):t.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ke,dt,Ot,kt.width,kt.height,0,kt.data):Ft("WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):pe?et&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ke,dt,0,0,kt.width,kt.height,gt,st,kt.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ke,dt,Ot,kt.width,kt.height,0,gt,st,kt.data)}}}else{if(tt=B.mipmaps,pe&&Ee){tt.length>0&&Pt++;const ke=He(Xe[0]);t.texStorage2D(n.TEXTURE_CUBE_MAP,Pt,Ot,ke.width,ke.height)}for(let ke=0;ke<6;ke++)if(Ge){pe?et&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ke,0,0,0,Xe[ke].width,Xe[ke].height,gt,st,Xe[ke].data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ke,0,Ot,Xe[ke].width,Xe[ke].height,0,gt,st,Xe[ke].data);for(let dt=0;dt<tt.length;dt++){const zt=tt[dt].image[ke].image;pe?et&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ke,dt+1,0,0,zt.width,zt.height,gt,st,zt.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ke,dt+1,Ot,zt.width,zt.height,0,gt,st,zt.data)}}else{pe?et&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ke,0,0,0,gt,st,Xe[ke]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ke,0,Ot,gt,st,Xe[ke]);for(let dt=0;dt<tt.length;dt++){const kt=tt[dt];pe?et&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ke,dt+1,0,0,gt,st,kt.image[ke]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ke,dt+1,Ot,gt,st,kt.image[ke])}}}x(B)&&S(n.TEXTURE_CUBE_MAP),Te.__version=Pe.version,B.onUpdate&&B.onUpdate(B)}q.__version=B.version}function ye(q,B,ue,Re,Pe,Te){const ot=s.convert(ue.format,ue.colorSpace),rt=s.convert(ue.type),mt=A(ue.internalFormat,ot,rt,ue.colorSpace),Rt=r.get(B),Ge=r.get(ue);if(Ge.__renderTarget=B,!Rt.__hasExternalTextures){const Xe=Math.max(1,B.width>>Te),nt=Math.max(1,B.height>>Te);Pe===n.TEXTURE_3D||Pe===n.TEXTURE_2D_ARRAY?t.texImage3D(Pe,Te,mt,Xe,nt,B.depth,0,ot,rt,null):t.texImage2D(Pe,Te,mt,Xe,nt,0,ot,rt,null)}t.bindFramebuffer(n.FRAMEBUFFER,q),at(B)?o.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,Re,Pe,Ge.__webglTexture,0,Q(B)):(Pe===n.TEXTURE_2D||Pe>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&Pe<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&n.framebufferTexture2D(n.FRAMEBUFFER,Re,Pe,Ge.__webglTexture,Te),t.bindFramebuffer(n.FRAMEBUFFER,null)}function ze(q,B,ue){if(n.bindRenderbuffer(n.RENDERBUFFER,q),B.depthBuffer){const Re=B.depthTexture,Pe=Re&&Re.isDepthTexture?Re.type:null,Te=P(B.stencilBuffer,Pe),ot=B.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT;at(B)?o.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,Q(B),Te,B.width,B.height):ue?n.renderbufferStorageMultisample(n.RENDERBUFFER,Q(B),Te,B.width,B.height):n.renderbufferStorage(n.RENDERBUFFER,Te,B.width,B.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,ot,n.RENDERBUFFER,q)}else{const Re=B.textures;for(let Pe=0;Pe<Re.length;Pe++){const Te=Re[Pe],ot=s.convert(Te.format,Te.colorSpace),rt=s.convert(Te.type),mt=A(Te.internalFormat,ot,rt,Te.colorSpace);at(B)?o.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,Q(B),mt,B.width,B.height):ue?n.renderbufferStorageMultisample(n.RENDERBUFFER,Q(B),mt,B.width,B.height):n.renderbufferStorage(n.RENDERBUFFER,mt,B.width,B.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function Ve(q,B,ue){const Re=B.isWebGLCubeRenderTarget===!0;if(t.bindFramebuffer(n.FRAMEBUFFER,q),!(B.depthTexture&&B.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const Pe=r.get(B.depthTexture);if(Pe.__renderTarget=B,(!Pe.__webglTexture||B.depthTexture.image.width!==B.width||B.depthTexture.image.height!==B.height)&&(B.depthTexture.image.width=B.width,B.depthTexture.image.height=B.height,B.depthTexture.needsUpdate=!0),Re){if(Pe.__webglInit===void 0&&(Pe.__webglInit=!0,B.depthTexture.addEventListener("dispose",D)),Pe.__webglTexture===void 0){Pe.__webglTexture=n.createTexture(),t.bindTexture(n.TEXTURE_CUBE_MAP,Pe.__webglTexture),K(n.TEXTURE_CUBE_MAP,B.depthTexture);const Rt=s.convert(B.depthTexture.format),Ge=s.convert(B.depthTexture.type);let Xe;B.depthTexture.format===ko?Xe=n.DEPTH_COMPONENT24:B.depthTexture.format===vu&&(Xe=n.DEPTH24_STENCIL8);for(let nt=0;nt<6;nt++)n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+nt,0,Xe,B.width,B.height,0,Rt,Ge,null)}}else ae(B.depthTexture,0);const Te=Pe.__webglTexture,ot=Q(B),rt=Re?n.TEXTURE_CUBE_MAP_POSITIVE_X+ue:n.TEXTURE_2D,mt=B.depthTexture.format===vu?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT;if(B.depthTexture.format===ko)at(B)?o.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,mt,rt,Te,0,ot):n.framebufferTexture2D(n.FRAMEBUFFER,mt,rt,Te,0);else if(B.depthTexture.format===vu)at(B)?o.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,mt,rt,Te,0,ot):n.framebufferTexture2D(n.FRAMEBUFFER,mt,rt,Te,0);else throw new Error("Unknown depthTexture format")}function Ke(q){const B=r.get(q),ue=q.isWebGLCubeRenderTarget===!0;if(B.__boundDepthTexture!==q.depthTexture){const Re=q.depthTexture;if(B.__depthDisposeCallback&&B.__depthDisposeCallback(),Re){const Pe=()=>{delete B.__boundDepthTexture,delete B.__depthDisposeCallback,Re.removeEventListener("dispose",Pe)};Re.addEventListener("dispose",Pe),B.__depthDisposeCallback=Pe}B.__boundDepthTexture=Re}if(q.depthTexture&&!B.__autoAllocateDepthBuffer)if(ue)for(let Re=0;Re<6;Re++)Ve(B.__webglFramebuffer[Re],q,Re);else{const Re=q.texture.mipmaps;Re&&Re.length>0?Ve(B.__webglFramebuffer[0],q,0):Ve(B.__webglFramebuffer,q,0)}else if(ue){B.__webglDepthbuffer=[];for(let Re=0;Re<6;Re++)if(t.bindFramebuffer(n.FRAMEBUFFER,B.__webglFramebuffer[Re]),B.__webglDepthbuffer[Re]===void 0)B.__webglDepthbuffer[Re]=n.createRenderbuffer(),ze(B.__webglDepthbuffer[Re],q,!1);else{const Pe=q.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,Te=B.__webglDepthbuffer[Re];n.bindRenderbuffer(n.RENDERBUFFER,Te),n.framebufferRenderbuffer(n.FRAMEBUFFER,Pe,n.RENDERBUFFER,Te)}}else{const Re=q.texture.mipmaps;if(Re&&Re.length>0?t.bindFramebuffer(n.FRAMEBUFFER,B.__webglFramebuffer[0]):t.bindFramebuffer(n.FRAMEBUFFER,B.__webglFramebuffer),B.__webglDepthbuffer===void 0)B.__webglDepthbuffer=n.createRenderbuffer(),ze(B.__webglDepthbuffer,q,!1);else{const Pe=q.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,Te=B.__webglDepthbuffer;n.bindRenderbuffer(n.RENDERBUFFER,Te),n.framebufferRenderbuffer(n.FRAMEBUFFER,Pe,n.RENDERBUFFER,Te)}}t.bindFramebuffer(n.FRAMEBUFFER,null)}function Qe(q,B,ue){const Re=r.get(q);B!==void 0&&ye(Re.__webglFramebuffer,q,q.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,0),ue!==void 0&&Ke(q)}function pt(q){const B=q.texture,ue=r.get(q),Re=r.get(B);q.addEventListener("dispose",F);const Pe=q.textures,Te=q.isWebGLCubeRenderTarget===!0,ot=Pe.length>1;if(ot||(Re.__webglTexture===void 0&&(Re.__webglTexture=n.createTexture()),Re.__version=B.version,a.memory.textures++),Te){ue.__webglFramebuffer=[];for(let rt=0;rt<6;rt++)if(B.mipmaps&&B.mipmaps.length>0){ue.__webglFramebuffer[rt]=[];for(let mt=0;mt<B.mipmaps.length;mt++)ue.__webglFramebuffer[rt][mt]=n.createFramebuffer()}else ue.__webglFramebuffer[rt]=n.createFramebuffer()}else{if(B.mipmaps&&B.mipmaps.length>0){ue.__webglFramebuffer=[];for(let rt=0;rt<B.mipmaps.length;rt++)ue.__webglFramebuffer[rt]=n.createFramebuffer()}else ue.__webglFramebuffer=n.createFramebuffer();if(ot)for(let rt=0,mt=Pe.length;rt<mt;rt++){const Rt=r.get(Pe[rt]);Rt.__webglTexture===void 0&&(Rt.__webglTexture=n.createTexture(),a.memory.textures++)}if(q.samples>0&&at(q)===!1){ue.__webglMultisampledFramebuffer=n.createFramebuffer(),ue.__webglColorRenderbuffer=[],t.bindFramebuffer(n.FRAMEBUFFER,ue.__webglMultisampledFramebuffer);for(let rt=0;rt<Pe.length;rt++){const mt=Pe[rt];ue.__webglColorRenderbuffer[rt]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,ue.__webglColorRenderbuffer[rt]);const Rt=s.convert(mt.format,mt.colorSpace),Ge=s.convert(mt.type),Xe=A(mt.internalFormat,Rt,Ge,mt.colorSpace,q.isXRRenderTarget===!0),nt=Q(q);n.renderbufferStorageMultisample(n.RENDERBUFFER,nt,Xe,q.width,q.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+rt,n.RENDERBUFFER,ue.__webglColorRenderbuffer[rt])}n.bindRenderbuffer(n.RENDERBUFFER,null),q.depthBuffer&&(ue.__webglDepthRenderbuffer=n.createRenderbuffer(),ze(ue.__webglDepthRenderbuffer,q,!0)),t.bindFramebuffer(n.FRAMEBUFFER,null)}}if(Te){t.bindTexture(n.TEXTURE_CUBE_MAP,Re.__webglTexture),K(n.TEXTURE_CUBE_MAP,B);for(let rt=0;rt<6;rt++)if(B.mipmaps&&B.mipmaps.length>0)for(let mt=0;mt<B.mipmaps.length;mt++)ye(ue.__webglFramebuffer[rt][mt],q,B,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+rt,mt);else ye(ue.__webglFramebuffer[rt],q,B,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+rt,0);x(B)&&S(n.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(ot){for(let rt=0,mt=Pe.length;rt<mt;rt++){const Rt=Pe[rt],Ge=r.get(Rt);let Xe=n.TEXTURE_2D;(q.isWebGL3DRenderTarget||q.isWebGLArrayRenderTarget)&&(Xe=q.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY),t.bindTexture(Xe,Ge.__webglTexture),K(Xe,Rt),ye(ue.__webglFramebuffer,q,Rt,n.COLOR_ATTACHMENT0+rt,Xe,0),x(Rt)&&S(Xe)}t.unbindTexture()}else{let rt=n.TEXTURE_2D;if((q.isWebGL3DRenderTarget||q.isWebGLArrayRenderTarget)&&(rt=q.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY),t.bindTexture(rt,Re.__webglTexture),K(rt,B),B.mipmaps&&B.mipmaps.length>0)for(let mt=0;mt<B.mipmaps.length;mt++)ye(ue.__webglFramebuffer[mt],q,B,n.COLOR_ATTACHMENT0,rt,mt);else ye(ue.__webglFramebuffer,q,B,n.COLOR_ATTACHMENT0,rt,0);x(B)&&S(rt),t.unbindTexture()}q.depthBuffer&&Ke(q)}function Ne(q){const B=q.textures;for(let ue=0,Re=B.length;ue<Re;ue++){const Pe=B[ue];if(x(Pe)){const Te=T(q),ot=r.get(Pe).__webglTexture;t.bindTexture(Te,ot),S(Te),t.unbindTexture()}}}const Be=[],De=[];function it(q){if(q.samples>0){if(at(q)===!1){const B=q.textures,ue=q.width,Re=q.height;let Pe=n.COLOR_BUFFER_BIT;const Te=q.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,ot=r.get(q),rt=B.length>1;if(rt)for(let Rt=0;Rt<B.length;Rt++)t.bindFramebuffer(n.FRAMEBUFFER,ot.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Rt,n.RENDERBUFFER,null),t.bindFramebuffer(n.FRAMEBUFFER,ot.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Rt,n.TEXTURE_2D,null,0);t.bindFramebuffer(n.READ_FRAMEBUFFER,ot.__webglMultisampledFramebuffer);const mt=q.texture.mipmaps;mt&&mt.length>0?t.bindFramebuffer(n.DRAW_FRAMEBUFFER,ot.__webglFramebuffer[0]):t.bindFramebuffer(n.DRAW_FRAMEBUFFER,ot.__webglFramebuffer);for(let Rt=0;Rt<B.length;Rt++){if(q.resolveDepthBuffer&&(q.depthBuffer&&(Pe|=n.DEPTH_BUFFER_BIT),q.stencilBuffer&&q.resolveStencilBuffer&&(Pe|=n.STENCIL_BUFFER_BIT)),rt){n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,ot.__webglColorRenderbuffer[Rt]);const Ge=r.get(B[Rt]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,Ge,0)}n.blitFramebuffer(0,0,ue,Re,0,0,ue,Re,Pe,n.NEAREST),u===!0&&(Be.length=0,De.length=0,Be.push(n.COLOR_ATTACHMENT0+Rt),q.depthBuffer&&q.resolveDepthBuffer===!1&&(Be.push(Te),De.push(Te),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,De)),n.invalidateFramebuffer(n.READ_FRAMEBUFFER,Be))}if(t.bindFramebuffer(n.READ_FRAMEBUFFER,null),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),rt)for(let Rt=0;Rt<B.length;Rt++){t.bindFramebuffer(n.FRAMEBUFFER,ot.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Rt,n.RENDERBUFFER,ot.__webglColorRenderbuffer[Rt]);const Ge=r.get(B[Rt]).__webglTexture;t.bindFramebuffer(n.FRAMEBUFFER,ot.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Rt,n.TEXTURE_2D,Ge,0)}t.bindFramebuffer(n.DRAW_FRAMEBUFFER,ot.__webglMultisampledFramebuffer)}else if(q.depthBuffer&&q.resolveDepthBuffer===!1&&u){const B=q.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT;n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[B])}}}function Q(q){return Math.min(i.maxSamples,q.samples)}function at(q){const B=r.get(q);return q.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&B.__useRenderToTexture!==!1}function je(q){const B=a.render.frame;f.get(q)!==B&&(f.set(q,B),q.update())}function Ce(q,B){const ue=q.colorSpace,Re=q.format,Pe=q.type;return q.isCompressedTexture===!0||q.isVideoTexture===!0||ue!==zo&&ue!==bl&&(kn.getTransfer(ue)===Yn?(Re!==Ki||Pe!==Rr)&&Ft("WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):ln("WebGLTextures: Unsupported texture color space:",ue)),B}function He(q){return typeof HTMLImageElement<"u"&&q instanceof HTMLImageElement?(c.width=q.naturalWidth||q.width,c.height=q.naturalHeight||q.height):typeof VideoFrame<"u"&&q instanceof VideoFrame?(c.width=q.displayWidth,c.height=q.displayHeight):(c.width=q.width,c.height=q.height),c}this.allocateTextureUnit=J,this.resetTextureUnits=H,this.setTexture2D=ae,this.setTexture2DArray=ne,this.setTexture3D=oe,this.setTextureCube=te,this.rebindTextures=Qe,this.setupRenderTarget=pt,this.updateRenderTargetMipmap=Ne,this.updateMultisampleRenderTarget=it,this.setupDepthRenderbuffer=Ke,this.setupFrameBufferTexture=ye,this.useMultisampledRTT=at,this.isReversedDepthBuffer=function(){return t.buffers.depth.getReversed()}}function p3(n,e){function t(r,i=bl){let s;const a=kn.getTransfer(i);if(r===Rr)return n.UNSIGNED_BYTE;if(r===Dv)return n.UNSIGNED_SHORT_4_4_4_4;if(r===Uv)return n.UNSIGNED_SHORT_5_5_5_1;if(r===Z_)return n.UNSIGNED_INT_5_9_9_9_REV;if(r===J_)return n.UNSIGNED_INT_10F_11F_11F_REV;if(r===Lv)return n.BYTE;if(r===Nv)return n.SHORT;if(r===Nf)return n.UNSIGNED_SHORT;if(r===t0)return n.INT;if(r===ca)return n.UNSIGNED_INT;if(r===bi)return n.FLOAT;if(r===Vi)return n.HALF_FLOAT;if(r===K_)return n.ALPHA;if(r===Q_)return n.RGB;if(r===Ki)return n.RGBA;if(r===ko)return n.DEPTH_COMPONENT;if(r===vu)return n.DEPTH_STENCIL;if(r===n0)return n.RED;if(r===i0)return n.RED_INTEGER;if(r===jc)return n.RG;if(r===Fv)return n.RG_INTEGER;if(r===Ov)return n.RGBA_INTEGER;if(r===gp||r===vp||r===yp||r===_p)if(a===Yn)if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(r===gp)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(r===vp)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(r===yp)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(r===_p)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=e.get("WEBGL_compressed_texture_s3tc"),s!==null){if(r===gp)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===vp)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===yp)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===_p)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(r===Ug||r===Fg||r===Og||r===kg)if(s=e.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(r===Ug)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===Fg)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===Og)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===kg)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(r===zg||r===Bg||r===Gg||r===Vg||r===Hg||r===Wg||r===jg)if(s=e.get("WEBGL_compressed_texture_etc"),s!==null){if(r===zg||r===Bg)return a===Yn?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(r===Gg)return a===Yn?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC;if(r===Vg)return s.COMPRESSED_R11_EAC;if(r===Hg)return s.COMPRESSED_SIGNED_R11_EAC;if(r===Wg)return s.COMPRESSED_RG11_EAC;if(r===jg)return s.COMPRESSED_SIGNED_RG11_EAC}else return null;if(r===Xg||r===qg||r===Yg||r===Zg||r===Jg||r===Kg||r===Qg||r===$g||r===ev||r===tv||r===nv||r===iv||r===rv||r===sv)if(s=e.get("WEBGL_compressed_texture_astc"),s!==null){if(r===Xg)return a===Yn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(r===qg)return a===Yn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(r===Yg)return a===Yn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(r===Zg)return a===Yn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(r===Jg)return a===Yn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(r===Kg)return a===Yn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(r===Qg)return a===Yn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(r===$g)return a===Yn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(r===ev)return a===Yn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(r===tv)return a===Yn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(r===nv)return a===Yn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(r===iv)return a===Yn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(r===rv)return a===Yn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(r===sv)return a===Yn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(r===av||r===ov||r===lv)if(s=e.get("EXT_texture_compression_bptc"),s!==null){if(r===av)return a===Yn?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(r===ov)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(r===lv)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(r===uv||r===cv||r===hv||r===fv)if(s=e.get("EXT_texture_compression_rgtc"),s!==null){if(r===uv)return s.COMPRESSED_RED_RGTC1_EXT;if(r===cv)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(r===hv)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(r===fv)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return r===Df?n.UNSIGNED_INT_24_8:n[r]!==void 0?n[r]:null}return{convert:t}}const j5=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,X5=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class q5{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t){if(this.texture===null){const r=new lx(e.texture);(e.depthNear!==t.depthNear||e.depthFar!==t.depthFar)&&(this.depthNear=e.depthNear,this.depthFar=e.depthFar),this.texture=r}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,r=new Es({vertexShader:j5,fragmentShader:X5,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new pi(new po(20,20),r)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class Y5 extends Vo{constructor(e,t){super();const r=this;let i=null,s=1,a=null,o="local-floor",u=1,c=null,f=null,m=null,g=null,y=null,_=null;const E=typeof XRWebGLBinding<"u",x=new q5,S={},T=t.getContextAttributes();let A=null,P=null;const L=[],D=[],F=new ct;let k=null;const R=new Pr;R.viewport=new $n;const U=new Pr;U.viewport=new $n;const V=[R,U],H=new r3;let J=null,$=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(re){let he=L[re];return he===void 0&&(he=new gg,L[re]=he),he.getTargetRaySpace()},this.getControllerGrip=function(re){let he=L[re];return he===void 0&&(he=new gg,L[re]=he),he.getGripSpace()},this.getHand=function(re){let he=L[re];return he===void 0&&(he=new gg,L[re]=he),he.getHandSpace()};function ae(re){const he=D.indexOf(re.inputSource);if(he===-1)return;const ye=L[he];ye!==void 0&&(ye.update(re.inputSource,re.frame,c||a),ye.dispatchEvent({type:re.type,data:re.inputSource}))}function ne(){i.removeEventListener("select",ae),i.removeEventListener("selectstart",ae),i.removeEventListener("selectend",ae),i.removeEventListener("squeeze",ae),i.removeEventListener("squeezestart",ae),i.removeEventListener("squeezeend",ae),i.removeEventListener("end",ne),i.removeEventListener("inputsourceschange",oe);for(let re=0;re<L.length;re++){const he=D[re];he!==null&&(D[re]=null,L[re].disconnect(he))}J=null,$=null,x.reset();for(const re in S)delete S[re];e.setRenderTarget(A),y=null,g=null,m=null,i=null,P=null,ve.stop(),r.isPresenting=!1,e.setPixelRatio(k),e.setSize(F.width,F.height,!1),r.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(re){s=re,r.isPresenting===!0&&Ft("WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(re){o=re,r.isPresenting===!0&&Ft("WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||a},this.setReferenceSpace=function(re){c=re},this.getBaseLayer=function(){return g!==null?g:y},this.getBinding=function(){return m===null&&E&&(m=new XRWebGLBinding(i,t)),m},this.getFrame=function(){return _},this.getSession=function(){return i},this.setSession=async function(re){if(i=re,i!==null){if(A=e.getRenderTarget(),i.addEventListener("select",ae),i.addEventListener("selectstart",ae),i.addEventListener("selectend",ae),i.addEventListener("squeeze",ae),i.addEventListener("squeezestart",ae),i.addEventListener("squeezeend",ae),i.addEventListener("end",ne),i.addEventListener("inputsourceschange",oe),T.xrCompatible!==!0&&await t.makeXRCompatible(),k=e.getPixelRatio(),e.getSize(F),E&&"createProjectionLayer"in XRWebGLBinding.prototype){let ye=null,ze=null,Ve=null;T.depth&&(Ve=T.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,ye=T.stencil?vu:ko,ze=T.stencil?Df:ca);const Ke={colorFormat:t.RGBA8,depthFormat:Ve,scaleFactor:s};m=this.getBinding(),g=m.createProjectionLayer(Ke),i.updateRenderState({layers:[g]}),e.setPixelRatio(1),e.setSize(g.textureWidth,g.textureHeight,!1),P=new ws(g.textureWidth,g.textureHeight,{format:Ki,type:Rr,depthTexture:new zf(g.textureWidth,g.textureHeight,ze,void 0,void 0,void 0,void 0,void 0,void 0,ye),stencilBuffer:T.stencil,colorSpace:e.outputColorSpace,samples:T.antialias?4:0,resolveDepthBuffer:g.ignoreDepthValues===!1,resolveStencilBuffer:g.ignoreDepthValues===!1})}else{const ye={antialias:T.antialias,alpha:!0,depth:T.depth,stencil:T.stencil,framebufferScaleFactor:s};y=new XRWebGLLayer(i,t,ye),i.updateRenderState({baseLayer:y}),e.setPixelRatio(1),e.setSize(y.framebufferWidth,y.framebufferHeight,!1),P=new ws(y.framebufferWidth,y.framebufferHeight,{format:Ki,type:Rr,colorSpace:e.outputColorSpace,stencilBuffer:T.stencil,resolveDepthBuffer:y.ignoreDepthValues===!1,resolveStencilBuffer:y.ignoreDepthValues===!1})}P.isXRRenderTarget=!0,this.setFoveation(u),c=null,a=await i.requestReferenceSpace(o),ve.setContext(i),ve.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(i!==null)return i.environmentBlendMode},this.getDepthTexture=function(){return x.getDepthTexture()};function oe(re){for(let he=0;he<re.removed.length;he++){const ye=re.removed[he],ze=D.indexOf(ye);ze>=0&&(D[ze]=null,L[ze].disconnect(ye))}for(let he=0;he<re.added.length;he++){const ye=re.added[he];let ze=D.indexOf(ye);if(ze===-1){for(let Ke=0;Ke<L.length;Ke++)if(Ke>=D.length){D.push(ye),ze=Ke;break}else if(D[Ke]===null){D[Ke]=ye,ze=Ke;break}if(ze===-1)break}const Ve=L[ze];Ve&&Ve.connect(ye)}}const te=new X,ie=new X;function Y(re,he,ye){te.setFromMatrixPosition(he.matrixWorld),ie.setFromMatrixPosition(ye.matrixWorld);const ze=te.distanceTo(ie),Ve=he.projectionMatrix.elements,Ke=ye.projectionMatrix.elements,Qe=Ve[14]/(Ve[10]-1),pt=Ve[14]/(Ve[10]+1),Ne=(Ve[9]+1)/Ve[5],Be=(Ve[9]-1)/Ve[5],De=(Ve[8]-1)/Ve[0],it=(Ke[8]+1)/Ke[0],Q=Qe*De,at=Qe*it,je=ze/(-De+it),Ce=je*-De;if(he.matrixWorld.decompose(re.position,re.quaternion,re.scale),re.translateX(Ce),re.translateZ(je),re.matrixWorld.compose(re.position,re.quaternion,re.scale),re.matrixWorldInverse.copy(re.matrixWorld).invert(),Ve[10]===-1)re.projectionMatrix.copy(he.projectionMatrix),re.projectionMatrixInverse.copy(he.projectionMatrixInverse);else{const He=Qe+je,q=pt+je,B=Q-Ce,ue=at+(ze-Ce),Re=Ne*pt/q*He,Pe=Be*pt/q*He;re.projectionMatrix.makePerspective(B,ue,Re,Pe,He,q),re.projectionMatrixInverse.copy(re.projectionMatrix).invert()}}function z(re,he){he===null?re.matrixWorld.copy(re.matrix):re.matrixWorld.multiplyMatrices(he.matrixWorld,re.matrix),re.matrixWorldInverse.copy(re.matrixWorld).invert()}this.updateCamera=function(re){if(i===null)return;let he=re.near,ye=re.far;x.texture!==null&&(x.depthNear>0&&(he=x.depthNear),x.depthFar>0&&(ye=x.depthFar)),H.near=U.near=R.near=he,H.far=U.far=R.far=ye,(J!==H.near||$!==H.far)&&(i.updateRenderState({depthNear:H.near,depthFar:H.far}),J=H.near,$=H.far),H.layers.mask=re.layers.mask|6,R.layers.mask=H.layers.mask&3,U.layers.mask=H.layers.mask&5;const ze=re.parent,Ve=H.cameras;z(H,ze);for(let Ke=0;Ke<Ve.length;Ke++)z(Ve[Ke],ze);Ve.length===2?Y(H,R,U):H.projectionMatrix.copy(R.projectionMatrix),K(re,H,ze)};function K(re,he,ye){ye===null?re.matrix.copy(he.matrixWorld):(re.matrix.copy(ye.matrixWorld),re.matrix.invert(),re.matrix.multiply(he.matrixWorld)),re.matrix.decompose(re.position,re.quaternion,re.scale),re.updateMatrixWorld(!0),re.projectionMatrix.copy(he.projectionMatrix),re.projectionMatrixInverse.copy(he.projectionMatrixInverse),re.isPerspectiveCamera&&(re.fov=Of*2*Math.atan(1/re.projectionMatrix.elements[5]),re.zoom=1)}this.getCamera=function(){return H},this.getFoveation=function(){if(!(g===null&&y===null))return u},this.setFoveation=function(re){u=re,g!==null&&(g.fixedFoveation=re),y!==null&&y.fixedFoveation!==void 0&&(y.fixedFoveation=re)},this.hasDepthSensing=function(){return x.texture!==null},this.getDepthSensingMesh=function(){return x.getMesh(H)},this.getCameraTexture=function(re){return S[re]};let le=null;function me(re,he){if(f=he.getViewerPose(c||a),_=he,f!==null){const ye=f.views;y!==null&&(e.setRenderTargetFramebuffer(P,y.framebuffer),e.setRenderTarget(P));let ze=!1;ye.length!==H.cameras.length&&(H.cameras.length=0,ze=!0);for(let pt=0;pt<ye.length;pt++){const Ne=ye[pt];let Be=null;if(y!==null)Be=y.getViewport(Ne);else{const it=m.getViewSubImage(g,Ne);Be=it.viewport,pt===0&&(e.setRenderTargetTextures(P,it.colorTexture,it.depthStencilTexture),e.setRenderTarget(P))}let De=V[pt];De===void 0&&(De=new Pr,De.layers.enable(pt),De.viewport=new $n,V[pt]=De),De.matrix.fromArray(Ne.transform.matrix),De.matrix.decompose(De.position,De.quaternion,De.scale),De.projectionMatrix.fromArray(Ne.projectionMatrix),De.projectionMatrixInverse.copy(De.projectionMatrix).invert(),De.viewport.set(Be.x,Be.y,Be.width,Be.height),pt===0&&(H.matrix.copy(De.matrix),H.matrix.decompose(H.position,H.quaternion,H.scale)),ze===!0&&H.cameras.push(De)}const Ve=i.enabledFeatures;if(Ve&&Ve.includes("depth-sensing")&&i.depthUsage=="gpu-optimized"&&E){m=r.getBinding();const pt=m.getDepthInformation(ye[0]);pt&&pt.isValid&&pt.texture&&x.init(pt,i.renderState)}if(Ve&&Ve.includes("camera-access")&&E){e.state.unbindTexture(),m=r.getBinding();for(let pt=0;pt<ye.length;pt++){const Ne=ye[pt].camera;if(Ne){let Be=S[Ne];Be||(Be=new lx,S[Ne]=Be);const De=m.getCameraImage(Ne);Be.sourceTexture=De}}}}for(let ye=0;ye<L.length;ye++){const ze=D[ye],Ve=L[ye];ze!==null&&Ve!==void 0&&Ve.update(ze,he,c||a)}le&&le(re,he),he.detectedPlanes&&r.dispatchEvent({type:"planesdetected",data:he}),_=null}const ve=new u3;ve.setAnimationLoop(me),this.setAnimationLoop=function(re){le=re},this.dispose=function(){}}}const Cc=new Qi,Z5=new vn;function J5(n,e){function t(x,S){x.matrixAutoUpdate===!0&&x.updateMatrix(),S.value.copy(x.matrix)}function r(x,S){S.color.getRGB(x.fogColor.value,dE(n)),S.isFog?(x.fogNear.value=S.near,x.fogFar.value=S.far):S.isFogExp2&&(x.fogDensity.value=S.density)}function i(x,S,T,A,P){S.isMeshBasicMaterial||S.isMeshLambertMaterial?s(x,S):S.isMeshToonMaterial?(s(x,S),m(x,S)):S.isMeshPhongMaterial?(s(x,S),f(x,S)):S.isMeshStandardMaterial?(s(x,S),g(x,S),S.isMeshPhysicalMaterial&&y(x,S,P)):S.isMeshMatcapMaterial?(s(x,S),_(x,S)):S.isMeshDepthMaterial?s(x,S):S.isMeshDistanceMaterial?(s(x,S),E(x,S)):S.isMeshNormalMaterial?s(x,S):S.isLineBasicMaterial?(a(x,S),S.isLineDashedMaterial&&o(x,S)):S.isPointsMaterial?u(x,S,T,A):S.isSpriteMaterial?c(x,S):S.isShadowMaterial?(x.color.value.copy(S.color),x.opacity.value=S.opacity):S.isShaderMaterial&&(S.uniformsNeedUpdate=!1)}function s(x,S){x.opacity.value=S.opacity,S.color&&x.diffuse.value.copy(S.color),S.emissive&&x.emissive.value.copy(S.emissive).multiplyScalar(S.emissiveIntensity),S.map&&(x.map.value=S.map,t(S.map,x.mapTransform)),S.alphaMap&&(x.alphaMap.value=S.alphaMap,t(S.alphaMap,x.alphaMapTransform)),S.bumpMap&&(x.bumpMap.value=S.bumpMap,t(S.bumpMap,x.bumpMapTransform),x.bumpScale.value=S.bumpScale,S.side===Ms&&(x.bumpScale.value*=-1)),S.normalMap&&(x.normalMap.value=S.normalMap,t(S.normalMap,x.normalMapTransform),x.normalScale.value.copy(S.normalScale),S.side===Ms&&x.normalScale.value.negate()),S.displacementMap&&(x.displacementMap.value=S.displacementMap,t(S.displacementMap,x.displacementMapTransform),x.displacementScale.value=S.displacementScale,x.displacementBias.value=S.displacementBias),S.emissiveMap&&(x.emissiveMap.value=S.emissiveMap,t(S.emissiveMap,x.emissiveMapTransform)),S.specularMap&&(x.specularMap.value=S.specularMap,t(S.specularMap,x.specularMapTransform)),S.alphaTest>0&&(x.alphaTest.value=S.alphaTest);const T=e.get(S),A=T.envMap,P=T.envMapRotation;A&&(x.envMap.value=A,Cc.copy(P),Cc.x*=-1,Cc.y*=-1,Cc.z*=-1,A.isCubeTexture&&A.isRenderTargetTexture===!1&&(Cc.y*=-1,Cc.z*=-1),x.envMapRotation.value.setFromMatrix4(Z5.makeRotationFromEuler(Cc)),x.flipEnvMap.value=A.isCubeTexture&&A.isRenderTargetTexture===!1?-1:1,x.reflectivity.value=S.reflectivity,x.ior.value=S.ior,x.refractionRatio.value=S.refractionRatio),S.lightMap&&(x.lightMap.value=S.lightMap,x.lightMapIntensity.value=S.lightMapIntensity,t(S.lightMap,x.lightMapTransform)),S.aoMap&&(x.aoMap.value=S.aoMap,x.aoMapIntensity.value=S.aoMapIntensity,t(S.aoMap,x.aoMapTransform))}function a(x,S){x.diffuse.value.copy(S.color),x.opacity.value=S.opacity,S.map&&(x.map.value=S.map,t(S.map,x.mapTransform))}function o(x,S){x.dashSize.value=S.dashSize,x.totalSize.value=S.dashSize+S.gapSize,x.scale.value=S.scale}function u(x,S,T,A){x.diffuse.value.copy(S.color),x.opacity.value=S.opacity,x.size.value=S.size*T,x.scale.value=A*.5,S.map&&(x.map.value=S.map,t(S.map,x.uvTransform)),S.alphaMap&&(x.alphaMap.value=S.alphaMap,t(S.alphaMap,x.alphaMapTransform)),S.alphaTest>0&&(x.alphaTest.value=S.alphaTest)}function c(x,S){x.diffuse.value.copy(S.color),x.opacity.value=S.opacity,x.rotation.value=S.rotation,S.map&&(x.map.value=S.map,t(S.map,x.mapTransform)),S.alphaMap&&(x.alphaMap.value=S.alphaMap,t(S.alphaMap,x.alphaMapTransform)),S.alphaTest>0&&(x.alphaTest.value=S.alphaTest)}function f(x,S){x.specular.value.copy(S.specular),x.shininess.value=Math.max(S.shininess,1e-4)}function m(x,S){S.gradientMap&&(x.gradientMap.value=S.gradientMap)}function g(x,S){x.metalness.value=S.metalness,S.metalnessMap&&(x.metalnessMap.value=S.metalnessMap,t(S.metalnessMap,x.metalnessMapTransform)),x.roughness.value=S.roughness,S.roughnessMap&&(x.roughnessMap.value=S.roughnessMap,t(S.roughnessMap,x.roughnessMapTransform)),S.envMap&&(x.envMapIntensity.value=S.envMapIntensity)}function y(x,S,T){x.ior.value=S.ior,S.sheen>0&&(x.sheenColor.value.copy(S.sheenColor).multiplyScalar(S.sheen),x.sheenRoughness.value=S.sheenRoughness,S.sheenColorMap&&(x.sheenColorMap.value=S.sheenColorMap,t(S.sheenColorMap,x.sheenColorMapTransform)),S.sheenRoughnessMap&&(x.sheenRoughnessMap.value=S.sheenRoughnessMap,t(S.sheenRoughnessMap,x.sheenRoughnessMapTransform))),S.clearcoat>0&&(x.clearcoat.value=S.clearcoat,x.clearcoatRoughness.value=S.clearcoatRoughness,S.clearcoatMap&&(x.clearcoatMap.value=S.clearcoatMap,t(S.clearcoatMap,x.clearcoatMapTransform)),S.clearcoatRoughnessMap&&(x.clearcoatRoughnessMap.value=S.clearcoatRoughnessMap,t(S.clearcoatRoughnessMap,x.clearcoatRoughnessMapTransform)),S.clearcoatNormalMap&&(x.clearcoatNormalMap.value=S.clearcoatNormalMap,t(S.clearcoatNormalMap,x.clearcoatNormalMapTransform),x.clearcoatNormalScale.value.copy(S.clearcoatNormalScale),S.side===Ms&&x.clearcoatNormalScale.value.negate())),S.dispersion>0&&(x.dispersion.value=S.dispersion),S.iridescence>0&&(x.iridescence.value=S.iridescence,x.iridescenceIOR.value=S.iridescenceIOR,x.iridescenceThicknessMinimum.value=S.iridescenceThicknessRange[0],x.iridescenceThicknessMaximum.value=S.iridescenceThicknessRange[1],S.iridescenceMap&&(x.iridescenceMap.value=S.iridescenceMap,t(S.iridescenceMap,x.iridescenceMapTransform)),S.iridescenceThicknessMap&&(x.iridescenceThicknessMap.value=S.iridescenceThicknessMap,t(S.iridescenceThicknessMap,x.iridescenceThicknessMapTransform))),S.transmission>0&&(x.transmission.value=S.transmission,x.transmissionSamplerMap.value=T.texture,x.transmissionSamplerSize.value.set(T.width,T.height),S.transmissionMap&&(x.transmissionMap.value=S.transmissionMap,t(S.transmissionMap,x.transmissionMapTransform)),x.thickness.value=S.thickness,S.thicknessMap&&(x.thicknessMap.value=S.thicknessMap,t(S.thicknessMap,x.thicknessMapTransform)),x.attenuationDistance.value=S.attenuationDistance,x.attenuationColor.value.copy(S.attenuationColor)),S.anisotropy>0&&(x.anisotropyVector.value.set(S.anisotropy*Math.cos(S.anisotropyRotation),S.anisotropy*Math.sin(S.anisotropyRotation)),S.anisotropyMap&&(x.anisotropyMap.value=S.anisotropyMap,t(S.anisotropyMap,x.anisotropyMapTransform))),x.specularIntensity.value=S.specularIntensity,x.specularColor.value.copy(S.specularColor),S.specularColorMap&&(x.specularColorMap.value=S.specularColorMap,t(S.specularColorMap,x.specularColorMapTransform)),S.specularIntensityMap&&(x.specularIntensityMap.value=S.specularIntensityMap,t(S.specularIntensityMap,x.specularIntensityMapTransform))}function _(x,S){S.matcap&&(x.matcap.value=S.matcap)}function E(x,S){const T=e.get(S).light;x.referencePosition.value.setFromMatrixPosition(T.matrixWorld),x.nearDistance.value=T.shadow.camera.near,x.farDistance.value=T.shadow.camera.far}return{refreshFogUniforms:r,refreshMaterialUniforms:i}}function K5(n,e,t,r){let i={},s={},a=[];const o=n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS);function u(T,A){const P=A.program;r.uniformBlockBinding(T,P)}function c(T,A){let P=i[T.id];P===void 0&&(_(T),P=f(T),i[T.id]=P,T.addEventListener("dispose",x));const L=A.program;r.updateUBOMapping(T,L);const D=e.render.frame;s[T.id]!==D&&(g(T),s[T.id]=D)}function f(T){const A=m();T.__bindingPointIndex=A;const P=n.createBuffer(),L=T.__size,D=T.usage;return n.bindBuffer(n.UNIFORM_BUFFER,P),n.bufferData(n.UNIFORM_BUFFER,L,D),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,A,P),P}function m(){for(let T=0;T<o;T++)if(a.indexOf(T)===-1)return a.push(T),T;return ln("WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function g(T){const A=i[T.id],P=T.uniforms,L=T.__cache;n.bindBuffer(n.UNIFORM_BUFFER,A);for(let D=0,F=P.length;D<F;D++){const k=Array.isArray(P[D])?P[D]:[P[D]];for(let R=0,U=k.length;R<U;R++){const V=k[R];if(y(V,D,R,L)===!0){const H=V.__offset,J=Array.isArray(V.value)?V.value:[V.value];let $=0;for(let ae=0;ae<J.length;ae++){const ne=J[ae],oe=E(ne);typeof ne=="number"||typeof ne=="boolean"?(V.__data[0]=ne,n.bufferSubData(n.UNIFORM_BUFFER,H+$,V.__data)):ne.isMatrix3?(V.__data[0]=ne.elements[0],V.__data[1]=ne.elements[1],V.__data[2]=ne.elements[2],V.__data[3]=0,V.__data[4]=ne.elements[3],V.__data[5]=ne.elements[4],V.__data[6]=ne.elements[5],V.__data[7]=0,V.__data[8]=ne.elements[6],V.__data[9]=ne.elements[7],V.__data[10]=ne.elements[8],V.__data[11]=0):(ne.toArray(V.__data,$),$+=oe.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,H,V.__data)}}}n.bindBuffer(n.UNIFORM_BUFFER,null)}function y(T,A,P,L){const D=T.value,F=A+"_"+P;if(L[F]===void 0)return typeof D=="number"||typeof D=="boolean"?L[F]=D:L[F]=D.clone(),!0;{const k=L[F];if(typeof D=="number"||typeof D=="boolean"){if(k!==D)return L[F]=D,!0}else if(k.equals(D)===!1)return k.copy(D),!0}return!1}function _(T){const A=T.uniforms;let P=0;const L=16;for(let F=0,k=A.length;F<k;F++){const R=Array.isArray(A[F])?A[F]:[A[F]];for(let U=0,V=R.length;U<V;U++){const H=R[U],J=Array.isArray(H.value)?H.value:[H.value];for(let $=0,ae=J.length;$<ae;$++){const ne=J[$],oe=E(ne),te=P%L,ie=te%oe.boundary,Y=te+ie;P+=ie,Y!==0&&L-Y<oe.storage&&(P+=L-Y),H.__data=new Float32Array(oe.storage/Float32Array.BYTES_PER_ELEMENT),H.__offset=P,P+=oe.storage}}}const D=P%L;return D>0&&(P+=L-D),T.__size=P,T.__cache={},this}function E(T){const A={boundary:0,storage:0};return typeof T=="number"||typeof T=="boolean"?(A.boundary=4,A.storage=4):T.isVector2?(A.boundary=8,A.storage=8):T.isVector3||T.isColor?(A.boundary=16,A.storage=12):T.isVector4?(A.boundary=16,A.storage=16):T.isMatrix3?(A.boundary=48,A.storage=48):T.isMatrix4?(A.boundary=64,A.storage=64):T.isTexture?Ft("WebGLRenderer: Texture samplers can not be part of an uniforms group."):Ft("WebGLRenderer: Unsupported uniform value type.",T),A}function x(T){const A=T.target;A.removeEventListener("dispose",x);const P=a.indexOf(A.__bindingPointIndex);a.splice(P,1),n.deleteBuffer(i[A.id]),delete i[A.id],delete s[A.id]}function S(){for(const T in i)n.deleteBuffer(i[T]);a=[],i={},s={}}return{bind:u,update:c,dispose:S}}const Q5=new Uint16Array([12469,15057,12620,14925,13266,14620,13807,14376,14323,13990,14545,13625,14713,13328,14840,12882,14931,12528,14996,12233,15039,11829,15066,11525,15080,11295,15085,10976,15082,10705,15073,10495,13880,14564,13898,14542,13977,14430,14158,14124,14393,13732,14556,13410,14702,12996,14814,12596,14891,12291,14937,11834,14957,11489,14958,11194,14943,10803,14921,10506,14893,10278,14858,9960,14484,14039,14487,14025,14499,13941,14524,13740,14574,13468,14654,13106,14743,12678,14818,12344,14867,11893,14889,11509,14893,11180,14881,10751,14852,10428,14812,10128,14765,9754,14712,9466,14764,13480,14764,13475,14766,13440,14766,13347,14769,13070,14786,12713,14816,12387,14844,11957,14860,11549,14868,11215,14855,10751,14825,10403,14782,10044,14729,9651,14666,9352,14599,9029,14967,12835,14966,12831,14963,12804,14954,12723,14936,12564,14917,12347,14900,11958,14886,11569,14878,11247,14859,10765,14828,10401,14784,10011,14727,9600,14660,9289,14586,8893,14508,8533,15111,12234,15110,12234,15104,12216,15092,12156,15067,12010,15028,11776,14981,11500,14942,11205,14902,10752,14861,10393,14812,9991,14752,9570,14682,9252,14603,8808,14519,8445,14431,8145,15209,11449,15208,11451,15202,11451,15190,11438,15163,11384,15117,11274,15055,10979,14994,10648,14932,10343,14871,9936,14803,9532,14729,9218,14645,8742,14556,8381,14461,8020,14365,7603,15273,10603,15272,10607,15267,10619,15256,10631,15231,10614,15182,10535,15118,10389,15042,10167,14963,9787,14883,9447,14800,9115,14710,8665,14615,8318,14514,7911,14411,7507,14279,7198,15314,9675,15313,9683,15309,9712,15298,9759,15277,9797,15229,9773,15166,9668,15084,9487,14995,9274,14898,8910,14800,8539,14697,8234,14590,7790,14479,7409,14367,7067,14178,6621,15337,8619,15337,8631,15333,8677,15325,8769,15305,8871,15264,8940,15202,8909,15119,8775,15022,8565,14916,8328,14804,8009,14688,7614,14569,7287,14448,6888,14321,6483,14088,6171,15350,7402,15350,7419,15347,7480,15340,7613,15322,7804,15287,7973,15229,8057,15148,8012,15046,7846,14933,7611,14810,7357,14682,7069,14552,6656,14421,6316,14251,5948,14007,5528,15356,5942,15356,5977,15353,6119,15348,6294,15332,6551,15302,6824,15249,7044,15171,7122,15070,7050,14949,6861,14818,6611,14679,6349,14538,6067,14398,5651,14189,5311,13935,4958,15359,4123,15359,4153,15356,4296,15353,4646,15338,5160,15311,5508,15263,5829,15188,6042,15088,6094,14966,6001,14826,5796,14678,5543,14527,5287,14377,4985,14133,4586,13869,4257,15360,1563,15360,1642,15358,2076,15354,2636,15341,3350,15317,4019,15273,4429,15203,4732,15105,4911,14981,4932,14836,4818,14679,4621,14517,4386,14359,4156,14083,3795,13808,3437,15360,122,15360,137,15358,285,15355,636,15344,1274,15322,2177,15281,2765,15215,3223,15120,3451,14995,3569,14846,3567,14681,3466,14511,3305,14344,3121,14037,2800,13753,2467,15360,0,15360,1,15359,21,15355,89,15346,253,15325,479,15287,796,15225,1148,15133,1492,15008,1749,14856,1882,14685,1886,14506,1783,14324,1608,13996,1398,13702,1183]);let Do=null;function $5(){return Do===null&&(Do=new Aa(Q5,16,16,jc,Vi),Do.name="DFG_LUT",Do.minFilter=Dn,Do.magFilter=Dn,Do.wrapS=Gi,Do.wrapT=Gi,Do.generateMipmaps=!1,Do.needsUpdate=!0),Do}class Lx{constructor(e={}){const{canvas:t=cE(),context:r=null,depth:i=!0,stencil:s=!1,alpha:a=!1,antialias:o=!1,premultipliedAlpha:u=!0,preserveDrawingBuffer:c=!1,powerPreference:f="default",failIfMajorPerformanceCaveat:m=!1,reversedDepthBuffer:g=!1,outputBufferType:y=Rr}=e;this.isWebGLRenderer=!0;let _;if(r!==null){if(typeof WebGLRenderingContext<"u"&&r instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");_=r.getContextAttributes().alpha}else _=a;const E=y,x=new Set([Ov,Fv,i0]),S=new Set([Rr,ca,Nf,Df,Dv,Uv]),T=new Uint32Array(4),A=new Int32Array(4);let P=null,L=null;const D=[],F=[];let k=null;this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=ba,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const R=this;let U=!1;this._outputColorSpace=rs;let V=0,H=0,J=null,$=-1,ae=null;const ne=new $n,oe=new $n;let te=null;const ie=new jt(0);let Y=0,z=t.width,K=t.height,le=1,me=null,ve=null;const re=new $n(0,0,z,K),he=new $n(0,0,z,K);let ye=!1;const ze=new Xf;let Ve=!1,Ke=!1;const Qe=new vn,pt=new X,Ne=new $n,Be={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let De=!1;function it(){return J===null?le:1}let Q=r;function at(Z,de){return t.getContext(Z,de)}try{const Z={alpha:!0,depth:i,stencil:s,antialias:o,premultipliedAlpha:u,preserveDrawingBuffer:c,powerPreference:f,failIfMajorPerformanceCaveat:m};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${$p}`),t.addEventListener("webglcontextlost",kt,!1),t.addEventListener("webglcontextrestored",zt,!1),t.addEventListener("webglcontextcreationerror",nn,!1),Q===null){const de="webgl2";if(Q=at(de,Z),Q===null)throw at(de)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(Z){throw ln("WebGLRenderer: "+Z.message),Z}let je,Ce,He,q,B,ue,Re,Pe,Te,ot,rt,mt,Rt,Ge,Xe,nt,gt,st,Ot,pe,Ee,et,Pt,tt;function ke(){je=new eL(Q),je.init(),et=new p3(Q,je),Ce=new jI(Q,je,e,et),He=new H5(Q,je),Ce.reversedDepthBuffer&&g&&He.buffers.depth.setReversed(!0),q=new iL(Q),B=new C5,ue=new W5(Q,je,He,B,Ce,et,q),Re=new qI(R),Pe=new $I(R),Te=new oP(Q),Pt=new HI(Q,Te),ot=new tL(Q,Te,q,Pt),rt=new sL(Q,ot,Te,q),Ot=new rL(Q,Ce,ue),nt=new XI(B),mt=new A5(R,Re,Pe,je,Ce,Pt,nt),Rt=new J5(R,B),Ge=new R5,Xe=new F5(je),st=new VI(R,Re,Pe,He,rt,_,u),gt=new G5(R,rt,Ce),tt=new K5(Q,q,Ce,He),pe=new WI(Q,je,q),Ee=new nL(Q,je,q),q.programs=mt.programs,R.capabilities=Ce,R.extensions=je,R.properties=B,R.renderLists=Ge,R.shadowMap=gt,R.state=He,R.info=q}ke(),E!==Rr&&(k=new oL(E,t.width,t.height,i,s));const dt=new Y5(R,Q);this.xr=dt,this.getContext=function(){return Q},this.getContextAttributes=function(){return Q.getContextAttributes()},this.forceContextLoss=function(){const Z=je.get("WEBGL_lose_context");Z&&Z.loseContext()},this.forceContextRestore=function(){const Z=je.get("WEBGL_lose_context");Z&&Z.restoreContext()},this.getPixelRatio=function(){return le},this.setPixelRatio=function(Z){Z!==void 0&&(le=Z,this.setSize(z,K,!1))},this.getSize=function(Z){return Z.set(z,K)},this.setSize=function(Z,de,xe=!0){if(dt.isPresenting){Ft("WebGLRenderer: Can't change size while VR device is presenting.");return}z=Z,K=de,t.width=Math.floor(Z*le),t.height=Math.floor(de*le),xe===!0&&(t.style.width=Z+"px",t.style.height=de+"px"),k!==null&&k.setSize(t.width,t.height),this.setViewport(0,0,Z,de)},this.getDrawingBufferSize=function(Z){return Z.set(z*le,K*le).floor()},this.setDrawingBufferSize=function(Z,de,xe){z=Z,K=de,le=xe,t.width=Math.floor(Z*xe),t.height=Math.floor(de*xe),this.setViewport(0,0,Z,de)},this.setEffects=function(Z){if(E===Rr){console.error("THREE.WebGLRenderer: setEffects() requires outputBufferType set to HalfFloatType or FloatType.");return}if(Z){for(let de=0;de<Z.length;de++)if(Z[de].isOutputPass===!0){console.warn("THREE.WebGLRenderer: OutputPass is not needed in setEffects(). Tone mapping and color space conversion are applied automatically.");break}}k.setEffects(Z||[])},this.getCurrentViewport=function(Z){return Z.copy(ne)},this.getViewport=function(Z){return Z.copy(re)},this.setViewport=function(Z,de,xe,Me){Z.isVector4?re.set(Z.x,Z.y,Z.z,Z.w):re.set(Z,de,xe,Me),He.viewport(ne.copy(re).multiplyScalar(le).round())},this.getScissor=function(Z){return Z.copy(he)},this.setScissor=function(Z,de,xe,Me){Z.isVector4?he.set(Z.x,Z.y,Z.z,Z.w):he.set(Z,de,xe,Me),He.scissor(oe.copy(he).multiplyScalar(le).round())},this.getScissorTest=function(){return ye},this.setScissorTest=function(Z){He.setScissorTest(ye=Z)},this.setOpaqueSort=function(Z){me=Z},this.setTransparentSort=function(Z){ve=Z},this.getClearColor=function(Z){return Z.copy(st.getClearColor())},this.setClearColor=function(){st.setClearColor(...arguments)},this.getClearAlpha=function(){return st.getClearAlpha()},this.setClearAlpha=function(){st.setClearAlpha(...arguments)},this.clear=function(Z=!0,de=!0,xe=!0){let Me=0;if(Z){let Se=!1;if(J!==null){const lt=J.texture.format;Se=x.has(lt)}if(Se){const lt=J.texture.type,ut=S.has(lt),Je=st.getClearColor(),ht=st.getClearAlpha(),ft=Je.r,Nt=Je.g,St=Je.b;ut?(T[0]=ft,T[1]=Nt,T[2]=St,T[3]=ht,Q.clearBufferuiv(Q.COLOR,0,T)):(A[0]=ft,A[1]=Nt,A[2]=St,A[3]=ht,Q.clearBufferiv(Q.COLOR,0,A))}else Me|=Q.COLOR_BUFFER_BIT}de&&(Me|=Q.DEPTH_BUFFER_BIT),xe&&(Me|=Q.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),Q.clear(Me)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",kt,!1),t.removeEventListener("webglcontextrestored",zt,!1),t.removeEventListener("webglcontextcreationerror",nn,!1),st.dispose(),Ge.dispose(),Xe.dispose(),B.dispose(),Re.dispose(),Pe.dispose(),rt.dispose(),Pt.dispose(),tt.dispose(),mt.dispose(),dt.dispose(),dt.removeEventListener("sessionstart",Mi),dt.removeEventListener("sessionend",ri),on.stop()};function kt(Z){Z.preventDefault(),zp("WebGLRenderer: Context Lost."),U=!0}function zt(){zp("WebGLRenderer: Context Restored."),U=!1;const Z=q.autoReset,de=gt.enabled,xe=gt.autoUpdate,Me=gt.needsUpdate,Se=gt.type;ke(),q.autoReset=Z,gt.enabled=de,gt.autoUpdate=xe,gt.needsUpdate=Me,gt.type=Se}function nn(Z){ln("WebGLRenderer: A WebGL context could not be created. Reason: ",Z.statusMessage)}function zn(Z){const de=Z.target;de.removeEventListener("dispose",zn),Un(de)}function Un(Z){Kn(Z),B.remove(Z)}function Kn(Z){const de=B.get(Z).programs;de!==void 0&&(de.forEach(function(xe){mt.releaseProgram(xe)}),Z.isShaderMaterial&&mt.releaseShaderCache(Z))}this.renderBufferDirect=function(Z,de,xe,Me,Se,lt){de===null&&(de=Be);const ut=Se.isMesh&&Se.matrixWorld.determinant()<0,Je=Mt(Z,de,xe,Me,Se);He.setMaterial(Me,ut);let ht=xe.index,ft=1;if(Me.wireframe===!0){if(ht=ot.getWireframeAttribute(xe),ht===void 0)return;ft=2}const Nt=xe.drawRange,St=xe.attributes.position;let Xt=Nt.start*ft,un=(Nt.start+Nt.count)*ft;lt!==null&&(Xt=Math.max(Xt,lt.start*ft),un=Math.min(un,(lt.start+lt.count)*ft)),ht!==null?(Xt=Math.max(Xt,0),un=Math.min(un,ht.count)):St!=null&&(Xt=Math.max(Xt,0),un=Math.min(un,St.count));const dn=un-Xt;if(dn<0||dn===1/0)return;Pt.setup(Se,Me,Je,xe,ht);let fn,Kt=pe;if(ht!==null&&(fn=Te.get(ht),Kt=Ee,Kt.setIndex(fn)),Se.isMesh)Me.wireframe===!0?(He.setLineWidth(Me.wireframeLinewidth*it()),Kt.setMode(Q.LINES)):Kt.setMode(Q.TRIANGLES);else if(Se.isLine){let Ut=Me.linewidth;Ut===void 0&&(Ut=1),He.setLineWidth(Ut*it()),Se.isLineSegments?Kt.setMode(Q.LINES):Se.isLineLoop?Kt.setMode(Q.LINE_LOOP):Kt.setMode(Q.LINE_STRIP)}else Se.isPoints?Kt.setMode(Q.POINTS):Se.isSprite&&Kt.setMode(Q.TRIANGLES);if(Se.isBatchedMesh)if(Se._multiDrawInstances!==null)Ff("WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),Kt.renderMultiDrawInstances(Se._multiDrawStarts,Se._multiDrawCounts,Se._multiDrawCount,Se._multiDrawInstances);else if(je.get("WEBGL_multi_draw"))Kt.renderMultiDraw(Se._multiDrawStarts,Se._multiDrawCounts,Se._multiDrawCount);else{const Ut=Se._multiDrawStarts,$t=Se._multiDrawCounts,Dt=Se._multiDrawCount,bn=ht?Te.get(ht).bytesPerElement:1,mi=B.get(Me).currentProgram.getUniforms();for(let In=0;In<Dt;In++)mi.setValue(Q,"_gl_DrawID",In),Kt.render(Ut[In]/bn,$t[In])}else if(Se.isInstancedMesh)Kt.renderInstances(Xt,dn,Se.count);else if(xe.isInstancedBufferGeometry){const Ut=xe._maxInstanceCount!==void 0?xe._maxInstanceCount:1/0,$t=Math.min(xe.instanceCount,Ut);Kt.renderInstances(Xt,dn,$t)}else Kt.render(Xt,dn)};function Si(Z,de,xe){Z.transparent===!0&&Z.side===Ea&&Z.forceSinglePass===!1?(Z.side=Ms,Z.needsUpdate=!0,Ue(Z,de,xe),Z.side=Pl,Z.needsUpdate=!0,Ue(Z,de,xe),Z.side=Ea):Ue(Z,de,xe)}this.compile=function(Z,de,xe=null){xe===null&&(xe=Z),L=Xe.get(xe),L.init(de),F.push(L),xe.traverseVisible(function(Se){Se.isLight&&Se.layers.test(de.layers)&&(L.pushLight(Se),Se.castShadow&&L.pushShadow(Se))}),Z!==xe&&Z.traverseVisible(function(Se){Se.isLight&&Se.layers.test(de.layers)&&(L.pushLight(Se),Se.castShadow&&L.pushShadow(Se))}),L.setupLights();const Me=new Set;return Z.traverse(function(Se){if(!(Se.isMesh||Se.isPoints||Se.isLine||Se.isSprite))return;const lt=Se.material;if(lt)if(Array.isArray(lt))for(let ut=0;ut<lt.length;ut++){const Je=lt[ut];Si(Je,xe,Se),Me.add(Je)}else Si(lt,xe,Se),Me.add(lt)}),L=F.pop(),Me},this.compileAsync=function(Z,de,xe=null){const Me=this.compile(Z,de,xe);return new Promise(Se=>{function lt(){if(Me.forEach(function(ut){B.get(ut).currentProgram.isReady()&&Me.delete(ut)}),Me.size===0){Se(Z);return}setTimeout(lt,10)}je.get("KHR_parallel_shader_compile")!==null?lt():setTimeout(lt,10)})};let Di=null;function Ai(Z){Di&&Di(Z)}function Mi(){on.stop()}function ri(){on.start()}const on=new u3;on.setAnimationLoop(Ai),typeof self<"u"&&on.setContext(self),this.setAnimationLoop=function(Z){Di=Z,dt.setAnimationLoop(Z),Z===null?on.stop():on.start()},dt.addEventListener("sessionstart",Mi),dt.addEventListener("sessionend",ri),this.render=function(Z,de){if(de!==void 0&&de.isCamera!==!0){ln("WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(U===!0)return;const xe=dt.enabled===!0&&dt.isPresenting===!0,Me=k!==null&&(J===null||xe)&&k.begin(R,J);if(Z.matrixWorldAutoUpdate===!0&&Z.updateMatrixWorld(),de.parent===null&&de.matrixWorldAutoUpdate===!0&&de.updateMatrixWorld(),dt.enabled===!0&&dt.isPresenting===!0&&(k===null||k.isCompositing()===!1)&&(dt.cameraAutoUpdate===!0&&dt.updateCamera(de),de=dt.getCamera()),Z.isScene===!0&&Z.onBeforeRender(R,Z,de,J),L=Xe.get(Z,F.length),L.init(de),F.push(L),Qe.multiplyMatrices(de.projectionMatrix,de.matrixWorldInverse),ze.setFromProjectionMatrix(Qe,oa,de.reversedDepth),Ke=this.localClippingEnabled,Ve=nt.init(this.clippingPlanes,Ke),P=Ge.get(Z,D.length),P.init(),D.push(P),dt.enabled===!0&&dt.isPresenting===!0){const ut=R.xr.getDepthSensingMesh();ut!==null&&li(ut,de,-1/0,R.sortObjects)}li(Z,de,0,R.sortObjects),P.finish(),R.sortObjects===!0&&P.sort(me,ve),De=dt.enabled===!1||dt.isPresenting===!1||dt.hasDepthSensing()===!1,De&&st.addToRenderList(P,Z),this.info.render.frame++,Ve===!0&&nt.beginShadows();const Se=L.state.shadowsArray;if(gt.render(Se,Z,de),Ve===!0&&nt.endShadows(),this.info.autoReset===!0&&this.info.reset(),(Me&&k.hasRenderPass())===!1){const ut=P.opaque,Je=P.transmissive;if(L.setupLights(),de.isArrayCamera){const ht=de.cameras;if(Je.length>0)for(let ft=0,Nt=ht.length;ft<Nt;ft++){const St=ht[ft];W(ut,Je,Z,St)}De&&st.render(Z);for(let ft=0,Nt=ht.length;ft<Nt;ft++){const St=ht[ft];Xr(P,Z,St,St.viewport)}}else Je.length>0&&W(ut,Je,Z,de),De&&st.render(Z),Xr(P,Z,de)}J!==null&&H===0&&(ue.updateMultisampleRenderTarget(J),ue.updateRenderTargetMipmap(J)),Me&&k.end(R),Z.isScene===!0&&Z.onAfterRender(R,Z,de),Pt.resetDefaultState(),$=-1,ae=null,F.pop(),F.length>0?(L=F[F.length-1],Ve===!0&&nt.setGlobalState(R.clippingPlanes,L.state.camera)):L=null,D.pop(),D.length>0?P=D[D.length-1]:P=null};function li(Z,de,xe,Me){if(Z.visible===!1)return;if(Z.layers.test(de.layers)){if(Z.isGroup)xe=Z.renderOrder;else if(Z.isLOD)Z.autoUpdate===!0&&Z.update(de);else if(Z.isLight)L.pushLight(Z),Z.castShadow&&L.pushShadow(Z);else if(Z.isSprite){if(!Z.frustumCulled||ze.intersectsSprite(Z)){Me&&Ne.setFromMatrixPosition(Z.matrixWorld).applyMatrix4(Qe);const ut=rt.update(Z),Je=Z.material;Je.visible&&P.push(Z,ut,Je,xe,Ne.z,null)}}else if((Z.isMesh||Z.isLine||Z.isPoints)&&(!Z.frustumCulled||ze.intersectsObject(Z))){const ut=rt.update(Z),Je=Z.material;if(Me&&(Z.boundingSphere!==void 0?(Z.boundingSphere===null&&Z.computeBoundingSphere(),Ne.copy(Z.boundingSphere.center)):(ut.boundingSphere===null&&ut.computeBoundingSphere(),Ne.copy(ut.boundingSphere.center)),Ne.applyMatrix4(Z.matrixWorld).applyMatrix4(Qe)),Array.isArray(Je)){const ht=ut.groups;for(let ft=0,Nt=ht.length;ft<Nt;ft++){const St=ht[ft],Xt=Je[St.materialIndex];Xt&&Xt.visible&&P.push(Z,ut,Xt,xe,Ne.z,St)}}else Je.visible&&P.push(Z,ut,Je,xe,Ne.z,null)}}const lt=Z.children;for(let ut=0,Je=lt.length;ut<Je;ut++)li(lt[ut],de,xe,Me)}function Xr(Z,de,xe,Me){const{opaque:Se,transmissive:lt,transparent:ut}=Z;L.setupLightsView(xe),Ve===!0&&nt.setGlobalState(R.clippingPlanes,xe),Me&&He.viewport(ne.copy(Me)),Se.length>0&&ee(Se,de,xe),lt.length>0&&ee(lt,de,xe),ut.length>0&&ee(ut,de,xe),He.buffers.depth.setTest(!0),He.buffers.depth.setMask(!0),He.buffers.color.setMask(!0),He.setPolygonOffset(!1)}function W(Z,de,xe,Me){if((xe.isScene===!0?xe.overrideMaterial:null)!==null)return;if(L.state.transmissionRenderTarget[Me.id]===void 0){const Xt=je.has("EXT_color_buffer_half_float")||je.has("EXT_color_buffer_float");L.state.transmissionRenderTarget[Me.id]=new ws(1,1,{generateMipmaps:!0,type:Xt?Vi:Rr,minFilter:Fo,samples:Ce.samples,stencilBuffer:s,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:kn.workingColorSpace})}const lt=L.state.transmissionRenderTarget[Me.id],ut=Me.viewport||ne;lt.setSize(ut.z*R.transmissionResolutionScale,ut.w*R.transmissionResolutionScale);const Je=R.getRenderTarget(),ht=R.getActiveCubeFace(),ft=R.getActiveMipmapLevel();R.setRenderTarget(lt),R.getClearColor(ie),Y=R.getClearAlpha(),Y<1&&R.setClearColor(16777215,.5),R.clear(),De&&st.render(xe);const Nt=R.toneMapping;R.toneMapping=ba;const St=Me.viewport;if(Me.viewport!==void 0&&(Me.viewport=void 0),L.setupLightsView(Me),Ve===!0&&nt.setGlobalState(R.clippingPlanes,Me),ee(Z,xe,Me),ue.updateMultisampleRenderTarget(lt),ue.updateRenderTargetMipmap(lt),je.has("WEBGL_multisampled_render_to_texture")===!1){let Xt=!1;for(let un=0,dn=de.length;un<dn;un++){const fn=de[un],{object:Kt,geometry:Ut,material:$t,group:Dt}=fn;if($t.side===Ea&&Kt.layers.test(Me.layers)){const bn=$t.side;$t.side=Ms,$t.needsUpdate=!0,ge(Kt,xe,Me,Ut,$t,Dt),$t.side=bn,$t.needsUpdate=!0,Xt=!0}}Xt===!0&&(ue.updateMultisampleRenderTarget(lt),ue.updateRenderTargetMipmap(lt))}R.setRenderTarget(Je,ht,ft),R.setClearColor(ie,Y),St!==void 0&&(Me.viewport=St),R.toneMapping=Nt}function ee(Z,de,xe){const Me=de.isScene===!0?de.overrideMaterial:null;for(let Se=0,lt=Z.length;Se<lt;Se++){const ut=Z[Se],{object:Je,geometry:ht,group:ft}=ut;let Nt=ut.material;Nt.allowOverride===!0&&Me!==null&&(Nt=Me),Je.layers.test(xe.layers)&&ge(Je,de,xe,ht,Nt,ft)}}function ge(Z,de,xe,Me,Se,lt){Z.onBeforeRender(R,de,xe,Me,Se,lt),Z.modelViewMatrix.multiplyMatrices(xe.matrixWorldInverse,Z.matrixWorld),Z.normalMatrix.getNormalMatrix(Z.modelViewMatrix),Se.onBeforeRender(R,de,xe,Me,Z,lt),Se.transparent===!0&&Se.side===Ea&&Se.forceSinglePass===!1?(Se.side=Ms,Se.needsUpdate=!0,R.renderBufferDirect(xe,de,Me,Se,Z,lt),Se.side=Pl,Se.needsUpdate=!0,R.renderBufferDirect(xe,de,Me,Se,Z,lt),Se.side=Ea):R.renderBufferDirect(xe,de,Me,Se,Z,lt),Z.onAfterRender(R,de,xe,Me,Se,lt)}function Ue(Z,de,xe){de.isScene!==!0&&(de=Be);const Me=B.get(Z),Se=L.state.lights,lt=L.state.shadowsArray,ut=Se.state.version,Je=mt.getParameters(Z,Se.state,lt,de,xe),ht=mt.getProgramCacheKey(Je);let ft=Me.programs;Me.environment=Z.isMeshStandardMaterial?de.environment:null,Me.fog=de.fog,Me.envMap=(Z.isMeshStandardMaterial?Pe:Re).get(Z.envMap||Me.environment),Me.envMapRotation=Me.environment!==null&&Z.envMap===null?de.environmentRotation:Z.envMapRotation,ft===void 0&&(Z.addEventListener("dispose",zn),ft=new Map,Me.programs=ft);let Nt=ft.get(ht);if(Nt!==void 0){if(Me.currentProgram===Nt&&Me.lightsStateVersion===ut)return Ye(Z,Je),Nt}else Je.uniforms=mt.getUniforms(Z),Z.onBeforeCompile(Je,R),Nt=mt.acquireProgram(Je,ht),ft.set(ht,Nt),Me.uniforms=Je.uniforms;const St=Me.uniforms;return(!Z.isShaderMaterial&&!Z.isRawShaderMaterial||Z.clipping===!0)&&(St.clippingPlanes=nt.uniform),Ye(Z,Je),Me.needsLights=Et(Z),Me.lightsStateVersion=ut,Me.needsLights&&(St.ambientLightColor.value=Se.state.ambient,St.lightProbe.value=Se.state.probe,St.directionalLights.value=Se.state.directional,St.directionalLightShadows.value=Se.state.directionalShadow,St.spotLights.value=Se.state.spot,St.spotLightShadows.value=Se.state.spotShadow,St.rectAreaLights.value=Se.state.rectArea,St.ltc_1.value=Se.state.rectAreaLTC1,St.ltc_2.value=Se.state.rectAreaLTC2,St.pointLights.value=Se.state.point,St.pointLightShadows.value=Se.state.pointShadow,St.hemisphereLights.value=Se.state.hemi,St.directionalShadowMap.value=Se.state.directionalShadowMap,St.directionalShadowMatrix.value=Se.state.directionalShadowMatrix,St.spotShadowMap.value=Se.state.spotShadowMap,St.spotLightMatrix.value=Se.state.spotLightMatrix,St.spotLightMap.value=Se.state.spotLightMap,St.pointShadowMap.value=Se.state.pointShadowMap,St.pointShadowMatrix.value=Se.state.pointShadowMatrix),Me.currentProgram=Nt,Me.uniformsList=null,Nt}function qe(Z){if(Z.uniformsList===null){const de=Z.currentProgram.getUniforms();Z.uniformsList=vg.seqWithValue(de.seq,Z.uniforms)}return Z.uniformsList}function Ye(Z,de){const xe=B.get(Z);xe.outputColorSpace=de.outputColorSpace,xe.batching=de.batching,xe.batchingColor=de.batchingColor,xe.instancing=de.instancing,xe.instancingColor=de.instancingColor,xe.instancingMorph=de.instancingMorph,xe.skinning=de.skinning,xe.morphTargets=de.morphTargets,xe.morphNormals=de.morphNormals,xe.morphColors=de.morphColors,xe.morphTargetsCount=de.morphTargetsCount,xe.numClippingPlanes=de.numClippingPlanes,xe.numIntersection=de.numClipIntersection,xe.vertexAlphas=de.vertexAlphas,xe.vertexTangents=de.vertexTangents,xe.toneMapping=de.toneMapping}function Mt(Z,de,xe,Me,Se){de.isScene!==!0&&(de=Be),ue.resetTextureUnits();const lt=de.fog,ut=Me.isMeshStandardMaterial?de.environment:null,Je=J===null?R.outputColorSpace:J.isXRRenderTarget===!0?J.texture.colorSpace:zo,ht=(Me.isMeshStandardMaterial?Pe:Re).get(Me.envMap||ut),ft=Me.vertexColors===!0&&!!xe.attributes.color&&xe.attributes.color.itemSize===4,Nt=!!xe.attributes.tangent&&(!!Me.normalMap||Me.anisotropy>0),St=!!xe.morphAttributes.position,Xt=!!xe.morphAttributes.normal,un=!!xe.morphAttributes.color;let dn=ba;Me.toneMapped&&(J===null||J.isXRRenderTarget===!0)&&(dn=R.toneMapping);const fn=xe.morphAttributes.position||xe.morphAttributes.normal||xe.morphAttributes.color,Kt=fn!==void 0?fn.length:0,Ut=B.get(Me),$t=L.state.lights;if(Ve===!0&&(Ke===!0||Z!==ae)){const ui=Z===ae&&Me.id===$;nt.setState(Me,Z,ui)}let Dt=!1;Me.version===Ut.__version?(Ut.needsLights&&Ut.lightsStateVersion!==$t.state.version||Ut.outputColorSpace!==Je||Se.isBatchedMesh&&Ut.batching===!1||!Se.isBatchedMesh&&Ut.batching===!0||Se.isBatchedMesh&&Ut.batchingColor===!0&&Se.colorTexture===null||Se.isBatchedMesh&&Ut.batchingColor===!1&&Se.colorTexture!==null||Se.isInstancedMesh&&Ut.instancing===!1||!Se.isInstancedMesh&&Ut.instancing===!0||Se.isSkinnedMesh&&Ut.skinning===!1||!Se.isSkinnedMesh&&Ut.skinning===!0||Se.isInstancedMesh&&Ut.instancingColor===!0&&Se.instanceColor===null||Se.isInstancedMesh&&Ut.instancingColor===!1&&Se.instanceColor!==null||Se.isInstancedMesh&&Ut.instancingMorph===!0&&Se.morphTexture===null||Se.isInstancedMesh&&Ut.instancingMorph===!1&&Se.morphTexture!==null||Ut.envMap!==ht||Me.fog===!0&&Ut.fog!==lt||Ut.numClippingPlanes!==void 0&&(Ut.numClippingPlanes!==nt.numPlanes||Ut.numIntersection!==nt.numIntersection)||Ut.vertexAlphas!==ft||Ut.vertexTangents!==Nt||Ut.morphTargets!==St||Ut.morphNormals!==Xt||Ut.morphColors!==un||Ut.toneMapping!==dn||Ut.morphTargetsCount!==Kt)&&(Dt=!0):(Dt=!0,Ut.__version=Me.version);let bn=Ut.currentProgram;Dt===!0&&(bn=Ue(Me,de,Se));let mi=!1,In=!1,Hi=!1;const Ln=bn.getUniforms(),cn=Ut.uniforms;if(He.useProgram(bn.program)&&(mi=!0,In=!0,Hi=!0),Me.id!==$&&($=Me.id,In=!0),mi||ae!==Z){He.buffers.depth.getReversed()&&Z.reversedDepth!==!0&&(Z._reversedDepth=!0,Z.updateProjectionMatrix()),Ln.setValue(Q,"projectionMatrix",Z.projectionMatrix),Ln.setValue(Q,"viewMatrix",Z.matrixWorldInverse);const Ci=Ln.map.cameraPosition;Ci!==void 0&&Ci.setValue(Q,pt.setFromMatrixPosition(Z.matrixWorld)),Ce.logarithmicDepthBuffer&&Ln.setValue(Q,"logDepthBufFC",2/(Math.log(Z.far+1)/Math.LN2)),(Me.isMeshPhongMaterial||Me.isMeshToonMaterial||Me.isMeshLambertMaterial||Me.isMeshBasicMaterial||Me.isMeshStandardMaterial||Me.isShaderMaterial)&&Ln.setValue(Q,"isOrthographic",Z.isOrthographicCamera===!0),ae!==Z&&(ae=Z,In=!0,Hi=!0)}if(Ut.needsLights&&($t.state.directionalShadowMap.length>0&&Ln.setValue(Q,"directionalShadowMap",$t.state.directionalShadowMap,ue),$t.state.spotShadowMap.length>0&&Ln.setValue(Q,"spotShadowMap",$t.state.spotShadowMap,ue),$t.state.pointShadowMap.length>0&&Ln.setValue(Q,"pointShadowMap",$t.state.pointShadowMap,ue)),Se.isSkinnedMesh){Ln.setOptional(Q,Se,"bindMatrix"),Ln.setOptional(Q,Se,"bindMatrixInverse");const ui=Se.skeleton;ui&&(ui.boneTexture===null&&ui.computeBoneTexture(),Ln.setValue(Q,"boneTexture",ui.boneTexture,ue))}Se.isBatchedMesh&&(Ln.setOptional(Q,Se,"batchingTexture"),Ln.setValue(Q,"batchingTexture",Se._matricesTexture,ue),Ln.setOptional(Q,Se,"batchingIdTexture"),Ln.setValue(Q,"batchingIdTexture",Se._indirectTexture,ue),Ln.setOptional(Q,Se,"batchingColorTexture"),Se._colorsTexture!==null&&Ln.setValue(Q,"batchingColorTexture",Se._colorsTexture,ue));const gi=xe.morphAttributes;if((gi.position!==void 0||gi.normal!==void 0||gi.color!==void 0)&&Ot.update(Se,xe,bn),(In||Ut.receiveShadow!==Se.receiveShadow)&&(Ut.receiveShadow=Se.receiveShadow,Ln.setValue(Q,"receiveShadow",Se.receiveShadow)),Me.isMeshGouraudMaterial&&Me.envMap!==null&&(cn.envMap.value=ht,cn.flipEnvMap.value=ht.isCubeTexture&&ht.isRenderTargetTexture===!1?-1:1),Me.isMeshStandardMaterial&&Me.envMap===null&&de.environment!==null&&(cn.envMapIntensity.value=de.environmentIntensity),cn.dfgLUT!==void 0&&(cn.dfgLUT.value=$5()),In&&(Ln.setValue(Q,"toneMappingExposure",R.toneMappingExposure),Ut.needsLights&&vt(cn,Hi),lt&&Me.fog===!0&&Rt.refreshFogUniforms(cn,lt),Rt.refreshMaterialUniforms(cn,Me,le,K,L.state.transmissionRenderTarget[Z.id]),vg.upload(Q,qe(Ut),cn,ue)),Me.isShaderMaterial&&Me.uniformsNeedUpdate===!0&&(vg.upload(Q,qe(Ut),cn,ue),Me.uniformsNeedUpdate=!1),Me.isSpriteMaterial&&Ln.setValue(Q,"center",Se.center),Ln.setValue(Q,"modelViewMatrix",Se.modelViewMatrix),Ln.setValue(Q,"normalMatrix",Se.normalMatrix),Ln.setValue(Q,"modelMatrix",Se.matrixWorld),Me.isShaderMaterial||Me.isRawShaderMaterial){const ui=Me.uniformsGroups;for(let Ci=0,ha=ui.length;Ci<ha;Ci++){const $i=ui[Ci];tt.update($i,bn),tt.bind($i,bn)}}return bn}function vt(Z,de){Z.ambientLightColor.needsUpdate=de,Z.lightProbe.needsUpdate=de,Z.directionalLights.needsUpdate=de,Z.directionalLightShadows.needsUpdate=de,Z.pointLights.needsUpdate=de,Z.pointLightShadows.needsUpdate=de,Z.spotLights.needsUpdate=de,Z.spotLightShadows.needsUpdate=de,Z.rectAreaLights.needsUpdate=de,Z.hemisphereLights.needsUpdate=de}function Et(Z){return Z.isMeshLambertMaterial||Z.isMeshToonMaterial||Z.isMeshPhongMaterial||Z.isMeshStandardMaterial||Z.isShadowMaterial||Z.isShaderMaterial&&Z.lights===!0}this.getActiveCubeFace=function(){return V},this.getActiveMipmapLevel=function(){return H},this.getRenderTarget=function(){return J},this.setRenderTargetTextures=function(Z,de,xe){const Me=B.get(Z);Me.__autoAllocateDepthBuffer=Z.resolveDepthBuffer===!1,Me.__autoAllocateDepthBuffer===!1&&(Me.__useRenderToTexture=!1),B.get(Z.texture).__webglTexture=de,B.get(Z.depthTexture).__webglTexture=Me.__autoAllocateDepthBuffer?void 0:xe,Me.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(Z,de){const xe=B.get(Z);xe.__webglFramebuffer=de,xe.__useDefaultFramebuffer=de===void 0};const Tt=Q.createFramebuffer();this.setRenderTarget=function(Z,de=0,xe=0){J=Z,V=de,H=xe;let Me=null,Se=!1,lt=!1;if(Z){const Je=B.get(Z);if(Je.__useDefaultFramebuffer!==void 0){He.bindFramebuffer(Q.FRAMEBUFFER,Je.__webglFramebuffer),ne.copy(Z.viewport),oe.copy(Z.scissor),te=Z.scissorTest,He.viewport(ne),He.scissor(oe),He.setScissorTest(te),$=-1;return}else if(Je.__webglFramebuffer===void 0)ue.setupRenderTarget(Z);else if(Je.__hasExternalTextures)ue.rebindTextures(Z,B.get(Z.texture).__webglTexture,B.get(Z.depthTexture).__webglTexture);else if(Z.depthBuffer){const Nt=Z.depthTexture;if(Je.__boundDepthTexture!==Nt){if(Nt!==null&&B.has(Nt)&&(Z.width!==Nt.image.width||Z.height!==Nt.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");ue.setupDepthRenderbuffer(Z)}}const ht=Z.texture;(ht.isData3DTexture||ht.isDataArrayTexture||ht.isCompressedArrayTexture)&&(lt=!0);const ft=B.get(Z).__webglFramebuffer;Z.isWebGLCubeRenderTarget?(Array.isArray(ft[de])?Me=ft[de][xe]:Me=ft[de],Se=!0):Z.samples>0&&ue.useMultisampledRTT(Z)===!1?Me=B.get(Z).__webglMultisampledFramebuffer:Array.isArray(ft)?Me=ft[xe]:Me=ft,ne.copy(Z.viewport),oe.copy(Z.scissor),te=Z.scissorTest}else ne.copy(re).multiplyScalar(le).floor(),oe.copy(he).multiplyScalar(le).floor(),te=ye;if(xe!==0&&(Me=Tt),He.bindFramebuffer(Q.FRAMEBUFFER,Me)&&He.drawBuffers(Z,Me),He.viewport(ne),He.scissor(oe),He.setScissorTest(te),Se){const Je=B.get(Z.texture);Q.framebufferTexture2D(Q.FRAMEBUFFER,Q.COLOR_ATTACHMENT0,Q.TEXTURE_CUBE_MAP_POSITIVE_X+de,Je.__webglTexture,xe)}else if(lt){const Je=de;for(let ht=0;ht<Z.textures.length;ht++){const ft=B.get(Z.textures[ht]);Q.framebufferTextureLayer(Q.FRAMEBUFFER,Q.COLOR_ATTACHMENT0+ht,ft.__webglTexture,xe,Je)}}else if(Z!==null&&xe!==0){const Je=B.get(Z.texture);Q.framebufferTexture2D(Q.FRAMEBUFFER,Q.COLOR_ATTACHMENT0,Q.TEXTURE_2D,Je.__webglTexture,xe)}$=-1},this.readRenderTargetPixels=function(Z,de,xe,Me,Se,lt,ut,Je=0){if(!(Z&&Z.isWebGLRenderTarget)){ln("WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let ht=B.get(Z).__webglFramebuffer;if(Z.isWebGLCubeRenderTarget&&ut!==void 0&&(ht=ht[ut]),ht){He.bindFramebuffer(Q.FRAMEBUFFER,ht);try{const ft=Z.textures[Je],Nt=ft.format,St=ft.type;if(!Ce.textureFormatReadable(Nt)){ln("WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!Ce.textureTypeReadable(St)){ln("WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}de>=0&&de<=Z.width-Me&&xe>=0&&xe<=Z.height-Se&&(Z.textures.length>1&&Q.readBuffer(Q.COLOR_ATTACHMENT0+Je),Q.readPixels(de,xe,Me,Se,et.convert(Nt),et.convert(St),lt))}finally{const ft=J!==null?B.get(J).__webglFramebuffer:null;He.bindFramebuffer(Q.FRAMEBUFFER,ft)}}},this.readRenderTargetPixelsAsync=async function(Z,de,xe,Me,Se,lt,ut,Je=0){if(!(Z&&Z.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let ht=B.get(Z).__webglFramebuffer;if(Z.isWebGLCubeRenderTarget&&ut!==void 0&&(ht=ht[ut]),ht)if(de>=0&&de<=Z.width-Me&&xe>=0&&xe<=Z.height-Se){He.bindFramebuffer(Q.FRAMEBUFFER,ht);const ft=Z.textures[Je],Nt=ft.format,St=ft.type;if(!Ce.textureFormatReadable(Nt))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Ce.textureTypeReadable(St))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const Xt=Q.createBuffer();Q.bindBuffer(Q.PIXEL_PACK_BUFFER,Xt),Q.bufferData(Q.PIXEL_PACK_BUFFER,lt.byteLength,Q.STREAM_READ),Z.textures.length>1&&Q.readBuffer(Q.COLOR_ATTACHMENT0+Je),Q.readPixels(de,xe,Me,Se,et.convert(Nt),et.convert(St),0);const un=J!==null?B.get(J).__webglFramebuffer:null;He.bindFramebuffer(Q.FRAMEBUFFER,un);const dn=Q.fenceSync(Q.SYNC_GPU_COMMANDS_COMPLETE,0);return Q.flush(),await hA(Q,dn,4),Q.bindBuffer(Q.PIXEL_PACK_BUFFER,Xt),Q.getBufferSubData(Q.PIXEL_PACK_BUFFER,0,lt),Q.deleteBuffer(Xt),Q.deleteSync(dn),lt}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")},this.copyFramebufferToTexture=function(Z,de=null,xe=0){const Me=Math.pow(2,-xe),Se=Math.floor(Z.image.width*Me),lt=Math.floor(Z.image.height*Me),ut=de!==null?de.x:0,Je=de!==null?de.y:0;ue.setTexture2D(Z,0),Q.copyTexSubImage2D(Q.TEXTURE_2D,xe,0,0,ut,Je,Se,lt),He.unbindTexture()};const At=Q.createFramebuffer(),Ie=Q.createFramebuffer();this.copyTextureToTexture=function(Z,de,xe=null,Me=null,Se=0,lt=null){lt===null&&(Se!==0?(Ff("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),lt=Se,Se=0):lt=0);let ut,Je,ht,ft,Nt,St,Xt,un,dn;const fn=Z.isCompressedTexture?Z.mipmaps[lt]:Z.image;if(xe!==null)ut=xe.max.x-xe.min.x,Je=xe.max.y-xe.min.y,ht=xe.isBox3?xe.max.z-xe.min.z:1,ft=xe.min.x,Nt=xe.min.y,St=xe.isBox3?xe.min.z:0;else{const gi=Math.pow(2,-Se);ut=Math.floor(fn.width*gi),Je=Math.floor(fn.height*gi),Z.isDataArrayTexture?ht=fn.depth:Z.isData3DTexture?ht=Math.floor(fn.depth*gi):ht=1,ft=0,Nt=0,St=0}Me!==null?(Xt=Me.x,un=Me.y,dn=Me.z):(Xt=0,un=0,dn=0);const Kt=et.convert(de.format),Ut=et.convert(de.type);let $t;de.isData3DTexture?(ue.setTexture3D(de,0),$t=Q.TEXTURE_3D):de.isDataArrayTexture||de.isCompressedArrayTexture?(ue.setTexture2DArray(de,0),$t=Q.TEXTURE_2D_ARRAY):(ue.setTexture2D(de,0),$t=Q.TEXTURE_2D),Q.pixelStorei(Q.UNPACK_FLIP_Y_WEBGL,de.flipY),Q.pixelStorei(Q.UNPACK_PREMULTIPLY_ALPHA_WEBGL,de.premultiplyAlpha),Q.pixelStorei(Q.UNPACK_ALIGNMENT,de.unpackAlignment);const Dt=Q.getParameter(Q.UNPACK_ROW_LENGTH),bn=Q.getParameter(Q.UNPACK_IMAGE_HEIGHT),mi=Q.getParameter(Q.UNPACK_SKIP_PIXELS),In=Q.getParameter(Q.UNPACK_SKIP_ROWS),Hi=Q.getParameter(Q.UNPACK_SKIP_IMAGES);Q.pixelStorei(Q.UNPACK_ROW_LENGTH,fn.width),Q.pixelStorei(Q.UNPACK_IMAGE_HEIGHT,fn.height),Q.pixelStorei(Q.UNPACK_SKIP_PIXELS,ft),Q.pixelStorei(Q.UNPACK_SKIP_ROWS,Nt),Q.pixelStorei(Q.UNPACK_SKIP_IMAGES,St);const Ln=Z.isDataArrayTexture||Z.isData3DTexture,cn=de.isDataArrayTexture||de.isData3DTexture;if(Z.isDepthTexture){const gi=B.get(Z),ui=B.get(de),Ci=B.get(gi.__renderTarget),ha=B.get(ui.__renderTarget);He.bindFramebuffer(Q.READ_FRAMEBUFFER,Ci.__webglFramebuffer),He.bindFramebuffer(Q.DRAW_FRAMEBUFFER,ha.__webglFramebuffer);for(let $i=0;$i<ht;$i++)Ln&&(Q.framebufferTextureLayer(Q.READ_FRAMEBUFFER,Q.COLOR_ATTACHMENT0,B.get(Z).__webglTexture,Se,St+$i),Q.framebufferTextureLayer(Q.DRAW_FRAMEBUFFER,Q.COLOR_ATTACHMENT0,B.get(de).__webglTexture,lt,dn+$i)),Q.blitFramebuffer(ft,Nt,ut,Je,Xt,un,ut,Je,Q.DEPTH_BUFFER_BIT,Q.NEAREST);He.bindFramebuffer(Q.READ_FRAMEBUFFER,null),He.bindFramebuffer(Q.DRAW_FRAMEBUFFER,null)}else if(Se!==0||Z.isRenderTargetTexture||B.has(Z)){const gi=B.get(Z),ui=B.get(de);He.bindFramebuffer(Q.READ_FRAMEBUFFER,At),He.bindFramebuffer(Q.DRAW_FRAMEBUFFER,Ie);for(let Ci=0;Ci<ht;Ci++)Ln?Q.framebufferTextureLayer(Q.READ_FRAMEBUFFER,Q.COLOR_ATTACHMENT0,gi.__webglTexture,Se,St+Ci):Q.framebufferTexture2D(Q.READ_FRAMEBUFFER,Q.COLOR_ATTACHMENT0,Q.TEXTURE_2D,gi.__webglTexture,Se),cn?Q.framebufferTextureLayer(Q.DRAW_FRAMEBUFFER,Q.COLOR_ATTACHMENT0,ui.__webglTexture,lt,dn+Ci):Q.framebufferTexture2D(Q.DRAW_FRAMEBUFFER,Q.COLOR_ATTACHMENT0,Q.TEXTURE_2D,ui.__webglTexture,lt),Se!==0?Q.blitFramebuffer(ft,Nt,ut,Je,Xt,un,ut,Je,Q.COLOR_BUFFER_BIT,Q.NEAREST):cn?Q.copyTexSubImage3D($t,lt,Xt,un,dn+Ci,ft,Nt,ut,Je):Q.copyTexSubImage2D($t,lt,Xt,un,ft,Nt,ut,Je);He.bindFramebuffer(Q.READ_FRAMEBUFFER,null),He.bindFramebuffer(Q.DRAW_FRAMEBUFFER,null)}else cn?Z.isDataTexture||Z.isData3DTexture?Q.texSubImage3D($t,lt,Xt,un,dn,ut,Je,ht,Kt,Ut,fn.data):de.isCompressedArrayTexture?Q.compressedTexSubImage3D($t,lt,Xt,un,dn,ut,Je,ht,Kt,fn.data):Q.texSubImage3D($t,lt,Xt,un,dn,ut,Je,ht,Kt,Ut,fn):Z.isDataTexture?Q.texSubImage2D(Q.TEXTURE_2D,lt,Xt,un,ut,Je,Kt,Ut,fn.data):Z.isCompressedTexture?Q.compressedTexSubImage2D(Q.TEXTURE_2D,lt,Xt,un,fn.width,fn.height,Kt,fn.data):Q.texSubImage2D(Q.TEXTURE_2D,lt,Xt,un,ut,Je,Kt,Ut,fn);Q.pixelStorei(Q.UNPACK_ROW_LENGTH,Dt),Q.pixelStorei(Q.UNPACK_IMAGE_HEIGHT,bn),Q.pixelStorei(Q.UNPACK_SKIP_PIXELS,mi),Q.pixelStorei(Q.UNPACK_SKIP_ROWS,In),Q.pixelStorei(Q.UNPACK_SKIP_IMAGES,Hi),lt===0&&de.generateMipmaps&&Q.generateMipmap($t),He.unbindTexture()},this.initRenderTarget=function(Z){B.get(Z).__webglFramebuffer===void 0&&ue.setupRenderTarget(Z)},this.initTexture=function(Z){Z.isCubeTexture?ue.setTextureCube(Z,0):Z.isData3DTexture?ue.setTexture3D(Z,0):Z.isDataArrayTexture||Z.isCompressedArrayTexture?ue.setTexture2DArray(Z,0):ue.setTexture2D(Z,0),He.unbindTexture()},this.resetState=function(){V=0,H=0,J=null,He.reset(),Pt.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return oa}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=kn._getDrawingBufferColorSpace(e),t.unpackColorSpace=kn._getUnpackColorSpace()}}const eN=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:Iv,AddEquation:gu,AddOperation:Yw,AdditiveAnimationBlendMode:$_,AdditiveBlending:u_,AgXToneMapping:X_,AlphaFormat:K_,AlwaysCompare:oE,AlwaysDepth:Pg,AlwaysStencilFunc:p_,AmbientLight:e3,AnimationAction:o3,AnimationClip:jp,AnimationLoader:e4,AnimationMixer:b4,AnimationObjectGroup:E4,AnimationUtils:JC,ArcCurve:bE,ArrayCamera:r3,ArrowHelper:Q4,AttachedBindMode:f_,Audio:s3,AudioAnalyser:p4,AudioContext:Tx,AudioListener:h4,AudioLoader:l4,AxesHelper:$4,BackSide:Ms,BasicDepthPacking:$w,BasicShadowMap:Cw,BatchedMesh:xE,Bone:ax,BooleanKeyframeTrack:$c,Box2:F4,Box3:Nr,Box3Helper:J4,BoxGeometry:Qc,BoxHelper:Z4,BufferAttribute:jn,BufferGeometry:Sn,BufferGeometryLoader:i3,ByteType:Lv,Cache:Oo,Camera:r0,CameraHelper:Y4,CanvasTexture:_C,CapsuleGeometry:Jv,CatmullRomCurve3:AE,CineonToneMapping:W_,CircleGeometry:Kv,ClampToEdgeWrapping:Gi,Clock:bx,Color:jt,ColorKeyframeTrack:_x,ColorManagement:kn,CompressedArrayTexture:vC,CompressedCubeTexture:yC,CompressedTexture:Zv,CompressedTextureLoader:t4,ConeGeometry:l0,ConstantAlphaFactor:jw,ConstantColorFactor:Hw,Controls:tP,CubeCamera:pE,CubeDepthTexture:EE,CubeReflectionMapping:ho,CubeRefractionMapping:Eu,CubeTexture:s0,CubeTextureLoader:ZE,CubeUVReflectionMapping:Wf,CubicBezierCurve:cx,CubicBezierCurve3:CE,CubicInterpolant:jE,CullFaceBack:l_,CullFaceFront:Aw,CullFaceFrontBack:wb,CullFaceNone:bw,Curve:fo,CurvePath:RE,CustomBlending:Pw,CustomToneMapping:j_,CylinderGeometry:o0,Cylindrical:U4,Data3DTexture:Vv,DataArrayTexture:Gv,DataTexture:Aa,DataTextureLoader:xx,DataUtils:Fc,DecrementStencilOp:zb,DecrementWrapStencilOp:Gb,DefaultLoadingManager:YE,DepthFormat:ko,DepthStencilFormat:vu,DepthTexture:zf,DetachedBindMode:Zw,DirectionalLight:$E,DirectionalLightHelper:q4,DiscreteInterpolant:XE,DodecahedronGeometry:Qv,DoubleSide:Ea,DstAlphaFactor:kw,DstColorFactor:Bw,DynamicCopyUsage:nA,DynamicDrawUsage:Jb,DynamicReadUsage:$b,EdgesGeometry:TE,EllipseCurve:$v,EqualCompare:rE,EqualDepth:Ig,EqualStencilFunc:jb,EquirectangularReflectionMapping:Lf,EquirectangularRefractionMapping:Ip,Euler:Qi,EventDispatcher:Vo,ExternalTexture:lx,ExtrudeGeometry:e1,FileLoader:ua,Float16BufferAttribute:ZA,Float32BufferAttribute:Jt,FloatType:bi,Fog:jv,FogExp2:Wv,FramebufferTexture:gC,FrontSide:Pl,Frustum:Xf,FrustumArray:Yv,GLBufferAttribute:I4,GLSL1:rA,GLSL3:m_,GreaterCompare:sE,GreaterDepth:Ng,GreaterEqualCompare:Bv,GreaterEqualDepth:Lg,GreaterEqualStencilFunc:Zb,GreaterStencilFunc:qb,GridHelper:j4,Group:Sf,HalfFloatType:Vi,HemisphereLight:JE,HemisphereLightHelper:W4,IcosahedronGeometry:u0,ImageBitmapLoader:o4,ImageLoader:Xp,ImageUtils:hE,IncrementStencilOp:kb,IncrementWrapStencilOp:Bb,InstancedBufferAttribute:qc,InstancedBufferGeometry:Ex,InstancedInterleavedBuffer:R4,InstancedMesh:_E,Int16BufferAttribute:qA,Int32BufferAttribute:YA,Int8BufferAttribute:WA,IntType:t0,InterleavedBuffer:Xv,InterleavedBufferAttribute:Xc,Interpolant:f0,InterpolateDiscrete:Dp,InterpolateLinear:dv,InterpolateSmooth:mg,InterpolationSamplingMode:oA,InterpolationSamplingType:aA,InvertStencilOp:Vb,KeepStencilOp:Rc,KeyframeTrack:Pa,LOD:vE,LatheGeometry:t1,Layers:Gc,LessCompare:iE,LessDepth:Rg,LessEqualCompare:zv,LessEqualDepth:Wc,LessEqualStencilFunc:Xb,LessStencilFunc:Wb,Light:Lu,LightProbe:n3,Line:bu,Line3:z4,LineBasicMaterial:Ts,LineCurve:hx,LineCurve3:PE,LineDashedMaterial:HE,LineLoop:SE,LineSegments:Wo,LinearFilter:Dn,LinearInterpolant:yx,LinearMipMapLinearFilter:d_,LinearMipMapNearestFilter:bb,LinearMipmapLinearFilter:Fo,LinearMipmapNearestFilter:mp,LinearSRGBColorSpace:zo,LinearToneMapping:V_,LinearTransfer:Fp,Loader:bs,LoaderUtils:x_,LoadingManager:c1,LoopOnce:Jw,LoopPingPong:Qw,LoopRepeat:Kw,MOUSE:Sb,Material:ss,MaterialLoader:h1,MathUtils:CA,Matrix2:Ix,Matrix3:Tn,Matrix4:vn,MaxEquation:Nw,Mesh:pi,MeshBasicMaterial:Ho,MeshDepthMaterial:l1,MeshDistanceMaterial:u1,MeshLambertMaterial:GE,MeshMatcapMaterial:VE,MeshNormalMaterial:BE,MeshPhongMaterial:kE,MeshPhysicalMaterial:OE,MeshStandardMaterial:gx,MeshToonMaterial:zE,MinEquation:Lw,MirroredRepeatWrapping:Np,MixOperation:qw,MultiplyBlending:h_,MultiplyOperation:e0,NearestFilter:Ji,NearestMipMapLinearFilter:Tb,NearestMipMapNearestFilter:Eb,NearestMipmapLinearFilter:_f,NearestMipmapNearestFilter:Y_,NeutralToneMapping:q_,NeverCompare:nE,NeverDepth:Cg,NeverStencilFunc:Hb,NoBlending:uo,NoColorSpace:bl,NoNormalPacking:Nb,NoToneMapping:ba,NormalAnimationBlendMode:kv,NormalBlending:zc,NormalGAPacking:Ub,NormalRGPacking:Db,NotEqualCompare:aE,NotEqualDepth:Dg,NotEqualStencilFunc:Yb,NumberKeyframeTrack:Hp,Object3D:Hn,ObjectLoader:s4,ObjectSpaceNormalMap:tE,OctahedronGeometry:c0,OneFactor:Uw,OneMinusConstantAlphaFactor:Xw,OneMinusConstantColorFactor:Ww,OneMinusDstAlphaFactor:zw,OneMinusDstColorFactor:Gw,OneMinusSrcAlphaFactor:Ag,OneMinusSrcColorFactor:Ow,OrthographicCamera:th,PCFShadowMap:Af,PCFSoftShadowMap:pp,PMREMGenerator:w_,Path:vv,PerspectiveCamera:Pr,Plane:pu,PlaneGeometry:po,PlaneHelper:K4,PointLight:QE,PointLightHelper:V4,Points:ME,PointsMaterial:ox,PolarGridHelper:X4,PolyhedronGeometry:Iu,PositionalAudio:d4,PropertyBinding:Vn,PropertyMixer:a3,QuadraticBezierCurve:fx,QuadraticBezierCurve3:dx,Quaternion:xn,QuaternionKeyframeTrack:d0,QuaternionLinearInterpolant:qE,R11_EAC_Format:Vg,RED_GREEN_RGTC2_Format:hv,RED_RGTC1_Format:uv,REVISION:$p,RG11_EAC_Format:Wg,RGBADepthPacking:eE,RGBAFormat:Ki,RGBAIntegerFormat:Ov,RGBA_ASTC_10x10_Format:iv,RGBA_ASTC_10x5_Format:ev,RGBA_ASTC_10x6_Format:tv,RGBA_ASTC_10x8_Format:nv,RGBA_ASTC_12x10_Format:rv,RGBA_ASTC_12x12_Format:sv,RGBA_ASTC_4x4_Format:Xg,RGBA_ASTC_5x4_Format:qg,RGBA_ASTC_5x5_Format:Yg,RGBA_ASTC_6x5_Format:Zg,RGBA_ASTC_6x6_Format:Jg,RGBA_ASTC_8x5_Format:Kg,RGBA_ASTC_8x6_Format:Qg,RGBA_ASTC_8x8_Format:$g,RGBA_BPTC_Format:av,RGBA_ETC2_EAC_Format:Gg,RGBA_PVRTC_2BPPV1_Format:kg,RGBA_PVRTC_4BPPV1_Format:Og,RGBA_S3TC_DXT1_Format:vp,RGBA_S3TC_DXT3_Format:yp,RGBA_S3TC_DXT5_Format:_p,RGBDepthPacking:Ib,RGBFormat:Q_,RGBIntegerFormat:Ab,RGB_BPTC_SIGNED_Format:ov,RGB_BPTC_UNSIGNED_Format:lv,RGB_ETC1_Format:zg,RGB_ETC2_Format:Bg,RGB_PVRTC_2BPPV1_Format:Fg,RGB_PVRTC_4BPPV1_Format:Ug,RGB_S3TC_DXT1_Format:gp,RGDepthPacking:Lb,RGFormat:jc,RGIntegerFormat:Fv,RawShaderMaterial:mx,Ray:jf,Raycaster:Rx,RectAreaLight:t3,RedFormat:n0,RedIntegerFormat:i0,ReinhardToneMapping:H_,RenderTarget:tx,RenderTarget3D:A4,RepeatWrapping:Lp,ReplaceStencilOp:Ob,ReverseSubtractEquation:Iw,RingGeometry:n1,SIGNED_R11_EAC_Format:Hg,SIGNED_RED_GREEN_RGTC2_Format:fv,SIGNED_RED_RGTC1_Format:cv,SIGNED_RG11_EAC_Format:jg,SRGBColorSpace:rs,SRGBTransfer:Yn,Scene:a0,ShaderChunk:Pn,ShaderLib:oo,ShaderMaterial:Es,ShadowMaterial:FE,Shape:Vc,ShapeGeometry:i1,ShapePath:eP,ShapeUtils:lo,ShortType:Nv,Skeleton:qv,SkeletonHelper:G4,SkinnedMesh:yE,Source:yu,Sphere:Dr,SphereGeometry:h0,Spherical:D4,SphericalHarmonics3:wx,SplineCurve:px,SpotLight:KE,SpotLightHelper:B4,Sprite:gE,SpriteMaterial:sx,SrcAlphaFactor:bg,SrcAlphaSaturateFactor:Vw,SrcColorFactor:Fw,StaticCopyUsage:tA,StaticDrawUsage:Op,StaticReadUsage:Qb,StereoCamera:u4,StreamCopyUsage:iA,StreamDrawUsage:Kb,StreamReadUsage:eA,StringKeyframeTrack:eh,SubtractEquation:Rw,SubtractiveBlending:c_,TOUCH:Mb,TangentSpaceNormalMap:Ru,TetrahedronGeometry:r1,Texture:ei,TextureLoader:Sx,TextureUtils:aP,Timer:L4,TimestampQuery:sA,TorusGeometry:s1,TorusKnotGeometry:a1,Triangle:Hs,TriangleFanDrawMode:Rb,TriangleStripDrawMode:Pb,TrianglesDrawMode:Cb,TubeGeometry:o1,UVMapping:wu,Uint16BufferAttribute:nx,Uint32BufferAttribute:ix,Uint8BufferAttribute:jA,Uint8ClampedBufferAttribute:XA,Uniform:Px,UniformsGroup:P4,UniformsLib:Gt,UniformsUtils:rx,UnsignedByteType:Rr,UnsignedInt101111Type:J_,UnsignedInt248Type:Df,UnsignedInt5999Type:Z_,UnsignedIntType:ca,UnsignedShort4444Type:Dv,UnsignedShort5551Type:Uv,UnsignedShortType:Nf,VSMShadowMap:Nc,Vector2:ct,Vector3:X,Vector4:$n,VectorKeyframeTrack:Wp,VideoFrameTexture:mC,VideoTexture:wE,WebGL3DRenderTarget:NA,WebGLArrayRenderTarget:LA,WebGLCoordinateSystem:oa,WebGLCubeRenderTarget:Hv,WebGLRenderTarget:ws,WebGLRenderer:Lx,WebGLUtils:p3,WebGPUCoordinateSystem:Uf,WebXRController:gg,WireframeGeometry:UE,WrapAroundEnding:Up,ZeroCurvatureEnding:Dc,ZeroFactor:Dw,ZeroSlopeEnding:Uc,ZeroStencilOp:Fb,createCanvasElement:cE,error:ln,getConsoleFunction:cA,log:zp,setConsoleFunction:uA,warn:Ft,warnOnce:Ff},Symbol.toStringTag,{value:"Module"}));var zy={exports:{}},fu={};var g2;function tN(){return g2||(g2=1,fu.ConcurrentRoot=1,fu.ContinuousEventPriority=4,fu.DefaultEventPriority=16,fu.DiscreteEventPriority=1,fu.IdleEventPriority=536870912,fu.LegacyRoot=0),fu}var v2;function nN(){return v2||(v2=1,zy.exports=tN()),zy.exports}var Mf=nN();function iN(n){let e;const t=new Set,r=(c,f)=>{const m=typeof c=="function"?c(e):c;if(m!==e){const g=e;e=f?m:Object.assign({},e,m),t.forEach(y=>y(e,g))}},i=()=>e,s=(c,f=i,m=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let g=f(e);function y(){const _=f(e);if(!m(g,_)){const E=g;c(g=_,E)}}return t.add(y),()=>t.delete(y)},u={setState:r,getState:i,subscribe:(c,f,m)=>f||m?s(c,f,m):(t.add(c),()=>t.delete(c)),destroy:()=>t.clear()};return e=n(r,i,u),u}const rN=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),y2=rN?se.useEffect:se.useLayoutEffect;function m3(n){const e=typeof n=="function"?iN(n):n,t=(r=e.getState,i=Object.is)=>{const[,s]=se.useReducer(x=>x+1,0),a=e.getState(),o=se.useRef(a),u=se.useRef(r),c=se.useRef(i),f=se.useRef(!1),m=se.useRef();m.current===void 0&&(m.current=r(a));let g,y=!1;(o.current!==a||u.current!==r||c.current!==i||f.current)&&(g=r(a),y=!i(m.current,g)),y2(()=>{y&&(m.current=g),o.current=a,u.current=r,c.current=i,f.current=!1});const _=se.useRef(a);y2(()=>{const x=()=>{try{const T=e.getState(),A=u.current(T);c.current(m.current,A)||(o.current=T,m.current=A,s())}catch{f.current=!0,s()}},S=e.subscribe(x);return e.getState()!==_.current&&x(),S},[]);const E=y?g:m.current;return se.useDebugValue(E),E};return Object.assign(t,e),t[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const r=[t,e];return{next(){const i=r.length<=0;return{value:r.shift(),done:i}}}},t}const sN=n=>typeof n=="object"&&typeof n.then=="function",kc=[];function g3(n,e,t=(r,i)=>r===i){if(n===e)return!0;if(!n||!e)return!1;const r=n.length;if(e.length!==r)return!1;for(let i=0;i<r;i++)if(!t(n[i],e[i]))return!1;return!0}function v3(n,e=null,t=!1,r={}){e===null&&(e=[n]);for(const s of kc)if(g3(e,s.keys,s.equal)){if(t)return;if(Object.prototype.hasOwnProperty.call(s,"error"))throw s.error;if(Object.prototype.hasOwnProperty.call(s,"response"))return r.lifespan&&r.lifespan>0&&(s.timeout&&clearTimeout(s.timeout),s.timeout=setTimeout(s.remove,r.lifespan)),s.response;if(!t)throw s.promise}const i={keys:e,equal:r.equal,remove:()=>{const s=kc.indexOf(i);s!==-1&&kc.splice(s,1)},promise:(sN(n)?n:n(...e)).then(s=>{i.response=s,r.lifespan&&r.lifespan>0&&(i.timeout=setTimeout(i.remove,r.lifespan))}).catch(s=>i.error=s)};if(kc.push(i),!t)throw i.promise}const y3=(n,e,t)=>v3(n,e,!1,t),aN=(n,e,t)=>void v3(n,e,!0,t),oN=n=>{if(n===void 0||n.length===0)kc.splice(0,kc.length);else{const e=kc.find(t=>g3(n,t.keys,t.equal));e&&e.remove()}};var By={exports:{}},Gy={exports:{}},Vy={};var _2;function lN(){return _2||(_2=1,(function(n){function e(te,ie){var Y=te.length;te.push(ie);e:for(;0<Y;){var z=Y-1>>>1,K=te[z];if(0<i(K,ie))te[z]=ie,te[Y]=K,Y=z;else break e}}function t(te){return te.length===0?null:te[0]}function r(te){if(te.length===0)return null;var ie=te[0],Y=te.pop();if(Y!==ie){te[0]=Y;e:for(var z=0,K=te.length,le=K>>>1;z<le;){var me=2*(z+1)-1,ve=te[me],re=me+1,he=te[re];if(0>i(ve,Y))re<K&&0>i(he,ve)?(te[z]=he,te[re]=Y,z=re):(te[z]=ve,te[me]=Y,z=me);else if(re<K&&0>i(he,Y))te[z]=he,te[re]=Y,z=re;else break e}}return ie}function i(te,ie){var Y=te.sortIndex-ie.sortIndex;return Y!==0?Y:te.id-ie.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();n.unstable_now=function(){return a.now()-o}}var u=[],c=[],f=1,m=null,g=3,y=!1,_=!1,E=!1,x=typeof setTimeout=="function"?setTimeout:null,S=typeof clearTimeout=="function"?clearTimeout:null,T=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function A(te){for(var ie=t(c);ie!==null;){if(ie.callback===null)r(c);else if(ie.startTime<=te)r(c),ie.sortIndex=ie.expirationTime,e(u,ie);else break;ie=t(c)}}function P(te){if(E=!1,A(te),!_)if(t(u)!==null)_=!0,ne(L);else{var ie=t(c);ie!==null&&oe(P,ie.startTime-te)}}function L(te,ie){_=!1,E&&(E=!1,S(k),k=-1),y=!0;var Y=g;try{for(A(ie),m=t(u);m!==null&&(!(m.expirationTime>ie)||te&&!V());){var z=m.callback;if(typeof z=="function"){m.callback=null,g=m.priorityLevel;var K=z(m.expirationTime<=ie);ie=n.unstable_now(),typeof K=="function"?m.callback=K:m===t(u)&&r(u),A(ie)}else r(u);m=t(u)}if(m!==null)var le=!0;else{var me=t(c);me!==null&&oe(P,me.startTime-ie),le=!1}return le}finally{m=null,g=Y,y=!1}}var D=!1,F=null,k=-1,R=5,U=-1;function V(){return!(n.unstable_now()-U<R)}function H(){if(F!==null){var te=n.unstable_now();U=te;var ie=!0;try{ie=F(!0,te)}finally{ie?J():(D=!1,F=null)}}else D=!1}var J;if(typeof T=="function")J=function(){T(H)};else if(typeof MessageChannel<"u"){var $=new MessageChannel,ae=$.port2;$.port1.onmessage=H,J=function(){ae.postMessage(null)}}else J=function(){x(H,0)};function ne(te){F=te,D||(D=!0,J())}function oe(te,ie){k=x(function(){te(n.unstable_now())},ie)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(te){te.callback=null},n.unstable_continueExecution=function(){_||y||(_=!0,ne(L))},n.unstable_forceFrameRate=function(te){0>te||125<te?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<te?Math.floor(1e3/te):5},n.unstable_getCurrentPriorityLevel=function(){return g},n.unstable_getFirstCallbackNode=function(){return t(u)},n.unstable_next=function(te){switch(g){case 1:case 2:case 3:var ie=3;break;default:ie=g}var Y=g;g=ie;try{return te()}finally{g=Y}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(te,ie){switch(te){case 1:case 2:case 3:case 4:case 5:break;default:te=3}var Y=g;g=te;try{return ie()}finally{g=Y}},n.unstable_scheduleCallback=function(te,ie,Y){var z=n.unstable_now();switch(typeof Y=="object"&&Y!==null?(Y=Y.delay,Y=typeof Y=="number"&&0<Y?z+Y:z):Y=z,te){case 1:var K=-1;break;case 2:K=250;break;case 5:K=1073741823;break;case 4:K=1e4;break;default:K=5e3}return K=Y+K,te={id:f++,callback:ie,priorityLevel:te,startTime:Y,expirationTime:K,sortIndex:-1},Y>z?(te.sortIndex=Y,e(c,te),t(u)===null&&te===t(c)&&(E?(S(k),k=-1):E=!0,oe(P,Y-z))):(te.sortIndex=K,e(u,te),_||y||(_=!0,ne(L))),te},n.unstable_shouldYield=V,n.unstable_wrapCallback=function(te){var ie=g;return function(){var Y=g;g=ie;try{return te.apply(this,arguments)}finally{g=Y}}}})(Vy)),Vy}var x2;function _3(){return x2||(x2=1,Gy.exports=lN()),Gy.exports}var Hy,S2;function uN(){return S2||(S2=1,Hy=function(e){var t={},r=Rv(),i=_3(),s=Object.assign;function a(d){for(var p="https://reactjs.org/docs/error-decoder.html?invariant="+d,M=1;M<arguments.length;M++)p+="&args[]="+encodeURIComponent(arguments[M]);return"Minified React error #"+d+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,u=Symbol.for("react.element"),c=Symbol.for("react.portal"),f=Symbol.for("react.fragment"),m=Symbol.for("react.strict_mode"),g=Symbol.for("react.profiler"),y=Symbol.for("react.provider"),_=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),x=Symbol.for("react.suspense"),S=Symbol.for("react.suspense_list"),T=Symbol.for("react.memo"),A=Symbol.for("react.lazy"),P=Symbol.for("react.offscreen"),L=Symbol.iterator;function D(d){return d===null||typeof d!="object"?null:(d=L&&d[L]||d["@@iterator"],typeof d=="function"?d:null)}function F(d){if(d==null)return null;if(typeof d=="function")return d.displayName||d.name||null;if(typeof d=="string")return d;switch(d){case f:return"Fragment";case c:return"Portal";case g:return"Profiler";case m:return"StrictMode";case x:return"Suspense";case S:return"SuspenseList"}if(typeof d=="object")switch(d.$$typeof){case _:return(d.displayName||"Context")+".Consumer";case y:return(d._context.displayName||"Context")+".Provider";case E:var p=d.render;return d=d.displayName,d||(d=p.displayName||p.name||"",d=d!==""?"ForwardRef("+d+")":"ForwardRef"),d;case T:return p=d.displayName||null,p!==null?p:F(d.type)||"Memo";case A:p=d._payload,d=d._init;try{return F(d(p))}catch{}}return null}function k(d){var p=d.type;switch(d.tag){case 24:return"Cache";case 9:return(p.displayName||"Context")+".Consumer";case 10:return(p._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return d=p.render,d=d.displayName||d.name||"",p.displayName||(d!==""?"ForwardRef("+d+")":"ForwardRef");case 7:return"Fragment";case 5:return p;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return F(p);case 8:return p===m?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof p=="function")return p.displayName||p.name||null;if(typeof p=="string")return p}return null}function R(d){var p=d,M=d;if(d.alternate)for(;p.return;)p=p.return;else{d=p;do p=d,(p.flags&4098)!==0&&(M=p.return),d=p.return;while(d)}return p.tag===3?M:null}function U(d){if(R(d)!==d)throw Error(a(188))}function V(d){var p=d.alternate;if(!p){if(p=R(d),p===null)throw Error(a(188));return p!==d?null:d}for(var M=d,b=p;;){var I=M.return;if(I===null)break;var G=I.alternate;if(G===null){if(b=I.return,b!==null){M=b;continue}break}if(I.child===G.child){for(G=I.child;G;){if(G===M)return U(I),d;if(G===b)return U(I),p;G=G.sibling}throw Error(a(188))}if(M.return!==b.return)M=I,b=G;else{for(var ce=!1,be=I.child;be;){if(be===M){ce=!0,M=I,b=G;break}if(be===b){ce=!0,b=I,M=G;break}be=be.sibling}if(!ce){for(be=G.child;be;){if(be===M){ce=!0,M=G,b=I;break}if(be===b){ce=!0,b=G,M=I;break}be=be.sibling}if(!ce)throw Error(a(189))}}if(M.alternate!==b)throw Error(a(190))}if(M.tag!==3)throw Error(a(188));return M.stateNode.current===M?d:p}function H(d){return d=V(d),d!==null?J(d):null}function J(d){if(d.tag===5||d.tag===6)return d;for(d=d.child;d!==null;){var p=J(d);if(p!==null)return p;d=d.sibling}return null}function $(d){if(d.tag===5||d.tag===6)return d;for(d=d.child;d!==null;){if(d.tag!==4){var p=$(d);if(p!==null)return p}d=d.sibling}return null}var ae=Array.isArray,ne=e.getPublicInstance,oe=e.getRootHostContext,te=e.getChildHostContext,ie=e.prepareForCommit,Y=e.resetAfterCommit,z=e.createInstance,K=e.appendInitialChild,le=e.finalizeInitialChildren,me=e.prepareUpdate,ve=e.shouldSetTextContent,re=e.createTextInstance,he=e.scheduleTimeout,ye=e.cancelTimeout,ze=e.noTimeout,Ve=e.isPrimaryRenderer,Ke=e.supportsMutation,Qe=e.supportsPersistence,pt=e.supportsHydration,Ne=e.getInstanceFromNode,Be=e.preparePortalMount,De=e.getCurrentEventPriority,it=e.detachDeletedInstance,Q=e.supportsMicrotasks,at=e.scheduleMicrotask,je=e.supportsTestSelectors,Ce=e.findFiberRoot,He=e.getBoundingRect,q=e.getTextContent,B=e.isHiddenSubtree,ue=e.matchAccessibilityRole,Re=e.setFocusIfFocusable,Pe=e.setupIntersectionObserver,Te=e.appendChild,ot=e.appendChildToContainer,rt=e.commitTextUpdate,mt=e.commitMount,Rt=e.commitUpdate,Ge=e.insertBefore,Xe=e.insertInContainerBefore,nt=e.removeChild,gt=e.removeChildFromContainer,st=e.resetTextContent,Ot=e.hideInstance,pe=e.hideTextInstance,Ee=e.unhideInstance,et=e.unhideTextInstance,Pt=e.clearContainer,tt=e.cloneInstance,ke=e.createContainerChildSet,dt=e.appendChildToContainerChildSet,kt=e.finalizeContainerChildren,zt=e.replaceContainerChildren,nn=e.cloneHiddenInstance,zn=e.cloneHiddenTextInstance,Un=e.canHydrateInstance,Kn=e.canHydrateTextInstance,Si=e.canHydrateSuspenseInstance,Di=e.isSuspenseInstancePending,Ai=e.isSuspenseInstanceFallback,Mi=e.registerSuspenseInstanceRetry,ri=e.getNextHydratableSibling,on=e.getFirstHydratableChild,li=e.getFirstHydratableChildWithinContainer,Xr=e.getFirstHydratableChildWithinSuspenseInstance,W=e.hydrateInstance,ee=e.hydrateTextInstance,ge=e.hydrateSuspenseInstance,Ue=e.getNextHydratableInstanceAfterSuspenseInstance,qe=e.commitHydratedContainer,Ye=e.commitHydratedSuspenseInstance,Mt=e.clearSuspenseBoundary,vt=e.clearSuspenseBoundaryFromContainer,Et=e.shouldDeleteUnhydratedTailInstances,Tt=e.didNotMatchHydratedContainerTextInstance,At=e.didNotMatchHydratedTextInstance,Ie;function Z(d){if(Ie===void 0)try{throw Error()}catch(M){var p=M.stack.trim().match(/\n( *(at )?)/);Ie=p&&p[1]||""}return`
`+Ie+d}var de=!1;function xe(d,p){if(!d||de)return"";de=!0;var M=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(p)if(p=function(){throw Error()},Object.defineProperty(p.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(p,[])}catch(bt){var b=bt}Reflect.construct(d,[],p)}else{try{p.call()}catch(bt){b=bt}d.call(p.prototype)}else{try{throw Error()}catch(bt){b=bt}d()}}catch(bt){if(bt&&b&&typeof bt.stack=="string"){for(var I=bt.stack.split(`
`),G=b.stack.split(`
`),ce=I.length-1,be=G.length-1;1<=ce&&0<=be&&I[ce]!==G[be];)be--;for(;1<=ce&&0<=be;ce--,be--)if(I[ce]!==G[be]){if(ce!==1||be!==1)do if(ce--,be--,0>be||I[ce]!==G[be]){var $e=`
`+I[ce].replace(" at new "," at ");return d.displayName&&$e.includes("<anonymous>")&&($e=$e.replace("<anonymous>",d.displayName)),$e}while(1<=ce&&0<=be);break}}}finally{de=!1,Error.prepareStackTrace=M}return(d=d?d.displayName||d.name:"")?Z(d):""}var Me=Object.prototype.hasOwnProperty,Se=[],lt=-1;function ut(d){return{current:d}}function Je(d){0>lt||(d.current=Se[lt],Se[lt]=null,lt--)}function ht(d,p){lt++,Se[lt]=d.current,d.current=p}var ft={},Nt=ut(ft),St=ut(!1),Xt=ft;function un(d,p){var M=d.type.contextTypes;if(!M)return ft;var b=d.stateNode;if(b&&b.__reactInternalMemoizedUnmaskedChildContext===p)return b.__reactInternalMemoizedMaskedChildContext;var I={},G;for(G in M)I[G]=p[G];return b&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=p,d.__reactInternalMemoizedMaskedChildContext=I),I}function dn(d){return d=d.childContextTypes,d!=null}function fn(){Je(St),Je(Nt)}function Kt(d,p,M){if(Nt.current!==ft)throw Error(a(168));ht(Nt,p),ht(St,M)}function Ut(d,p,M){var b=d.stateNode;if(p=p.childContextTypes,typeof b.getChildContext!="function")return M;b=b.getChildContext();for(var I in b)if(!(I in p))throw Error(a(108,k(d)||"Unknown",I));return s({},M,b)}function $t(d){return d=(d=d.stateNode)&&d.__reactInternalMemoizedMergedChildContext||ft,Xt=Nt.current,ht(Nt,d),ht(St,St.current),!0}function Dt(d,p,M){var b=d.stateNode;if(!b)throw Error(a(169));M?(d=Ut(d,p,Xt),b.__reactInternalMemoizedMergedChildContext=d,Je(St),Je(Nt),ht(Nt,d)):Je(St),ht(St,M)}var bn=Math.clz32?Math.clz32:Hi,mi=Math.log,In=Math.LN2;function Hi(d){return d>>>=0,d===0?32:31-(mi(d)/In|0)|0}var Ln=64,cn=4194304;function gi(d){switch(d&-d){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return d&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return d}}function ui(d,p){var M=d.pendingLanes;if(M===0)return 0;var b=0,I=d.suspendedLanes,G=d.pingedLanes,ce=M&268435455;if(ce!==0){var be=ce&~I;be!==0?b=gi(be):(G&=ce,G!==0&&(b=gi(G)))}else ce=M&~I,ce!==0?b=gi(ce):G!==0&&(b=gi(G));if(b===0)return 0;if(p!==0&&p!==b&&(p&I)===0&&(I=b&-b,G=p&-p,I>=G||I===16&&(G&4194240)!==0))return p;if((b&4)!==0&&(b|=M&16),p=d.entangledLanes,p!==0)for(d=d.entanglements,p&=b;0<p;)M=31-bn(p),I=1<<M,b|=d[M],p&=~I;return b}function Ci(d,p){switch(d){case 1:case 2:case 4:return p+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ha(d,p){for(var M=d.suspendedLanes,b=d.pingedLanes,I=d.expirationTimes,G=d.pendingLanes;0<G;){var ce=31-bn(G),be=1<<ce,$e=I[ce];$e===-1?((be&M)===0||(be&b)!==0)&&(I[ce]=Ci(be,p)):$e<=p&&(d.expiredLanes|=be),G&=~be}}function $i(d){return d=d.pendingLanes&-1073741825,d!==0?d:d&1073741824?1073741824:0}function jo(d){for(var p=[],M=0;31>M;M++)p.push(d);return p}function As(d,p,M){d.pendingLanes|=p,p!==536870912&&(d.suspendedLanes=0,d.pingedLanes=0),d=d.eventTimes,p=31-bn(p),d[p]=M}function Ys(d,p){var M=d.pendingLanes&~p;d.pendingLanes=p,d.suspendedLanes=0,d.pingedLanes=0,d.expiredLanes&=p,d.mutableReadLanes&=p,d.entangledLanes&=p,p=d.entanglements;var b=d.eventTimes;for(d=d.expirationTimes;0<M;){var I=31-bn(M),G=1<<I;p[I]=0,b[I]=-1,d[I]=-1,M&=~G}}function hr(d,p){var M=d.entangledLanes|=p;for(d=d.entanglements;M;){var b=31-bn(M),I=1<<b;I&p|d[b]&p&&(d[b]|=p),M&=~I}}var yn=0;function Cs(d){return d&=-d,1<d?4<d?(d&268435455)!==0?16:536870912:4:1}var as=i.unstable_scheduleCallback,fa=i.unstable_cancelCallback,Ps=i.unstable_shouldYield,nh=i.unstable_requestPaint,ci=i.unstable_now,Zs=i.unstable_ImmediatePriority,ih=i.unstable_UserBlockingPriority,Sr=i.unstable_NormalPriority,mo=i.unstable_IdlePriority,go=null,os=null;function Ra(d){if(os&&typeof os.onCommitFiberRoot=="function")try{os.onCommitFiberRoot(go,d,void 0,(d.current.flags&128)===128)}catch{}}function vo(d,p){return d===p&&(d!==0||1/d===1/p)||d!==d&&p!==p}var er=typeof Object.is=="function"?Object.is:vo,tr=null,da=!1,Rs=!1;function Xo(d){tr===null?tr=[d]:tr.push(d)}function yo(d){da=!0,Xo(d)}function Mr(){if(!Rs&&tr!==null){Rs=!0;var d=0,p=yn;try{var M=tr;for(yn=1;d<M.length;d++){var b=M[d];do b=b(!0);while(b!==null)}tr=null,da=!1}catch(I){throw tr!==null&&(tr=tr.slice(d+1)),as(Zs,Mr),I}finally{yn=p,Rs=!1}}return null}var _o=o.ReactCurrentBatchConfig;function qr(d,p){if(er(d,p))return!0;if(typeof d!="object"||d===null||typeof p!="object"||p===null)return!1;var M=Object.keys(d),b=Object.keys(p);if(M.length!==b.length)return!1;for(b=0;b<M.length;b++){var I=M[b];if(!Me.call(p,I)||!er(d[I],p[I]))return!1}return!0}function Ia(d){switch(d.tag){case 5:return Z(d.type);case 16:return Z("Lazy");case 13:return Z("Suspense");case 19:return Z("SuspenseList");case 0:case 2:case 15:return d=xe(d.type,!1),d;case 11:return d=xe(d.type.render,!1),d;case 1:return d=xe(d.type,!0),d;default:return""}}function nr(d,p){if(d&&d.defaultProps){p=s({},p),d=d.defaultProps;for(var M in d)p[M]===void 0&&(p[M]=d[M]);return p}return p}var Wi=ut(null),La=null,Yr=null,Na=null;function ir(){Na=Yr=La=null}function Da(d,p,M){Ve?(ht(Wi,p._currentValue),p._currentValue=M):(ht(Wi,p._currentValue2),p._currentValue2=M)}function Ui(d){var p=Wi.current;Je(Wi),Ve?d._currentValue=p:d._currentValue2=p}function ji(d,p,M){for(;d!==null;){var b=d.alternate;if((d.childLanes&p)!==p?(d.childLanes|=p,b!==null&&(b.childLanes|=p)):b!==null&&(b.childLanes&p)!==p&&(b.childLanes|=p),d===M)break;d=d.return}}function Pi(d,p){La=d,Na=Yr=null,d=d.dependencies,d!==null&&d.firstContext!==null&&((d.lanes&p)!==0&&(or=!0),d.firstContext=null)}function vi(d){var p=Ve?d._currentValue:d._currentValue2;if(Na!==d)if(d={context:d,memoizedValue:p,next:null},Yr===null){if(La===null)throw Error(a(308));Yr=d,La.dependencies={lanes:0,firstContext:d}}else Yr=Yr.next=d;return p}var Ur=null,Is=!1;function Il(d){d.updateQueue={baseState:d.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Jf(d,p){d=d.updateQueue,p.updateQueue===d&&(p.updateQueue={baseState:d.baseState,firstBaseUpdate:d.firstBaseUpdate,lastBaseUpdate:d.lastBaseUpdate,shared:d.shared,effects:d.effects})}function Ua(d,p){return{eventTime:d,lane:p,tag:0,payload:null,callback:null,next:null}}function xo(d,p){var M=d.updateQueue;M!==null&&(M=M.shared,Ii!==null&&(d.mode&1)!==0&&(An&2)===0?(d=M.interleaved,d===null?(p.next=p,Ur===null?Ur=[M]:Ur.push(M)):(p.next=d.next,d.next=p),M.interleaved=p):(d=M.pending,d===null?p.next=p:(p.next=d.next,d.next=p),M.pending=p))}function rh(d,p,M){if(p=p.updateQueue,p!==null&&(p=p.shared,(M&4194240)!==0)){var b=p.lanes;b&=d.pendingLanes,M|=b,p.lanes=M,hr(d,M)}}function sh(d,p){var M=d.updateQueue,b=d.alternate;if(b!==null&&(b=b.updateQueue,M===b)){var I=null,G=null;if(M=M.firstBaseUpdate,M!==null){do{var ce={eventTime:M.eventTime,lane:M.lane,tag:M.tag,payload:M.payload,callback:M.callback,next:null};G===null?I=G=ce:G=G.next=ce,M=M.next}while(M!==null);G===null?I=G=p:G=G.next=p}else I=G=p;M={baseState:b.baseState,firstBaseUpdate:I,lastBaseUpdate:G,shared:b.shared,effects:b.effects},d.updateQueue=M;return}d=M.lastBaseUpdate,d===null?M.firstBaseUpdate=p:d.next=p,M.lastBaseUpdate=p}function ah(d,p,M,b){var I=d.updateQueue;Is=!1;var G=I.firstBaseUpdate,ce=I.lastBaseUpdate,be=I.shared.pending;if(be!==null){I.shared.pending=null;var $e=be,bt=$e.next;$e.next=null,ce===null?G=bt:ce.next=bt,ce=$e;var Zt=d.alternate;Zt!==null&&(Zt=Zt.updateQueue,be=Zt.lastBaseUpdate,be!==ce&&(be===null?Zt.firstBaseUpdate=bt:be.next=bt,Zt.lastBaseUpdate=$e))}if(G!==null){var Mn=I.baseState;ce=0,Zt=bt=$e=null,be=G;do{var hn=be.lane,Cn=be.eventTime;if((b&hn)===hn){Zt!==null&&(Zt=Zt.next={eventTime:Cn,lane:0,tag:be.tag,payload:be.payload,callback:be.callback,next:null});e:{var Wt=d,vr=be;switch(hn=p,Cn=M,vr.tag){case 1:if(Wt=vr.payload,typeof Wt=="function"){Mn=Wt.call(Cn,Mn,hn);break e}Mn=Wt;break e;case 3:Wt.flags=Wt.flags&-65537|128;case 0:if(Wt=vr.payload,hn=typeof Wt=="function"?Wt.call(Cn,Mn,hn):Wt,hn==null)break e;Mn=s({},Mn,hn);break e;case 2:Is=!0}}be.callback!==null&&be.lane!==0&&(d.flags|=64,hn=I.effects,hn===null?I.effects=[be]:hn.push(be))}else Cn={eventTime:Cn,lane:hn,tag:be.tag,payload:be.payload,callback:be.callback,next:null},Zt===null?(bt=Zt=Cn,$e=Mn):Zt=Zt.next=Cn,ce|=hn;if(be=be.next,be===null){if(be=I.shared.pending,be===null)break;hn=be,be=hn.next,hn.next=null,I.lastBaseUpdate=hn,I.shared.pending=null}}while(!0);if(Zt===null&&($e=Mn),I.baseState=$e,I.firstBaseUpdate=bt,I.lastBaseUpdate=Zt,p=I.shared.interleaved,p!==null){I=p;do ce|=I.lane,I=I.next;while(I!==p)}else G===null&&(I.shared.lanes=0);va|=ce,d.lanes=ce,d.memoizedState=Mn}}function S0(d,p,M){if(d=p.effects,p.effects=null,d!==null)for(p=0;p<d.length;p++){var b=d[p],I=b.callback;if(I!==null){if(b.callback=null,b=M,typeof I!="function")throw Error(a(191,I));I.call(b)}}}var M0=new r.Component().refs;function Kf(d,p,M,b){p=d.memoizedState,M=M(b,p),M=M==null?p:s({},p,M),d.memoizedState=M,d.lanes===0&&(d.updateQueue.baseState=M)}var oh={isMounted:function(d){return(d=d._reactInternals)?R(d)===d:!1},enqueueSetState:function(d,p,M){d=d._reactInternals;var b=Bn(),I=na(d),G=Ua(b,I);G.payload=p,M!=null&&(G.callback=M),xo(d,G),p=Tr(d,I,b),p!==null&&rh(p,d,I)},enqueueReplaceState:function(d,p,M){d=d._reactInternals;var b=Bn(),I=na(d),G=Ua(b,I);G.tag=1,G.payload=p,M!=null&&(G.callback=M),xo(d,G),p=Tr(d,I,b),p!==null&&rh(p,d,I)},enqueueForceUpdate:function(d,p){d=d._reactInternals;var M=Bn(),b=na(d),I=Ua(M,b);I.tag=2,p!=null&&(I.callback=p),xo(d,I),p=Tr(d,b,M),p!==null&&rh(p,d,b)}};function Qf(d,p,M,b,I,G,ce){return d=d.stateNode,typeof d.shouldComponentUpdate=="function"?d.shouldComponentUpdate(b,G,ce):p.prototype&&p.prototype.isPureReactComponent?!qr(M,b)||!qr(I,G):!0}function w0(d,p,M){var b=!1,I=ft,G=p.contextType;return typeof G=="object"&&G!==null?G=vi(G):(I=dn(p)?Xt:Nt.current,b=p.contextTypes,G=(b=b!=null)?un(d,I):ft),p=new p(M,G),d.memoizedState=p.state!==null&&p.state!==void 0?p.state:null,p.updater=oh,d.stateNode=p,p._reactInternals=d,b&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=I,d.__reactInternalMemoizedMaskedChildContext=G),p}function E0(d,p,M,b){d=p.state,typeof p.componentWillReceiveProps=="function"&&p.componentWillReceiveProps(M,b),typeof p.UNSAFE_componentWillReceiveProps=="function"&&p.UNSAFE_componentWillReceiveProps(M,b),p.state!==d&&oh.enqueueReplaceState(p,p.state,null)}function $f(d,p,M,b){var I=d.stateNode;I.props=M,I.state=d.memoizedState,I.refs=M0,Il(d);var G=p.contextType;typeof G=="object"&&G!==null?I.context=vi(G):(G=dn(p)?Xt:Nt.current,I.context=un(d,G)),I.state=d.memoizedState,G=p.getDerivedStateFromProps,typeof G=="function"&&(Kf(d,p,G,M),I.state=d.memoizedState),typeof p.getDerivedStateFromProps=="function"||typeof I.getSnapshotBeforeUpdate=="function"||typeof I.UNSAFE_componentWillMount!="function"&&typeof I.componentWillMount!="function"||(p=I.state,typeof I.componentWillMount=="function"&&I.componentWillMount(),typeof I.UNSAFE_componentWillMount=="function"&&I.UNSAFE_componentWillMount(),p!==I.state&&oh.enqueueReplaceState(I,I.state,null),ah(d,M,I,b),I.state=d.memoizedState),typeof I.componentDidMount=="function"&&(d.flags|=4194308)}var Ll=[],So=0,lh=null,uh=0,Ls=[],ls=0,qo=null,Fa=1,Oa="";function Yo(d,p){Ll[So++]=uh,Ll[So++]=lh,lh=d,uh=p}function T0(d,p,M){Ls[ls++]=Fa,Ls[ls++]=Oa,Ls[ls++]=qo,qo=d;var b=Fa;d=Oa;var I=32-bn(b)-1;b&=~(1<<I),M+=1;var G=32-bn(p)+I;if(30<G){var ce=I-I%5;G=(b&(1<<ce)-1).toString(32),b>>=ce,I-=ce,Fa=1<<32-bn(p)+I|M<<I|b,Oa=G+d}else Fa=1<<G|M<<I|b,Oa=d}function ed(d){d.return!==null&&(Yo(d,1),T0(d,1,0))}function td(d){for(;d===lh;)lh=Ll[--So],Ll[So]=null,uh=Ll[--So],Ll[So]=null;for(;d===qo;)qo=Ls[--ls],Ls[ls]=null,Oa=Ls[--ls],Ls[ls]=null,Fa=Ls[--ls],Ls[ls]=null}var Fr=null,fr=null,hi=!1,Nl=!1,Ns=null;function nd(d,p){var M=ms(5,null,null,0);M.elementType="DELETED",M.stateNode=p,M.return=d,p=d.deletions,p===null?(d.deletions=[M],d.flags|=16):p.push(M)}function id(d,p){switch(d.tag){case 5:return p=Un(p,d.type,d.pendingProps),p!==null?(d.stateNode=p,Fr=d,fr=on(p),!0):!1;case 6:return p=Kn(p,d.pendingProps),p!==null?(d.stateNode=p,Fr=d,fr=null,!0):!1;case 13:if(p=Si(p),p!==null){var M=qo!==null?{id:Fa,overflow:Oa}:null;return d.memoizedState={dehydrated:p,treeContext:M,retryLane:1073741824},M=ms(18,null,null,0),M.stateNode=p,M.return=d,d.child=M,Fr=d,fr=null,!0}return!1;default:return!1}}function ch(d){return(d.mode&1)!==0&&(d.flags&128)===0}function Mo(d){if(hi){var p=fr;if(p){var M=p;if(!id(d,p)){if(ch(d))throw Error(a(418));p=ri(M);var b=Fr;p&&id(d,p)?nd(b,M):(d.flags=d.flags&-4097|2,hi=!1,Fr=d)}}else{if(ch(d))throw Error(a(418));d.flags=d.flags&-4097|2,hi=!1,Fr=d}}}function b0(d){for(d=d.return;d!==null&&d.tag!==5&&d.tag!==3&&d.tag!==13;)d=d.return;Fr=d}function Fu(d){if(!pt||d!==Fr)return!1;if(!hi)return b0(d),hi=!0,!1;if(d.tag!==3&&(d.tag!==5||Et(d.type)&&!ve(d.type,d.memoizedProps))){var p=fr;if(p){if(ch(d)){for(d=fr;d;)d=ri(d);throw Error(a(418))}for(;p;)nd(d,p),p=ri(p)}}if(b0(d),d.tag===13){if(!pt)throw Error(a(316));if(d=d.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(a(317));fr=Ue(d)}else fr=Fr?ri(d.stateNode):null;return!0}function Dl(){pt&&(fr=Fr=null,Nl=hi=!1)}function hh(d){Ns===null?Ns=[d]:Ns.push(d)}function Ul(d,p,M){if(d=M.ref,d!==null&&typeof d!="function"&&typeof d!="object"){if(M._owner){if(M=M._owner,M){if(M.tag!==1)throw Error(a(309));var b=M.stateNode}if(!b)throw Error(a(147,d));var I=b,G=""+d;return p!==null&&p.ref!==null&&typeof p.ref=="function"&&p.ref._stringRef===G?p.ref:(p=function(ce){var be=I.refs;be===M0&&(be=I.refs={}),ce===null?delete be[G]:be[G]=ce},p._stringRef=G,p)}if(typeof d!="string")throw Error(a(284));if(!M._owner)throw Error(a(290,d))}return d}function wo(d,p){throw d=Object.prototype.toString.call(p),Error(a(31,d==="[object Object]"?"object with keys {"+Object.keys(p).join(", ")+"}":d))}function Fl(d){var p=d._init;return p(d._payload)}function A0(d){function p(Oe,Ae){if(d){var Ze=Oe.deletions;Ze===null?(Oe.deletions=[Ae],Oe.flags|=16):Ze.push(Ae)}}function M(Oe,Ae){if(!d)return null;for(;Ae!==null;)p(Oe,Ae),Ae=Ae.sibling;return null}function b(Oe,Ae){for(Oe=new Map;Ae!==null;)Ae.key!==null?Oe.set(Ae.key,Ae):Oe.set(Ae.index,Ae),Ae=Ae.sibling;return Oe}function I(Oe,Ae){return Oe=Ka(Oe,Ae),Oe.index=0,Oe.sibling=null,Oe}function G(Oe,Ae,Ze){return Oe.index=Ze,d?(Ze=Oe.alternate,Ze!==null?(Ze=Ze.index,Ze<Ae?(Oe.flags|=2,Ae):Ze):(Oe.flags|=2,Ae)):(Oe.flags|=1048576,Ae)}function ce(Oe){return d&&Oe.alternate===null&&(Oe.flags|=2),Oe}function be(Oe,Ae,Ze,Bt){return Ae===null||Ae.tag!==6?(Ae=kh(Ze,Oe.mode,Bt),Ae.return=Oe,Ae):(Ae=I(Ae,Ze),Ae.return=Oe,Ae)}function $e(Oe,Ae,Ze,Bt){var sn=Ze.type;return sn===f?Zt(Oe,Ae,Ze.props.children,Bt,Ze.key):Ae!==null&&(Ae.elementType===sn||typeof sn=="object"&&sn!==null&&sn.$$typeof===A&&Fl(sn)===Ae.type)?(Bt=I(Ae,Ze.props),Bt.ref=Ul(Oe,Ae,Ze),Bt.return=Oe,Bt):(Bt=Oh(Ze.type,Ze.key,Ze.props,null,Oe.mode,Bt),Bt.ref=Ul(Oe,Ae,Ze),Bt.return=Oe,Bt)}function bt(Oe,Ae,Ze,Bt){return Ae===null||Ae.tag!==4||Ae.stateNode.containerInfo!==Ze.containerInfo||Ae.stateNode.implementation!==Ze.implementation?(Ae=zh(Ze,Oe.mode,Bt),Ae.return=Oe,Ae):(Ae=I(Ae,Ze.children||[]),Ae.return=Oe,Ae)}function Zt(Oe,Ae,Ze,Bt,sn){return Ae===null||Ae.tag!==7?(Ae=gl(Ze,Oe.mode,Bt,sn),Ae.return=Oe,Ae):(Ae=I(Ae,Ze),Ae.return=Oe,Ae)}function Mn(Oe,Ae,Ze){if(typeof Ae=="string"&&Ae!==""||typeof Ae=="number")return Ae=kh(""+Ae,Oe.mode,Ze),Ae.return=Oe,Ae;if(typeof Ae=="object"&&Ae!==null){switch(Ae.$$typeof){case u:return Ze=Oh(Ae.type,Ae.key,Ae.props,null,Oe.mode,Ze),Ze.ref=Ul(Oe,null,Ae),Ze.return=Oe,Ze;case c:return Ae=zh(Ae,Oe.mode,Ze),Ae.return=Oe,Ae;case A:var Bt=Ae._init;return Mn(Oe,Bt(Ae._payload),Ze)}if(ae(Ae)||D(Ae))return Ae=gl(Ae,Oe.mode,Ze,null),Ae.return=Oe,Ae;wo(Oe,Ae)}return null}function hn(Oe,Ae,Ze,Bt){var sn=Ae!==null?Ae.key:null;if(typeof Ze=="string"&&Ze!==""||typeof Ze=="number")return sn!==null?null:be(Oe,Ae,""+Ze,Bt);if(typeof Ze=="object"&&Ze!==null){switch(Ze.$$typeof){case u:return Ze.key===sn?$e(Oe,Ae,Ze,Bt):null;case c:return Ze.key===sn?bt(Oe,Ae,Ze,Bt):null;case A:return sn=Ze._init,hn(Oe,Ae,sn(Ze._payload),Bt)}if(ae(Ze)||D(Ze))return sn!==null?null:Zt(Oe,Ae,Ze,Bt,null);wo(Oe,Ze)}return null}function Cn(Oe,Ae,Ze,Bt,sn){if(typeof Bt=="string"&&Bt!==""||typeof Bt=="number")return Oe=Oe.get(Ze)||null,be(Ae,Oe,""+Bt,sn);if(typeof Bt=="object"&&Bt!==null){switch(Bt.$$typeof){case u:return Oe=Oe.get(Bt.key===null?Ze:Bt.key)||null,$e(Ae,Oe,Bt,sn);case c:return Oe=Oe.get(Bt.key===null?Ze:Bt.key)||null,bt(Ae,Oe,Bt,sn);case A:var En=Bt._init;return Cn(Oe,Ae,Ze,En(Bt._payload),sn)}if(ae(Bt)||D(Bt))return Oe=Oe.get(Ze)||null,Zt(Ae,Oe,Bt,sn,null);wo(Ae,Bt)}return null}function Wt(Oe,Ae,Ze,Bt){for(var sn=null,En=null,wn=Ae,On=Ae=0,Oi=null;wn!==null&&On<Ze.length;On++){wn.index>On?(Oi=wn,wn=null):Oi=wn.sibling;var Fn=hn(Oe,wn,Ze[On],Bt);if(Fn===null){wn===null&&(wn=Oi);break}d&&wn&&Fn.alternate===null&&p(Oe,wn),Ae=G(Fn,Ae,On),En===null?sn=Fn:En.sibling=Fn,En=Fn,wn=Oi}if(On===Ze.length)return M(Oe,wn),hi&&Yo(Oe,On),sn;if(wn===null){for(;On<Ze.length;On++)wn=Mn(Oe,Ze[On],Bt),wn!==null&&(Ae=G(wn,Ae,On),En===null?sn=wn:En.sibling=wn,En=wn);return hi&&Yo(Oe,On),sn}for(wn=b(Oe,wn);On<Ze.length;On++)Oi=Cn(wn,Oe,On,Ze[On],Bt),Oi!==null&&(d&&Oi.alternate!==null&&wn.delete(Oi.key===null?On:Oi.key),Ae=G(Oi,Ae,On),En===null?sn=Oi:En.sibling=Oi,En=Oi);return d&&wn.forEach(function(Qa){return p(Oe,Qa)}),hi&&Yo(Oe,On),sn}function vr(Oe,Ae,Ze,Bt){var sn=D(Ze);if(typeof sn!="function")throw Error(a(150));if(Ze=sn.call(Ze),Ze==null)throw Error(a(151));for(var En=sn=null,wn=Ae,On=Ae=0,Oi=null,Fn=Ze.next();wn!==null&&!Fn.done;On++,Fn=Ze.next()){wn.index>On?(Oi=wn,wn=null):Oi=wn.sibling;var Qa=hn(Oe,wn,Fn.value,Bt);if(Qa===null){wn===null&&(wn=Oi);break}d&&wn&&Qa.alternate===null&&p(Oe,wn),Ae=G(Qa,Ae,On),En===null?sn=Qa:En.sibling=Qa,En=Qa,wn=Oi}if(Fn.done)return M(Oe,wn),hi&&Yo(Oe,On),sn;if(wn===null){for(;!Fn.done;On++,Fn=Ze.next())Fn=Mn(Oe,Fn.value,Bt),Fn!==null&&(Ae=G(Fn,Ae,On),En===null?sn=Fn:En.sibling=Fn,En=Fn);return hi&&Yo(Oe,On),sn}for(wn=b(Oe,wn);!Fn.done;On++,Fn=Ze.next())Fn=Cn(wn,Oe,On,Fn.value,Bt),Fn!==null&&(d&&Fn.alternate!==null&&wn.delete(Fn.key===null?On:Fn.key),Ae=G(Fn,Ae,On),En===null?sn=Fn:En.sibling=Fn,En=Fn);return d&&wn.forEach(function(Dd){return p(Oe,Dd)}),hi&&Yo(Oe,On),sn}function gs(Oe,Ae,Ze,Bt){if(typeof Ze=="object"&&Ze!==null&&Ze.type===f&&Ze.key===null&&(Ze=Ze.props.children),typeof Ze=="object"&&Ze!==null){switch(Ze.$$typeof){case u:e:{for(var sn=Ze.key,En=Ae;En!==null;){if(En.key===sn){if(sn=Ze.type,sn===f){if(En.tag===7){M(Oe,En.sibling),Ae=I(En,Ze.props.children),Ae.return=Oe,Oe=Ae;break e}}else if(En.elementType===sn||typeof sn=="object"&&sn!==null&&sn.$$typeof===A&&Fl(sn)===En.type){M(Oe,En.sibling),Ae=I(En,Ze.props),Ae.ref=Ul(Oe,En,Ze),Ae.return=Oe,Oe=Ae;break e}M(Oe,En);break}else p(Oe,En);En=En.sibling}Ze.type===f?(Ae=gl(Ze.props.children,Oe.mode,Bt,Ze.key),Ae.return=Oe,Oe=Ae):(Bt=Oh(Ze.type,Ze.key,Ze.props,null,Oe.mode,Bt),Bt.ref=Ul(Oe,Ae,Ze),Bt.return=Oe,Oe=Bt)}return ce(Oe);case c:e:{for(En=Ze.key;Ae!==null;){if(Ae.key===En)if(Ae.tag===4&&Ae.stateNode.containerInfo===Ze.containerInfo&&Ae.stateNode.implementation===Ze.implementation){M(Oe,Ae.sibling),Ae=I(Ae,Ze.children||[]),Ae.return=Oe,Oe=Ae;break e}else{M(Oe,Ae);break}else p(Oe,Ae);Ae=Ae.sibling}Ae=zh(Ze,Oe.mode,Bt),Ae.return=Oe,Oe=Ae}return ce(Oe);case A:return En=Ze._init,gs(Oe,Ae,En(Ze._payload),Bt)}if(ae(Ze))return Wt(Oe,Ae,Ze,Bt);if(D(Ze))return vr(Oe,Ae,Ze,Bt);wo(Oe,Ze)}return typeof Ze=="string"&&Ze!==""||typeof Ze=="number"?(Ze=""+Ze,Ae!==null&&Ae.tag===6?(M(Oe,Ae.sibling),Ae=I(Ae,Ze),Ae.return=Oe,Oe=Ae):(M(Oe,Ae),Ae=kh(Ze,Oe.mode,Bt),Ae.return=Oe,Oe=Ae),ce(Oe)):M(Oe,Ae)}return gs}var ka=A0(!0),C0=A0(!1),Ol={},Zr=ut(Ol),Zo=ut(Ol),Jo=ut(Ol);function Js(d){if(d===Ol)throw Error(a(174));return d}function fh(d,p){ht(Jo,p),ht(Zo,d),ht(Zr,Ol),d=oe(p),Je(Zr),ht(Zr,d)}function kl(){Je(Zr),Je(Zo),Je(Jo)}function P0(d){var p=Js(Jo.current),M=Js(Zr.current);p=te(M,d.type,p),M!==p&&(ht(Zo,d),ht(Zr,p))}function rd(d){Zo.current===d&&(Je(Zr),Je(Zo))}var yi=ut(0);function dh(d){for(var p=d;p!==null;){if(p.tag===13){var M=p.memoizedState;if(M!==null&&(M=M.dehydrated,M===null||Di(M)||Ai(M)))return p}else if(p.tag===19&&p.memoizedProps.revealOrder!==void 0){if((p.flags&128)!==0)return p}else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===d)break;for(;p.sibling===null;){if(p.return===null||p.return===d)return null;p=p.return}p.sibling.return=p.return,p=p.sibling}return null}var us=[];function Ko(){for(var d=0;d<us.length;d++){var p=us[d];Ve?p._workInProgressVersionPrimary=null:p._workInProgressVersionSecondary=null}us.length=0}var Ou=o.ReactCurrentDispatcher,cs=o.ReactCurrentBatchConfig,Qo=0,_i=null,rr=null,sr=null,ph=!1,pa=!1,$o=0,ku=0;function ar(){throw Error(a(321))}function mh(d,p){if(p===null)return!1;for(var M=0;M<p.length&&M<d.length;M++)if(!er(d[M],p[M]))return!1;return!0}function zl(d,p,M,b,I,G){if(Qo=G,_i=p,p.memoizedState=null,p.updateQueue=null,p.lanes=0,Ou.current=d===null||d.memoizedState===null?cd:hd,d=M(b,I),pa){G=0;do{if(pa=!1,$o=0,25<=G)throw Error(a(301));G+=1,sr=rr=null,p.updateQueue=null,Ou.current=fd,d=M(b,I)}while(pa)}if(Ou.current=Hl,p=rr!==null&&rr.next!==null,Qo=0,sr=rr=_i=null,ph=!1,p)throw Error(a(300));return d}function Eo(){var d=$o!==0;return $o=0,d}function Ks(){var d={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return sr===null?_i.memoizedState=sr=d:sr=sr.next=d,sr}function Qs(){if(rr===null){var d=_i.alternate;d=d!==null?d.memoizedState:null}else d=rr.next;var p=sr===null?_i.memoizedState:sr.next;if(p!==null)sr=p,rr=d;else{if(d===null)throw Error(a(310));rr=d,d={memoizedState:rr.memoizedState,baseState:rr.baseState,baseQueue:rr.baseQueue,queue:rr.queue,next:null},sr===null?_i.memoizedState=sr=d:sr=sr.next=d}return sr}function ma(d,p){return typeof p=="function"?p(d):p}function zu(d){var p=Qs(),M=p.queue;if(M===null)throw Error(a(311));M.lastRenderedReducer=d;var b=rr,I=b.baseQueue,G=M.pending;if(G!==null){if(I!==null){var ce=I.next;I.next=G.next,G.next=ce}b.baseQueue=I=G,M.pending=null}if(I!==null){G=I.next,b=b.baseState;var be=ce=null,$e=null,bt=G;do{var Zt=bt.lane;if((Qo&Zt)===Zt)$e!==null&&($e=$e.next={lane:0,action:bt.action,hasEagerState:bt.hasEagerState,eagerState:bt.eagerState,next:null}),b=bt.hasEagerState?bt.eagerState:d(b,bt.action);else{var Mn={lane:Zt,action:bt.action,hasEagerState:bt.hasEagerState,eagerState:bt.eagerState,next:null};$e===null?(be=$e=Mn,ce=b):$e=$e.next=Mn,_i.lanes|=Zt,va|=Zt}bt=bt.next}while(bt!==null&&bt!==G);$e===null?ce=b:$e.next=be,er(b,p.memoizedState)||(or=!0),p.memoizedState=b,p.baseState=ce,p.baseQueue=$e,M.lastRenderedState=b}if(d=M.interleaved,d!==null){I=d;do G=I.lane,_i.lanes|=G,va|=G,I=I.next;while(I!==d)}else I===null&&(M.lanes=0);return[p.memoizedState,M.dispatch]}function Bu(d){var p=Qs(),M=p.queue;if(M===null)throw Error(a(311));M.lastRenderedReducer=d;var b=M.dispatch,I=M.pending,G=p.memoizedState;if(I!==null){M.pending=null;var ce=I=I.next;do G=d(G,ce.action),ce=ce.next;while(ce!==I);er(G,p.memoizedState)||(or=!0),p.memoizedState=G,p.baseQueue===null&&(p.baseState=G),M.lastRenderedState=G}return[G,b]}function sd(){}function ad(d,p){var M=_i,b=Qs(),I=p(),G=!er(b.memoizedState,I);if(G&&(b.memoizedState=I,or=!0),b=b.queue,Bl(za.bind(null,M,b,d),[d]),b.getSnapshot!==p||G||sr!==null&&sr.memoizedState.tag&1){if(M.flags|=2048,Vu(9,ld.bind(null,M,b,I,p),void 0,null),Ii===null)throw Error(a(349));(Qo&30)!==0||od(M,p,I)}return I}function od(d,p,M){d.flags|=16384,d={getSnapshot:p,value:M},p=_i.updateQueue,p===null?(p={lastEffect:null,stores:null},_i.updateQueue=p,p.stores=[d]):(M=p.stores,M===null?p.stores=[d]:M.push(d))}function ld(d,p,M,b){p.value=M,p.getSnapshot=b,gh(p)&&Tr(d,1,-1)}function za(d,p,M){return M(function(){gh(p)&&Tr(d,1,-1)})}function gh(d){var p=d.getSnapshot;d=d.value;try{var M=p();return!er(d,M)}catch{return!0}}function Gu(d){var p=Ks();return typeof d=="function"&&(d=d()),p.memoizedState=p.baseState=d,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ma,lastRenderedState:d},p.queue=d,d=d.dispatch=y1.bind(null,_i,d),[p.memoizedState,d]}function Vu(d,p,M,b){return d={tag:d,create:p,destroy:M,deps:b,next:null},p=_i.updateQueue,p===null?(p={lastEffect:null,stores:null},_i.updateQueue=p,p.lastEffect=d.next=d):(M=p.lastEffect,M===null?p.lastEffect=d.next=d:(b=M.next,M.next=d,d.next=b,p.lastEffect=d)),d}function R0(){return Qs().memoizedState}function To(d,p,M,b){var I=Ks();_i.flags|=d,I.memoizedState=Vu(1|p,M,void 0,b===void 0?null:b)}function vh(d,p,M,b){var I=Qs();b=b===void 0?null:b;var G=void 0;if(rr!==null){var ce=rr.memoizedState;if(G=ce.destroy,b!==null&&mh(b,ce.deps)){I.memoizedState=Vu(p,M,G,b);return}}_i.flags|=d,I.memoizedState=Vu(1|p,M,G,b)}function yh(d,p){return To(8390656,8,d,p)}function Bl(d,p){return vh(2048,8,d,p)}function ti(d,p){return vh(4,2,d,p)}function _h(d,p){return vh(4,4,d,p)}function Hu(d,p){if(typeof p=="function")return d=d(),p(d),function(){p(null)};if(p!=null)return d=d(),p.current=d,function(){p.current=null}}function Gl(d,p,M){return M=M!=null?M.concat([d]):null,vh(4,4,Hu.bind(null,p,d),M)}function xh(){}function Sh(d,p){var M=Qs();p=p===void 0?null:p;var b=M.memoizedState;return b!==null&&p!==null&&mh(p,b[1])?b[0]:(M.memoizedState=[d,p],d)}function Vl(d,p){var M=Qs();p=p===void 0?null:p;var b=M.memoizedState;return b!==null&&p!==null&&mh(p,b[1])?b[0]:(d=d(),M.memoizedState=[d,p],d)}function Mh(d,p){var M=yn;yn=M!==0&&4>M?M:4,d(!0);var b=cs.transition;cs.transition={};try{d(!1),p()}finally{yn=M,cs.transition=b}}function el(){return Qs().memoizedState}function I0(d,p,M){var b=na(d);M={lane:b,action:M,hasEagerState:!1,eagerState:null,next:null},L0(d)?ud(p,M):(Wu(d,p,M),M=Bn(),d=Tr(d,b,M),d!==null&&ju(d,p,b))}function y1(d,p,M){var b=na(d),I={lane:b,action:M,hasEagerState:!1,eagerState:null,next:null};if(L0(d))ud(p,I);else{Wu(d,p,I);var G=d.alternate;if(d.lanes===0&&(G===null||G.lanes===0)&&(G=p.lastRenderedReducer,G!==null))try{var ce=p.lastRenderedState,be=G(ce,M);if(I.hasEagerState=!0,I.eagerState=be,er(be,ce))return}catch{}finally{}M=Bn(),d=Tr(d,b,M),d!==null&&ju(d,p,b)}}function L0(d){var p=d.alternate;return d===_i||p!==null&&p===_i}function ud(d,p){pa=ph=!0;var M=d.pending;M===null?p.next=p:(p.next=M.next,M.next=p),d.pending=p}function Wu(d,p,M){Ii!==null&&(d.mode&1)!==0&&(An&2)===0?(d=p.interleaved,d===null?(M.next=M,Ur===null?Ur=[p]:Ur.push(p)):(M.next=d.next,d.next=M),p.interleaved=M):(d=p.pending,d===null?M.next=M:(M.next=d.next,d.next=M),p.pending=M)}function ju(d,p,M){if((M&4194240)!==0){var b=p.lanes;b&=d.pendingLanes,M|=b,p.lanes=M,hr(d,M)}}var Hl={readContext:vi,useCallback:ar,useContext:ar,useEffect:ar,useImperativeHandle:ar,useInsertionEffect:ar,useLayoutEffect:ar,useMemo:ar,useReducer:ar,useRef:ar,useState:ar,useDebugValue:ar,useDeferredValue:ar,useTransition:ar,useMutableSource:ar,useSyncExternalStore:ar,useId:ar,unstable_isNewReconciler:!1},cd={readContext:vi,useCallback:function(d,p){return Ks().memoizedState=[d,p===void 0?null:p],d},useContext:vi,useEffect:yh,useImperativeHandle:function(d,p,M){return M=M!=null?M.concat([d]):null,To(4194308,4,Hu.bind(null,p,d),M)},useLayoutEffect:function(d,p){return To(4194308,4,d,p)},useInsertionEffect:function(d,p){return To(4,2,d,p)},useMemo:function(d,p){var M=Ks();return p=p===void 0?null:p,d=d(),M.memoizedState=[d,p],d},useReducer:function(d,p,M){var b=Ks();return p=M!==void 0?M(p):p,b.memoizedState=b.baseState=p,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:d,lastRenderedState:p},b.queue=d,d=d.dispatch=I0.bind(null,_i,d),[b.memoizedState,d]},useRef:function(d){var p=Ks();return d={current:d},p.memoizedState=d},useState:Gu,useDebugValue:xh,useDeferredValue:function(d){var p=Gu(d),M=p[0],b=p[1];return yh(function(){var I=cs.transition;cs.transition={};try{b(d)}finally{cs.transition=I}},[d]),M},useTransition:function(){var d=Gu(!1),p=d[0];return d=Mh.bind(null,d[1]),Ks().memoizedState=d,[p,d]},useMutableSource:function(){},useSyncExternalStore:function(d,p,M){var b=_i,I=Ks();if(hi){if(M===void 0)throw Error(a(407));M=M()}else{if(M=p(),Ii===null)throw Error(a(349));(Qo&30)!==0||od(b,p,M)}I.memoizedState=M;var G={value:M,getSnapshot:p};return I.queue=G,yh(za.bind(null,b,G,d),[d]),b.flags|=2048,Vu(9,ld.bind(null,b,G,M,p),void 0,null),M},useId:function(){var d=Ks(),p=Ii.identifierPrefix;if(hi){var M=Oa,b=Fa;M=(b&~(1<<32-bn(b)-1)).toString(32)+M,p=":"+p+"R"+M,M=$o++,0<M&&(p+="H"+M.toString(32)),p+=":"}else M=ku++,p=":"+p+"r"+M.toString(32)+":";return d.memoizedState=p},unstable_isNewReconciler:!1},hd={readContext:vi,useCallback:Sh,useContext:vi,useEffect:Bl,useImperativeHandle:Gl,useInsertionEffect:ti,useLayoutEffect:_h,useMemo:Vl,useReducer:zu,useRef:R0,useState:function(){return zu(ma)},useDebugValue:xh,useDeferredValue:function(d){var p=zu(ma),M=p[0],b=p[1];return Bl(function(){var I=cs.transition;cs.transition={};try{b(d)}finally{cs.transition=I}},[d]),M},useTransition:function(){var d=zu(ma)[0],p=Qs().memoizedState;return[d,p]},useMutableSource:sd,useSyncExternalStore:ad,useId:el,unstable_isNewReconciler:!1},fd={readContext:vi,useCallback:Sh,useContext:vi,useEffect:Bl,useImperativeHandle:Gl,useInsertionEffect:ti,useLayoutEffect:_h,useMemo:Vl,useReducer:Bu,useRef:R0,useState:function(){return Bu(ma)},useDebugValue:xh,useDeferredValue:function(d){var p=Bu(ma),M=p[0],b=p[1];return Bl(function(){var I=cs.transition;cs.transition={};try{b(d)}finally{cs.transition=I}},[d]),M},useTransition:function(){var d=Bu(ma)[0],p=Qs().memoizedState;return[d,p]},useMutableSource:sd,useSyncExternalStore:ad,useId:el,unstable_isNewReconciler:!1};function dd(d,p){try{var M="",b=p;do M+=Ia(b),b=b.return;while(b);var I=M}catch(G){I=`
Error generating stack: `+G.message+`
`+G.stack}return{value:d,source:p,stack:I}}function wh(d,p){try{console.error(p.value)}catch(M){setTimeout(function(){throw M})}}var _1=typeof WeakMap=="function"?WeakMap:Map;function N0(d,p,M){M=Ua(-1,M),M.tag=3,M.payload={element:null};var b=p.value;return M.callback=function(){Zl||(Zl=!0,ai=b),wh(d,p)},M}function Eh(d,p,M){M=Ua(-1,M),M.tag=3;var b=d.type.getDerivedStateFromError;if(typeof b=="function"){var I=p.value;M.payload=function(){return b(I)},M.callback=function(){wh(d,p)}}var G=d.stateNode;return G!==null&&typeof G.componentDidCatch=="function"&&(M.callback=function(){wh(d,p),typeof b!="function"&&(ta===null?ta=new Set([this]):ta.add(this));var ce=p.stack;this.componentDidCatch(p.value,{componentStack:ce!==null?ce:""})}),M}function Ba(d,p,M){var b=d.pingCache;if(b===null){b=d.pingCache=new _1;var I=new Set;b.set(p,I)}else I=b.get(p),I===void 0&&(I=new Set,b.set(p,I));I.has(M)||(I.add(M),d=Id.bind(null,d,p,M),p.then(d,d))}function pd(d){do{var p;if((p=d.tag===13)&&(p=d.memoizedState,p=p!==null?p.dehydrated!==null:!0),p)return d;d=d.return}while(d!==null);return null}function tl(d,p,M,b,I){return(d.mode&1)===0?(d===p?d.flags|=65536:(d.flags|=128,M.flags|=131072,M.flags&=-52805,M.tag===1&&(M.alternate===null?M.tag=17:(p=Ua(-1,1),p.tag=2,xo(M,p))),M.lanes|=1),d):(d.flags|=65536,d.lanes=I,d)}function Xi(d){d.flags|=4}function Wl(d,p){if(d!==null&&d.child===p.child)return!0;if((p.flags&16)!==0)return!1;for(d=p.child;d!==null;){if((d.flags&12854)!==0||(d.subtreeFlags&12854)!==0)return!1;d=d.sibling}return!0}var hs,nl,Th,bh;if(Ke)hs=function(d,p){for(var M=p.child;M!==null;){if(M.tag===5||M.tag===6)K(d,M.stateNode);else if(M.tag!==4&&M.child!==null){M.child.return=M,M=M.child;continue}if(M===p)break;for(;M.sibling===null;){if(M.return===null||M.return===p)return;M=M.return}M.sibling.return=M.return,M=M.sibling}},nl=function(){},Th=function(d,p,M,b,I){if(d=d.memoizedProps,d!==b){var G=p.stateNode,ce=Js(Zr.current);M=me(G,M,d,b,I,ce),(p.updateQueue=M)&&Xi(p)}},bh=function(d,p,M,b){M!==b&&Xi(p)};else if(Qe){hs=function(d,p,M,b){for(var I=p.child;I!==null;){if(I.tag===5){var G=I.stateNode;M&&b&&(G=nn(G,I.type,I.memoizedProps,I)),K(d,G)}else if(I.tag===6)G=I.stateNode,M&&b&&(G=zn(G,I.memoizedProps,I)),K(d,G);else if(I.tag!==4){if(I.tag===22&&I.memoizedState!==null)G=I.child,G!==null&&(G.return=I),hs(d,I,!0,!0);else if(I.child!==null){I.child.return=I,I=I.child;continue}}if(I===p)break;for(;I.sibling===null;){if(I.return===null||I.return===p)return;I=I.return}I.sibling.return=I.return,I=I.sibling}};var bo=function(d,p,M,b){for(var I=p.child;I!==null;){if(I.tag===5){var G=I.stateNode;M&&b&&(G=nn(G,I.type,I.memoizedProps,I)),dt(d,G)}else if(I.tag===6)G=I.stateNode,M&&b&&(G=zn(G,I.memoizedProps,I)),dt(d,G);else if(I.tag!==4){if(I.tag===22&&I.memoizedState!==null)G=I.child,G!==null&&(G.return=I),bo(d,I,!0,!0);else if(I.child!==null){I.child.return=I,I=I.child;continue}}if(I===p)break;for(;I.sibling===null;){if(I.return===null||I.return===p)return;I=I.return}I.sibling.return=I.return,I=I.sibling}};nl=function(d,p){var M=p.stateNode;if(!Wl(d,p)){d=M.containerInfo;var b=ke(d);bo(b,p,!1,!1),M.pendingChildren=b,Xi(p),kt(d,b)}},Th=function(d,p,M,b,I){var G=d.stateNode,ce=d.memoizedProps;if((d=Wl(d,p))&&ce===b)p.stateNode=G;else{var be=p.stateNode,$e=Js(Zr.current),bt=null;ce!==b&&(bt=me(be,M,ce,b,I,$e)),d&&bt===null?p.stateNode=G:(G=tt(G,bt,M,ce,b,p,d,be),le(G,M,b,I,$e)&&Xi(p),p.stateNode=G,d?Xi(p):hs(G,p,!1,!1))}},bh=function(d,p,M,b){M!==b?(d=Js(Jo.current),M=Js(Zr.current),p.stateNode=re(b,d,M,p),Xi(p)):p.stateNode=d.stateNode}}else nl=function(){},Th=function(){},bh=function(){};function Ga(d,p){if(!hi)switch(d.tailMode){case"hidden":p=d.tail;for(var M=null;p!==null;)p.alternate!==null&&(M=p),p=p.sibling;M===null?d.tail=null:M.sibling=null;break;case"collapsed":M=d.tail;for(var b=null;M!==null;)M.alternate!==null&&(b=M),M=M.sibling;b===null?p||d.tail===null?d.tail=null:d.tail.sibling=null:b.sibling=null}}function Ri(d){var p=d.alternate!==null&&d.alternate.child===d.child,M=0,b=0;if(p)for(var I=d.child;I!==null;)M|=I.lanes|I.childLanes,b|=I.subtreeFlags&14680064,b|=I.flags&14680064,I.return=d,I=I.sibling;else for(I=d.child;I!==null;)M|=I.lanes|I.childLanes,b|=I.subtreeFlags,b|=I.flags,I.return=d,I=I.sibling;return d.subtreeFlags|=b,d.childLanes=M,p}function Ah(d,p,M){var b=p.pendingProps;switch(td(p),p.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ri(p),null;case 1:return dn(p.type)&&fn(),Ri(p),null;case 3:return b=p.stateNode,kl(),Je(St),Je(Nt),Ko(),b.pendingContext&&(b.context=b.pendingContext,b.pendingContext=null),(d===null||d.child===null)&&(Fu(p)?Xi(p):d===null||d.memoizedState.isDehydrated&&(p.flags&256)===0||(p.flags|=1024,Ns!==null&&(rc(Ns),Ns=null))),nl(d,p),Ri(p),null;case 5:rd(p),M=Js(Jo.current);var I=p.type;if(d!==null&&p.stateNode!=null)Th(d,p,I,b,M),d.ref!==p.ref&&(p.flags|=512,p.flags|=2097152);else{if(!b){if(p.stateNode===null)throw Error(a(166));return Ri(p),null}if(d=Js(Zr.current),Fu(p)){if(!pt)throw Error(a(175));d=W(p.stateNode,p.type,p.memoizedProps,M,d,p,!Nl),p.updateQueue=d,d!==null&&Xi(p)}else{var G=z(I,b,M,d,p);hs(G,p,!1,!1),p.stateNode=G,le(G,I,b,M,d)&&Xi(p)}p.ref!==null&&(p.flags|=512,p.flags|=2097152)}return Ri(p),null;case 6:if(d&&p.stateNode!=null)bh(d,p,d.memoizedProps,b);else{if(typeof b!="string"&&p.stateNode===null)throw Error(a(166));if(d=Js(Jo.current),M=Js(Zr.current),Fu(p)){if(!pt)throw Error(a(176));if(d=p.stateNode,b=p.memoizedProps,(M=ee(d,b,p,!Nl))&&(I=Fr,I!==null))switch(G=(I.mode&1)!==0,I.tag){case 3:Tt(I.stateNode.containerInfo,d,b,G);break;case 5:At(I.type,I.memoizedProps,I.stateNode,d,b,G)}M&&Xi(p)}else p.stateNode=re(b,d,M,p)}return Ri(p),null;case 13:if(Je(yi),b=p.memoizedState,hi&&fr!==null&&(p.mode&1)!==0&&(p.flags&128)===0){for(d=fr;d;)d=ri(d);return Dl(),p.flags|=98560,p}if(b!==null&&b.dehydrated!==null){if(b=Fu(p),d===null){if(!b)throw Error(a(318));if(!pt)throw Error(a(344));if(d=p.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(a(317));ge(d,p)}else Dl(),(p.flags&128)===0&&(p.memoizedState=null),p.flags|=4;return Ri(p),null}return Ns!==null&&(rc(Ns),Ns=null),(p.flags&128)!==0?(p.lanes=M,p):(b=b!==null,M=!1,d===null?Fu(p):M=d.memoizedState!==null,b&&!M&&(p.child.flags|=8192,(p.mode&1)!==0&&(d===null||(yi.current&1)!==0?Ei===0&&(Ei=3):Dh())),p.updateQueue!==null&&(p.flags|=4),Ri(p),null);case 4:return kl(),nl(d,p),d===null&&Be(p.stateNode.containerInfo),Ri(p),null;case 10:return Ui(p.type._context),Ri(p),null;case 17:return dn(p.type)&&fn(),Ri(p),null;case 19:if(Je(yi),I=p.memoizedState,I===null)return Ri(p),null;if(b=(p.flags&128)!==0,G=I.rendering,G===null)if(b)Ga(I,!1);else{if(Ei!==0||d!==null&&(d.flags&128)!==0)for(d=p.child;d!==null;){if(G=dh(d),G!==null){for(p.flags|=128,Ga(I,!1),d=G.updateQueue,d!==null&&(p.updateQueue=d,p.flags|=4),p.subtreeFlags=0,d=M,b=p.child;b!==null;)M=b,I=d,M.flags&=14680066,G=M.alternate,G===null?(M.childLanes=0,M.lanes=I,M.child=null,M.subtreeFlags=0,M.memoizedProps=null,M.memoizedState=null,M.updateQueue=null,M.dependencies=null,M.stateNode=null):(M.childLanes=G.childLanes,M.lanes=G.lanes,M.child=G.child,M.subtreeFlags=0,M.deletions=null,M.memoizedProps=G.memoizedProps,M.memoizedState=G.memoizedState,M.updateQueue=G.updateQueue,M.type=G.type,I=G.dependencies,M.dependencies=I===null?null:{lanes:I.lanes,firstContext:I.firstContext}),b=b.sibling;return ht(yi,yi.current&1|2),p.child}d=d.sibling}I.tail!==null&&ci()>Po&&(p.flags|=128,b=!0,Ga(I,!1),p.lanes=4194304)}else{if(!b)if(d=dh(G),d!==null){if(p.flags|=128,b=!0,d=d.updateQueue,d!==null&&(p.updateQueue=d,p.flags|=4),Ga(I,!0),I.tail===null&&I.tailMode==="hidden"&&!G.alternate&&!hi)return Ri(p),null}else 2*ci()-I.renderingStartTime>Po&&M!==1073741824&&(p.flags|=128,b=!0,Ga(I,!1),p.lanes=4194304);I.isBackwards?(G.sibling=p.child,p.child=G):(d=I.last,d!==null?d.sibling=G:p.child=G,I.last=G)}return I.tail!==null?(p=I.tail,I.rendering=p,I.tail=p.sibling,I.renderingStartTime=ci(),p.sibling=null,d=yi.current,ht(yi,b?d&1|2:d&1),p):(Ri(p),null);case 22:case 23:return sc(),b=p.memoizedState!==null,d!==null&&d.memoizedState!==null!==b&&(p.flags|=8192),b&&(p.mode&1)!==0?(Er&1073741824)!==0&&(Ri(p),Ke&&p.subtreeFlags&6&&(p.flags|=8192)):Ri(p),null;case 24:return null;case 25:return null}throw Error(a(156,p.tag))}var md=o.ReactCurrentOwner,or=!1;function wi(d,p,M,b){p.child=d===null?C0(p,null,M,b):ka(p,d.child,M,b)}function ni(d,p,M,b,I){M=M.render;var G=p.ref;return Pi(p,I),b=zl(d,p,M,b,G,I),M=Eo(),d!==null&&!or?(p.updateQueue=d.updateQueue,p.flags&=-2053,d.lanes&=~I,Jr(d,p,I)):(hi&&M&&ed(p),p.flags|=1,wi(d,p,b,I),p.child)}function Qn(d,p,M,b,I){if(d===null){var G=M.type;return typeof G=="function"&&!Fh(G)&&G.defaultProps===void 0&&M.compare===null&&M.defaultProps===void 0?(p.tag=15,p.type=G,Va(d,p,G,b,I)):(d=Oh(M.type,null,b,p,p.mode,I),d.ref=p.ref,d.return=p,p.child=d)}if(G=d.child,(d.lanes&I)===0){var ce=G.memoizedProps;if(M=M.compare,M=M!==null?M:qr,M(ce,b)&&d.ref===p.ref)return Jr(d,p,I)}return p.flags|=1,d=Ka(G,b),d.ref=p.ref,d.return=p,p.child=d}function Va(d,p,M,b,I){if(d!==null&&qr(d.memoizedProps,b)&&d.ref===p.ref)if(or=!1,(d.lanes&I)!==0)(d.flags&131072)!==0&&(or=!0);else return p.lanes=d.lanes,Jr(d,p,I);return Ha(d,p,M,b,I)}function dr(d,p,M){var b=p.pendingProps,I=b.children,G=d!==null?d.memoizedState:null;if(b.mode==="hidden")if((p.mode&1)===0)p.memoizedState={baseLanes:0,cachePool:null},ht(hl,Er),Er|=M;else if((M&1073741824)!==0)p.memoizedState={baseLanes:0,cachePool:null},b=G!==null?G.baseLanes:M,ht(hl,Er),Er|=b;else return d=G!==null?G.baseLanes|M:M,p.lanes=p.childLanes=1073741824,p.memoizedState={baseLanes:d,cachePool:null},p.updateQueue=null,ht(hl,Er),Er|=d,null;else G!==null?(b=G.baseLanes|M,p.memoizedState=null):b=M,ht(hl,Er),Er|=b;return wi(d,p,I,M),p.child}function Or(d,p){var M=p.ref;(d===null&&M!==null||d!==null&&d.ref!==M)&&(p.flags|=512,p.flags|=2097152)}function Ha(d,p,M,b,I){var G=dn(M)?Xt:Nt.current;return G=un(p,G),Pi(p,I),M=zl(d,p,M,b,G,I),b=Eo(),d!==null&&!or?(p.updateQueue=d.updateQueue,p.flags&=-2053,d.lanes&=~I,Jr(d,p,I)):(hi&&b&&ed(p),p.flags|=1,wi(d,p,M,I),p.child)}function il(d,p,M,b,I){if(dn(M)){var G=!0;$t(p)}else G=!1;if(Pi(p,I),p.stateNode===null)d!==null&&(d.alternate=null,p.alternate=null,p.flags|=2),w0(p,M,b),$f(p,M,b,I),b=!0;else if(d===null){var ce=p.stateNode,be=p.memoizedProps;ce.props=be;var $e=ce.context,bt=M.contextType;typeof bt=="object"&&bt!==null?bt=vi(bt):(bt=dn(M)?Xt:Nt.current,bt=un(p,bt));var Zt=M.getDerivedStateFromProps,Mn=typeof Zt=="function"||typeof ce.getSnapshotBeforeUpdate=="function";Mn||typeof ce.UNSAFE_componentWillReceiveProps!="function"&&typeof ce.componentWillReceiveProps!="function"||(be!==b||$e!==bt)&&E0(p,ce,b,bt),Is=!1;var hn=p.memoizedState;ce.state=hn,ah(p,b,ce,I),$e=p.memoizedState,be!==b||hn!==$e||St.current||Is?(typeof Zt=="function"&&(Kf(p,M,Zt,b),$e=p.memoizedState),(be=Is||Qf(p,M,be,b,hn,$e,bt))?(Mn||typeof ce.UNSAFE_componentWillMount!="function"&&typeof ce.componentWillMount!="function"||(typeof ce.componentWillMount=="function"&&ce.componentWillMount(),typeof ce.UNSAFE_componentWillMount=="function"&&ce.UNSAFE_componentWillMount()),typeof ce.componentDidMount=="function"&&(p.flags|=4194308)):(typeof ce.componentDidMount=="function"&&(p.flags|=4194308),p.memoizedProps=b,p.memoizedState=$e),ce.props=b,ce.state=$e,ce.context=bt,b=be):(typeof ce.componentDidMount=="function"&&(p.flags|=4194308),b=!1)}else{ce=p.stateNode,Jf(d,p),be=p.memoizedProps,bt=p.type===p.elementType?be:nr(p.type,be),ce.props=bt,Mn=p.pendingProps,hn=ce.context,$e=M.contextType,typeof $e=="object"&&$e!==null?$e=vi($e):($e=dn(M)?Xt:Nt.current,$e=un(p,$e));var Cn=M.getDerivedStateFromProps;(Zt=typeof Cn=="function"||typeof ce.getSnapshotBeforeUpdate=="function")||typeof ce.UNSAFE_componentWillReceiveProps!="function"&&typeof ce.componentWillReceiveProps!="function"||(be!==Mn||hn!==$e)&&E0(p,ce,b,$e),Is=!1,hn=p.memoizedState,ce.state=hn,ah(p,b,ce,I);var Wt=p.memoizedState;be!==Mn||hn!==Wt||St.current||Is?(typeof Cn=="function"&&(Kf(p,M,Cn,b),Wt=p.memoizedState),(bt=Is||Qf(p,M,bt,b,hn,Wt,$e)||!1)?(Zt||typeof ce.UNSAFE_componentWillUpdate!="function"&&typeof ce.componentWillUpdate!="function"||(typeof ce.componentWillUpdate=="function"&&ce.componentWillUpdate(b,Wt,$e),typeof ce.UNSAFE_componentWillUpdate=="function"&&ce.UNSAFE_componentWillUpdate(b,Wt,$e)),typeof ce.componentDidUpdate=="function"&&(p.flags|=4),typeof ce.getSnapshotBeforeUpdate=="function"&&(p.flags|=1024)):(typeof ce.componentDidUpdate!="function"||be===d.memoizedProps&&hn===d.memoizedState||(p.flags|=4),typeof ce.getSnapshotBeforeUpdate!="function"||be===d.memoizedProps&&hn===d.memoizedState||(p.flags|=1024),p.memoizedProps=b,p.memoizedState=Wt),ce.props=b,ce.state=Wt,ce.context=$e,b=bt):(typeof ce.componentDidUpdate!="function"||be===d.memoizedProps&&hn===d.memoizedState||(p.flags|=4),typeof ce.getSnapshotBeforeUpdate!="function"||be===d.memoizedProps&&hn===d.memoizedState||(p.flags|=1024),b=!1)}return wr(d,p,M,b,G,I)}function wr(d,p,M,b,I,G){Or(d,p);var ce=(p.flags&128)!==0;if(!b&&!ce)return I&&Dt(p,M,!1),Jr(d,p,G);b=p.stateNode,md.current=p;var be=ce&&typeof M.getDerivedStateFromError!="function"?null:b.render();return p.flags|=1,d!==null&&ce?(p.child=ka(p,d.child,null,G),p.child=ka(p,null,be,G)):wi(d,p,be,G),p.memoizedState=b.state,I&&Dt(p,M,!0),p.child}function Xu(d){var p=d.stateNode;p.pendingContext?Kt(d,p.pendingContext,p.pendingContext!==p.context):p.context&&Kt(d,p.context,!1),fh(d,p.containerInfo)}function gd(d,p,M,b,I){return Dl(),hh(I),p.flags|=256,wi(d,p,M,b),p.child}var qu={dehydrated:null,treeContext:null,retryLane:0};function rl(d){return{baseLanes:d,cachePool:null}}function vd(d,p,M){var b=p.pendingProps,I=yi.current,G=!1,ce=(p.flags&128)!==0,be;if((be=ce)||(be=d!==null&&d.memoizedState===null?!1:(I&2)!==0),be?(G=!0,p.flags&=-129):(d===null||d.memoizedState!==null)&&(I|=1),ht(yi,I&1),d===null)return Mo(p),d=p.memoizedState,d!==null&&(d=d.dehydrated,d!==null)?((p.mode&1)===0?p.lanes=1:Ai(d)?p.lanes=8:p.lanes=1073741824,null):(I=b.children,d=b.fallback,G?(b=p.mode,G=p.child,I={mode:"hidden",children:I},(b&1)===0&&G!==null?(G.childLanes=0,G.pendingProps=I):G=lc(I,b,0,null),d=gl(d,b,M,null),G.return=p,d.return=p,G.sibling=d,p.child=G,p.child.memoizedState=rl(M),p.memoizedState=qu,d):$s(p,I));if(I=d.memoizedState,I!==null){if(be=I.dehydrated,be!==null){if(ce)return p.flags&256?(p.flags&=-257,Zu(d,p,M,Error(a(422)))):p.memoizedState!==null?(p.child=d.child,p.flags|=128,null):(G=b.fallback,I=p.mode,b=lc({mode:"visible",children:b.children},I,0,null),G=gl(G,I,M,null),G.flags|=2,b.return=p,G.return=p,b.sibling=G,p.child=b,(p.mode&1)!==0&&ka(p,d.child,null,M),p.child.memoizedState=rl(M),p.memoizedState=qu,G);if((p.mode&1)===0)p=Zu(d,p,M,null);else if(Ai(be))p=Zu(d,p,M,Error(a(419)));else if(b=(M&d.childLanes)!==0,or||b){if(b=Ii,b!==null){switch(M&-M){case 4:G=2;break;case 16:G=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:G=32;break;case 536870912:G=268435456;break;default:G=0}b=(G&(b.suspendedLanes|M))!==0?0:G,b!==0&&b!==I.retryLane&&(I.retryLane=b,Tr(d,b,-1))}Dh(),p=Zu(d,p,M,Error(a(421)))}else Di(be)?(p.flags|=128,p.child=d.child,p=k0.bind(null,d),Mi(be,p),p=null):(M=I.treeContext,pt&&(fr=Xr(be),Fr=p,hi=!0,Ns=null,Nl=!1,M!==null&&(Ls[ls++]=Fa,Ls[ls++]=Oa,Ls[ls++]=qo,Fa=M.id,Oa=M.overflow,qo=p)),p=$s(p,p.pendingProps.children),p.flags|=4096);return p}return G?(b=Ch(d,p,b.children,b.fallback,M),G=p.child,I=d.child.memoizedState,G.memoizedState=I===null?rl(M):{baseLanes:I.baseLanes|M,cachePool:null},G.childLanes=d.childLanes&~M,p.memoizedState=qu,b):(M=Yu(d,p,b.children,M),p.memoizedState=null,M)}return G?(b=Ch(d,p,b.children,b.fallback,M),G=p.child,I=d.child.memoizedState,G.memoizedState=I===null?rl(M):{baseLanes:I.baseLanes|M,cachePool:null},G.childLanes=d.childLanes&~M,p.memoizedState=qu,b):(M=Yu(d,p,b.children,M),p.memoizedState=null,M)}function $s(d,p){return p=lc({mode:"visible",children:p},d.mode,0,null),p.return=d,d.child=p}function Yu(d,p,M,b){var I=d.child;return d=I.sibling,M=Ka(I,{mode:"visible",children:M}),(p.mode&1)===0&&(M.lanes=b),M.return=p,M.sibling=null,d!==null&&(b=p.deletions,b===null?(p.deletions=[d],p.flags|=16):b.push(d)),p.child=M}function Ch(d,p,M,b,I){var G=p.mode;d=d.child;var ce=d.sibling,be={mode:"hidden",children:M};return(G&1)===0&&p.child!==d?(M=p.child,M.childLanes=0,M.pendingProps=be,p.deletions=null):(M=Ka(d,be),M.subtreeFlags=d.subtreeFlags&14680064),ce!==null?b=Ka(ce,b):(b=gl(b,G,I,null),b.flags|=2),b.return=p,M.return=p,M.sibling=b,p.child=M,b}function Zu(d,p,M,b){return b!==null&&hh(b),ka(p,d.child,null,M),d=$s(p,p.pendingProps.children),d.flags|=2,p.memoizedState=null,d}function D0(d,p,M){d.lanes|=p;var b=d.alternate;b!==null&&(b.lanes|=p),ji(d.return,p,M)}function ga(d,p,M,b,I){var G=d.memoizedState;G===null?d.memoizedState={isBackwards:p,rendering:null,renderingStartTime:0,last:b,tail:M,tailMode:I}:(G.isBackwards=p,G.rendering=null,G.renderingStartTime=0,G.last=b,G.tail=M,G.tailMode=I)}function sl(d,p,M){var b=p.pendingProps,I=b.revealOrder,G=b.tail;if(wi(d,p,b.children,M),b=yi.current,(b&2)!==0)b=b&1|2,p.flags|=128;else{if(d!==null&&(d.flags&128)!==0)e:for(d=p.child;d!==null;){if(d.tag===13)d.memoizedState!==null&&D0(d,M,p);else if(d.tag===19)D0(d,M,p);else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===p)break e;for(;d.sibling===null;){if(d.return===null||d.return===p)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}b&=1}if(ht(yi,b),(p.mode&1)===0)p.memoizedState=null;else switch(I){case"forwards":for(M=p.child,I=null;M!==null;)d=M.alternate,d!==null&&dh(d)===null&&(I=M),M=M.sibling;M=I,M===null?(I=p.child,p.child=null):(I=M.sibling,M.sibling=null),ga(p,!1,I,M,G);break;case"backwards":for(M=null,I=p.child,p.child=null;I!==null;){if(d=I.alternate,d!==null&&dh(d)===null){p.child=I;break}d=I.sibling,I.sibling=M,M=I,I=d}ga(p,!0,M,null,G);break;case"together":ga(p,!1,null,null,void 0);break;default:p.memoizedState=null}return p.child}function Jr(d,p,M){if(d!==null&&(p.dependencies=d.dependencies),va|=p.lanes,(M&p.childLanes)===0)return null;if(d!==null&&p.child!==d.child)throw Error(a(153));if(p.child!==null){for(d=p.child,M=Ka(d,d.pendingProps),p.child=M,M.return=p;d.sibling!==null;)d=d.sibling,M=M.sibling=Ka(d,d.pendingProps),M.return=p;M.sibling=null}return p.child}function Ph(d,p,M){switch(p.tag){case 3:Xu(p),Dl();break;case 5:P0(p);break;case 1:dn(p.type)&&$t(p);break;case 4:fh(p,p.stateNode.containerInfo);break;case 10:Da(p,p.type._context,p.memoizedProps.value);break;case 13:var b=p.memoizedState;if(b!==null)return b.dehydrated!==null?(ht(yi,yi.current&1),p.flags|=128,null):(M&p.child.childLanes)!==0?vd(d,p,M):(ht(yi,yi.current&1),d=Jr(d,p,M),d!==null?d.sibling:null);ht(yi,yi.current&1);break;case 19:if(b=(M&p.childLanes)!==0,(d.flags&128)!==0){if(b)return sl(d,p,M);p.flags|=128}var I=p.memoizedState;if(I!==null&&(I.rendering=null,I.tail=null,I.lastEffect=null),ht(yi,yi.current),b)break;return null;case 22:case 23:return p.lanes=0,dr(d,p,M)}return Jr(d,p,M)}function Rh(d,p){switch(td(p),p.tag){case 1:return dn(p.type)&&fn(),d=p.flags,d&65536?(p.flags=d&-65537|128,p):null;case 3:return kl(),Je(St),Je(Nt),Ko(),d=p.flags,(d&65536)!==0&&(d&128)===0?(p.flags=d&-65537|128,p):null;case 5:return rd(p),null;case 13:if(Je(yi),d=p.memoizedState,d!==null&&d.dehydrated!==null){if(p.alternate===null)throw Error(a(340));Dl()}return d=p.flags,d&65536?(p.flags=d&-65537|128,p):null;case 19:return Je(yi),null;case 4:return kl(),null;case 10:return Ui(p.type._context),null;case 22:case 23:return sc(),null;case 24:return null;default:return null}}var kr=!1,lr=!1,al=typeof WeakSet=="function"?WeakSet:Set,It=null;function Ds(d,p){var M=d.ref;if(M!==null)if(typeof M=="function")try{M(null)}catch(b){Br(d,p,b)}else M.current=null}function Wa(d,p,M){try{M()}catch(b){Br(d,p,b)}}var yd=!1;function _d(d,p){for(ie(d.containerInfo),It=p;It!==null;)if(d=It,p=d.child,(d.subtreeFlags&1028)!==0&&p!==null)p.return=d,It=p;else for(;It!==null;){d=It;try{var M=d.alternate;if((d.flags&1024)!==0)switch(d.tag){case 0:case 11:case 15:break;case 1:if(M!==null){var b=M.memoizedProps,I=M.memoizedState,G=d.stateNode,ce=G.getSnapshotBeforeUpdate(d.elementType===d.type?b:nr(d.type,b),I);G.__reactInternalSnapshotBeforeUpdate=ce}break;case 3:Ke&&Pt(d.stateNode.containerInfo);break;case 5:case 6:case 4:case 17:break;default:throw Error(a(163))}}catch(be){Br(d,d.return,be)}if(p=d.sibling,p!==null){p.return=d.return,It=p;break}It=d.return}return M=yd,yd=!1,M}function ja(d,p,M){var b=p.updateQueue;if(b=b!==null?b.lastEffect:null,b!==null){var I=b=b.next;do{if((I.tag&d)===d){var G=I.destroy;I.destroy=void 0,G!==void 0&&Wa(p,M,G)}I=I.next}while(I!==b)}}function pr(d,p){if(p=p.updateQueue,p=p!==null?p.lastEffect:null,p!==null){var M=p=p.next;do{if((M.tag&d)===d){var b=M.create;M.destroy=b()}M=M.next}while(M!==p)}}function zr(d){var p=d.ref;if(p!==null){var M=d.stateNode;switch(d.tag){case 5:d=ne(M);break;default:d=M}typeof p=="function"?p(d):p.current=d}}function si(d,p,M){if(os&&typeof os.onCommitFiberUnmount=="function")try{os.onCommitFiberUnmount(go,p)}catch{}switch(p.tag){case 0:case 11:case 14:case 15:if(d=p.updateQueue,d!==null&&(d=d.lastEffect,d!==null)){var b=d=d.next;do{var I=b,G=I.destroy;I=I.tag,G!==void 0&&((I&2)!==0||(I&4)!==0)&&Wa(p,M,G),b=b.next}while(b!==d)}break;case 1:if(Ds(p,M),d=p.stateNode,typeof d.componentWillUnmount=="function")try{d.props=p.memoizedProps,d.state=p.memoizedState,d.componentWillUnmount()}catch(ce){Br(p,M,ce)}break;case 5:Ds(p,M);break;case 4:Ke?Md(d,p,M):Qe&&Qe&&(p=p.stateNode.containerInfo,M=ke(p),zt(p,M))}}function Us(d,p,M){for(var b=p;;)if(si(d,b,M),b.child===null||Ke&&b.tag===4){if(b===p)break;for(;b.sibling===null;){if(b.return===null||b.return===p)return;b=b.return}b.sibling.return=b.return,b=b.sibling}else b.child.return=b,b=b.child}function xd(d){var p=d.alternate;p!==null&&(d.alternate=null,xd(p)),d.child=null,d.deletions=null,d.sibling=null,d.tag===5&&(p=d.stateNode,p!==null&&it(p)),d.stateNode=null,d.return=null,d.dependencies=null,d.memoizedProps=null,d.memoizedState=null,d.pendingProps=null,d.stateNode=null,d.updateQueue=null}function Sd(d){return d.tag===5||d.tag===3||d.tag===4}function Ih(d){e:for(;;){for(;d.sibling===null;){if(d.return===null||Sd(d.return))return null;d=d.return}for(d.sibling.return=d.return,d=d.sibling;d.tag!==5&&d.tag!==6&&d.tag!==18;){if(d.flags&2||d.child===null||d.tag===4)continue e;d.child.return=d,d=d.child}if(!(d.flags&2))return d.stateNode}}function Lh(d){if(Ke){e:{for(var p=d.return;p!==null;){if(Sd(p))break e;p=p.return}throw Error(a(160))}var M=p;switch(M.tag){case 5:p=M.stateNode,M.flags&32&&(st(p),M.flags&=-33),M=Ih(d),jl(d,M,p);break;case 3:case 4:p=M.stateNode.containerInfo,M=Ih(d),Nh(d,M,p);break;default:throw Error(a(161))}}}function Nh(d,p,M){var b=d.tag;if(b===5||b===6)d=d.stateNode,p?Xe(M,d,p):ot(M,d);else if(b!==4&&(d=d.child,d!==null))for(Nh(d,p,M),d=d.sibling;d!==null;)Nh(d,p,M),d=d.sibling}function jl(d,p,M){var b=d.tag;if(b===5||b===6)d=d.stateNode,p?Ge(M,d,p):Te(M,d);else if(b!==4&&(d=d.child,d!==null))for(jl(d,p,M),d=d.sibling;d!==null;)jl(d,p,M),d=d.sibling}function Md(d,p,M){for(var b=p,I=!1,G,ce;;){if(!I){I=b.return;e:for(;;){if(I===null)throw Error(a(160));switch(G=I.stateNode,I.tag){case 5:ce=!1;break e;case 3:G=G.containerInfo,ce=!0;break e;case 4:G=G.containerInfo,ce=!0;break e}I=I.return}I=!0}if(b.tag===5||b.tag===6)Us(d,b,M),ce?gt(G,b.stateNode):nt(G,b.stateNode);else if(b.tag===18)ce?vt(G,b.stateNode):Mt(G,b.stateNode);else if(b.tag===4){if(b.child!==null){G=b.stateNode.containerInfo,ce=!0,b.child.return=b,b=b.child;continue}}else if(si(d,b,M),b.child!==null){b.child.return=b,b=b.child;continue}if(b===p)break;for(;b.sibling===null;){if(b.return===null||b.return===p)return;b=b.return,b.tag===4&&(I=!1)}b.sibling.return=b.return,b=b.sibling}}function Ao(d,p){if(Ke){switch(p.tag){case 0:case 11:case 14:case 15:ja(3,p,p.return),pr(3,p),ja(5,p,p.return);return;case 1:return;case 5:var M=p.stateNode;if(M!=null){var b=p.memoizedProps;d=d!==null?d.memoizedProps:b;var I=p.type,G=p.updateQueue;p.updateQueue=null,G!==null&&Rt(M,G,I,d,b,p)}return;case 6:if(p.stateNode===null)throw Error(a(162));M=p.memoizedProps,rt(p.stateNode,d!==null?d.memoizedProps:M,M);return;case 3:pt&&d!==null&&d.memoizedState.isDehydrated&&qe(p.stateNode.containerInfo);return;case 12:return;case 13:Xl(p);return;case 19:Xl(p);return;case 17:return}throw Error(a(163))}switch(p.tag){case 0:case 11:case 14:case 15:ja(3,p,p.return),pr(3,p),ja(5,p,p.return);return;case 12:return;case 13:Xl(p);return;case 19:Xl(p);return;case 3:pt&&d!==null&&d.memoizedState.isDehydrated&&qe(p.stateNode.containerInfo);break;case 22:case 23:return}e:if(Qe){switch(p.tag){case 1:case 5:case 6:break e;case 3:case 4:p=p.stateNode,zt(p.containerInfo,p.pendingChildren);break e}throw Error(a(163))}}function Xl(d){var p=d.updateQueue;if(p!==null){d.updateQueue=null;var M=d.stateNode;M===null&&(M=d.stateNode=new al),p.forEach(function(b){var I=z0.bind(null,d,b);M.has(b)||(M.add(b),b.then(I,I))})}}function x1(d,p){for(It=p;It!==null;){p=It;var M=p.deletions;if(M!==null)for(var b=0;b<M.length;b++){var I=M[b];try{var G=d;Ke?Md(G,I,p):Us(G,I,p);var ce=I.alternate;ce!==null&&(ce.return=null),I.return=null}catch(sn){Br(I,p,sn)}}if(M=p.child,(p.subtreeFlags&12854)!==0&&M!==null)M.return=p,It=M;else for(;It!==null;){p=It;try{var be=p.flags;if(be&32&&Ke&&st(p.stateNode),be&512){var $e=p.alternate;if($e!==null){var bt=$e.ref;bt!==null&&(typeof bt=="function"?bt(null):bt.current=null)}}if(be&8192)switch(p.tag){case 13:if(p.memoizedState!==null){var Zt=p.alternate;(Zt===null||Zt.memoizedState===null)&&(nc=ci())}break;case 22:var Mn=p.memoizedState!==null,hn=p.alternate,Cn=hn!==null&&hn.memoizedState!==null;if(M=p,Ke){e:if(b=M,I=Mn,G=null,Ke)for(var Wt=b;;){if(Wt.tag===5){if(G===null){G=Wt;var vr=Wt.stateNode;I?Ot(vr):Ee(Wt.stateNode,Wt.memoizedProps)}}else if(Wt.tag===6){if(G===null){var gs=Wt.stateNode;I?pe(gs):et(gs,Wt.memoizedProps)}}else if((Wt.tag!==22&&Wt.tag!==23||Wt.memoizedState===null||Wt===b)&&Wt.child!==null){Wt.child.return=Wt,Wt=Wt.child;continue}if(Wt===b)break;for(;Wt.sibling===null;){if(Wt.return===null||Wt.return===b)break e;G===Wt&&(G=null),Wt=Wt.return}G===Wt&&(G=null),Wt.sibling.return=Wt.return,Wt=Wt.sibling}}if(Mn&&!Cn&&(M.mode&1)!==0){It=M;for(var Oe=M.child;Oe!==null;){for(M=It=Oe;It!==null;){b=It;var Ae=b.child;switch(b.tag){case 0:case 11:case 14:case 15:ja(4,b,b.return);break;case 1:Ds(b,b.return);var Ze=b.stateNode;if(typeof Ze.componentWillUnmount=="function"){var Bt=b.return;try{Ze.props=b.memoizedProps,Ze.state=b.memoizedState,Ze.componentWillUnmount()}catch(sn){Br(b,Bt,sn)}}break;case 5:Ds(b,b.return);break;case 22:if(b.memoizedState!==null){Ed(M);continue}}Ae!==null?(Ae.return=b,It=Ae):Ed(M)}Oe=Oe.sibling}}}switch(be&4102){case 2:Lh(p),p.flags&=-3;break;case 6:Lh(p),p.flags&=-3,Ao(p.alternate,p);break;case 4096:p.flags&=-4097;break;case 4100:p.flags&=-4097,Ao(p.alternate,p);break;case 4:Ao(p.alternate,p)}}catch(sn){Br(p,p.return,sn)}if(M=p.sibling,M!==null){M.return=p.return,It=M;break}It=p.return}}}function Ju(d,p,M){It=d,Ku(d)}function Ku(d,p,M){for(var b=(d.mode&1)!==0;It!==null;){var I=It,G=I.child;if(I.tag===22&&b){var ce=I.memoizedState!==null||kr;if(!ce){var be=I.alternate,$e=be!==null&&be.memoizedState!==null||lr;be=kr;var bt=lr;if(kr=ce,(lr=$e)&&!bt)for(It=I;It!==null;)ce=It,$e=ce.child,ce.tag===22&&ce.memoizedState!==null?ol(I):$e!==null?($e.return=ce,It=$e):ol(I);for(;G!==null;)It=G,Ku(G),G=G.sibling;It=I,kr=be,lr=bt}wd(d)}else(I.subtreeFlags&8772)!==0&&G!==null?(G.return=I,It=G):wd(d)}}function wd(d){for(;It!==null;){var p=It;if((p.flags&8772)!==0){var M=p.alternate;try{if((p.flags&8772)!==0)switch(p.tag){case 0:case 11:case 15:lr||pr(5,p);break;case 1:var b=p.stateNode;if(p.flags&4&&!lr)if(M===null)b.componentDidMount();else{var I=p.elementType===p.type?M.memoizedProps:nr(p.type,M.memoizedProps);b.componentDidUpdate(I,M.memoizedState,b.__reactInternalSnapshotBeforeUpdate)}var G=p.updateQueue;G!==null&&S0(p,G,b);break;case 3:var ce=p.updateQueue;if(ce!==null){if(M=null,p.child!==null)switch(p.child.tag){case 5:M=ne(p.child.stateNode);break;case 1:M=p.child.stateNode}S0(p,ce,M)}break;case 5:var be=p.stateNode;M===null&&p.flags&4&&mt(be,p.type,p.memoizedProps,p);break;case 6:break;case 4:break;case 12:break;case 13:if(pt&&p.memoizedState===null){var $e=p.alternate;if($e!==null){var bt=$e.memoizedState;if(bt!==null){var Zt=bt.dehydrated;Zt!==null&&Ye(Zt)}}}break;case 19:case 17:case 21:case 22:case 23:break;default:throw Error(a(163))}lr||p.flags&512&&zr(p)}catch(Mn){Br(p,p.return,Mn)}}if(p===d){It=null;break}if(M=p.sibling,M!==null){M.return=p.return,It=M;break}It=p.return}}function Ed(d){for(;It!==null;){var p=It;if(p===d){It=null;break}var M=p.sibling;if(M!==null){M.return=p.return,It=M;break}It=p.return}}function ol(d){for(;It!==null;){var p=It;try{switch(p.tag){case 0:case 11:case 15:var M=p.return;try{pr(4,p)}catch($e){Br(p,M,$e)}break;case 1:var b=p.stateNode;if(typeof b.componentDidMount=="function"){var I=p.return;try{b.componentDidMount()}catch($e){Br(p,I,$e)}}var G=p.return;try{zr(p)}catch($e){Br(p,G,$e)}break;case 5:var ce=p.return;try{zr(p)}catch($e){Br(p,ce,$e)}}}catch($e){Br(p,p.return,$e)}if(p===d){It=null;break}var be=p.sibling;if(be!==null){be.return=p.return,It=be;break}It=p.return}}var Qu=0,ll=1,ul=2,Xa=3,ql=4;if(typeof Symbol=="function"&&Symbol.for){var cl=Symbol.for;Qu=cl("selector.component"),ll=cl("selector.has_pseudo_class"),ul=cl("selector.role"),Xa=cl("selector.test_id"),ql=cl("selector.text")}function $u(d){var p=Ne(d);if(p!=null){if(typeof p.memoizedProps["data-testname"]!="string")throw Error(a(364));return p}if(d=Ce(d),d===null)throw Error(a(362));return d.stateNode.current}function ec(d,p){switch(p.$$typeof){case Qu:if(d.type===p.value)return!0;break;case ll:e:{p=p.value,d=[d,0];for(var M=0;M<d.length;){var b=d[M++],I=d[M++],G=p[I];if(b.tag!==5||!B(b)){for(;G!=null&&ec(b,G);)I++,G=p[I];if(I===p.length){p=!0;break e}else for(b=b.child;b!==null;)d.push(b,I),b=b.sibling}}p=!1}return p;case ul:if(d.tag===5&&ue(d.stateNode,p.value))return!0;break;case ql:if((d.tag===5||d.tag===6)&&(d=q(d),d!==null&&0<=d.indexOf(p.value)))return!0;break;case Xa:if(d.tag===5&&(d=d.memoizedProps["data-testname"],typeof d=="string"&&d.toLowerCase()===p.value.toLowerCase()))return!0;break;default:throw Error(a(365))}return!1}function Co(d){switch(d.$$typeof){case Qu:return"<"+(F(d.value)||"Unknown")+">";case ll:return":has("+(Co(d)||"")+")";case ul:return'[role="'+d.value+'"]';case ql:return'"'+d.value+'"';case Xa:return'[data-testname="'+d.value+'"]';default:throw Error(a(365))}}function fs(d,p){var M=[];d=[d,0];for(var b=0;b<d.length;){var I=d[b++],G=d[b++],ce=p[G];if(I.tag!==5||!B(I)){for(;ce!=null&&ec(I,ce);)G++,ce=p[G];if(G===p.length)M.push(I);else for(I=I.child;I!==null;)d.push(I,G),I=I.sibling}}return M}function qa(d,p){if(!je)throw Error(a(363));d=$u(d),d=fs(d,p),p=[],d=Array.from(d);for(var M=0;M<d.length;){var b=d[M++];if(b.tag===5)B(b)||p.push(b.stateNode);else for(b=b.child;b!==null;)d.push(b),b=b.sibling}return p}var Td=Math.ceil,tc=o.ReactCurrentDispatcher,ea=o.ReactCurrentOwner,Xn=o.ReactCurrentBatchConfig,An=0,Ii=null,qn=null,fi=0,Er=0,hl=ut(0),Ei=0,Yl=null,va=0,ds=0,fl=0,Ya=null,Fi=null,nc=0,Po=1/0;function dl(){Po=ci()+500}var Zl=!1,ai=null,ta=null,Jl=!1,ya=null,pl=0,ml=0,Za=null,ii=-1,Ti=0;function Bn(){return(An&6)!==0?ci():ii!==-1?ii:ii=ci()}function na(d){return(d.mode&1)===0?1:(An&2)!==0&&fi!==0?fi&-fi:_o.transition!==null?(Ti===0&&(d=Ln,Ln<<=1,(Ln&4194240)===0&&(Ln=64),Ti=d),Ti):(d=yn,d!==0?d:De())}function Tr(d,p,M){if(50<ml)throw ml=0,Za=null,Error(a(185));var b=Ro(d,p);return b===null?null:(As(b,p,M),((An&2)===0||b!==Ii)&&(b===Ii&&((An&2)===0&&(ds|=p),Ei===4&&gr(b,fi)),Kr(b,M),p===1&&An===0&&(d.mode&1)===0&&(dl(),da&&Mr())),b)}function Ro(d,p){d.lanes|=p;var M=d.alternate;for(M!==null&&(M.lanes|=p),M=d,d=d.return;d!==null;)d.childLanes|=p,M=d.alternate,M!==null&&(M.childLanes|=p),M=d,d=d.return;return M.tag===3?M.stateNode:null}function Kr(d,p){var M=d.callbackNode;ha(d,p);var b=ui(d,d===Ii?fi:0);if(b===0)M!==null&&fa(M),d.callbackNode=null,d.callbackPriority=0;else if(p=b&-b,d.callbackPriority!==p){if(M!=null&&fa(M),p===1)d.tag===0?yo(ps.bind(null,d)):Xo(ps.bind(null,d)),Q?at(function(){An===0&&Mr()}):as(Zs,Mr),M=null;else{switch(Cs(b)){case 1:M=Zs;break;case 4:M=ih;break;case 16:M=Sr;break;case 536870912:M=mo;break;default:M=Sr}M=Uh(M,mr.bind(null,d))}d.callbackPriority=p,d.callbackNode=M}}function mr(d,p){if(ii=-1,Ti=0,(An&6)!==0)throw Error(a(327));var M=d.callbackNode;if(_a()&&d.callbackNode!==M)return null;var b=ui(d,d===Ii?fi:0);if(b===0)return null;if((b&30)!==0||(b&d.expiredLanes)!==0||p)p=ac(d,b);else{p=b;var I=An;An|=2;var G=Cd();(Ii!==d||fi!==p)&&(dl(),Ja(d,p));do try{F0();break}catch(be){Ad(d,be)}while(!0);ir(),tc.current=G,An=I,qn!==null?p=0:(Ii=null,fi=0,p=Ei)}if(p!==0){if(p===2&&(I=$i(d),I!==0&&(b=I,p=ic(d,I))),p===1)throw M=Yl,Ja(d,0),gr(d,b),Kr(d,ci()),M;if(p===6)gr(d,b);else{if(I=d.current.alternate,(b&30)===0&&!bd(I)&&(p=ac(d,b),p===2&&(G=$i(d),G!==0&&(b=G,p=ic(d,G))),p===1))throw M=Yl,Ja(d,0),gr(d,b),Kr(d,ci()),M;switch(d.finishedWork=I,d.finishedLanes=b,p){case 0:case 1:throw Error(a(345));case 2:ia(d,Fi);break;case 3:if(gr(d,b),(b&130023424)===b&&(p=nc+500-ci(),10<p)){if(ui(d,0)!==0)break;if(I=d.suspendedLanes,(I&b)!==b){Bn(),d.pingedLanes|=d.suspendedLanes&I;break}d.timeoutHandle=he(ia.bind(null,d,Fi),p);break}ia(d,Fi);break;case 4:if(gr(d,b),(b&4194240)===b)break;for(p=d.eventTimes,I=-1;0<b;){var ce=31-bn(b);G=1<<ce,ce=p[ce],ce>I&&(I=ce),b&=~G}if(b=I,b=ci()-b,b=(120>b?120:480>b?480:1080>b?1080:1920>b?1920:3e3>b?3e3:4320>b?4320:1960*Td(b/1960))-b,10<b){d.timeoutHandle=he(ia.bind(null,d,Fi),b);break}ia(d,Fi);break;case 5:ia(d,Fi);break;default:throw Error(a(329))}}}return Kr(d,ci()),d.callbackNode===M?mr.bind(null,d):null}function ic(d,p){var M=Ya;return d.current.memoizedState.isDehydrated&&(Ja(d,p).flags|=256),d=ac(d,p),d!==2&&(p=Fi,Fi=M,p!==null&&rc(p)),d}function rc(d){Fi===null?Fi=d:Fi.push.apply(Fi,d)}function bd(d){for(var p=d;;){if(p.flags&16384){var M=p.updateQueue;if(M!==null&&(M=M.stores,M!==null))for(var b=0;b<M.length;b++){var I=M[b],G=I.getSnapshot;I=I.value;try{if(!er(G(),I))return!1}catch{return!1}}}if(M=p.child,p.subtreeFlags&16384&&M!==null)M.return=p,p=M;else{if(p===d)break;for(;p.sibling===null;){if(p.return===null||p.return===d)return!0;p=p.return}p.sibling.return=p.return,p=p.sibling}}return!0}function gr(d,p){for(p&=~fl,p&=~ds,d.suspendedLanes|=p,d.pingedLanes&=~p,d=d.expirationTimes;0<p;){var M=31-bn(p),b=1<<M;d[M]=-1,p&=~b}}function ps(d){if((An&6)!==0)throw Error(a(327));_a();var p=ui(d,0);if((p&1)===0)return Kr(d,ci()),null;var M=ac(d,p);if(d.tag!==0&&M===2){var b=$i(d);b!==0&&(p=b,M=ic(d,b))}if(M===1)throw M=Yl,Ja(d,0),gr(d,p),Kr(d,ci()),M;if(M===6)throw Error(a(345));return d.finishedWork=d.current.alternate,d.finishedLanes=p,ia(d,Fi),Kr(d,ci()),null}function Kl(d){ya!==null&&ya.tag===0&&(An&6)===0&&_a();var p=An;An|=1;var M=Xn.transition,b=yn;try{if(Xn.transition=null,yn=1,d)return d()}finally{yn=b,Xn.transition=M,An=p,(An&6)===0&&Mr()}}function sc(){Er=hl.current,Je(hl)}function Ja(d,p){d.finishedWork=null,d.finishedLanes=0;var M=d.timeoutHandle;if(M!==ze&&(d.timeoutHandle=ze,ye(M)),qn!==null)for(M=qn.return;M!==null;){var b=M;switch(td(b),b.tag){case 1:b=b.type.childContextTypes,b!=null&&fn();break;case 3:kl(),Je(St),Je(Nt),Ko();break;case 5:rd(b);break;case 4:kl();break;case 13:Je(yi);break;case 19:Je(yi);break;case 10:Ui(b.type._context);break;case 22:case 23:sc()}M=M.return}if(Ii=d,qn=d=Ka(d.current,null),fi=Er=p,Ei=0,Yl=null,fl=ds=va=0,Fi=Ya=null,Ur!==null){for(p=0;p<Ur.length;p++)if(M=Ur[p],b=M.interleaved,b!==null){M.interleaved=null;var I=b.next,G=M.pending;if(G!==null){var ce=G.next;G.next=I,b.next=ce}M.pending=b}Ur=null}return d}function Ad(d,p){do{var M=qn;try{if(ir(),Ou.current=Hl,ph){for(var b=_i.memoizedState;b!==null;){var I=b.queue;I!==null&&(I.pending=null),b=b.next}ph=!1}if(Qo=0,sr=rr=_i=null,pa=!1,$o=0,ea.current=null,M===null||M.return===null){Ei=1,Yl=p,qn=null;break}e:{var G=d,ce=M.return,be=M,$e=p;if(p=fi,be.flags|=32768,$e!==null&&typeof $e=="object"&&typeof $e.then=="function"){var bt=$e,Zt=be,Mn=Zt.tag;if((Zt.mode&1)===0&&(Mn===0||Mn===11||Mn===15)){var hn=Zt.alternate;hn?(Zt.updateQueue=hn.updateQueue,Zt.memoizedState=hn.memoizedState,Zt.lanes=hn.lanes):(Zt.updateQueue=null,Zt.memoizedState=null)}var Cn=pd(ce);if(Cn!==null){Cn.flags&=-257,tl(Cn,ce,be,G,p),Cn.mode&1&&Ba(G,bt,p),p=Cn,$e=bt;var Wt=p.updateQueue;if(Wt===null){var vr=new Set;vr.add($e),p.updateQueue=vr}else Wt.add($e);break e}else{if((p&1)===0){Ba(G,bt,p),Dh();break e}$e=Error(a(426))}}else if(hi&&be.mode&1){var gs=pd(ce);if(gs!==null){(gs.flags&65536)===0&&(gs.flags|=256),tl(gs,ce,be,G,p),hh($e);break e}}G=$e,Ei!==4&&(Ei=2),Ya===null?Ya=[G]:Ya.push(G),$e=dd($e,be),be=ce;do{switch(be.tag){case 3:be.flags|=65536,p&=-p,be.lanes|=p;var Oe=N0(be,$e,p);sh(be,Oe);break e;case 1:G=$e;var Ae=be.type,Ze=be.stateNode;if((be.flags&128)===0&&(typeof Ae.getDerivedStateFromError=="function"||Ze!==null&&typeof Ze.componentDidCatch=="function"&&(ta===null||!ta.has(Ze)))){be.flags|=65536,p&=-p,be.lanes|=p;var Bt=Eh(be,G,p);sh(be,Bt);break e}}be=be.return}while(be!==null)}Rd(M)}catch(sn){p=sn,qn===M&&M!==null&&(qn=M=M.return);continue}break}while(!0)}function Cd(){var d=tc.current;return tc.current=Hl,d===null?Hl:d}function Dh(){(Ei===0||Ei===3||Ei===2)&&(Ei=4),Ii===null||(va&268435455)===0&&(ds&268435455)===0||gr(Ii,fi)}function ac(d,p){var M=An;An|=2;var b=Cd();Ii===d&&fi===p||Ja(d,p);do try{U0();break}catch(I){Ad(d,I)}while(!0);if(ir(),An=M,tc.current=b,qn!==null)throw Error(a(261));return Ii=null,fi=0,Ei}function U0(){for(;qn!==null;)Pd(qn)}function F0(){for(;qn!==null&&!Ps();)Pd(qn)}function Pd(d){var p=Nd(d.alternate,d,Er);d.memoizedProps=d.pendingProps,p===null?Rd(d):qn=p,ea.current=null}function Rd(d){var p=d;do{var M=p.alternate;if(d=p.return,(p.flags&32768)===0){if(M=Ah(M,p,Er),M!==null){qn=M;return}}else{if(M=Rh(M,p),M!==null){M.flags&=32767,qn=M;return}if(d!==null)d.flags|=32768,d.subtreeFlags=0,d.deletions=null;else{Ei=6,qn=null;return}}if(p=p.sibling,p!==null){qn=p;return}qn=p=d}while(p!==null);Ei===0&&(Ei=5)}function ia(d,p){var M=yn,b=Xn.transition;try{Xn.transition=null,yn=1,O0(d,p,M)}finally{Xn.transition=b,yn=M}return null}function O0(d,p,M){do _a();while(ya!==null);if((An&6)!==0)throw Error(a(327));var b=d.finishedWork,I=d.finishedLanes;if(b===null)return null;if(d.finishedWork=null,d.finishedLanes=0,b===d.current)throw Error(a(177));d.callbackNode=null,d.callbackPriority=0;var G=b.lanes|b.childLanes;if(Ys(d,G),d===Ii&&(qn=Ii=null,fi=0),(b.subtreeFlags&2064)===0&&(b.flags&2064)===0||Jl||(Jl=!0,Uh(Sr,function(){return _a(),null})),G=(b.flags&15990)!==0,(b.subtreeFlags&15990)!==0||G){G=Xn.transition,Xn.transition=null;var ce=yn;yn=1;var be=An;An|=4,ea.current=null,_d(d,b),x1(d,b),Y(d.containerInfo),d.current=b,Ju(b),nh(),An=be,yn=ce,Xn.transition=G}else d.current=b;if(Jl&&(Jl=!1,ya=d,pl=I),G=d.pendingLanes,G===0&&(ta=null),Ra(b.stateNode),Kr(d,ci()),p!==null)for(M=d.onRecoverableError,b=0;b<p.length;b++)M(p[b]);if(Zl)throw Zl=!1,d=ai,ai=null,d;return(pl&1)!==0&&d.tag!==0&&_a(),G=d.pendingLanes,(G&1)!==0?d===Za?ml++:(ml=0,Za=d):ml=0,Mr(),null}function _a(){if(ya!==null){var d=Cs(pl),p=Xn.transition,M=yn;try{if(Xn.transition=null,yn=16>d?16:d,ya===null)var b=!1;else{if(d=ya,ya=null,pl=0,(An&6)!==0)throw Error(a(331));var I=An;for(An|=4,It=d.current;It!==null;){var G=It,ce=G.child;if((It.flags&16)!==0){var be=G.deletions;if(be!==null){for(var $e=0;$e<be.length;$e++){var bt=be[$e];for(It=bt;It!==null;){var Zt=It;switch(Zt.tag){case 0:case 11:case 15:ja(8,Zt,G)}var Mn=Zt.child;if(Mn!==null)Mn.return=Zt,It=Mn;else for(;It!==null;){Zt=It;var hn=Zt.sibling,Cn=Zt.return;if(xd(Zt),Zt===bt){It=null;break}if(hn!==null){hn.return=Cn,It=hn;break}It=Cn}}}var Wt=G.alternate;if(Wt!==null){var vr=Wt.child;if(vr!==null){Wt.child=null;do{var gs=vr.sibling;vr.sibling=null,vr=gs}while(vr!==null)}}It=G}}if((G.subtreeFlags&2064)!==0&&ce!==null)ce.return=G,It=ce;else e:for(;It!==null;){if(G=It,(G.flags&2048)!==0)switch(G.tag){case 0:case 11:case 15:ja(9,G,G.return)}var Oe=G.sibling;if(Oe!==null){Oe.return=G.return,It=Oe;break e}It=G.return}}var Ae=d.current;for(It=Ae;It!==null;){ce=It;var Ze=ce.child;if((ce.subtreeFlags&2064)!==0&&Ze!==null)Ze.return=ce,It=Ze;else e:for(ce=Ae;It!==null;){if(be=It,(be.flags&2048)!==0)try{switch(be.tag){case 0:case 11:case 15:pr(9,be)}}catch(sn){Br(be,be.return,sn)}if(be===ce){It=null;break e}var Bt=be.sibling;if(Bt!==null){Bt.return=be.return,It=Bt;break e}It=be.return}}if(An=I,Mr(),os&&typeof os.onPostCommitFiberRoot=="function")try{os.onPostCommitFiberRoot(go,d)}catch{}b=!0}return b}finally{yn=M,Xn.transition=p}}return!1}function oc(d,p,M){p=dd(M,p),p=N0(d,p,1),xo(d,p),p=Bn(),d=Ro(d,1),d!==null&&(As(d,1,p),Kr(d,p))}function Br(d,p,M){if(d.tag===3)oc(d,d,M);else for(;p!==null;){if(p.tag===3){oc(p,d,M);break}else if(p.tag===1){var b=p.stateNode;if(typeof p.type.getDerivedStateFromError=="function"||typeof b.componentDidCatch=="function"&&(ta===null||!ta.has(b))){d=dd(M,d),d=Eh(p,d,1),xo(p,d),d=Bn(),p=Ro(p,1),p!==null&&(As(p,1,d),Kr(p,d));break}}p=p.return}}function Id(d,p,M){var b=d.pingCache;b!==null&&b.delete(p),p=Bn(),d.pingedLanes|=d.suspendedLanes&M,Ii===d&&(fi&M)===M&&(Ei===4||Ei===3&&(fi&130023424)===fi&&500>ci()-nc?Ja(d,0):fl|=M),Kr(d,p)}function Ld(d,p){p===0&&((d.mode&1)===0?p=1:(p=cn,cn<<=1,(cn&130023424)===0&&(cn=4194304)));var M=Bn();d=Ro(d,p),d!==null&&(As(d,p,M),Kr(d,M))}function k0(d){var p=d.memoizedState,M=0;p!==null&&(M=p.retryLane),Ld(d,M)}function z0(d,p){var M=0;switch(d.tag){case 13:var b=d.stateNode,I=d.memoizedState;I!==null&&(M=I.retryLane);break;case 19:b=d.stateNode;break;default:throw Error(a(314))}b!==null&&b.delete(p),Ld(d,M)}var Nd;Nd=function(d,p,M){if(d!==null)if(d.memoizedProps!==p.pendingProps||St.current)or=!0;else{if((d.lanes&M)===0&&(p.flags&128)===0)return or=!1,Ph(d,p,M);or=(d.flags&131072)!==0}else or=!1,hi&&(p.flags&1048576)!==0&&T0(p,uh,p.index);switch(p.lanes=0,p.tag){case 2:var b=p.type;d!==null&&(d.alternate=null,p.alternate=null,p.flags|=2),d=p.pendingProps;var I=un(p,Nt.current);Pi(p,M),I=zl(null,p,b,d,I,M);var G=Eo();return p.flags|=1,typeof I=="object"&&I!==null&&typeof I.render=="function"&&I.$$typeof===void 0?(p.tag=1,p.memoizedState=null,p.updateQueue=null,dn(b)?(G=!0,$t(p)):G=!1,p.memoizedState=I.state!==null&&I.state!==void 0?I.state:null,Il(p),I.updater=oh,p.stateNode=I,I._reactInternals=p,$f(p,b,d,M),p=wr(null,p,b,!0,G,M)):(p.tag=0,hi&&G&&ed(p),wi(null,p,I,M),p=p.child),p;case 16:b=p.elementType;e:{switch(d!==null&&(d.alternate=null,p.alternate=null,p.flags|=2),d=p.pendingProps,I=b._init,b=I(b._payload),p.type=b,I=p.tag=S1(b),d=nr(b,d),I){case 0:p=Ha(null,p,b,d,M);break e;case 1:p=il(null,p,b,d,M);break e;case 11:p=ni(null,p,b,d,M);break e;case 14:p=Qn(null,p,b,nr(b.type,d),M);break e}throw Error(a(306,b,""))}return p;case 0:return b=p.type,I=p.pendingProps,I=p.elementType===b?I:nr(b,I),Ha(d,p,b,I,M);case 1:return b=p.type,I=p.pendingProps,I=p.elementType===b?I:nr(b,I),il(d,p,b,I,M);case 3:e:{if(Xu(p),d===null)throw Error(a(387));b=p.pendingProps,G=p.memoizedState,I=G.element,Jf(d,p),ah(p,b,null,M);var ce=p.memoizedState;if(b=ce.element,pt&&G.isDehydrated)if(G={element:b,isDehydrated:!1,cache:ce.cache,transitions:ce.transitions},p.updateQueue.baseState=G,p.memoizedState=G,p.flags&256){I=Error(a(423)),p=gd(d,p,b,M,I);break e}else if(b!==I){I=Error(a(424)),p=gd(d,p,b,M,I);break e}else for(pt&&(fr=li(p.stateNode.containerInfo),Fr=p,hi=!0,Ns=null,Nl=!1),M=C0(p,null,b,M),p.child=M;M;)M.flags=M.flags&-3|4096,M=M.sibling;else{if(Dl(),b===I){p=Jr(d,p,M);break e}wi(d,p,b,M)}p=p.child}return p;case 5:return P0(p),d===null&&Mo(p),b=p.type,I=p.pendingProps,G=d!==null?d.memoizedProps:null,ce=I.children,ve(b,I)?ce=null:G!==null&&ve(b,G)&&(p.flags|=32),Or(d,p),wi(d,p,ce,M),p.child;case 6:return d===null&&Mo(p),null;case 13:return vd(d,p,M);case 4:return fh(p,p.stateNode.containerInfo),b=p.pendingProps,d===null?p.child=ka(p,null,b,M):wi(d,p,b,M),p.child;case 11:return b=p.type,I=p.pendingProps,I=p.elementType===b?I:nr(b,I),ni(d,p,b,I,M);case 7:return wi(d,p,p.pendingProps,M),p.child;case 8:return wi(d,p,p.pendingProps.children,M),p.child;case 12:return wi(d,p,p.pendingProps.children,M),p.child;case 10:e:{if(b=p.type._context,I=p.pendingProps,G=p.memoizedProps,ce=I.value,Da(p,b,ce),G!==null)if(er(G.value,ce)){if(G.children===I.children&&!St.current){p=Jr(d,p,M);break e}}else for(G=p.child,G!==null&&(G.return=p);G!==null;){var be=G.dependencies;if(be!==null){ce=G.child;for(var $e=be.firstContext;$e!==null;){if($e.context===b){if(G.tag===1){$e=Ua(-1,M&-M),$e.tag=2;var bt=G.updateQueue;if(bt!==null){bt=bt.shared;var Zt=bt.pending;Zt===null?$e.next=$e:($e.next=Zt.next,Zt.next=$e),bt.pending=$e}}G.lanes|=M,$e=G.alternate,$e!==null&&($e.lanes|=M),ji(G.return,M,p),be.lanes|=M;break}$e=$e.next}}else if(G.tag===10)ce=G.type===p.type?null:G.child;else if(G.tag===18){if(ce=G.return,ce===null)throw Error(a(341));ce.lanes|=M,be=ce.alternate,be!==null&&(be.lanes|=M),ji(ce,M,p),ce=G.sibling}else ce=G.child;if(ce!==null)ce.return=G;else for(ce=G;ce!==null;){if(ce===p){ce=null;break}if(G=ce.sibling,G!==null){G.return=ce.return,ce=G;break}ce=ce.return}G=ce}wi(d,p,I.children,M),p=p.child}return p;case 9:return I=p.type,b=p.pendingProps.children,Pi(p,M),I=vi(I),b=b(I),p.flags|=1,wi(d,p,b,M),p.child;case 14:return b=p.type,I=nr(b,p.pendingProps),I=nr(b.type,I),Qn(d,p,b,I,M);case 15:return Va(d,p,p.type,p.pendingProps,M);case 17:return b=p.type,I=p.pendingProps,I=p.elementType===b?I:nr(b,I),d!==null&&(d.alternate=null,p.alternate=null,p.flags|=2),p.tag=1,dn(b)?(d=!0,$t(p)):d=!1,Pi(p,M),w0(p,b,I),$f(p,b,I,M),wr(null,p,b,!0,d,M);case 19:return sl(d,p,M);case 22:return dr(d,p,M)}throw Error(a(156,p.tag))};function Uh(d,p){return as(d,p)}function B0(d,p,M,b){this.tag=d,this.key=M,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=p,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=b,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ms(d,p,M,b){return new B0(d,p,M,b)}function Fh(d){return d=d.prototype,!(!d||!d.isReactComponent)}function S1(d){if(typeof d=="function")return Fh(d)?1:0;if(d!=null){if(d=d.$$typeof,d===E)return 11;if(d===T)return 14}return 2}function Ka(d,p){var M=d.alternate;return M===null?(M=ms(d.tag,p,d.key,d.mode),M.elementType=d.elementType,M.type=d.type,M.stateNode=d.stateNode,M.alternate=d,d.alternate=M):(M.pendingProps=p,M.type=d.type,M.flags=0,M.subtreeFlags=0,M.deletions=null),M.flags=d.flags&14680064,M.childLanes=d.childLanes,M.lanes=d.lanes,M.child=d.child,M.memoizedProps=d.memoizedProps,M.memoizedState=d.memoizedState,M.updateQueue=d.updateQueue,p=d.dependencies,M.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext},M.sibling=d.sibling,M.index=d.index,M.ref=d.ref,M}function Oh(d,p,M,b,I,G){var ce=2;if(b=d,typeof d=="function")Fh(d)&&(ce=1);else if(typeof d=="string")ce=5;else e:switch(d){case f:return gl(M.children,I,G,p);case m:ce=8,I|=8;break;case g:return d=ms(12,M,p,I|2),d.elementType=g,d.lanes=G,d;case x:return d=ms(13,M,p,I),d.elementType=x,d.lanes=G,d;case S:return d=ms(19,M,p,I),d.elementType=S,d.lanes=G,d;case P:return lc(M,I,G,p);default:if(typeof d=="object"&&d!==null)switch(d.$$typeof){case y:ce=10;break e;case _:ce=9;break e;case E:ce=11;break e;case T:ce=14;break e;case A:ce=16,b=null;break e}throw Error(a(130,d==null?d:typeof d,""))}return p=ms(ce,M,p,I),p.elementType=d,p.type=b,p.lanes=G,p}function gl(d,p,M,b){return d=ms(7,d,b,p),d.lanes=M,d}function lc(d,p,M,b){return d=ms(22,d,b,p),d.elementType=P,d.lanes=M,d.stateNode={},d}function kh(d,p,M){return d=ms(6,d,null,p),d.lanes=M,d}function zh(d,p,M){return p=ms(4,d.children!==null?d.children:[],d.key,p),p.lanes=M,p.stateNode={containerInfo:d.containerInfo,pendingChildren:null,implementation:d.implementation},p}function Bh(d,p,M,b,I){this.tag=p,this.containerInfo=d,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=ze,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=jo(0),this.expirationTimes=jo(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=jo(0),this.identifierPrefix=b,this.onRecoverableError=I,pt&&(this.mutableSourceEagerHydrationData=null)}function G0(d,p,M,b,I,G,ce,be,$e){return d=new Bh(d,p,M,be,$e),p===1?(p=1,G===!0&&(p|=8)):p=0,G=ms(3,null,null,p),d.current=G,G.stateNode=d,G.memoizedState={element:b,isDehydrated:M,cache:null,transitions:null},Il(G),d}function V0(d){if(!d)return ft;d=d._reactInternals;e:{if(R(d)!==d||d.tag!==1)throw Error(a(170));var p=d;do{switch(p.tag){case 3:p=p.stateNode.context;break e;case 1:if(dn(p.type)){p=p.stateNode.__reactInternalMemoizedMergedChildContext;break e}}p=p.return}while(p!==null);throw Error(a(171))}if(d.tag===1){var M=d.type;if(dn(M))return Ut(d,M,p)}return p}function H0(d){var p=d._reactInternals;if(p===void 0)throw typeof d.render=="function"?Error(a(188)):(d=Object.keys(d).join(","),Error(a(268,d)));return d=H(p),d===null?null:d.stateNode}function Fs(d,p){if(d=d.memoizedState,d!==null&&d.dehydrated!==null){var M=d.retryLane;d.retryLane=M!==0&&M<p?M:p}}function uc(d,p){Fs(d,p),(d=d.alternate)&&Fs(d,p)}function Gh(d){return d=H(d),d===null?null:d.stateNode}function W0(){return null}return t.attemptContinuousHydration=function(d){if(d.tag===13){var p=Bn();Tr(d,134217728,p),uc(d,134217728)}},t.attemptHydrationAtCurrentPriority=function(d){if(d.tag===13){var p=Bn(),M=na(d);Tr(d,M,p),uc(d,M)}},t.attemptSynchronousHydration=function(d){switch(d.tag){case 3:var p=d.stateNode;if(p.current.memoizedState.isDehydrated){var M=gi(p.pendingLanes);M!==0&&(hr(p,M|1),Kr(p,ci()),(An&6)===0&&(dl(),Mr()))}break;case 13:var b=Bn();Kl(function(){return Tr(d,1,b)}),uc(d,1)}},t.batchedUpdates=function(d,p){var M=An;An|=1;try{return d(p)}finally{An=M,An===0&&(dl(),da&&Mr())}},t.createComponentSelector=function(d){return{$$typeof:Qu,value:d}},t.createContainer=function(d,p,M,b,I,G,ce){return G0(d,p,!1,null,M,b,I,G,ce)},t.createHasPseudoClassSelector=function(d){return{$$typeof:ll,value:d}},t.createHydrationContainer=function(d,p,M,b,I,G,ce,be,$e){return d=G0(M,b,!0,d,I,G,ce,be,$e),d.context=V0(null),M=d.current,b=Bn(),I=na(M),G=Ua(b,I),G.callback=p??null,xo(M,G),d.current.lanes=I,As(d,I,b),Kr(d,b),d},t.createPortal=function(d,p,M){var b=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:c,key:b==null?null:""+b,children:d,containerInfo:p,implementation:M}},t.createRoleSelector=function(d){return{$$typeof:ul,value:d}},t.createTestNameSelector=function(d){return{$$typeof:Xa,value:d}},t.createTextSelector=function(d){return{$$typeof:ql,value:d}},t.deferredUpdates=function(d){var p=yn,M=Xn.transition;try{return Xn.transition=null,yn=16,d()}finally{yn=p,Xn.transition=M}},t.discreteUpdates=function(d,p,M,b,I){var G=yn,ce=Xn.transition;try{return Xn.transition=null,yn=1,d(p,M,b,I)}finally{yn=G,Xn.transition=ce,An===0&&dl()}},t.findAllNodes=qa,t.findBoundingRects=function(d,p){if(!je)throw Error(a(363));p=qa(d,p),d=[];for(var M=0;M<p.length;M++)d.push(He(p[M]));for(p=d.length-1;0<p;p--){M=d[p];for(var b=M.x,I=b+M.width,G=M.y,ce=G+M.height,be=p-1;0<=be;be--)if(p!==be){var $e=d[be],bt=$e.x,Zt=bt+$e.width,Mn=$e.y,hn=Mn+$e.height;if(b>=bt&&G>=Mn&&I<=Zt&&ce<=hn){d.splice(p,1);break}else if(b!==bt||M.width!==$e.width||hn<G||Mn>ce){if(!(G!==Mn||M.height!==$e.height||Zt<b||bt>I)){bt>b&&($e.width+=bt-b,$e.x=b),Zt<I&&($e.width=I-bt),d.splice(p,1);break}}else{Mn>G&&($e.height+=Mn-G,$e.y=G),hn<ce&&($e.height=ce-Mn),d.splice(p,1);break}}}return d},t.findHostInstance=H0,t.findHostInstanceWithNoPortals=function(d){return d=V(d),d=d!==null?$(d):null,d===null?null:d.stateNode},t.findHostInstanceWithWarning=function(d){return H0(d)},t.flushControlled=function(d){var p=An;An|=1;var M=Xn.transition,b=yn;try{Xn.transition=null,yn=1,d()}finally{yn=b,Xn.transition=M,An=p,An===0&&(dl(),Mr())}},t.flushPassiveEffects=_a,t.flushSync=Kl,t.focusWithin=function(d,p){if(!je)throw Error(a(363));for(d=$u(d),p=fs(d,p),p=Array.from(p),d=0;d<p.length;){var M=p[d++];if(!B(M)){if(M.tag===5&&Re(M.stateNode))return!0;for(M=M.child;M!==null;)p.push(M),M=M.sibling}}return!1},t.getCurrentUpdatePriority=function(){return yn},t.getFindAllNodesFailureDescription=function(d,p){if(!je)throw Error(a(363));var M=0,b=[];d=[$u(d),0];for(var I=0;I<d.length;){var G=d[I++],ce=d[I++],be=p[ce];if((G.tag!==5||!B(G))&&(ec(G,be)&&(b.push(Co(be)),ce++,ce>M&&(M=ce)),ce<p.length))for(G=G.child;G!==null;)d.push(G,ce),G=G.sibling}if(M<p.length){for(d=[];M<p.length;M++)d.push(Co(p[M]));return`findAllNodes was able to match part of the selector:
  `+(b.join(" > ")+`

No matching component was found for:
  `)+d.join(" > ")}return null},t.getPublicRootInstance=function(d){if(d=d.current,!d.child)return null;switch(d.child.tag){case 5:return ne(d.child.stateNode);default:return d.child.stateNode}},t.injectIntoDevTools=function(d){if(d={bundleType:d.bundleType,version:d.version,rendererPackageName:d.rendererPackageName,rendererConfig:d.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:o.ReactCurrentDispatcher,findHostInstanceByFiber:Gh,findFiberByHostInstance:d.findFiberByHostInstance||W0,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.0.0-fc46dba67-20220329"},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")d=!1;else{var p=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(p.isDisabled||!p.supportsFiber)d=!0;else{try{go=p.inject(d),os=p}catch{}d=!!p.checkDCE}}return d},t.isAlreadyRendering=function(){return!1},t.observeVisibleRects=function(d,p,M,b){if(!je)throw Error(a(363));d=qa(d,p);var I=Pe(d,M,b).disconnect;return{disconnect:function(){I()}}},t.registerMutableSourceForHydration=function(d,p){var M=p._getVersion;M=M(p._source),d.mutableSourceEagerHydrationData==null?d.mutableSourceEagerHydrationData=[p,M]:d.mutableSourceEagerHydrationData.push(p,M)},t.runWithPriority=function(d,p){var M=yn;try{return yn=d,p()}finally{yn=M}},t.shouldError=function(){return null},t.shouldSuspend=function(){return!1},t.updateContainer=function(d,p,M,b){var I=p.current,G=Bn(),ce=na(I);return M=V0(M),p.context===null?p.context=M:p.pendingContext=M,p=Ua(G,ce),p.payload={element:d},b=b===void 0?null:b,b!==null&&(p.callback=b),xo(I,p),d=Tr(I,ce,G),d!==null&&rh(d,I,ce),ce},t}),Hy}var M2;function cN(){return M2||(M2=1,By.exports=uN()),By.exports}var hN=cN();const fN=Tw(hN);var w2=_3();const Nx={},x3=n=>void Object.assign(Nx,n);function dN(n,e){function t(f,{args:m=[],attach:g,...y},_){let E=`${f[0].toUpperCase()}${f.slice(1)}`,x;if(f==="primitive"){if(y.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const S=y.object;x=gf(S,{type:f,root:_,attach:g,primitive:!0})}else{const S=Nx[E];if(!S)throw new Error(`R3F: ${E} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(m))throw new Error("R3F: The args prop must be an array!");x=gf(new S(...m),{type:f,root:_,attach:g,memoizedProps:{args:m}})}return x.__r3f.attach===void 0&&(x.isBufferGeometry?x.__r3f.attach="geometry":x.isMaterial&&(x.__r3f.attach="material")),E!=="inject"&&Xy(x,y),x}function r(f,m){let g=!1;if(m){var y,_;(y=m.__r3f)!=null&&y.attach?jy(f,m,m.__r3f.attach):m.isObject3D&&f.isObject3D&&(f.add(m),g=!0),g||(_=f.__r3f)==null||_.objects.push(m),m.__r3f||gf(m,{}),m.__r3f.parent=f,A_(m),vf(m)}}function i(f,m,g){let y=!1;if(m){var _,E;if((_=m.__r3f)!=null&&_.attach)jy(f,m,m.__r3f.attach);else if(m.isObject3D&&f.isObject3D){m.parent=f,m.dispatchEvent({type:"added"}),f.dispatchEvent({type:"childadded",child:m});const x=f.children.filter(T=>T!==m),S=x.indexOf(g);f.children=[...x.slice(0,S),m,...x.slice(S)],y=!0}y||(E=f.__r3f)==null||E.objects.push(m),m.__r3f||gf(m,{}),m.__r3f.parent=f,A_(m),vf(m)}}function s(f,m,g=!1){f&&[...f].forEach(y=>a(m,y,g))}function a(f,m,g){if(m){var y,_,E;if(m.__r3f&&(m.__r3f.parent=null),(y=f.__r3f)!=null&&y.objects&&(f.__r3f.objects=f.__r3f.objects.filter(P=>P!==m)),(_=m.__r3f)!=null&&_.attach)C2(f,m,m.__r3f.attach);else if(m.isObject3D&&f.isObject3D){var x;f.remove(m),(x=m.__r3f)!=null&&x.root&&xN(yg(m),m)}const T=(E=m.__r3f)==null?void 0:E.primitive,A=!T&&(g===void 0?m.dispose!==null:g);if(!T){var S;s((S=m.__r3f)==null?void 0:S.objects,m,A),s(m.children,m,A)}if(delete m.__r3f,A&&m.dispose&&m.type!=="Scene"){const P=()=>{try{m.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?w2.unstable_scheduleCallback(w2.unstable_IdlePriority,P):P()}vf(f)}}function o(f,m,g,y){var _;const E=(_=f.__r3f)==null?void 0:_.parent;if(!E)return;const x=t(m,g,f.__r3f.root);if(f.children){for(const S of f.children)S.__r3f&&r(x,S);f.children=f.children.filter(S=>!S.__r3f)}f.__r3f.objects.forEach(S=>r(x,S)),f.__r3f.objects=[],f.__r3f.autoRemovedBeforeAppend||a(E,f),x.parent&&(x.__r3f.autoRemovedBeforeAppend=!0),r(E,x),x.raycast&&x.__r3f.eventCount&&yg(x).getState().internal.interaction.push(x),[y,y.alternate].forEach(S=>{S!==null&&(S.stateNode=x,S.ref&&(typeof S.ref=="function"?S.ref(x):S.ref.current=x))})}const u=()=>{};return{reconciler:fN({createInstance:t,removeChild:a,appendChild:r,appendInitialChild:r,insertBefore:i,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(f,m)=>{if(!m)return;const g=f.getState().scene;g.__r3f&&(g.__r3f.root=f,r(g,m))},removeChildFromContainer:(f,m)=>{m&&a(f.getState().scene,m)},insertInContainerBefore:(f,m,g)=>{if(!m||!g)return;const y=f.getState().scene;y.__r3f&&i(y,m,g)},getRootHostContext:()=>null,getChildHostContext:f=>f,finalizeInitialChildren(f){var m;return!!((m=f?.__r3f)!=null?m:{}).handlers},prepareUpdate(f,m,g,y){var _;if(((_=f?.__r3f)!=null?_:{}).primitive&&y.object&&y.object!==f)return[!0];{const{args:x=[],children:S,...T}=y,{args:A=[],children:P,...L}=g;if(!Array.isArray(x))throw new Error("R3F: the args prop must be an array!");if(x.some((F,k)=>F!==A[k]))return[!0];const D=A3(f,T,L,!0);return D.changes.length?[!1,D]:null}},commitUpdate(f,[m,g],y,_,E,x){m?o(f,y,E,x):Xy(f,g)},commitMount(f,m,g,y){var _;const E=(_=f.__r3f)!=null?_:{};f.raycast&&E.handlers&&E.eventCount&&yg(f).getState().internal.interaction.push(f)},getPublicInstance:f=>f,prepareForCommit:()=>null,preparePortalMount:f=>gf(f.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(f){var m;const{attach:g,parent:y}=(m=f.__r3f)!=null?m:{};g&&y&&C2(y,f,g),f.isObject3D&&(f.visible=!1),vf(f)},unhideInstance(f,m){var g;const{attach:y,parent:_}=(g=f.__r3f)!=null?g:{};y&&_&&jy(_,f,y),(f.isObject3D&&m.visible==null||m.visible)&&(f.visible=!0),vf(f)},createTextInstance:u,hideTextInstance:u,unhideTextInstance:u,getCurrentEventPriority:()=>e?e():Mf.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&di.fun(performance.now)?performance.now:di.fun(Date.now)?Date.now:()=>0,scheduleTimeout:di.fun(setTimeout)?setTimeout:void 0,cancelTimeout:di.fun(clearTimeout)?clearTimeout:void 0}),applyProps:Xy}}var E2,T2;const Wy=n=>"colorSpace"in n||"outputColorSpace"in n,S3=()=>{var n;return(n=Nx.ColorManagement)!=null?n:null},M3=n=>n&&n.isOrthographicCamera,pN=n=>n&&n.hasOwnProperty("current"),p0=typeof window<"u"&&((E2=window.document)!=null&&E2.createElement||((T2=window.navigator)==null?void 0:T2.product)==="ReactNative")?se.useLayoutEffect:se.useEffect;function w3(n){const e=se.useRef(n);return p0(()=>void(e.current=n),[n]),e}function mN({set:n}){return p0(()=>(n(new Promise(()=>null)),()=>n(!1)),[n]),null}class E3 extends se.Component{constructor(...e){super(...e),this.state={error:!1}}componentDidCatch(e){this.props.set(e)}render(){return this.state.error?null:this.props.children}}E3.getDerivedStateFromError=()=>({error:!0});const T3="__default",b2=new Map,gN=n=>n&&!!n.memoized&&!!n.changes;function b3(n){var e;const t=typeof window<"u"?(e=window.devicePixelRatio)!=null?e:2:1;return Array.isArray(n)?Math.min(Math.max(n[0],t),n[1]):n}const tp=n=>{var e;return(e=n.__r3f)==null?void 0:e.root.getState()};function yg(n){let e=n.__r3f.root;for(;e.getState().previousRoot;)e=e.getState().previousRoot;return e}const di={obj:n=>n===Object(n)&&!di.arr(n)&&typeof n!="function",fun:n=>typeof n=="function",str:n=>typeof n=="string",num:n=>typeof n=="number",boo:n=>typeof n=="boolean",und:n=>n===void 0,arr:n=>Array.isArray(n),equ(n,e,{arrays:t="shallow",objects:r="reference",strict:i=!0}={}){if(typeof n!=typeof e||!!n!=!!e)return!1;if(di.str(n)||di.num(n)||di.boo(n))return n===e;const s=di.obj(n);if(s&&r==="reference")return n===e;const a=di.arr(n);if(a&&t==="reference")return n===e;if((a||s)&&n===e)return!0;let o;for(o in n)if(!(o in e))return!1;if(s&&t==="shallow"&&r==="shallow"){for(o in i?e:n)if(!di.equ(n[o],e[o],{strict:i,objects:"reference"}))return!1}else for(o in i?e:n)if(n[o]!==e[o])return!1;if(di.und(o)){if(a&&n.length===0&&e.length===0||s&&Object.keys(n).length===0&&Object.keys(e).length===0)return!0;if(n!==e)return!1}return!0}};function vN(n){const e={nodes:{},materials:{}};return n&&n.traverse(t=>{t.name&&(e.nodes[t.name]=t),t.material&&!e.materials[t.material.name]&&(e.materials[t.material.name]=t.material)}),e}function yN(n){n.dispose&&n.type!=="Scene"&&n.dispose();for(const e in n)e.dispose==null||e.dispose(),delete n[e]}function gf(n,e){const t=n;return t.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...e},n}function b_(n,e){let t=n;if(e.includes("-")){const r=e.split("-"),i=r.pop();return t=r.reduce((s,a)=>s[a],n),{target:t,key:i}}else return{target:t,key:e}}const A2=/-\d+$/;function jy(n,e,t){if(di.str(t)){if(A2.test(t)){const s=t.replace(A2,""),{target:a,key:o}=b_(n,s);Array.isArray(a[o])||(a[o]=[])}const{target:r,key:i}=b_(n,t);e.__r3f.previousAttach=r[i],r[i]=e}else e.__r3f.previousAttach=t(n,e)}function C2(n,e,t){var r,i;if(di.str(t)){const{target:s,key:a}=b_(n,t),o=e.__r3f.previousAttach;o===void 0?delete s[a]:s[a]=o}else(r=e.__r3f)==null||r.previousAttach==null||r.previousAttach(n,e);(i=e.__r3f)==null||delete i.previousAttach}function A3(n,{children:e,key:t,ref:r,...i},{children:s,key:a,ref:o,...u}={},c=!1){const f=n.__r3f,m=Object.entries(i),g=[];if(c){const _=Object.keys(u);for(let E=0;E<_.length;E++)i.hasOwnProperty(_[E])||m.unshift([_[E],T3+"remove"])}m.forEach(([_,E])=>{var x;if((x=n.__r3f)!=null&&x.primitive&&_==="object"||di.equ(E,u[_]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(_))return g.push([_,E,!0,[]]);let S=[];_.includes("-")&&(S=_.split("-")),g.push([_,E,!1,S]);for(const T in i){const A=i[T];T.startsWith(`${_}-`)&&g.push([T,A,!1,T.split("-")])}});const y={...i};return f!=null&&f.memoizedProps&&f!=null&&f.memoizedProps.args&&(y.args=f.memoizedProps.args),f!=null&&f.memoizedProps&&f!=null&&f.memoizedProps.attach&&(y.attach=f.memoizedProps.attach),{memoized:y,changes:g}}function Xy(n,e){var t;const r=n.__r3f,i=r?.root,s=i==null||i.getState==null?void 0:i.getState(),{memoized:a,changes:o}=gN(e)?e:A3(n,e),u=r?.eventCount;n.__r3f&&(n.__r3f.memoizedProps=a);for(let g=0;g<o.length;g++){let[y,_,E,x]=o[g];if(Wy(n)){const P="srgb",L="srgb-linear";y==="encoding"?(y="colorSpace",_=_===3001?P:L):y==="outputEncoding"&&(y="outputColorSpace",_=_===3001?P:L)}let S=n,T=S[y];if(x.length&&(T=x.reduce((A,P)=>A[P],n),!(T&&T.set))){const[A,...P]=x.reverse();S=P.reverse().reduce((L,D)=>L[D],n),y=A}if(_===T3+"remove")if(S.constructor){let A=b2.get(S.constructor);A||(A=new S.constructor,b2.set(S.constructor,A)),_=A[y]}else _=0;if(E&&r)_?r.handlers[y]=_:delete r.handlers[y],r.eventCount=Object.keys(r.handlers).length;else if(T&&T.set&&(T.copy||T instanceof Gc)){if(Array.isArray(_))T.fromArray?T.fromArray(_):T.set(..._);else if(T.copy&&_&&_.constructor&&T.constructor===_.constructor)T.copy(_);else if(_!==void 0){var c;const A=(c=T)==null?void 0:c.isColor;!A&&T.setScalar?T.setScalar(_):T instanceof Gc&&_ instanceof Gc?T.mask=_.mask:T.set(_),!S3()&&s&&!s.linear&&A&&T.convertSRGBToLinear()}}else{var f;if(S[y]=_,(f=S[y])!=null&&f.isTexture&&S[y].format===Ki&&S[y].type===Rr&&s){const A=S[y];Wy(A)&&Wy(s.gl)?A.colorSpace=s.gl.outputColorSpace:A.encoding=s.gl.outputEncoding}}vf(n)}if(r&&r.parent&&n.raycast&&u!==r.eventCount){const g=yg(n).getState().internal,y=g.interaction.indexOf(n);y>-1&&g.interaction.splice(y,1),r.eventCount&&g.interaction.push(n)}return!(o.length===1&&o[0][0]==="onUpdate")&&o.length&&(t=n.__r3f)!=null&&t.parent&&A_(n),n}function vf(n){var e,t;const r=(e=n.__r3f)==null||(t=e.root)==null||t.getState==null?void 0:t.getState();r&&r.internal.frames===0&&r.invalidate()}function A_(n){n.onUpdate==null||n.onUpdate(n)}function C3(n,e){n.manual||(M3(n)?(n.left=e.width/-2,n.right=e.width/2,n.top=e.height/2,n.bottom=e.height/-2):n.aspect=e.width/e.height,n.updateProjectionMatrix(),n.updateMatrixWorld())}function ng(n){return(n.eventObject||n.object).uuid+"/"+n.index+n.instanceId}function _N(){var n;const e=typeof self<"u"&&self||typeof window<"u"&&window;if(!e)return Mf.DefaultEventPriority;switch((n=e.event)==null?void 0:n.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return Mf.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return Mf.ContinuousEventPriority;default:return Mf.DefaultEventPriority}}function P3(n,e,t,r){const i=t.get(e);i&&(t.delete(e),t.size===0&&(n.delete(r),i.target.releasePointerCapture(r)))}function xN(n,e){const{internal:t}=n.getState();t.interaction=t.interaction.filter(r=>r!==e),t.initialHits=t.initialHits.filter(r=>r!==e),t.hovered.forEach((r,i)=>{(r.eventObject===e||r.object===e)&&t.hovered.delete(i)}),t.capturedMap.forEach((r,i)=>{P3(t.capturedMap,e,r,i)})}function SN(n){function e(u){const{internal:c}=n.getState(),f=u.offsetX-c.initialClick[0],m=u.offsetY-c.initialClick[1];return Math.round(Math.sqrt(f*f+m*m))}function t(u){return u.filter(c=>["Move","Over","Enter","Out","Leave"].some(f=>{var m;return(m=c.__r3f)==null?void 0:m.handlers["onPointer"+f]}))}function r(u,c){const f=n.getState(),m=new Set,g=[],y=c?c(f.internal.interaction):f.internal.interaction;for(let S=0;S<y.length;S++){const T=tp(y[S]);T&&(T.raycaster.camera=void 0)}f.previousRoot||f.events.compute==null||f.events.compute(u,f);function _(S){const T=tp(S);if(!T||!T.events.enabled||T.raycaster.camera===null)return[];if(T.raycaster.camera===void 0){var A;T.events.compute==null||T.events.compute(u,T,(A=T.previousRoot)==null?void 0:A.getState()),T.raycaster.camera===void 0&&(T.raycaster.camera=null)}return T.raycaster.camera?T.raycaster.intersectObject(S,!0):[]}let E=y.flatMap(_).sort((S,T)=>{const A=tp(S.object),P=tp(T.object);return!A||!P?S.distance-T.distance:P.events.priority-A.events.priority||S.distance-T.distance}).filter(S=>{const T=ng(S);return m.has(T)?!1:(m.add(T),!0)});f.events.filter&&(E=f.events.filter(E,f));for(const S of E){let T=S.object;for(;T;){var x;(x=T.__r3f)!=null&&x.eventCount&&g.push({...S,eventObject:T}),T=T.parent}}if("pointerId"in u&&f.internal.capturedMap.has(u.pointerId))for(let S of f.internal.capturedMap.get(u.pointerId).values())m.has(ng(S.intersection))||g.push(S.intersection);return g}function i(u,c,f,m){const g=n.getState();if(u.length){const y={stopped:!1};for(const _ of u){const E=tp(_.object)||g,{raycaster:x,pointer:S,camera:T,internal:A}=E,P=new X(S.x,S.y,0).unproject(T),L=U=>{var V,H;return(V=(H=A.capturedMap.get(U))==null?void 0:H.has(_.eventObject))!=null?V:!1},D=U=>{const V={intersection:_,target:c.target};A.capturedMap.has(U)?A.capturedMap.get(U).set(_.eventObject,V):A.capturedMap.set(U,new Map([[_.eventObject,V]])),c.target.setPointerCapture(U)},F=U=>{const V=A.capturedMap.get(U);V&&P3(A.capturedMap,_.eventObject,V,U)};let k={};for(let U in c){let V=c[U];typeof V!="function"&&(k[U]=V)}let R={..._,...k,pointer:S,intersections:u,stopped:y.stopped,delta:f,unprojectedPoint:P,ray:x.ray,camera:T,stopPropagation(){const U="pointerId"in c&&A.capturedMap.get(c.pointerId);if((!U||U.has(_.eventObject))&&(R.stopped=y.stopped=!0,A.hovered.size&&Array.from(A.hovered.values()).find(V=>V.eventObject===_.eventObject))){const V=u.slice(0,u.indexOf(_));s([...V,_])}},target:{hasPointerCapture:L,setPointerCapture:D,releasePointerCapture:F},currentTarget:{hasPointerCapture:L,setPointerCapture:D,releasePointerCapture:F},nativeEvent:c};if(m(R),y.stopped===!0)break}}return u}function s(u){const{internal:c}=n.getState();for(const f of c.hovered.values())if(!u.length||!u.find(m=>m.object===f.object&&m.index===f.index&&m.instanceId===f.instanceId)){const g=f.eventObject.__r3f,y=g?.handlers;if(c.hovered.delete(ng(f)),g!=null&&g.eventCount){const _={...f,intersections:u};y.onPointerOut==null||y.onPointerOut(_),y.onPointerLeave==null||y.onPointerLeave(_)}}}function a(u,c){for(let f=0;f<c.length;f++){const m=c[f].__r3f;m==null||m.handlers.onPointerMissed==null||m.handlers.onPointerMissed(u)}}function o(u){switch(u){case"onPointerLeave":case"onPointerCancel":return()=>s([]);case"onLostPointerCapture":return c=>{const{internal:f}=n.getState();"pointerId"in c&&f.capturedMap.has(c.pointerId)&&requestAnimationFrame(()=>{f.capturedMap.has(c.pointerId)&&(f.capturedMap.delete(c.pointerId),s([]))})}}return function(f){const{onPointerMissed:m,internal:g}=n.getState();g.lastEvent.current=f;const y=u==="onPointerMove",_=u==="onClick"||u==="onContextMenu"||u==="onDoubleClick",x=r(f,y?t:void 0),S=_?e(f):0;u==="onPointerDown"&&(g.initialClick=[f.offsetX,f.offsetY],g.initialHits=x.map(A=>A.eventObject)),_&&!x.length&&S<=2&&(a(f,g.interaction),m&&m(f)),y&&s(x);function T(A){const P=A.eventObject,L=P.__r3f,D=L?.handlers;if(L!=null&&L.eventCount)if(y){if(D.onPointerOver||D.onPointerEnter||D.onPointerOut||D.onPointerLeave){const F=ng(A),k=g.hovered.get(F);k?k.stopped&&A.stopPropagation():(g.hovered.set(F,A),D.onPointerOver==null||D.onPointerOver(A),D.onPointerEnter==null||D.onPointerEnter(A))}D.onPointerMove==null||D.onPointerMove(A)}else{const F=D[u];F?(!_||g.initialHits.includes(P))&&(a(f,g.interaction.filter(k=>!g.initialHits.includes(k))),F(A)):_&&g.initialHits.includes(P)&&a(f,g.interaction.filter(k=>!g.initialHits.includes(k)))}}i(x,f,S,T)}}return{handlePointer:o}}const MN=["set","get","setSize","setFrameloop","setDpr","events","invalidate","advance","size","viewport"],R3=n=>!!(n!=null&&n.render),Dx=se.createContext(null),wN=(n,e)=>{const t=m3((o,u)=>{const c=new X,f=new X,m=new X;function g(S=u().camera,T=f,A=u().size){const{width:P,height:L,top:D,left:F}=A,k=P/L;T.isVector3?m.copy(T):m.set(...T);const R=S.getWorldPosition(c).distanceTo(m);if(M3(S))return{width:P/S.zoom,height:L/S.zoom,top:D,left:F,factor:1,distance:R,aspect:k};{const U=S.fov*Math.PI/180,V=2*Math.tan(U/2)*R,H=V*(P/L);return{width:H,height:V,top:D,left:F,factor:P/H,distance:R,aspect:k}}}let y;const _=S=>o(T=>({performance:{...T.performance,current:S}})),E=new ct;return{set:o,get:u,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(S=1)=>n(u(),S),advance:(S,T)=>e(S,T,u()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new bx,pointer:E,mouse:E,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const S=u();y&&clearTimeout(y),S.performance.current!==S.performance.min&&_(S.performance.min),y=setTimeout(()=>_(u().performance.max),S.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:g},setEvents:S=>o(T=>({...T,events:{...T.events,...S}})),setSize:(S,T,A,P,L)=>{const D=u().camera,F={width:S,height:T,top:P||0,left:L||0,updateStyle:A};o(k=>({size:F,viewport:{...k.viewport,...g(D,f,F)}}))},setDpr:S=>o(T=>{const A=b3(S);return{viewport:{...T.viewport,dpr:A,initialDpr:T.viewport.initialDpr||A}}}),setFrameloop:(S="always")=>{const T=u().clock;T.stop(),T.elapsedTime=0,S!=="never"&&(T.start(),T.elapsedTime=0),o(()=>({frameloop:S}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:se.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(S,T,A)=>{const P=u().internal;return P.priority=P.priority+(T>0?1:0),P.subscribers.push({ref:S,priority:T,store:A}),P.subscribers=P.subscribers.sort((L,D)=>L.priority-D.priority),()=>{const L=u().internal;L!=null&&L.subscribers&&(L.priority=L.priority-(T>0?1:0),L.subscribers=L.subscribers.filter(D=>D.ref!==S))}}}}}),r=t.getState();let i=r.size,s=r.viewport.dpr,a=r.camera;return t.subscribe(()=>{const{camera:o,size:u,viewport:c,gl:f,set:m}=t.getState();if(u.width!==i.width||u.height!==i.height||c.dpr!==s){var g;i=u,s=c.dpr,C3(o,u),f.setPixelRatio(c.dpr);const y=(g=u.updateStyle)!=null?g:typeof HTMLCanvasElement<"u"&&f.domElement instanceof HTMLCanvasElement;f.setSize(u.width,u.height,y)}o!==a&&(a=o,m(y=>({viewport:{...y.viewport,...y.viewport.getCurrentViewport(o)}})))}),t.subscribe(o=>n(o)),t};let ig,EN=new Set,TN=new Set,bN=new Set;function qy(n,e){if(n.size)for(const{callback:t}of n.values())t(e)}function np(n,e){switch(n){case"before":return qy(EN,e);case"after":return qy(TN,e);case"tail":return qy(bN,e)}}let Yy,Zy;function Jy(n,e,t){let r=e.clock.getDelta();for(e.frameloop==="never"&&typeof n=="number"&&(r=n-e.clock.elapsedTime,e.clock.oldTime=e.clock.elapsedTime,e.clock.elapsedTime=n),Yy=e.internal.subscribers,ig=0;ig<Yy.length;ig++)Zy=Yy[ig],Zy.ref.current(Zy.store.getState(),r,t);return!e.internal.priority&&e.gl.render&&e.gl.render(e.scene,e.camera),e.internal.frames=Math.max(0,e.internal.frames-1),e.frameloop==="always"?1:e.internal.frames}function AN(n){let e=!1,t=!1,r,i,s;function a(c){i=requestAnimationFrame(a),e=!0,r=0,np("before",c),t=!0;for(const m of n.values()){var f;s=m.store.getState(),s.internal.active&&(s.frameloop==="always"||s.internal.frames>0)&&!((f=s.gl.xr)!=null&&f.isPresenting)&&(r+=Jy(c,s))}if(t=!1,np("after",c),r===0)return np("tail",c),e=!1,cancelAnimationFrame(i)}function o(c,f=1){var m;if(!c)return n.forEach(g=>o(g.store.getState(),f));(m=c.gl.xr)!=null&&m.isPresenting||!c.internal.active||c.frameloop==="never"||(f>1?c.internal.frames=Math.min(60,c.internal.frames+f):t?c.internal.frames=2:c.internal.frames=1,e||(e=!0,requestAnimationFrame(a)))}function u(c,f=!0,m,g){if(f&&np("before",c),m)Jy(c,m,g);else for(const y of n.values())Jy(c,y.store.getState());f&&np("after",c)}return{loop:a,invalidate:o,advance:u}}function Ux(){const n=se.useContext(Dx);if(!n)throw new Error("R3F: Hooks can only be used within the Canvas component!");return n}function Zc(n=t=>t,e){return Ux()(n,e)}function oi(n,e=0){const t=Ux(),r=t.getState().internal.subscribe,i=w3(n);return p0(()=>r(i,e,t),[e,r,t]),null}const P2=new WeakMap;function I3(n,e){return function(t,...r){let i=P2.get(t);return i||(i=new t,P2.set(t,i)),n&&n(i),Promise.all(r.map(s=>new Promise((a,o)=>i.load(s,u=>{u.scene&&Object.assign(u,vN(u.scene)),a(u)},e,u=>o(new Error(`Could not load ${s}: ${u?.message}`))))))}}function Au(n,e,t,r){const i=Array.isArray(e)?e:[e],s=y3(I3(t,r),[n,...i],{equal:di.equ});return Array.isArray(e)?s:s[0]}Au.preload=function(n,e,t){const r=Array.isArray(e)?e:[e];return aN(I3(t),[n,...r])};Au.clear=function(n,e){const t=Array.isArray(e)?e:[e];return oN([n,...t])};const Gf=new Map,{invalidate:R2,advance:I2}=AN(Gf),{reconciler:qp,applyProps:mu}=dN(Gf,_N),pf={objects:"shallow",strict:!1},CN=(n,e)=>{const t=typeof n=="function"?n(e):n;return R3(t)?t:new Lx({powerPreference:"high-performance",canvas:e,antialias:!0,alpha:!0,...n})};function PN(n,e){const t=typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement;if(e){const{width:r,height:i,top:s,left:a,updateStyle:o=t}=e;return{width:r,height:i,top:s,left:a,updateStyle:o}}else if(typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement&&n.parentElement){const{width:r,height:i,top:s,left:a}=n.parentElement.getBoundingClientRect();return{width:r,height:i,top:s,left:a,updateStyle:t}}else if(typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas)return{width:n.width,height:n.height,top:0,left:0,updateStyle:t};return{width:0,height:0,top:0,left:0}}function RN(n){const e=Gf.get(n),t=e?.fiber,r=e?.store;e&&console.warn("R3F.createRoot should only be called once!");const i=typeof reportError=="function"?reportError:console.error,s=r||wN(R2,I2),a=t||qp.createContainer(s,Mf.ConcurrentRoot,null,!1,null,"",i,null);e||Gf.set(n,{fiber:a,store:s});let o,u=!1,c;return{configure(f={}){let{gl:m,size:g,scene:y,events:_,onCreated:E,shadows:x=!1,linear:S=!1,flat:T=!1,legacy:A=!1,orthographic:P=!1,frameloop:L="always",dpr:D=[1,2],performance:F,raycaster:k,camera:R,onPointerMissed:U}=f,V=s.getState(),H=V.gl;V.gl||V.set({gl:H=CN(m,n)});let J=V.raycaster;J||V.set({raycaster:J=new Rx});const{params:$,...ae}=k||{};if(di.equ(ae,J,pf)||mu(J,{...ae}),di.equ($,J.params,pf)||mu(J,{params:{...J.params,...$}}),!V.camera||V.camera===c&&!di.equ(c,R,pf)){c=R;const Y=R instanceof r0,z=Y?R:P?new th(0,0,0,0,.1,1e3):new Pr(75,0,.1,1e3);Y||(z.position.z=5,R&&(mu(z,R),("aspect"in R||"left"in R||"right"in R||"bottom"in R||"top"in R)&&(z.manual=!0,z.updateProjectionMatrix())),!V.camera&&!(R!=null&&R.rotation)&&z.lookAt(0,0,0)),V.set({camera:z}),J.camera=z}if(!V.scene){let Y;y!=null&&y.isScene?Y=y:(Y=new a0,y&&mu(Y,y)),V.set({scene:gf(Y)})}if(!V.xr){var ne;const Y=(le,me)=>{const ve=s.getState();ve.frameloop!=="never"&&I2(le,!0,ve,me)},z=()=>{const le=s.getState();le.gl.xr.enabled=le.gl.xr.isPresenting,le.gl.xr.setAnimationLoop(le.gl.xr.isPresenting?Y:null),le.gl.xr.isPresenting||R2(le)},K={connect(){const le=s.getState().gl;le.xr.addEventListener("sessionstart",z),le.xr.addEventListener("sessionend",z)},disconnect(){const le=s.getState().gl;le.xr.removeEventListener("sessionstart",z),le.xr.removeEventListener("sessionend",z)}};typeof((ne=H.xr)==null?void 0:ne.addEventListener)=="function"&&K.connect(),V.set({xr:K})}if(H.shadowMap){const Y=H.shadowMap.enabled,z=H.shadowMap.type;if(H.shadowMap.enabled=!!x,di.boo(x))H.shadowMap.type=pp;else if(di.str(x)){var oe;const K={basic:Cw,percentage:Af,soft:pp,variance:Nc};H.shadowMap.type=(oe=K[x])!=null?oe:pp}else di.obj(x)&&Object.assign(H.shadowMap,x);(Y!==H.shadowMap.enabled||z!==H.shadowMap.type)&&(H.shadowMap.needsUpdate=!0)}const te=S3();te&&("enabled"in te?te.enabled=!A:"legacyMode"in te&&(te.legacyMode=A)),u||mu(H,{outputEncoding:S?3e3:3001,toneMapping:T?ba:Iv}),V.legacy!==A&&V.set(()=>({legacy:A})),V.linear!==S&&V.set(()=>({linear:S})),V.flat!==T&&V.set(()=>({flat:T})),m&&!di.fun(m)&&!R3(m)&&!di.equ(m,H,pf)&&mu(H,m),_&&!V.events.handlers&&V.set({events:_(s)});const ie=PN(n,g);return di.equ(ie,V.size,pf)||V.setSize(ie.width,ie.height,ie.updateStyle,ie.top,ie.left),D&&V.viewport.dpr!==b3(D)&&V.setDpr(D),V.frameloop!==L&&V.setFrameloop(L),V.onPointerMissed||V.set({onPointerMissed:U}),F&&!di.equ(F,V.performance,pf)&&V.set(Y=>({performance:{...Y.performance,...F}})),o=E,u=!0,this},render(f){return u||this.configure(),qp.updateContainer(O.jsx(IN,{store:s,children:f,onCreated:o,rootElement:n}),a,null,()=>{}),s},unmount(){L3(n)}}}function IN({store:n,children:e,onCreated:t,rootElement:r}){return p0(()=>{const i=n.getState();i.set(s=>({internal:{...s.internal,active:!0}})),t&&t(i),n.getState().events.connected||i.events.connect==null||i.events.connect(r)},[]),O.jsx(Dx.Provider,{value:n,children:e})}function L3(n,e){const t=Gf.get(n),r=t?.fiber;if(r){const i=t?.store.getState();i&&(i.internal.active=!1),qp.updateContainer(null,r,null,()=>{i&&setTimeout(()=>{try{var s,a,o,u;i.events.disconnect==null||i.events.disconnect(),(s=i.gl)==null||(a=s.renderLists)==null||a.dispose==null||a.dispose(),(o=i.gl)==null||o.forceContextLoss==null||o.forceContextLoss(),(u=i.gl)!=null&&u.xr&&i.xr.disconnect(),yN(i),Gf.delete(n)}catch{}},500)})}}function LN(n,e,t){return O.jsx(NN,{children:n,container:e,state:t},e.uuid)}function NN({state:n={},children:e,container:t}){const{events:r,size:i,...s}=n,a=Ux(),[o]=se.useState(()=>new Rx),[u]=se.useState(()=>new ct),c=se.useCallback((m,g)=>{const y={...m};Object.keys(m).forEach(E=>{(MN.includes(E)||m[E]!==g[E]&&g[E])&&delete y[E]});let _;if(g&&i){const E=g.camera;_=m.viewport.getCurrentViewport(E,new X,i),E!==m.camera&&C3(E,i)}return{...y,scene:t,raycaster:o,pointer:u,mouse:u,previousRoot:a,events:{...m.events,...g?.events,...r},size:{...m.size,...i},viewport:{...m.viewport,..._},...s}},[n]),[f]=se.useState(()=>{const m=a.getState();return m3((y,_)=>({...m,scene:t,raycaster:o,pointer:u,mouse:u,previousRoot:a,events:{...m.events,...r},size:{...m.size,...i},...s,set:y,get:_,setEvents:E=>y(x=>({...x,events:{...x.events,...E}}))}))});return se.useEffect(()=>{const m=a.subscribe(g=>f.setState(y=>c(g,y)));return()=>{m()}},[c]),se.useEffect(()=>{f.setState(m=>c(a.getState(),m))},[c]),se.useEffect(()=>()=>{f.destroy()},[]),O.jsx(O.Fragment,{children:qp.createPortal(O.jsx(Dx.Provider,{value:f,children:e}),f,null)})}qp.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:se.version});const Ky={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function DN(n){const{handlePointer:e}=SN(n);return{priority:1,enabled:!0,compute(t,r,i){r.pointer.set(t.offsetX/r.size.width*2-1,-(t.offsetY/r.size.height)*2+1),r.raycaster.setFromCamera(r.pointer,r.camera)},connected:void 0,handlers:Object.keys(Ky).reduce((t,r)=>({...t,[r]:e(r)}),{}),update:()=>{var t;const{events:r,internal:i}=n.getState();(t=i.lastEvent)!=null&&t.current&&r.handlers&&r.handlers.onPointerMove(i.lastEvent.current)},connect:t=>{var r;const{set:i,events:s}=n.getState();s.disconnect==null||s.disconnect(),i(a=>({events:{...a.events,connected:t}})),Object.entries((r=s.handlers)!=null?r:[]).forEach(([a,o])=>{const[u,c]=Ky[a];t.addEventListener(u,o,{passive:c})})},disconnect:()=>{const{set:t,events:r}=n.getState();if(r.connected){var i;Object.entries((i=r.handlers)!=null?i:[]).forEach(([s,a])=>{if(r&&r.connected instanceof HTMLElement){const[o]=Ky[s];r.connected.removeEventListener(o,a)}}),t(s=>({events:{...s.events,connected:void 0}}))}}}}function L2(n,e){let t;return(...r)=>{window.clearTimeout(t),t=window.setTimeout(()=>n(...r),e)}}function UN({debounce:n,scroll:e,polyfill:t,offsetSize:r}={debounce:0,scroll:!1,offsetSize:!1}){const i=t||(typeof window>"u"?class{}:window.ResizeObserver);if(!i)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[s,a]=se.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),o=se.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:s,orientationHandler:null}),u=n?typeof n=="number"?n:n.scroll:null,c=n?typeof n=="number"?n:n.resize:null,f=se.useRef(!1);se.useEffect(()=>(f.current=!0,()=>void(f.current=!1)));const[m,g,y]=se.useMemo(()=>{const S=()=>{if(!o.current.element)return;const{left:T,top:A,width:P,height:L,bottom:D,right:F,x:k,y:R}=o.current.element.getBoundingClientRect(),U={left:T,top:A,width:P,height:L,bottom:D,right:F,x:k,y:R};o.current.element instanceof HTMLElement&&r&&(U.height=o.current.element.offsetHeight,U.width=o.current.element.offsetWidth),Object.freeze(U),f.current&&!zN(o.current.lastBounds,U)&&a(o.current.lastBounds=U)};return[S,c?L2(S,c):S,u?L2(S,u):S]},[a,r,u,c]);function _(){o.current.scrollContainers&&(o.current.scrollContainers.forEach(S=>S.removeEventListener("scroll",y,!0)),o.current.scrollContainers=null),o.current.resizeObserver&&(o.current.resizeObserver.disconnect(),o.current.resizeObserver=null),o.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",o.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",o.current.orientationHandler))}function E(){o.current.element&&(o.current.resizeObserver=new i(y),o.current.resizeObserver.observe(o.current.element),e&&o.current.scrollContainers&&o.current.scrollContainers.forEach(S=>S.addEventListener("scroll",y,{capture:!0,passive:!0})),o.current.orientationHandler=()=>{y()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",o.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",o.current.orientationHandler))}const x=S=>{!S||S===o.current.element||(_(),o.current.element=S,o.current.scrollContainers=N3(S),E())};return ON(y,!!e),FN(g),se.useEffect(()=>{_(),E()},[e,y,g]),se.useEffect(()=>_,[]),[x,s,m]}function FN(n){se.useEffect(()=>{const e=n;return window.addEventListener("resize",e),()=>void window.removeEventListener("resize",e)},[n])}function ON(n,e){se.useEffect(()=>{if(e){const t=n;return window.addEventListener("scroll",t,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",t,!0)}},[n,e])}function N3(n){const e=[];if(!n||n===document.body)return e;const{overflow:t,overflowX:r,overflowY:i}=window.getComputedStyle(n);return[t,r,i].some(s=>s==="auto"||s==="scroll")&&e.push(n),[...e,...N3(n.parentElement)]}const kN=["x","y","top","bottom","left","right","width","height"],zN=(n,e)=>kN.every(t=>n[t]===e[t]);var BN=Object.defineProperty,GN=Object.defineProperties,VN=Object.getOwnPropertyDescriptors,N2=Object.getOwnPropertySymbols,HN=Object.prototype.hasOwnProperty,WN=Object.prototype.propertyIsEnumerable,D2=(n,e,t)=>e in n?BN(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,U2=(n,e)=>{for(var t in e||(e={}))HN.call(e,t)&&D2(n,t,e[t]);if(N2)for(var t of N2(e))WN.call(e,t)&&D2(n,t,e[t]);return n},jN=(n,e)=>GN(n,VN(e)),F2,O2;typeof window<"u"&&((F2=window.document)!=null&&F2.createElement||((O2=window.navigator)==null?void 0:O2.product)==="ReactNative")?se.useLayoutEffect:se.useEffect;function D3(n,e,t){if(!n)return;if(t(n)===!0)return n;let r=n.child;for(;r;){const i=D3(r,e,t);if(i)return i;r=r.sibling}}function U3(n){try{return Object.defineProperties(n,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return n}}const k2=console.error;console.error=function(){const n=[...arguments].join("");if(n?.startsWith("Warning:")&&n.includes("useContext")){console.error=k2;return}return k2.apply(this,arguments)};const Fx=U3(se.createContext(null));class F3 extends se.Component{render(){return se.createElement(Fx.Provider,{value:this._reactInternals},this.props.children)}}function XN(){const n=se.useContext(Fx);if(n===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const e=se.useId();return se.useMemo(()=>{for(const r of[n,n?.alternate]){if(!r)continue;const i=D3(r,!1,s=>{let a=s.memoizedState;for(;a;){if(a.memoizedState===e)return!0;a=a.next}});if(i)return i}},[n,e])}function qN(){const n=XN(),[e]=se.useState(()=>new Map);e.clear();let t=n;for(;t;){if(t.type&&typeof t.type=="object"){const i=t.type._context===void 0&&t.type.Provider===t.type?t.type:t.type._context;i&&i!==Fx&&!e.has(i)&&e.set(i,se.useContext(U3(i)))}t=t.return}return e}function YN(){const n=qN();return se.useMemo(()=>Array.from(n.keys()).reduce((e,t)=>r=>se.createElement(e,null,se.createElement(t.Provider,jN(U2({},r),{value:n.get(t)}))),e=>se.createElement(F3,U2({},e))),[n])}const ZN=se.forwardRef(function({children:e,fallback:t,resize:r,style:i,gl:s,events:a=DN,eventSource:o,eventPrefix:u,shadows:c,linear:f,flat:m,legacy:g,orthographic:y,frameloop:_,dpr:E,performance:x,raycaster:S,camera:T,scene:A,onPointerMissed:P,onCreated:L,...D},F){se.useMemo(()=>x3(eN),[]);const k=YN(),[R,U]=UN({scroll:!0,debounce:{scroll:50,resize:0},...r}),V=se.useRef(null),H=se.useRef(null);se.useImperativeHandle(F,()=>V.current);const J=w3(P),[$,ae]=se.useState(!1),[ne,oe]=se.useState(!1);if($)throw $;if(ne)throw ne;const te=se.useRef(null);p0(()=>{const Y=V.current;U.width>0&&U.height>0&&Y&&(te.current||(te.current=RN(Y)),te.current.configure({gl:s,events:a,shadows:c,linear:f,flat:m,legacy:g,orthographic:y,frameloop:_,dpr:E,performance:x,raycaster:S,camera:T,scene:A,size:U,onPointerMissed:(...z)=>J.current==null?void 0:J.current(...z),onCreated:z=>{z.events.connect==null||z.events.connect(o?pN(o)?o.current:o:H.current),u&&z.setEvents({compute:(K,le)=>{const me=K[u+"X"],ve=K[u+"Y"];le.pointer.set(me/le.size.width*2-1,-(ve/le.size.height)*2+1),le.raycaster.setFromCamera(le.pointer,le.camera)}}),L?.(z)}}),te.current.render(O.jsx(k,{children:O.jsx(E3,{set:oe,children:O.jsx(se.Suspense,{fallback:O.jsx(mN,{set:ae}),children:e??null})})})))}),se.useEffect(()=>{const Y=V.current;if(Y)return()=>L3(Y)},[]);const ie=o?"none":"auto";return O.jsx("div",{ref:H,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:ie,...i},...D,children:O.jsx("div",{ref:R,style:{width:"100%",height:"100%"},children:O.jsx("canvas",{ref:V,style:{display:"block"},children:t})})})}),JN=se.forwardRef(function(e,t){return O.jsx(F3,{children:O.jsx(ZN,{...e,ref:t})})});function yv(){return yv=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},yv.apply(null,arguments)}const z2=n=>{let e;const t=new Set,r=(c,f)=>{const m=typeof c=="function"?c(e):c;if(!Object.is(m,e)){const g=e;e=f??(typeof m!="object"||m===null)?m:Object.assign({},e,m),t.forEach(y=>y(e,g))}},i=()=>e,o={setState:r,getState:i,getInitialState:()=>u,subscribe:c=>(t.add(c),()=>t.delete(c))},u=e=n(r,i,o);return o},KN=(n=>n?z2(n):z2),QN=n=>n;function $N(n,e=QN){const t=Uo.useSyncExternalStore(n.subscribe,Uo.useCallback(()=>e(n.getState()),[n,e]),Uo.useCallback(()=>e(n.getInitialState()),[n,e]));return Uo.useDebugValue(t),t}const B2=n=>{const e=KN(n),t=r=>$N(e,r);return Object.assign(t,e),t},eD=(n=>n?B2(n):B2),O3=parseInt($p.replace(/\D+/g,""));var Ta=Uint8Array,xu=Uint16Array,C_=Uint32Array,k3=new Ta([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),z3=new Ta([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),tD=new Ta([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),B3=function(n,e){for(var t=new xu(31),r=0;r<31;++r)t[r]=e+=1<<n[r-1];for(var i=new C_(t[30]),r=1;r<30;++r)for(var s=t[r];s<t[r+1];++s)i[s]=s-t[r]<<5|r;return[t,i]},G3=B3(k3,2),V3=G3[0],nD=G3[1];V3[28]=258,nD[258]=28;var iD=B3(z3,0),rD=iD[0],P_=new xu(32768);for(var xi=0;xi<32768;++xi){var du=(xi&43690)>>>1|(xi&21845)<<1;du=(du&52428)>>>2|(du&13107)<<2,du=(du&61680)>>>4|(du&3855)<<4,P_[xi]=((du&65280)>>>8|(du&255)<<8)>>>1}var wp=(function(n,e,t){for(var r=n.length,i=0,s=new xu(e);i<r;++i)++s[n[i]-1];var a=new xu(e);for(i=0;i<e;++i)a[i]=a[i-1]+s[i-1]<<1;var o;if(t){o=new xu(1<<e);var u=15-e;for(i=0;i<r;++i)if(n[i])for(var c=i<<4|n[i],f=e-n[i],m=a[n[i]-1]++<<f,g=m|(1<<f)-1;m<=g;++m)o[P_[m]>>>u]=c}else for(o=new xu(r),i=0;i<r;++i)n[i]&&(o[i]=P_[a[n[i]-1]++]>>>15-n[i]);return o}),m0=new Ta(288);for(var xi=0;xi<144;++xi)m0[xi]=8;for(var xi=144;xi<256;++xi)m0[xi]=9;for(var xi=256;xi<280;++xi)m0[xi]=7;for(var xi=280;xi<288;++xi)m0[xi]=8;var H3=new Ta(32);for(var xi=0;xi<32;++xi)H3[xi]=5;var sD=wp(m0,9,1),aD=wp(H3,5,1),Qy=function(n){for(var e=n[0],t=1;t<n.length;++t)n[t]>e&&(e=n[t]);return e},so=function(n,e,t){var r=e/8|0;return(n[r]|n[r+1]<<8)>>(e&7)&t},$y=function(n,e){var t=e/8|0;return(n[t]|n[t+1]<<8|n[t+2]<<16)>>(e&7)},oD=function(n){return(n/8|0)+(n&7&&1)},lD=function(n,e,t){(t==null||t>n.length)&&(t=n.length);var r=new(n instanceof xu?xu:n instanceof C_?C_:Ta)(t-e);return r.set(n.subarray(e,t)),r},uD=function(n,e,t){var r=n.length;if(!r||t&&!t.l&&r<5)return e||new Ta(0);var i=!e||t,s=!t||t.i;t||(t={}),e||(e=new Ta(r*3));var a=function(re){var he=e.length;if(re>he){var ye=new Ta(Math.max(he*2,re));ye.set(e),e=ye}},o=t.f||0,u=t.p||0,c=t.b||0,f=t.l,m=t.d,g=t.m,y=t.n,_=r*8;do{if(!f){t.f=o=so(n,u,1);var E=so(n,u+1,3);if(u+=3,E)if(E==1)f=sD,m=aD,g=9,y=5;else if(E==2){var A=so(n,u,31)+257,P=so(n,u+10,15)+4,L=A+so(n,u+5,31)+1;u+=14;for(var D=new Ta(L),F=new Ta(19),k=0;k<P;++k)F[tD[k]]=so(n,u+k*3,7);u+=P*3;for(var R=Qy(F),U=(1<<R)-1,V=wp(F,R,1),k=0;k<L;){var H=V[so(n,u,U)];u+=H&15;var x=H>>>4;if(x<16)D[k++]=x;else{var J=0,$=0;for(x==16?($=3+so(n,u,3),u+=2,J=D[k-1]):x==17?($=3+so(n,u,7),u+=3):x==18&&($=11+so(n,u,127),u+=7);$--;)D[k++]=J}}var ae=D.subarray(0,A),ne=D.subarray(A);g=Qy(ae),y=Qy(ne),f=wp(ae,g,1),m=wp(ne,y,1)}else throw"invalid block type";else{var x=oD(u)+4,S=n[x-4]|n[x-3]<<8,T=x+S;if(T>r){if(s)throw"unexpected EOF";break}i&&a(c+S),e.set(n.subarray(x,T),c),t.b=c+=S,t.p=u=T*8;continue}if(u>_){if(s)throw"unexpected EOF";break}}i&&a(c+131072);for(var oe=(1<<g)-1,te=(1<<y)-1,ie=u;;ie=u){var J=f[$y(n,u)&oe],Y=J>>>4;if(u+=J&15,u>_){if(s)throw"unexpected EOF";break}if(!J)throw"invalid length/literal";if(Y<256)e[c++]=Y;else if(Y==256){ie=u,f=null;break}else{var z=Y-254;if(Y>264){var k=Y-257,K=k3[k];z=so(n,u,(1<<K)-1)+V3[k],u+=K}var le=m[$y(n,u)&te],me=le>>>4;if(!le)throw"invalid distance";u+=le&15;var ne=rD[me];if(me>3){var K=z3[me];ne+=$y(n,u)&(1<<K)-1,u+=K}if(u>_){if(s)throw"unexpected EOF";break}i&&a(c+131072);for(var ve=c+z;c<ve;c+=4)e[c]=e[c-ne],e[c+1]=e[c+1-ne],e[c+2]=e[c+2-ne],e[c+3]=e[c+3-ne];c=ve}}t.l=f,t.p=ie,t.b=c,f&&(o=1,t.m=g,t.d=m,t.n=y)}while(!o);return c==e.length?e:lD(e,0,c)},cD=new Ta(0),hD=function(n){if((n[0]&15)!=8||n[0]>>>4>7||(n[0]<<8|n[1])%31)throw"invalid zlib data";if(n[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function rg(n,e){return uD((hD(n),n.subarray(2,-4)),e)}var fD=typeof TextDecoder<"u"&&new TextDecoder,dD=0;try{fD.decode(cD,{stream:!0}),dD=1}catch{}const pD=n=>n&&n.isCubeTexture;class mD extends pi{constructor(e,t){var r,i;const s=pD(e),o=((i=s?(r=e.image[0])==null?void 0:r.width:e.image.width)!=null?i:1024)/4,u=Math.floor(Math.log2(o)),c=Math.pow(2,u),f=3*Math.max(c,112),m=4*c,g=[s?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/f}`,`#define CUBEUV_TEXEL_HEIGHT ${1/m}`,`#define CUBEUV_MAX_MIP ${u}.0`],y=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,_=g.join(`
`)+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${O3>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `,E={map:{value:e},height:{value:t?.height||15},radius:{value:t?.radius||100}},x=new u0(1,16),S=new Es({uniforms:E,fragmentShader:_,vertexShader:y,side:Ea});super(x,S)}set radius(e){this.material.uniforms.radius.value=e}get radius(){return this.material.uniforms.radius.value}set height(e){this.material.uniforms.height.value=e}get height(){return this.material.uniforms.height.value}}class gD extends xx{constructor(e){super(e),this.type=Vi}parse(e){const a=function(k,R){switch(k){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(R||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(R||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(R||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(R||""))}},m=function(k,R,U){R=R||1024;let H=k.pos,J=-1,$=0,ae="",ne=String.fromCharCode.apply(null,new Uint16Array(k.subarray(H,H+128)));for(;0>(J=ne.indexOf(`
`))&&$<R&&H<k.byteLength;)ae+=ne,$+=ne.length,H+=128,ne+=String.fromCharCode.apply(null,new Uint16Array(k.subarray(H,H+128)));return-1<J?(k.pos+=$+J+1,ae+ne.slice(0,J)):!1},g=function(k){const R=/^#\?(\S+)/,U=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,V=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,H=/^\s*FORMAT=(\S+)\s*$/,J=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,$={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let ae,ne;for((k.pos>=k.byteLength||!(ae=m(k)))&&a(1,"no header found"),(ne=ae.match(R))||a(3,"bad initial token"),$.valid|=1,$.programtype=ne[1],$.string+=ae+`
`;ae=m(k),ae!==!1;){if($.string+=ae+`
`,ae.charAt(0)==="#"){$.comments+=ae+`
`;continue}if((ne=ae.match(U))&&($.gamma=parseFloat(ne[1])),(ne=ae.match(V))&&($.exposure=parseFloat(ne[1])),(ne=ae.match(H))&&($.valid|=2,$.format=ne[1]),(ne=ae.match(J))&&($.valid|=4,$.height=parseInt(ne[1],10),$.width=parseInt(ne[2],10)),$.valid&2&&$.valid&4)break}return $.valid&2||a(3,"missing format specifier"),$.valid&4||a(3,"missing image size specifier"),$},y=function(k,R,U){const V=R;if(V<8||V>32767||k[0]!==2||k[1]!==2||k[2]&128)return new Uint8Array(k);V!==(k[2]<<8|k[3])&&a(3,"wrong scanline width");const H=new Uint8Array(4*R*U);H.length||a(4,"unable to allocate buffer space");let J=0,$=0;const ae=4*V,ne=new Uint8Array(4),oe=new Uint8Array(ae);let te=U;for(;te>0&&$<k.byteLength;){$+4>k.byteLength&&a(1),ne[0]=k[$++],ne[1]=k[$++],ne[2]=k[$++],ne[3]=k[$++],(ne[0]!=2||ne[1]!=2||(ne[2]<<8|ne[3])!=V)&&a(3,"bad rgbe scanline format");let ie=0,Y;for(;ie<ae&&$<k.byteLength;){Y=k[$++];const K=Y>128;if(K&&(Y-=128),(Y===0||ie+Y>ae)&&a(3,"bad scanline data"),K){const le=k[$++];for(let me=0;me<Y;me++)oe[ie++]=le}else oe.set(k.subarray($,$+Y),ie),ie+=Y,$+=Y}const z=V;for(let K=0;K<z;K++){let le=0;H[J]=oe[K+le],le+=V,H[J+1]=oe[K+le],le+=V,H[J+2]=oe[K+le],le+=V,H[J+3]=oe[K+le],J+=4}te--}return H},_=function(k,R,U,V){const H=k[R+3],J=Math.pow(2,H-128)/255;U[V+0]=k[R+0]*J,U[V+1]=k[R+1]*J,U[V+2]=k[R+2]*J,U[V+3]=1},E=function(k,R,U,V){const H=k[R+3],J=Math.pow(2,H-128)/255;U[V+0]=Fc.toHalfFloat(Math.min(k[R+0]*J,65504)),U[V+1]=Fc.toHalfFloat(Math.min(k[R+1]*J,65504)),U[V+2]=Fc.toHalfFloat(Math.min(k[R+2]*J,65504)),U[V+3]=Fc.toHalfFloat(1)},x=new Uint8Array(e);x.pos=0;const S=g(x),T=S.width,A=S.height,P=y(x.subarray(x.pos),T,A);let L,D,F;switch(this.type){case bi:F=P.length/4;const k=new Float32Array(F*4);for(let U=0;U<F;U++)_(P,U*4,k,U*4);L=k,D=bi;break;case Vi:F=P.length/4;const R=new Uint16Array(F*4);for(let U=0;U<F;U++)E(P,U*4,R,U*4);L=R,D=Vi;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:T,height:A,data:L,header:S.string,gamma:S.gamma,exposure:S.exposure,type:D}}setDataType(e){return this.type=e,this}load(e,t,r,i){function s(a,o){switch(a.type){case bi:case Vi:"colorSpace"in a?a.colorSpace="srgb-linear":a.encoding=3e3,a.minFilter=Dn,a.magFilter=Dn,a.generateMipmaps=!1,a.flipY=!0;break}t&&t(a,o)}return super.load(e,s,r,i)}}const ip=O3>=152;class vD extends xx{constructor(e){super(e),this.type=Vi}parse(e){const R=Math.pow(2.7182818,2.2);function U(W,ee){for(var ge=0,Ue=0;Ue<65536;++Ue)(Ue==0||W[Ue>>3]&1<<(Ue&7))&&(ee[ge++]=Ue);for(var qe=ge-1;ge<65536;)ee[ge++]=0;return qe}function V(W){for(var ee=0;ee<16384;ee++)W[ee]={},W[ee].len=0,W[ee].lit=0,W[ee].p=null}const H={l:0,c:0,lc:0};function J(W,ee,ge,Ue,qe){for(;ge<W;)ee=ee<<8|nt(Ue,qe),ge+=8;ge-=W,H.l=ee>>ge&(1<<W)-1,H.c=ee,H.lc=ge}const $=new Array(59);function ae(W){for(var ee=0;ee<=58;++ee)$[ee]=0;for(var ee=0;ee<65537;++ee)$[W[ee]]+=1;for(var ge=0,ee=58;ee>0;--ee){var Ue=ge+$[ee]>>1;$[ee]=ge,ge=Ue}for(var ee=0;ee<65537;++ee){var qe=W[ee];qe>0&&(W[ee]=qe|$[qe]++<<6)}}function ne(W,ee,ge,Ue,qe,Ye,Mt){for(var vt=ge,Et=0,Tt=0;qe<=Ye;qe++){if(vt.value-ge.value>Ue)return!1;J(6,Et,Tt,W,vt);var At=H.l;if(Et=H.c,Tt=H.lc,Mt[qe]=At,At==63){if(vt.value-ge.value>Ue)throw"Something wrong with hufUnpackEncTable";J(8,Et,Tt,W,vt);var Ie=H.l+6;if(Et=H.c,Tt=H.lc,qe+Ie>Ye+1)throw"Something wrong with hufUnpackEncTable";for(;Ie--;)Mt[qe++]=0;qe--}else if(At>=59){var Ie=At-59+2;if(qe+Ie>Ye+1)throw"Something wrong with hufUnpackEncTable";for(;Ie--;)Mt[qe++]=0;qe--}}ae(Mt)}function oe(W){return W&63}function te(W){return W>>6}function ie(W,ee,ge,Ue){for(;ee<=ge;ee++){var qe=te(W[ee]),Ye=oe(W[ee]);if(qe>>Ye)throw"Invalid table entry";if(Ye>14){var Mt=Ue[qe>>Ye-14];if(Mt.len)throw"Invalid table entry";if(Mt.lit++,Mt.p){var vt=Mt.p;Mt.p=new Array(Mt.lit);for(var Et=0;Et<Mt.lit-1;++Et)Mt.p[Et]=vt[Et]}else Mt.p=new Array(1);Mt.p[Mt.lit-1]=ee}else if(Ye)for(var Tt=0,Et=1<<14-Ye;Et>0;Et--){var Mt=Ue[(qe<<14-Ye)+Tt];if(Mt.len||Mt.p)throw"Invalid table entry";Mt.len=Ye,Mt.lit=ee,Tt++}}return!0}const Y={c:0,lc:0};function z(W,ee,ge,Ue){W=W<<8|nt(ge,Ue),ee+=8,Y.c=W,Y.lc=ee}const K={c:0,lc:0};function le(W,ee,ge,Ue,qe,Ye,Mt,vt,Et,Tt){if(W==ee){Ue<8&&(z(ge,Ue,qe,Mt),ge=Y.c,Ue=Y.lc),Ue-=8;var At=ge>>Ue,At=new Uint8Array([At])[0];if(Et.value+At>Tt)return!1;for(var Ie=vt[Et.value-1];At-- >0;)vt[Et.value++]=Ie}else if(Et.value<Tt)vt[Et.value++]=W;else return!1;K.c=ge,K.lc=Ue}function me(W){return W&65535}function ve(W){var ee=me(W);return ee>32767?ee-65536:ee}const re={a:0,b:0};function he(W,ee){var ge=ve(W),Ue=ve(ee),qe=Ue,Ye=ge+(qe&1)+(qe>>1),Mt=Ye,vt=Ye-qe;re.a=Mt,re.b=vt}function ye(W,ee){var ge=me(W),Ue=me(ee),qe=ge-(Ue>>1)&65535,Ye=Ue+qe-32768&65535;re.a=Ye,re.b=qe}function ze(W,ee,ge,Ue,qe,Ye,Mt){for(var vt=Mt<16384,Et=ge>qe?qe:ge,Tt=1,At;Tt<=Et;)Tt<<=1;for(Tt>>=1,At=Tt,Tt>>=1;Tt>=1;){for(var Ie=0,Z=Ie+Ye*(qe-At),de=Ye*Tt,xe=Ye*At,Me=Ue*Tt,Se=Ue*At,lt,ut,Je,ht;Ie<=Z;Ie+=xe){for(var ft=Ie,Nt=Ie+Ue*(ge-At);ft<=Nt;ft+=Se){var St=ft+Me,Xt=ft+de,un=Xt+Me;vt?(he(W[ft+ee],W[Xt+ee]),lt=re.a,Je=re.b,he(W[St+ee],W[un+ee]),ut=re.a,ht=re.b,he(lt,ut),W[ft+ee]=re.a,W[St+ee]=re.b,he(Je,ht),W[Xt+ee]=re.a,W[un+ee]=re.b):(ye(W[ft+ee],W[Xt+ee]),lt=re.a,Je=re.b,ye(W[St+ee],W[un+ee]),ut=re.a,ht=re.b,ye(lt,ut),W[ft+ee]=re.a,W[St+ee]=re.b,ye(Je,ht),W[Xt+ee]=re.a,W[un+ee]=re.b)}if(ge&Tt){var Xt=ft+de;vt?he(W[ft+ee],W[Xt+ee]):ye(W[ft+ee],W[Xt+ee]),lt=re.a,W[Xt+ee]=re.b,W[ft+ee]=lt}}if(qe&Tt)for(var ft=Ie,Nt=Ie+Ue*(ge-At);ft<=Nt;ft+=Se){var St=ft+Me;vt?he(W[ft+ee],W[St+ee]):ye(W[ft+ee],W[St+ee]),lt=re.a,W[St+ee]=re.b,W[ft+ee]=lt}At=Tt,Tt>>=1}return Ie}function Ve(W,ee,ge,Ue,qe,Ye,Mt,vt,Et,Tt){for(var At=0,Ie=0,Z=vt,de=Math.trunc(qe.value+(Ye+7)/8);qe.value<de;)for(z(At,Ie,ge,qe),At=Y.c,Ie=Y.lc;Ie>=14;){var xe=At>>Ie-14&16383,Me=ee[xe];if(Me.len)Ie-=Me.len,le(Me.lit,Mt,At,Ie,ge,Ue,qe,Et,Tt,Z),At=K.c,Ie=K.lc;else{if(!Me.p)throw"hufDecode issues";var Se;for(Se=0;Se<Me.lit;Se++){for(var lt=oe(W[Me.p[Se]]);Ie<lt&&qe.value<de;)z(At,Ie,ge,qe),At=Y.c,Ie=Y.lc;if(Ie>=lt&&te(W[Me.p[Se]])==(At>>Ie-lt&(1<<lt)-1)){Ie-=lt,le(Me.p[Se],Mt,At,Ie,ge,Ue,qe,Et,Tt,Z),At=K.c,Ie=K.lc;break}}if(Se==Me.lit)throw"hufDecode issues"}}var ut=8-Ye&7;for(At>>=ut,Ie-=ut;Ie>0;){var Me=ee[At<<14-Ie&16383];if(Me.len)Ie-=Me.len,le(Me.lit,Mt,At,Ie,ge,Ue,qe,Et,Tt,Z),At=K.c,Ie=K.lc;else throw"hufDecode issues"}return!0}function Ke(W,ee,ge,Ue,qe,Ye){var Mt={value:0},vt=ge.value,Et=Xe(ee,ge),Tt=Xe(ee,ge);ge.value+=4;var At=Xe(ee,ge);if(ge.value+=4,Et<0||Et>=65537||Tt<0||Tt>=65537)throw"Something wrong with HUF_ENCSIZE";var Ie=new Array(65537),Z=new Array(16384);V(Z);var de=Ue-(ge.value-vt);if(ne(W,ee,ge,de,Et,Tt,Ie),At>8*(Ue-(ge.value-vt)))throw"Something wrong with hufUncompress";ie(Ie,Et,Tt,Z),Ve(Ie,Z,W,ee,ge,At,Tt,Ye,qe,Mt)}function Qe(W,ee,ge){for(var Ue=0;Ue<ge;++Ue)ee[Ue]=W[ee[Ue]]}function pt(W){for(var ee=1;ee<W.length;ee++){var ge=W[ee-1]+W[ee]-128;W[ee]=ge}}function Ne(W,ee){for(var ge=0,Ue=Math.floor((W.length+1)/2),qe=0,Ye=W.length-1;!(qe>Ye||(ee[qe++]=W[ge++],qe>Ye));)ee[qe++]=W[Ue++]}function Be(W){for(var ee=W.byteLength,ge=new Array,Ue=0,qe=new DataView(W);ee>0;){var Ye=qe.getInt8(Ue++);if(Ye<0){var Mt=-Ye;ee-=Mt+1;for(var vt=0;vt<Mt;vt++)ge.push(qe.getUint8(Ue++))}else{var Mt=Ye;ee-=2;for(var Et=qe.getUint8(Ue++),vt=0;vt<Mt+1;vt++)ge.push(Et)}}return ge}function De(W,ee,ge,Ue,qe,Ye){var St=new DataView(Ye.buffer),Mt=ge[W.idx[0]].width,vt=ge[W.idx[0]].height,Et=3,Tt=Math.floor(Mt/8),At=Math.ceil(Mt/8),Ie=Math.ceil(vt/8),Z=Mt-(At-1)*8,de=vt-(Ie-1)*8,xe={value:0},Me=new Array(Et),Se=new Array(Et),lt=new Array(Et),ut=new Array(Et),Je=new Array(Et);for(let Kt=0;Kt<Et;++Kt)Je[Kt]=ee[W.idx[Kt]],Me[Kt]=Kt<1?0:Me[Kt-1]+At*Ie,Se[Kt]=new Float32Array(64),lt[Kt]=new Uint16Array(64),ut[Kt]=new Uint16Array(At*64);for(let Kt=0;Kt<Ie;++Kt){var ht=8;Kt==Ie-1&&(ht=de);var ft=8;for(let $t=0;$t<At;++$t){$t==At-1&&(ft=Z);for(let Dt=0;Dt<Et;++Dt)lt[Dt].fill(0),lt[Dt][0]=qe[Me[Dt]++],it(xe,Ue,lt[Dt]),Q(lt[Dt],Se[Dt]),at(Se[Dt]);je(Se);for(let Dt=0;Dt<Et;++Dt)Ce(Se[Dt],ut[Dt],$t*64)}let Ut=0;for(let $t=0;$t<Et;++$t){const Dt=ge[W.idx[$t]].type;for(let bn=8*Kt;bn<8*Kt+ht;++bn){Ut=Je[$t][bn];for(let mi=0;mi<Tt;++mi){const In=mi*64+(bn&7)*8;St.setUint16(Ut+0*Dt,ut[$t][In+0],!0),St.setUint16(Ut+2*Dt,ut[$t][In+1],!0),St.setUint16(Ut+4*Dt,ut[$t][In+2],!0),St.setUint16(Ut+6*Dt,ut[$t][In+3],!0),St.setUint16(Ut+8*Dt,ut[$t][In+4],!0),St.setUint16(Ut+10*Dt,ut[$t][In+5],!0),St.setUint16(Ut+12*Dt,ut[$t][In+6],!0),St.setUint16(Ut+14*Dt,ut[$t][In+7],!0),Ut+=16*Dt}}if(Tt!=At)for(let bn=8*Kt;bn<8*Kt+ht;++bn){const mi=Je[$t][bn]+8*Tt*2*Dt,In=Tt*64+(bn&7)*8;for(let Hi=0;Hi<ft;++Hi)St.setUint16(mi+Hi*2*Dt,ut[$t][In+Hi],!0)}}}for(var Nt=new Uint16Array(Mt),St=new DataView(Ye.buffer),Xt=0;Xt<Et;++Xt){ge[W.idx[Xt]].decoded=!0;var un=ge[W.idx[Xt]].type;if(ge[Xt].type==2)for(var dn=0;dn<vt;++dn){const Kt=Je[Xt][dn];for(var fn=0;fn<Mt;++fn)Nt[fn]=St.getUint16(Kt+fn*2*un,!0);for(var fn=0;fn<Mt;++fn)St.setFloat32(Kt+fn*2*un,Ee(Nt[fn]),!0)}}}function it(W,ee,ge){for(var Ue,qe=1;qe<64;)Ue=ee[W.value],Ue==65280?qe=64:Ue>>8==255?qe+=Ue&255:(ge[qe]=Ue,qe++),W.value++}function Q(W,ee){ee[0]=Ee(W[0]),ee[1]=Ee(W[1]),ee[2]=Ee(W[5]),ee[3]=Ee(W[6]),ee[4]=Ee(W[14]),ee[5]=Ee(W[15]),ee[6]=Ee(W[27]),ee[7]=Ee(W[28]),ee[8]=Ee(W[2]),ee[9]=Ee(W[4]),ee[10]=Ee(W[7]),ee[11]=Ee(W[13]),ee[12]=Ee(W[16]),ee[13]=Ee(W[26]),ee[14]=Ee(W[29]),ee[15]=Ee(W[42]),ee[16]=Ee(W[3]),ee[17]=Ee(W[8]),ee[18]=Ee(W[12]),ee[19]=Ee(W[17]),ee[20]=Ee(W[25]),ee[21]=Ee(W[30]),ee[22]=Ee(W[41]),ee[23]=Ee(W[43]),ee[24]=Ee(W[9]),ee[25]=Ee(W[11]),ee[26]=Ee(W[18]),ee[27]=Ee(W[24]),ee[28]=Ee(W[31]),ee[29]=Ee(W[40]),ee[30]=Ee(W[44]),ee[31]=Ee(W[53]),ee[32]=Ee(W[10]),ee[33]=Ee(W[19]),ee[34]=Ee(W[23]),ee[35]=Ee(W[32]),ee[36]=Ee(W[39]),ee[37]=Ee(W[45]),ee[38]=Ee(W[52]),ee[39]=Ee(W[54]),ee[40]=Ee(W[20]),ee[41]=Ee(W[22]),ee[42]=Ee(W[33]),ee[43]=Ee(W[38]),ee[44]=Ee(W[46]),ee[45]=Ee(W[51]),ee[46]=Ee(W[55]),ee[47]=Ee(W[60]),ee[48]=Ee(W[21]),ee[49]=Ee(W[34]),ee[50]=Ee(W[37]),ee[51]=Ee(W[47]),ee[52]=Ee(W[50]),ee[53]=Ee(W[56]),ee[54]=Ee(W[59]),ee[55]=Ee(W[61]),ee[56]=Ee(W[35]),ee[57]=Ee(W[36]),ee[58]=Ee(W[48]),ee[59]=Ee(W[49]),ee[60]=Ee(W[57]),ee[61]=Ee(W[58]),ee[62]=Ee(W[62]),ee[63]=Ee(W[63])}function at(W){const ee=.5*Math.cos(.7853975),ge=.5*Math.cos(3.14159/16),Ue=.5*Math.cos(3.14159/8),qe=.5*Math.cos(3*3.14159/16),Ye=.5*Math.cos(5*3.14159/16),Mt=.5*Math.cos(3*3.14159/8),vt=.5*Math.cos(7*3.14159/16);for(var Et=new Array(4),Tt=new Array(4),At=new Array(4),Ie=new Array(4),Z=0;Z<8;++Z){var de=Z*8;Et[0]=Ue*W[de+2],Et[1]=Mt*W[de+2],Et[2]=Ue*W[de+6],Et[3]=Mt*W[de+6],Tt[0]=ge*W[de+1]+qe*W[de+3]+Ye*W[de+5]+vt*W[de+7],Tt[1]=qe*W[de+1]-vt*W[de+3]-ge*W[de+5]-Ye*W[de+7],Tt[2]=Ye*W[de+1]-ge*W[de+3]+vt*W[de+5]+qe*W[de+7],Tt[3]=vt*W[de+1]-Ye*W[de+3]+qe*W[de+5]-ge*W[de+7],At[0]=ee*(W[de+0]+W[de+4]),At[3]=ee*(W[de+0]-W[de+4]),At[1]=Et[0]+Et[3],At[2]=Et[1]-Et[2],Ie[0]=At[0]+At[1],Ie[1]=At[3]+At[2],Ie[2]=At[3]-At[2],Ie[3]=At[0]-At[1],W[de+0]=Ie[0]+Tt[0],W[de+1]=Ie[1]+Tt[1],W[de+2]=Ie[2]+Tt[2],W[de+3]=Ie[3]+Tt[3],W[de+4]=Ie[3]-Tt[3],W[de+5]=Ie[2]-Tt[2],W[de+6]=Ie[1]-Tt[1],W[de+7]=Ie[0]-Tt[0]}for(var xe=0;xe<8;++xe)Et[0]=Ue*W[16+xe],Et[1]=Mt*W[16+xe],Et[2]=Ue*W[48+xe],Et[3]=Mt*W[48+xe],Tt[0]=ge*W[8+xe]+qe*W[24+xe]+Ye*W[40+xe]+vt*W[56+xe],Tt[1]=qe*W[8+xe]-vt*W[24+xe]-ge*W[40+xe]-Ye*W[56+xe],Tt[2]=Ye*W[8+xe]-ge*W[24+xe]+vt*W[40+xe]+qe*W[56+xe],Tt[3]=vt*W[8+xe]-Ye*W[24+xe]+qe*W[40+xe]-ge*W[56+xe],At[0]=ee*(W[xe]+W[32+xe]),At[3]=ee*(W[xe]-W[32+xe]),At[1]=Et[0]+Et[3],At[2]=Et[1]-Et[2],Ie[0]=At[0]+At[1],Ie[1]=At[3]+At[2],Ie[2]=At[3]-At[2],Ie[3]=At[0]-At[1],W[0+xe]=Ie[0]+Tt[0],W[8+xe]=Ie[1]+Tt[1],W[16+xe]=Ie[2]+Tt[2],W[24+xe]=Ie[3]+Tt[3],W[32+xe]=Ie[3]-Tt[3],W[40+xe]=Ie[2]-Tt[2],W[48+xe]=Ie[1]-Tt[1],W[56+xe]=Ie[0]-Tt[0]}function je(W){for(var ee=0;ee<64;++ee){var ge=W[0][ee],Ue=W[1][ee],qe=W[2][ee];W[0][ee]=ge+1.5747*qe,W[1][ee]=ge-.1873*Ue-.4682*qe,W[2][ee]=ge+1.8556*Ue}}function Ce(W,ee,ge){for(var Ue=0;Ue<64;++Ue)ee[ge+Ue]=Fc.toHalfFloat(He(W[Ue]))}function He(W){return W<=1?Math.sign(W)*Math.pow(Math.abs(W),2.2):Math.sign(W)*Math.pow(R,Math.abs(W)-1)}function q(W){return new DataView(W.array.buffer,W.offset.value,W.size)}function B(W){var ee=W.viewer.buffer.slice(W.offset.value,W.offset.value+W.size),ge=new Uint8Array(Be(ee)),Ue=new Uint8Array(ge.length);return pt(ge),Ne(ge,Ue),new DataView(Ue.buffer)}function ue(W){var ee=W.array.slice(W.offset.value,W.offset.value+W.size),ge=rg(ee),Ue=new Uint8Array(ge.length);return pt(ge),Ne(ge,Ue),new DataView(Ue.buffer)}function Re(W){for(var ee=W.viewer,ge={value:W.offset.value},Ue=new Uint16Array(W.width*W.scanlineBlockSize*(W.channels*W.type)),qe=new Uint8Array(8192),Ye=0,Mt=new Array(W.channels),vt=0;vt<W.channels;vt++)Mt[vt]={},Mt[vt].start=Ye,Mt[vt].end=Mt[vt].start,Mt[vt].nx=W.width,Mt[vt].ny=W.lines,Mt[vt].size=W.type,Ye+=Mt[vt].nx*Mt[vt].ny*Mt[vt].size;var Et=et(ee,ge),Tt=et(ee,ge);if(Tt>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(Et<=Tt)for(var vt=0;vt<Tt-Et+1;vt++)qe[vt+Et]=gt(ee,ge);var At=new Uint16Array(65536),Ie=U(qe,At),Z=Xe(ee,ge);Ke(W.array,ee,ge,Z,Ue,Ye);for(var vt=0;vt<W.channels;++vt)for(var de=Mt[vt],xe=0;xe<Mt[vt].size;++xe)ze(Ue,de.start+xe,de.nx,de.size,de.ny,de.nx*de.size,Ie);Qe(At,Ue,Ye);for(var Me=0,Se=new Uint8Array(Ue.buffer.byteLength),lt=0;lt<W.lines;lt++)for(var ut=0;ut<W.channels;ut++){var de=Mt[ut],Je=de.nx*de.size,ht=new Uint8Array(Ue.buffer,de.end*2,Je*2);Se.set(ht,Me),Me+=Je*2,de.end+=Je}return new DataView(Se.buffer)}function Pe(W){var ee=W.array.slice(W.offset.value,W.offset.value+W.size),ge=rg(ee);const Ue=W.lines*W.channels*W.width,qe=W.type==1?new Uint16Array(Ue):new Uint32Array(Ue);let Ye=0,Mt=0;const vt=new Array(4);for(let Et=0;Et<W.lines;Et++)for(let Tt=0;Tt<W.channels;Tt++){let At=0;switch(W.type){case 1:vt[0]=Ye,vt[1]=vt[0]+W.width,Ye=vt[1]+W.width;for(let Ie=0;Ie<W.width;++Ie){const Z=ge[vt[0]++]<<8|ge[vt[1]++];At+=Z,qe[Mt]=At,Mt++}break;case 2:vt[0]=Ye,vt[1]=vt[0]+W.width,vt[2]=vt[1]+W.width,Ye=vt[2]+W.width;for(let Ie=0;Ie<W.width;++Ie){const Z=ge[vt[0]++]<<24|ge[vt[1]++]<<16|ge[vt[2]++]<<8;At+=Z,qe[Mt]=At,Mt++}break}}return new DataView(qe.buffer)}function Te(W){var ee=W.viewer,ge={value:W.offset.value},Ue=new Uint8Array(W.width*W.lines*(W.channels*W.type*2)),qe={version:st(ee,ge),unknownUncompressedSize:st(ee,ge),unknownCompressedSize:st(ee,ge),acCompressedSize:st(ee,ge),dcCompressedSize:st(ee,ge),rleCompressedSize:st(ee,ge),rleUncompressedSize:st(ee,ge),rleRawSize:st(ee,ge),totalAcUncompressedCount:st(ee,ge),totalDcUncompressedCount:st(ee,ge),acCompression:st(ee,ge)};if(qe.version<2)throw"EXRLoader.parse: "+ri.compression+" version "+qe.version+" is unsupported";for(var Ye=new Array,Mt=et(ee,ge)-2;Mt>0;){var vt=ot(ee.buffer,ge),Et=gt(ee,ge),Tt=Et>>2&3,At=(Et>>4)-1,Ie=new Int8Array([At])[0],Z=gt(ee,ge);Ye.push({name:vt,index:Ie,type:Z,compression:Tt}),Mt-=vt.length+3}for(var de=ri.channels,xe=new Array(W.channels),Me=0;Me<W.channels;++Me){var Se=xe[Me]={},lt=de[Me];Se.name=lt.name,Se.compression=0,Se.decoded=!1,Se.type=lt.pixelType,Se.pLinear=lt.pLinear,Se.width=W.width,Se.height=W.lines}for(var ut={idx:new Array(3)},Je=0;Je<W.channels;++Je)for(var Se=xe[Je],Me=0;Me<Ye.length;++Me){var ht=Ye[Me];Se.name==ht.name&&(Se.compression=ht.compression,ht.index>=0&&(ut.idx[ht.index]=Je),Se.offset=Je)}if(qe.acCompressedSize>0)switch(qe.acCompression){case 0:var St=new Uint16Array(qe.totalAcUncompressedCount);Ke(W.array,ee,ge,qe.acCompressedSize,St,qe.totalAcUncompressedCount);break;case 1:var ft=W.array.slice(ge.value,ge.value+qe.totalAcUncompressedCount),Nt=rg(ft),St=new Uint16Array(Nt.buffer);ge.value+=qe.totalAcUncompressedCount;break}if(qe.dcCompressedSize>0){var Xt={array:W.array,offset:ge,size:qe.dcCompressedSize},un=new Uint16Array(ue(Xt).buffer);ge.value+=qe.dcCompressedSize}if(qe.rleRawSize>0){var ft=W.array.slice(ge.value,ge.value+qe.rleCompressedSize),Nt=rg(ft),dn=Be(Nt.buffer);ge.value+=qe.rleCompressedSize}for(var fn=0,Kt=new Array(xe.length),Me=0;Me<Kt.length;++Me)Kt[Me]=new Array;for(var Ut=0;Ut<W.lines;++Ut)for(var $t=0;$t<xe.length;++$t)Kt[$t].push(fn),fn+=xe[$t].width*W.type*2;De(ut,Kt,xe,St,un,Ue);for(var Me=0;Me<xe.length;++Me){var Se=xe[Me];if(!Se.decoded)switch(Se.compression){case 2:for(var Dt=0,bn=0,Ut=0;Ut<W.lines;++Ut){for(var mi=Kt[Me][Dt],In=0;In<Se.width;++In){for(var Hi=0;Hi<2*Se.type;++Hi)Ue[mi++]=dn[bn+Hi*Se.width*Se.height];bn++}Dt++}break;case 1:default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(Ue.buffer)}function ot(W,ee){for(var ge=new Uint8Array(W),Ue=0;ge[ee.value+Ue]!=0;)Ue+=1;var qe=new TextDecoder().decode(ge.slice(ee.value,ee.value+Ue));return ee.value=ee.value+Ue+1,qe}function rt(W,ee,ge){var Ue=new TextDecoder().decode(new Uint8Array(W).slice(ee.value,ee.value+ge));return ee.value=ee.value+ge,Ue}function mt(W,ee){var ge=Ge(W,ee),Ue=Xe(W,ee);return[ge,Ue]}function Rt(W,ee){var ge=Xe(W,ee),Ue=Xe(W,ee);return[ge,Ue]}function Ge(W,ee){var ge=W.getInt32(ee.value,!0);return ee.value=ee.value+4,ge}function Xe(W,ee){var ge=W.getUint32(ee.value,!0);return ee.value=ee.value+4,ge}function nt(W,ee){var ge=W[ee.value];return ee.value=ee.value+1,ge}function gt(W,ee){var ge=W.getUint8(ee.value);return ee.value=ee.value+1,ge}const st=function(W,ee){let ge;return"getBigInt64"in DataView.prototype?ge=Number(W.getBigInt64(ee.value,!0)):ge=W.getUint32(ee.value+4,!0)+Number(W.getUint32(ee.value,!0)<<32),ee.value+=8,ge};function Ot(W,ee){var ge=W.getFloat32(ee.value,!0);return ee.value+=4,ge}function pe(W,ee){return Fc.toHalfFloat(Ot(W,ee))}function Ee(W){var ee=(W&31744)>>10,ge=W&1023;return(W>>15?-1:1)*(ee?ee===31?ge?NaN:1/0:Math.pow(2,ee-15)*(1+ge/1024):6103515625e-14*(ge/1024))}function et(W,ee){var ge=W.getUint16(ee.value,!0);return ee.value+=2,ge}function Pt(W,ee){return Ee(et(W,ee))}function tt(W,ee,ge,Ue){for(var qe=ge.value,Ye=[];ge.value<qe+Ue-1;){var Mt=ot(ee,ge),vt=Ge(W,ge),Et=gt(W,ge);ge.value+=3;var Tt=Ge(W,ge),At=Ge(W,ge);Ye.push({name:Mt,pixelType:vt,pLinear:Et,xSampling:Tt,ySampling:At})}return ge.value+=1,Ye}function ke(W,ee){var ge=Ot(W,ee),Ue=Ot(W,ee),qe=Ot(W,ee),Ye=Ot(W,ee),Mt=Ot(W,ee),vt=Ot(W,ee),Et=Ot(W,ee),Tt=Ot(W,ee);return{redX:ge,redY:Ue,greenX:qe,greenY:Ye,blueX:Mt,blueY:vt,whiteX:Et,whiteY:Tt}}function dt(W,ee){var ge=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],Ue=gt(W,ee);return ge[Ue]}function kt(W,ee){var ge=Xe(W,ee),Ue=Xe(W,ee),qe=Xe(W,ee),Ye=Xe(W,ee);return{xMin:ge,yMin:Ue,xMax:qe,yMax:Ye}}function zt(W,ee){var ge=["INCREASING_Y"],Ue=gt(W,ee);return ge[Ue]}function nn(W,ee){var ge=Ot(W,ee),Ue=Ot(W,ee);return[ge,Ue]}function zn(W,ee){var ge=Ot(W,ee),Ue=Ot(W,ee),qe=Ot(W,ee);return[ge,Ue,qe]}function Un(W,ee,ge,Ue,qe){if(Ue==="string"||Ue==="stringvector"||Ue==="iccProfile")return rt(ee,ge,qe);if(Ue==="chlist")return tt(W,ee,ge,qe);if(Ue==="chromaticities")return ke(W,ge);if(Ue==="compression")return dt(W,ge);if(Ue==="box2i")return kt(W,ge);if(Ue==="lineOrder")return zt(W,ge);if(Ue==="float")return Ot(W,ge);if(Ue==="v2f")return nn(W,ge);if(Ue==="v3f")return zn(W,ge);if(Ue==="int")return Ge(W,ge);if(Ue==="rational")return mt(W,ge);if(Ue==="timecode")return Rt(W,ge);if(Ue==="preview")return ge.value+=qe,"skipped";ge.value+=qe}function Kn(W,ee,ge){const Ue={};if(W.getUint32(0,!0)!=20000630)throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";Ue.version=W.getUint8(4);const qe=W.getUint8(5);Ue.spec={singleTile:!!(qe&2),longName:!!(qe&4),deepFormat:!!(qe&8),multiPart:!!(qe&16)},ge.value=8;for(var Ye=!0;Ye;){var Mt=ot(ee,ge);if(Mt==0)Ye=!1;else{var vt=ot(ee,ge),Et=Xe(W,ge),Tt=Un(W,ee,ge,vt,Et);Tt===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${vt}'.`):Ue[Mt]=Tt}}if((qe&-5)!=0)throw console.error("EXRHeader:",Ue),"THREE.EXRLoader: provided file is currently unsupported.";return Ue}function Si(W,ee,ge,Ue,qe){const Ye={size:0,viewer:ee,array:ge,offset:Ue,width:W.dataWindow.xMax-W.dataWindow.xMin+1,height:W.dataWindow.yMax-W.dataWindow.yMin+1,channels:W.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:W.channels[0].pixelType,uncompress:null,getter:null,format:null,[ip?"colorSpace":"encoding"]:null};switch(W.compression){case"NO_COMPRESSION":Ye.lines=1,Ye.uncompress=q;break;case"RLE_COMPRESSION":Ye.lines=1,Ye.uncompress=B;break;case"ZIPS_COMPRESSION":Ye.lines=1,Ye.uncompress=ue;break;case"ZIP_COMPRESSION":Ye.lines=16,Ye.uncompress=ue;break;case"PIZ_COMPRESSION":Ye.lines=32,Ye.uncompress=Re;break;case"PXR24_COMPRESSION":Ye.lines=16,Ye.uncompress=Pe;break;case"DWAA_COMPRESSION":Ye.lines=32,Ye.uncompress=Te;break;case"DWAB_COMPRESSION":Ye.lines=256,Ye.uncompress=Te;break;default:throw"EXRLoader.parse: "+W.compression+" is unsupported"}if(Ye.scanlineBlockSize=Ye.lines,Ye.type==1)switch(qe){case bi:Ye.getter=Pt,Ye.inputSize=2;break;case Vi:Ye.getter=et,Ye.inputSize=2;break}else if(Ye.type==2)switch(qe){case bi:Ye.getter=Ot,Ye.inputSize=4;break;case Vi:Ye.getter=pe,Ye.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+Ye.type+" for "+W.compression+".";Ye.blockCount=(W.dataWindow.yMax+1)/Ye.scanlineBlockSize;for(var Mt=0;Mt<Ye.blockCount;Mt++)st(ee,Ue);Ye.outputChannels=Ye.channels==3?4:Ye.channels;const vt=Ye.width*Ye.height*Ye.outputChannels;switch(qe){case bi:Ye.byteArray=new Float32Array(vt),Ye.channels<Ye.outputChannels&&Ye.byteArray.fill(1,0,vt);break;case Vi:Ye.byteArray=new Uint16Array(vt),Ye.channels<Ye.outputChannels&&Ye.byteArray.fill(15360,0,vt);break;default:console.error("THREE.EXRLoader: unsupported type: ",qe);break}return Ye.bytesPerLine=Ye.width*Ye.inputSize*Ye.channels,Ye.outputChannels==4?Ye.format=Ki:Ye.format=n0,ip?Ye.colorSpace="srgb-linear":Ye.encoding=3e3,Ye}const Di=new DataView(e),Ai=new Uint8Array(e),Mi={value:0},ri=Kn(Di,e,Mi),on=Si(ri,Di,Ai,Mi,this.type),li={value:0},Xr={R:0,G:1,B:2,A:3,Y:0};for(let W=0;W<on.height/on.scanlineBlockSize;W++){const ee=Xe(Di,Mi);on.size=Xe(Di,Mi),on.lines=ee+on.scanlineBlockSize>on.height?on.height-ee:on.scanlineBlockSize;const Ue=on.size<on.lines*on.bytesPerLine?on.uncompress(on):q(on);Mi.value+=on.size;for(let qe=0;qe<on.scanlineBlockSize;qe++){const Ye=qe+W*on.scanlineBlockSize;if(Ye>=on.height)break;for(let Mt=0;Mt<on.channels;Mt++){const vt=Xr[ri.channels[Mt].name];for(let Et=0;Et<on.width;Et++){li.value=(qe*(on.channels*on.width)+Mt*on.width+Et)*on.inputSize;const Tt=(on.height-1-Ye)*(on.width*on.outputChannels)+Et*on.outputChannels+vt;on.byteArray[Tt]=on.getter(Ue,li)}}}}return{header:ri,width:on.width,height:on.height,data:on.byteArray,format:on.format,[ip?"colorSpace":"encoding"]:on[ip?"colorSpace":"encoding"],type:this.type}}setDataType(e){return this.type=e,this}load(e,t,r,i){function s(a,o){ip?a.colorSpace=o.colorSpace:a.encoding=o.encoding,a.minFilter=Dn,a.magFilter=Dn,a.generateMipmaps=!1,a.flipY=!1,t&&t(a,o)}return super.load(e,s,r,i)}}function yD(){var n=Object.create(null);function e(i,s){var a=i.id,o=i.name,u=i.dependencies;u===void 0&&(u=[]);var c=i.init;c===void 0&&(c=function(){});var f=i.getTransferables;if(f===void 0&&(f=null),!n[a])try{u=u.map(function(g){return g&&g.isWorkerModule&&(e(g,function(y){if(y instanceof Error)throw y}),g=n[g.id].value),g}),c=r("<"+o+">.init",c),f&&(f=r("<"+o+">.getTransferables",f));var m=null;typeof c=="function"?m=c.apply(void 0,u):console.error("worker module init function failed to rehydrate"),n[a]={id:a,value:m,getTransferables:f},s(m)}catch(g){g&&g.noLog||console.error(g),s(g)}}function t(i,s){var a,o=i.id,u=i.args;(!n[o]||typeof n[o].value!="function")&&s(new Error("Worker module "+o+": not found or its 'init' did not return a function"));try{var c=(a=n[o]).value.apply(a,u);c&&typeof c.then=="function"?c.then(f,function(m){return s(m instanceof Error?m:new Error(""+m))}):f(c)}catch(m){s(m)}function f(m){try{var g=n[o].getTransferables&&n[o].getTransferables(m);(!g||!Array.isArray(g)||!g.length)&&(g=void 0),s(m,g)}catch(y){console.error(y),s(y)}}}function r(i,s){var a=void 0;self.troikaDefine=function(u){return a=u};var o=URL.createObjectURL(new Blob(["/** "+i.replace(/\*/g,"")+` **/

troikaDefine(
`+s+`
)`],{type:"application/javascript"}));try{importScripts(o)}catch(u){console.error(u)}return URL.revokeObjectURL(o),delete self.troikaDefine,a}self.addEventListener("message",function(i){var s=i.data,a=s.messageId,o=s.action,u=s.data;try{o==="registerModule"&&e(u,function(c){c instanceof Error?postMessage({messageId:a,success:!1,error:c.message}):postMessage({messageId:a,success:!0,result:{isCallable:typeof c=="function"}})}),o==="callModule"&&t(u,function(c,f){c instanceof Error?postMessage({messageId:a,success:!1,error:c.message}):postMessage({messageId:a,success:!0,result:c},f||void 0)})}catch(c){postMessage({messageId:a,success:!1,error:c.stack})}})}function _D(n){var e=function(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];return e._getInitResult().then(function(i){if(typeof i=="function")return i.apply(void 0,t);throw new Error("Worker module function was called but `init` did not return a callable function")})};return e._getInitResult=function(){var t=n.dependencies,r=n.init;t=Array.isArray(t)?t.map(function(s){return s&&(s=s.onMainThread||s,s._getInitResult&&(s=s._getInitResult())),s}):[];var i=Promise.all(t).then(function(s){return r.apply(null,s)});return e._getInitResult=function(){return i},i},e}var W3=function(){var n=!1;if(typeof window<"u"&&typeof window.document<"u")try{var e=new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})));e.terminate(),n=!0}catch(t){console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+t.message+"]")}return W3=function(){return n},n},xD=0,SD=0,e_=!1,Ep=Object.create(null),Tp=Object.create(null),R_=Object.create(null);function Yf(n){if((!n||typeof n.init!="function")&&!e_)throw new Error("requires `options.init` function");var e=n.dependencies,t=n.init,r=n.getTransferables,i=n.workerId,s=_D(n);i==null&&(i="#default");var a="workerModule"+ ++xD,o=n.name||a,u=null;e=e&&e.map(function(f){return typeof f=="function"&&!f.workerModuleData&&(e_=!0,f=Yf({workerId:i,name:"<"+o+"> function dependency: "+f.name,init:`function(){return (
`+_g(f)+`
)}`}),e_=!1),f&&f.workerModuleData&&(f=f.workerModuleData),f});function c(){for(var f=[],m=arguments.length;m--;)f[m]=arguments[m];if(!W3())return s.apply(void 0,f);if(!u){u=G2(i,"registerModule",c.workerModuleData);var g=function(){u=null,Tp[i].delete(g)};(Tp[i]||(Tp[i]=new Set)).add(g)}return u.then(function(y){var _=y.isCallable;if(_)return G2(i,"callModule",{id:a,args:f});throw new Error("Worker module function was called but `init` did not return a callable function")})}return c.workerModuleData={isWorkerModule:!0,id:a,name:o,dependencies:e,init:_g(t),getTransferables:r&&_g(r)},c.onMainThread=s,c}function MD(n){Tp[n]&&Tp[n].forEach(function(e){e()}),Ep[n]&&(Ep[n].terminate(),delete Ep[n])}function _g(n){var e=n.toString();return!/^function/.test(e)&&/^\w+\s*\(/.test(e)&&(e="function "+e),e}function wD(n){var e=Ep[n];if(!e){var t=_g(yD);e=Ep[n]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+n.replace(/\*/g,"")+` **/

;(`+t+")()"],{type:"application/javascript"}))),e.onmessage=function(r){var i=r.data,s=i.messageId,a=R_[s];if(!a)throw new Error("WorkerModule response with empty or unknown messageId");delete R_[s],a(i)}}return e}function G2(n,e,t){return new Promise(function(r,i){var s=++SD;R_[s]=function(a){a.success?r(a.result):i(new Error("Error in worker "+e+" call: "+a.error))},wD(n).postMessage({messageId:s,action:e,data:t})})}function j3(){var n=(function(e){function t(ie,Y,z,K,le,me,ve,re){var he=1-ve;re.x=he*he*ie+2*he*ve*z+ve*ve*le,re.y=he*he*Y+2*he*ve*K+ve*ve*me}function r(ie,Y,z,K,le,me,ve,re,he,ye){var ze=1-he;ye.x=ze*ze*ze*ie+3*ze*ze*he*z+3*ze*he*he*le+he*he*he*ve,ye.y=ze*ze*ze*Y+3*ze*ze*he*K+3*ze*he*he*me+he*he*he*re}function i(ie,Y){for(var z=/([MLQCZ])([^MLQCZ]*)/g,K,le,me,ve,re;K=z.exec(ie);){var he=K[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(ye){return parseFloat(ye)});switch(K[1]){case"M":ve=le=he[0],re=me=he[1];break;case"L":(he[0]!==ve||he[1]!==re)&&Y("L",ve,re,ve=he[0],re=he[1]);break;case"Q":{Y("Q",ve,re,ve=he[2],re=he[3],he[0],he[1]);break}case"C":{Y("C",ve,re,ve=he[4],re=he[5],he[0],he[1],he[2],he[3]);break}case"Z":(ve!==le||re!==me)&&Y("L",ve,re,le,me);break}}}function s(ie,Y,z){z===void 0&&(z=16);var K={x:0,y:0};i(ie,function(le,me,ve,re,he,ye,ze,Ve,Ke){switch(le){case"L":Y(me,ve,re,he);break;case"Q":{for(var Qe=me,pt=ve,Ne=1;Ne<z;Ne++)t(me,ve,ye,ze,re,he,Ne/(z-1),K),Y(Qe,pt,K.x,K.y),Qe=K.x,pt=K.y;break}case"C":{for(var Be=me,De=ve,it=1;it<z;it++)r(me,ve,ye,ze,Ve,Ke,re,he,it/(z-1),K),Y(Be,De,K.x,K.y),Be=K.x,De=K.y;break}}})}var a="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",o="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",u=new WeakMap,c={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function f(ie,Y){var z=ie.getContext?ie.getContext("webgl",c):ie,K=u.get(z);if(!K){let Be=function(Ce){var He=me[Ce];if(!He&&(He=me[Ce]=z.getExtension(Ce),!He))throw new Error(Ce+" not supported");return He},De=function(Ce,He){var q=z.createShader(He);return z.shaderSource(q,Ce),z.compileShader(q),q},it=function(Ce,He,q,B){if(!ve[Ce]){var ue={},Re={},Pe=z.createProgram();z.attachShader(Pe,De(He,z.VERTEX_SHADER)),z.attachShader(Pe,De(q,z.FRAGMENT_SHADER)),z.linkProgram(Pe),ve[Ce]={program:Pe,transaction:function(ot){z.useProgram(Pe),ot({setUniform:function(mt,Rt){for(var Ge=[],Xe=arguments.length-2;Xe-- >0;)Ge[Xe]=arguments[Xe+2];var nt=Re[Rt]||(Re[Rt]=z.getUniformLocation(Pe,Rt));z["uniform"+mt].apply(z,[nt].concat(Ge))},setAttribute:function(mt,Rt,Ge,Xe,nt){var gt=ue[mt];gt||(gt=ue[mt]={buf:z.createBuffer(),loc:z.getAttribLocation(Pe,mt),data:null}),z.bindBuffer(z.ARRAY_BUFFER,gt.buf),z.vertexAttribPointer(gt.loc,Rt,z.FLOAT,!1,0,0),z.enableVertexAttribArray(gt.loc),le?z.vertexAttribDivisor(gt.loc,Xe):Be("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(gt.loc,Xe),nt!==gt.data&&(z.bufferData(z.ARRAY_BUFFER,nt,Ge),gt.data=nt)}})}}}ve[Ce].transaction(B)},Q=function(Ce,He){he++;try{z.activeTexture(z.TEXTURE0+he);var q=re[Ce];q||(q=re[Ce]=z.createTexture(),z.bindTexture(z.TEXTURE_2D,q),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MIN_FILTER,z.NEAREST),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MAG_FILTER,z.NEAREST)),z.bindTexture(z.TEXTURE_2D,q),He(q,he)}finally{he--}},at=function(Ce,He,q){var B=z.createFramebuffer();ye.push(B),z.bindFramebuffer(z.FRAMEBUFFER,B),z.activeTexture(z.TEXTURE0+He),z.bindTexture(z.TEXTURE_2D,Ce),z.framebufferTexture2D(z.FRAMEBUFFER,z.COLOR_ATTACHMENT0,z.TEXTURE_2D,Ce,0);try{q(B)}finally{z.deleteFramebuffer(B),z.bindFramebuffer(z.FRAMEBUFFER,ye[--ye.length-1]||null)}},je=function(){me={},ve={},re={},he=-1,ye.length=0};var ze=Be,Ve=De,Ke=it,Qe=Q,pt=at,Ne=je,le=typeof WebGL2RenderingContext<"u"&&z instanceof WebGL2RenderingContext,me={},ve={},re={},he=-1,ye=[];z.canvas.addEventListener("webglcontextlost",function(Ce){je(),Ce.preventDefault()},!1),u.set(z,K={gl:z,isWebGL2:le,getExtension:Be,withProgram:it,withTexture:Q,withTextureFramebuffer:at,handleContextLoss:je})}Y(K)}function m(ie,Y,z,K,le,me,ve,re){ve===void 0&&(ve=15),re===void 0&&(re=null),f(ie,function(he){var ye=he.gl,ze=he.withProgram,Ve=he.withTexture;Ve("copy",function(Ke,Qe){ye.texImage2D(ye.TEXTURE_2D,0,ye.RGBA,le,me,0,ye.RGBA,ye.UNSIGNED_BYTE,Y),ze("copy",a,o,function(pt){var Ne=pt.setUniform,Be=pt.setAttribute;Be("aUV",2,ye.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),Ne("1i","image",Qe),ye.bindFramebuffer(ye.FRAMEBUFFER,re||null),ye.disable(ye.BLEND),ye.colorMask(ve&8,ve&4,ve&2,ve&1),ye.viewport(z,K,le,me),ye.scissor(z,K,le,me),ye.drawArrays(ye.TRIANGLES,0,3)})})})}function g(ie,Y,z){var K=ie.width,le=ie.height;f(ie,function(me){var ve=me.gl,re=new Uint8Array(K*le*4);ve.readPixels(0,0,K,le,ve.RGBA,ve.UNSIGNED_BYTE,re),ie.width=Y,ie.height=z,m(ve,re,0,0,K,le)})}var y=Object.freeze({__proto__:null,withWebGLContext:f,renderImageData:m,resizeWebGLCanvasWithoutClearing:g});function _(ie,Y,z,K,le,me){me===void 0&&(me=1);var ve=new Uint8Array(ie*Y),re=K[2]-K[0],he=K[3]-K[1],ye=[];s(z,function(Be,De,it,Q){ye.push({x1:Be,y1:De,x2:it,y2:Q,minX:Math.min(Be,it),minY:Math.min(De,Q),maxX:Math.max(Be,it),maxY:Math.max(De,Q)})}),ye.sort(function(Be,De){return Be.maxX-De.maxX});for(var ze=0;ze<ie;ze++)for(var Ve=0;Ve<Y;Ve++){var Ke=pt(K[0]+re*(ze+.5)/ie,K[1]+he*(Ve+.5)/Y),Qe=Math.pow(1-Math.abs(Ke)/le,me)/2;Ke<0&&(Qe=1-Qe),Qe=Math.max(0,Math.min(255,Math.round(Qe*255))),ve[Ve*ie+ze]=Qe}return ve;function pt(Be,De){for(var it=1/0,Q=1/0,at=ye.length;at--;){var je=ye[at];if(je.maxX+Q<=Be)break;if(Be+Q>je.minX&&De-Q<je.maxY&&De+Q>je.minY){var Ce=S(Be,De,je.x1,je.y1,je.x2,je.y2);Ce<it&&(it=Ce,Q=Math.sqrt(it))}}return Ne(Be,De)&&(Q=-Q),Q}function Ne(Be,De){for(var it=0,Q=ye.length;Q--;){var at=ye[Q];if(at.maxX<=Be)break;var je=at.y1>De!=at.y2>De&&Be<(at.x2-at.x1)*(De-at.y1)/(at.y2-at.y1)+at.x1;je&&(it+=at.y1<at.y2?1:-1)}return it!==0}}function E(ie,Y,z,K,le,me,ve,re,he,ye){me===void 0&&(me=1),re===void 0&&(re=0),he===void 0&&(he=0),ye===void 0&&(ye=0),x(ie,Y,z,K,le,me,ve,null,re,he,ye)}function x(ie,Y,z,K,le,me,ve,re,he,ye,ze){me===void 0&&(me=1),he===void 0&&(he=0),ye===void 0&&(ye=0),ze===void 0&&(ze=0);for(var Ve=_(ie,Y,z,K,le,me),Ke=new Uint8Array(Ve.length*4),Qe=0;Qe<Ve.length;Qe++)Ke[Qe*4+ze]=Ve[Qe];m(ve,Ke,he,ye,ie,Y,1<<3-ze,re)}function S(ie,Y,z,K,le,me){var ve=le-z,re=me-K,he=ve*ve+re*re,ye=he?Math.max(0,Math.min(1,((ie-z)*ve+(Y-K)*re)/he)):0,ze=ie-(z+ye*ve),Ve=Y-(K+ye*re);return ze*ze+Ve*Ve}var T=Object.freeze({__proto__:null,generate:_,generateIntoCanvas:E,generateIntoFramebuffer:x}),A="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",P="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",L="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",D=new Float32Array([0,0,2,0,0,2]),F=null,k=!1,R={},U=new WeakMap;function V(ie){if(!k&&!ae(ie))throw new Error("WebGL generation not supported")}function H(ie,Y,z,K,le,me,ve){if(me===void 0&&(me=1),ve===void 0&&(ve=null),!ve&&(ve=F,!ve)){var re=typeof OffscreenCanvas=="function"?new OffscreenCanvas(1,1):typeof document<"u"?document.createElement("canvas"):null;if(!re)throw new Error("OffscreenCanvas or DOM canvas not supported");ve=F=re.getContext("webgl",{depth:!1})}V(ve);var he=new Uint8Array(ie*Y*4);f(ve,function(Ke){var Qe=Ke.gl,pt=Ke.withTexture,Ne=Ke.withTextureFramebuffer;pt("readable",function(Be,De){Qe.texImage2D(Qe.TEXTURE_2D,0,Qe.RGBA,ie,Y,0,Qe.RGBA,Qe.UNSIGNED_BYTE,null),Ne(Be,De,function(it){$(ie,Y,z,K,le,me,Qe,it,0,0,0),Qe.readPixels(0,0,ie,Y,Qe.RGBA,Qe.UNSIGNED_BYTE,he)})})});for(var ye=new Uint8Array(ie*Y),ze=0,Ve=0;ze<he.length;ze+=4)ye[Ve++]=he[ze];return ye}function J(ie,Y,z,K,le,me,ve,re,he,ye){me===void 0&&(me=1),re===void 0&&(re=0),he===void 0&&(he=0),ye===void 0&&(ye=0),$(ie,Y,z,K,le,me,ve,null,re,he,ye)}function $(ie,Y,z,K,le,me,ve,re,he,ye,ze){me===void 0&&(me=1),he===void 0&&(he=0),ye===void 0&&(ye=0),ze===void 0&&(ze=0),V(ve);var Ve=[];s(z,function(Ke,Qe,pt,Ne){Ve.push(Ke,Qe,pt,Ne)}),Ve=new Float32Array(Ve),f(ve,function(Ke){var Qe=Ke.gl,pt=Ke.isWebGL2,Ne=Ke.getExtension,Be=Ke.withProgram,De=Ke.withTexture,it=Ke.withTextureFramebuffer,Q=Ke.handleContextLoss;if(De("rawDistances",function(at,je){(ie!==at._lastWidth||Y!==at._lastHeight)&&Qe.texImage2D(Qe.TEXTURE_2D,0,Qe.RGBA,at._lastWidth=ie,at._lastHeight=Y,0,Qe.RGBA,Qe.UNSIGNED_BYTE,null),Be("main",A,P,function(Ce){var He=Ce.setAttribute,q=Ce.setUniform,B=!pt&&Ne("ANGLE_instanced_arrays"),ue=!pt&&Ne("EXT_blend_minmax");He("aUV",2,Qe.STATIC_DRAW,0,D),He("aLineSegment",4,Qe.DYNAMIC_DRAW,1,Ve),q.apply(void 0,["4f","uGlyphBounds"].concat(K)),q("1f","uMaxDistance",le),q("1f","uExponent",me),it(at,je,function(Re){Qe.enable(Qe.BLEND),Qe.colorMask(!0,!0,!0,!0),Qe.viewport(0,0,ie,Y),Qe.scissor(0,0,ie,Y),Qe.blendFunc(Qe.ONE,Qe.ONE),Qe.blendEquationSeparate(Qe.FUNC_ADD,pt?Qe.MAX:ue.MAX_EXT),Qe.clear(Qe.COLOR_BUFFER_BIT),pt?Qe.drawArraysInstanced(Qe.TRIANGLES,0,3,Ve.length/4):B.drawArraysInstancedANGLE(Qe.TRIANGLES,0,3,Ve.length/4)})}),Be("post",a,L,function(Ce){Ce.setAttribute("aUV",2,Qe.STATIC_DRAW,0,D),Ce.setUniform("1i","tex",je),Qe.bindFramebuffer(Qe.FRAMEBUFFER,re),Qe.disable(Qe.BLEND),Qe.colorMask(ze===0,ze===1,ze===2,ze===3),Qe.viewport(he,ye,ie,Y),Qe.scissor(he,ye,ie,Y),Qe.drawArrays(Qe.TRIANGLES,0,3)})}),Qe.isContextLost())throw Q(),new Error("webgl context lost")})}function ae(ie){var Y=!ie||ie===F?R:ie.canvas||ie,z=U.get(Y);if(z===void 0){k=!0;var K=null;try{var le=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],me=H(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,ie);z=me&&le.length===me.length&&me.every(function(ve,re){return ve===le[re]}),z||(K="bad trial run results",console.info(le,me))}catch(ve){z=!1,K=ve.message}K&&console.warn("WebGL SDF generation not supported:",K),k=!1,U.set(Y,z)}return z}var ne=Object.freeze({__proto__:null,generate:H,generateIntoCanvas:J,generateIntoFramebuffer:$,isSupported:ae});function oe(ie,Y,z,K,le,me){le===void 0&&(le=Math.max(K[2]-K[0],K[3]-K[1])/2),me===void 0&&(me=1);try{return H.apply(ne,arguments)}catch(ve){return console.info("WebGL SDF generation failed, falling back to JS",ve),_.apply(T,arguments)}}function te(ie,Y,z,K,le,me,ve,re,he,ye){le===void 0&&(le=Math.max(K[2]-K[0],K[3]-K[1])/2),me===void 0&&(me=1),re===void 0&&(re=0),he===void 0&&(he=0),ye===void 0&&(ye=0);try{return J.apply(ne,arguments)}catch(ze){return console.info("WebGL SDF generation failed, falling back to JS",ze),E.apply(T,arguments)}}return e.forEachPathCommand=i,e.generate=oe,e.generateIntoCanvas=te,e.javascript=T,e.pathToLineSegments=s,e.webgl=ne,e.webglUtils=y,Object.defineProperty(e,"__esModule",{value:!0}),e})({});return n}function ED(){var n=(function(e){var t={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},r={},i={};r.L=1,i[1]="L",Object.keys(t).forEach(function(Q,at){r[Q]=1<<at+1,i[r[Q]]=Q}),Object.freeze(r);var s=r.LRI|r.RLI|r.FSI,a=r.L|r.R|r.AL,o=r.B|r.S|r.WS|r.ON|r.FSI|r.LRI|r.RLI|r.PDI,u=r.BN|r.RLE|r.LRE|r.RLO|r.LRO|r.PDF,c=r.S|r.WS|r.B|s|r.PDI|u,f=null;function m(){if(!f){f=new Map;var Q=function(je){if(t.hasOwnProperty(je)){var Ce=0;t[je].split(",").forEach(function(He){var q=He.split("+"),B=q[0],ue=q[1];B=parseInt(B,36),ue=ue?parseInt(ue,36):0,f.set(Ce+=B,r[je]);for(var Re=0;Re<ue;Re++)f.set(++Ce,r[je])})}};for(var at in t)Q(at)}}function g(Q){return m(),f.get(Q.codePointAt(0))||r.L}function y(Q){return i[g(Q)]}var _={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function E(Q,at){var je=36,Ce=0,He=new Map,q=at&&new Map,B;return Q.split(",").forEach(function ue(Re){if(Re.indexOf("+")!==-1)for(var Pe=+Re;Pe--;)ue(B);else{B=Re;var Te=Re.split(">"),ot=Te[0],rt=Te[1];ot=String.fromCodePoint(Ce+=parseInt(ot,je)),rt=String.fromCodePoint(Ce+=parseInt(rt,je)),He.set(ot,rt),at&&q.set(rt,ot)}}),{map:He,reverseMap:q}}var x,S,T;function A(){if(!x){var Q=E(_.pairs,!0),at=Q.map,je=Q.reverseMap;x=at,S=je,T=E(_.canonical,!1).map}}function P(Q){return A(),x.get(Q)||null}function L(Q){return A(),S.get(Q)||null}function D(Q){return A(),T.get(Q)||null}var F=r.L,k=r.R,R=r.EN,U=r.ES,V=r.ET,H=r.AN,J=r.CS,$=r.B,ae=r.S,ne=r.ON,oe=r.BN,te=r.NSM,ie=r.AL,Y=r.LRO,z=r.RLO,K=r.LRE,le=r.RLE,me=r.PDF,ve=r.LRI,re=r.RLI,he=r.FSI,ye=r.PDI;function ze(Q,at){for(var je=125,Ce=new Uint32Array(Q.length),He=0;He<Q.length;He++)Ce[He]=g(Q[He]);var q=new Map;function B(Ui,ji){var Pi=Ce[Ui];Ce[Ui]=ji,q.set(Pi,q.get(Pi)-1),Pi&o&&q.set(o,q.get(o)-1),q.set(ji,(q.get(ji)||0)+1),ji&o&&q.set(o,(q.get(o)||0)+1)}for(var ue=new Uint8Array(Q.length),Re=new Map,Pe=[],Te=null,ot=0;ot<Q.length;ot++)Te||Pe.push(Te={start:ot,end:Q.length-1,level:at==="rtl"?1:at==="ltr"?0:ir(ot,!1)}),Ce[ot]&$&&(Te.end=ot,Te=null);for(var rt=le|K|z|Y|s|ye|me|$,mt=function(Ui){return Ui+(Ui&1?1:2)},Rt=function(Ui){return Ui+(Ui&1?2:1)},Ge=0;Ge<Pe.length;Ge++){Te=Pe[Ge];var Xe=[{_level:Te.level,_override:0,_isolate:0}],nt=void 0,gt=0,st=0,Ot=0;q.clear();for(var pe=Te.start;pe<=Te.end;pe++){var Ee=Ce[pe];if(nt=Xe[Xe.length-1],q.set(Ee,(q.get(Ee)||0)+1),Ee&o&&q.set(o,(q.get(o)||0)+1),Ee&rt)if(Ee&(le|K)){ue[pe]=nt._level;var et=(Ee===le?Rt:mt)(nt._level);et<=je&&!gt&&!st?Xe.push({_level:et,_override:0,_isolate:0}):gt||st++}else if(Ee&(z|Y)){ue[pe]=nt._level;var Pt=(Ee===z?Rt:mt)(nt._level);Pt<=je&&!gt&&!st?Xe.push({_level:Pt,_override:Ee&z?k:F,_isolate:0}):gt||st++}else if(Ee&s){Ee&he&&(Ee=ir(pe+1,!0)===1?re:ve),ue[pe]=nt._level,nt._override&&B(pe,nt._override);var tt=(Ee===re?Rt:mt)(nt._level);tt<=je&&gt===0&&st===0?(Ot++,Xe.push({_level:tt,_override:0,_isolate:1,_isolInitIndex:pe})):gt++}else if(Ee&ye){if(gt>0)gt--;else if(Ot>0){for(st=0;!Xe[Xe.length-1]._isolate;)Xe.pop();var ke=Xe[Xe.length-1]._isolInitIndex;ke!=null&&(Re.set(ke,pe),Re.set(pe,ke)),Xe.pop(),Ot--}nt=Xe[Xe.length-1],ue[pe]=nt._level,nt._override&&B(pe,nt._override)}else Ee&me?(gt===0&&(st>0?st--:!nt._isolate&&Xe.length>1&&(Xe.pop(),nt=Xe[Xe.length-1])),ue[pe]=nt._level):Ee&$&&(ue[pe]=Te.level);else ue[pe]=nt._level,nt._override&&Ee!==oe&&B(pe,nt._override)}for(var dt=[],kt=null,zt=Te.start;zt<=Te.end;zt++){var nn=Ce[zt];if(!(nn&u)){var zn=ue[zt],Un=nn&s,Kn=nn===ye;kt&&zn===kt._level?(kt._end=zt,kt._endsWithIsolInit=Un):dt.push(kt={_start:zt,_end:zt,_level:zn,_startsWithPDI:Kn,_endsWithIsolInit:Un})}}for(var Si=[],Di=0;Di<dt.length;Di++){var Ai=dt[Di];if(!Ai._startsWithPDI||Ai._startsWithPDI&&!Re.has(Ai._start)){for(var Mi=[kt=Ai],ri=void 0;kt&&kt._endsWithIsolInit&&(ri=Re.get(kt._end))!=null;)for(var on=Di+1;on<dt.length;on++)if(dt[on]._start===ri){Mi.push(kt=dt[on]);break}for(var li=[],Xr=0;Xr<Mi.length;Xr++)for(var W=Mi[Xr],ee=W._start;ee<=W._end;ee++)li.push(ee);for(var ge=ue[li[0]],Ue=Te.level,qe=li[0]-1;qe>=0;qe--)if(!(Ce[qe]&u)){Ue=ue[qe];break}var Ye=li[li.length-1],Mt=ue[Ye],vt=Te.level;if(!(Ce[Ye]&s)){for(var Et=Ye+1;Et<=Te.end;Et++)if(!(Ce[Et]&u)){vt=ue[Et];break}}Si.push({_seqIndices:li,_sosType:Math.max(Ue,ge)%2?k:F,_eosType:Math.max(vt,Mt)%2?k:F})}}for(var Tt=0;Tt<Si.length;Tt++){var At=Si[Tt],Ie=At._seqIndices,Z=At._sosType,de=At._eosType,xe=ue[Ie[0]]&1?k:F;if(q.get(te))for(var Me=0;Me<Ie.length;Me++){var Se=Ie[Me];if(Ce[Se]&te){for(var lt=Z,ut=Me-1;ut>=0;ut--)if(!(Ce[Ie[ut]]&u)){lt=Ce[Ie[ut]];break}B(Se,lt&(s|ye)?ne:lt)}}if(q.get(R))for(var Je=0;Je<Ie.length;Je++){var ht=Ie[Je];if(Ce[ht]&R)for(var ft=Je-1;ft>=-1;ft--){var Nt=ft===-1?Z:Ce[Ie[ft]];if(Nt&a){Nt===ie&&B(ht,H);break}}}if(q.get(ie))for(var St=0;St<Ie.length;St++){var Xt=Ie[St];Ce[Xt]&ie&&B(Xt,k)}if(q.get(U)||q.get(J))for(var un=1;un<Ie.length-1;un++){var dn=Ie[un];if(Ce[dn]&(U|J)){for(var fn=0,Kt=0,Ut=un-1;Ut>=0&&(fn=Ce[Ie[Ut]],!!(fn&u));Ut--);for(var $t=un+1;$t<Ie.length&&(Kt=Ce[Ie[$t]],!!(Kt&u));$t++);fn===Kt&&(Ce[dn]===U?fn===R:fn&(R|H))&&B(dn,fn)}}if(q.get(R))for(var Dt=0;Dt<Ie.length;Dt++){var bn=Ie[Dt];if(Ce[bn]&R){for(var mi=Dt-1;mi>=0&&Ce[Ie[mi]]&(V|u);mi--)B(Ie[mi],R);for(Dt++;Dt<Ie.length&&Ce[Ie[Dt]]&(V|u|R);Dt++)Ce[Ie[Dt]]!==R&&B(Ie[Dt],R)}}if(q.get(V)||q.get(U)||q.get(J))for(var In=0;In<Ie.length;In++){var Hi=Ie[In];if(Ce[Hi]&(V|U|J)){B(Hi,ne);for(var Ln=In-1;Ln>=0&&Ce[Ie[Ln]]&u;Ln--)B(Ie[Ln],ne);for(var cn=In+1;cn<Ie.length&&Ce[Ie[cn]]&u;cn++)B(Ie[cn],ne)}}if(q.get(R))for(var gi=0,ui=Z;gi<Ie.length;gi++){var Ci=Ie[gi],ha=Ce[Ci];ha&R?ui===F&&B(Ci,F):ha&a&&(ui=ha)}if(q.get(o)){var $i=k|R|H,jo=$i|F,As=[];{for(var Ys=[],hr=0;hr<Ie.length;hr++)if(Ce[Ie[hr]]&o){var yn=Q[Ie[hr]],Cs=void 0;if(P(yn)!==null)if(Ys.length<63)Ys.push({char:yn,seqIndex:hr});else break;else if((Cs=L(yn))!==null)for(var as=Ys.length-1;as>=0;as--){var fa=Ys[as].char;if(fa===Cs||fa===L(D(yn))||P(D(fa))===yn){As.push([Ys[as].seqIndex,hr]),Ys.length=as;break}}}As.sort(function(Ui,ji){return Ui[0]-ji[0]})}for(var Ps=0;Ps<As.length;Ps++){for(var nh=As[Ps],ci=nh[0],Zs=nh[1],ih=!1,Sr=0,mo=ci+1;mo<Zs;mo++){var go=Ie[mo];if(Ce[go]&jo){ih=!0;var os=Ce[go]&$i?k:F;if(os===xe){Sr=os;break}}}if(ih&&!Sr){Sr=Z;for(var Ra=ci-1;Ra>=0;Ra--){var vo=Ie[Ra];if(Ce[vo]&jo){var er=Ce[vo]&$i?k:F;er!==xe?Sr=er:Sr=xe;break}}}if(Sr){if(Ce[Ie[ci]]=Ce[Ie[Zs]]=Sr,Sr!==xe){for(var tr=ci+1;tr<Ie.length;tr++)if(!(Ce[Ie[tr]]&u)){g(Q[Ie[tr]])&te&&(Ce[Ie[tr]]=Sr);break}}if(Sr!==xe){for(var da=Zs+1;da<Ie.length;da++)if(!(Ce[Ie[da]]&u)){g(Q[Ie[da]])&te&&(Ce[Ie[da]]=Sr);break}}}}for(var Rs=0;Rs<Ie.length;Rs++)if(Ce[Ie[Rs]]&o){for(var Xo=Rs,yo=Rs,Mr=Z,_o=Rs-1;_o>=0;_o--)if(Ce[Ie[_o]]&u)Xo=_o;else{Mr=Ce[Ie[_o]]&$i?k:F;break}for(var qr=de,Ia=Rs+1;Ia<Ie.length;Ia++)if(Ce[Ie[Ia]]&(o|u))yo=Ia;else{qr=Ce[Ie[Ia]]&$i?k:F;break}for(var nr=Xo;nr<=yo;nr++)Ce[Ie[nr]]=Mr===qr?Mr:xe;Rs=yo}}}for(var Wi=Te.start;Wi<=Te.end;Wi++){var La=ue[Wi],Yr=Ce[Wi];if(La&1?Yr&(F|R|H)&&ue[Wi]++:Yr&k?ue[Wi]++:Yr&(H|R)&&(ue[Wi]+=2),Yr&u&&(ue[Wi]=Wi===0?Te.level:ue[Wi-1]),Wi===Te.end||g(Q[Wi])&(ae|$))for(var Na=Wi;Na>=0&&g(Q[Na])&c;Na--)ue[Na]=Te.level}}return{levels:ue,paragraphs:Pe};function ir(Ui,ji){for(var Pi=Ui;Pi<Q.length;Pi++){var vi=Ce[Pi];if(vi&(k|ie))return 1;if(vi&($|F)||ji&&vi===ye)return 0;if(vi&s){var Ur=Da(Pi);Pi=Ur===-1?Q.length:Ur}}return 0}function Da(Ui){for(var ji=1,Pi=Ui+1;Pi<Q.length;Pi++){var vi=Ce[Pi];if(vi&$)break;if(vi&ye){if(--ji===0)return Pi}else vi&s&&ji++}return-1}}var Ve="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",Ke;function Qe(){if(!Ke){var Q=E(Ve,!0),at=Q.map,je=Q.reverseMap;je.forEach(function(Ce,He){at.set(He,Ce)}),Ke=at}}function pt(Q){return Qe(),Ke.get(Q)||null}function Ne(Q,at,je,Ce){var He=Q.length;je=Math.max(0,je==null?0:+je),Ce=Math.min(He-1,Ce==null?He-1:+Ce);for(var q=new Map,B=je;B<=Ce;B++)if(at[B]&1){var ue=pt(Q[B]);ue!==null&&q.set(B,ue)}return q}function Be(Q,at,je,Ce){var He=Q.length;je=Math.max(0,je==null?0:+je),Ce=Math.min(He-1,Ce==null?He-1:+Ce);var q=[];return at.paragraphs.forEach(function(B){var ue=Math.max(je,B.start),Re=Math.min(Ce,B.end);if(ue<Re){for(var Pe=at.levels.slice(ue,Re+1),Te=Re;Te>=ue&&g(Q[Te])&c;Te--)Pe[Te]=B.level;for(var ot=B.level,rt=1/0,mt=0;mt<Pe.length;mt++){var Rt=Pe[mt];Rt>ot&&(ot=Rt),Rt<rt&&(rt=Rt|1)}for(var Ge=ot;Ge>=rt;Ge--)for(var Xe=0;Xe<Pe.length;Xe++)if(Pe[Xe]>=Ge){for(var nt=Xe;Xe+1<Pe.length&&Pe[Xe+1]>=Ge;)Xe++;Xe>nt&&q.push([nt+ue,Xe+ue])}}}),q}function De(Q,at,je,Ce){var He=it(Q,at,je,Ce),q=[].concat(Q);return He.forEach(function(B,ue){q[ue]=(at.levels[B]&1?pt(Q[B]):null)||Q[B]}),q.join("")}function it(Q,at,je,Ce){for(var He=Be(Q,at,je,Ce),q=[],B=0;B<Q.length;B++)q[B]=B;return He.forEach(function(ue){for(var Re=ue[0],Pe=ue[1],Te=q.slice(Re,Pe+1),ot=Te.length;ot--;)q[Pe-ot]=Te[ot]}),q}return e.closingToOpeningBracket=L,e.getBidiCharType=g,e.getBidiCharTypeName=y,e.getCanonicalBracket=D,e.getEmbeddingLevels=ze,e.getMirroredCharacter=pt,e.getMirroredCharactersMap=Ne,e.getReorderSegments=Be,e.getReorderedIndices=it,e.getReorderedString=De,e.openingToClosingBracket=P,Object.defineProperty(e,"__esModule",{value:!0}),e})({});return n}const X3=/\bvoid\s+main\s*\(\s*\)\s*{/g;function I_(n){const e=/^[ \t]*#include +<([\w\d./]+)>/gm;function t(r,i){let s=Pn[i];return s?I_(s):r}return n.replace(e,t)}const Hr=[];for(let n=0;n<256;n++)Hr[n]=(n<16?"0":"")+n.toString(16);function TD(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(Hr[n&255]+Hr[n>>8&255]+Hr[n>>16&255]+Hr[n>>24&255]+"-"+Hr[e&255]+Hr[e>>8&255]+"-"+Hr[e>>16&15|64]+Hr[e>>24&255]+"-"+Hr[t&63|128]+Hr[t>>8&255]+"-"+Hr[t>>16&255]+Hr[t>>24&255]+Hr[r&255]+Hr[r>>8&255]+Hr[r>>16&255]+Hr[r>>24&255]).toUpperCase()}const Pc=Object.assign||function(){let n=arguments[0];for(let e=1,t=arguments.length;e<t;e++){let r=arguments[e];if(r)for(let i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])}return n},bD=Date.now(),V2=new WeakMap,H2=new Map;let AD=1e10;function L_(n,e){const t=ID(e);let r=V2.get(n);if(r||V2.set(n,r=Object.create(null)),r[t])return new r[t];const i=`_onBeforeCompile${t}`,s=function(c,f){n.onBeforeCompile.call(this,c,f);const m=this.customProgramCacheKey()+"|"+c.vertexShader+"|"+c.fragmentShader;let g=H2[m];if(!g){const y=CD(this,c,e,t);g=H2[m]=y}c.vertexShader=g.vertexShader,c.fragmentShader=g.fragmentShader,Pc(c.uniforms,this.uniforms),e.timeUniform&&(c.uniforms[e.timeUniform]={get value(){return Date.now()-bD}}),this[i]&&this[i](c)},a=function(){return o(e.chained?n:n.clone())},o=function(c){const f=Object.create(c,u);return Object.defineProperty(f,"baseMaterial",{value:n}),Object.defineProperty(f,"id",{value:AD++}),f.uuid=TD(),f.uniforms=Pc({},c.uniforms,e.uniforms),f.defines=Pc({},c.defines,e.defines),f.defines[`TROIKA_DERIVED_MATERIAL_${t}`]="",f.extensions=Pc({},c.extensions,e.extensions),f._listeners=void 0,f},u={constructor:{value:a},isDerivedMaterial:{value:!0},type:{get:()=>n.type,set:c=>{n.type=c}},isDerivedFrom:{writable:!0,configurable:!0,value:function(c){const f=this.baseMaterial;return c===f||f.isDerivedMaterial&&f.isDerivedFrom(c)||!1}},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return n.customProgramCacheKey()+"|"+t}},onBeforeCompile:{get(){return s},set(c){this[i]=c}},copy:{writable:!0,configurable:!0,value:function(c){return n.copy.call(this,c),!n.isShaderMaterial&&!n.isDerivedMaterial&&(Pc(this.extensions,c.extensions),Pc(this.defines,c.defines),Pc(this.uniforms,rx.clone(c.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const c=new n.constructor;return o(c).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let c=this._depthMaterial;return c||(c=this._depthMaterial=L_(n.isDerivedMaterial?n.getDepthMaterial():new l1({depthPacking:eE}),e),c.defines.IS_DEPTH_MATERIAL="",c.uniforms=this.uniforms),c}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let c=this._distanceMaterial;return c||(c=this._distanceMaterial=L_(n.isDerivedMaterial?n.getDistanceMaterial():new u1,e),c.defines.IS_DISTANCE_MATERIAL="",c.uniforms=this.uniforms),c}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:c,_distanceMaterial:f}=this;c&&c.dispose(),f&&f.dispose(),n.dispose.call(this)}}};return r[t]=a,new a}function CD(n,{vertexShader:e,fragmentShader:t},r,i){let{vertexDefs:s,vertexMainIntro:a,vertexMainOutro:o,vertexTransform:u,fragmentDefs:c,fragmentMainIntro:f,fragmentMainOutro:m,fragmentColorTransform:g,customRewriter:y,timeUniform:_}=r;if(s=s||"",a=a||"",o=o||"",c=c||"",f=f||"",m=m||"",(u||y)&&(e=I_(e)),(g||y)&&(t=t.replace(/^[ \t]*#include <((?:tonemapping|encodings|colorspace|fog|premultiplied_alpha|dithering)_fragment)>/gm,`
//!BEGIN_POST_CHUNK $1
$&
//!END_POST_CHUNK
`),t=I_(t)),y){let E=y({vertexShader:e,fragmentShader:t});e=E.vertexShader,t=E.fragmentShader}if(g){let E=[];t=t.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,x=>(E.push(x),"")),m=`${g}
${E.join(`
`)}
${m}`}if(_){const E=`
uniform float ${_};
`;s=E+s,c=E+c}return u&&(e=`vec3 troika_position_${i};
vec3 troika_normal_${i};
vec2 troika_uv_${i};
${e}
`,s=`${s}
void troikaVertexTransform${i}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${u}
}
`,a=`
troika_position_${i} = vec3(position);
troika_normal_${i} = vec3(normal);
troika_uv_${i} = vec2(uv);
troikaVertexTransform${i}(troika_position_${i}, troika_normal_${i}, troika_uv_${i});
${a}
`,e=e.replace(/\b(position|normal|uv)\b/g,(E,x,S,T)=>/\battribute\s+vec[23]\s+$/.test(T.substr(0,S))?x:`troika_${x}_${i}`),n.map&&n.map.channel>0||(e=e.replace(/\bMAP_UV\b/g,`troika_uv_${i}`))),e=W2(e,i,s,a,o),t=W2(t,i,c,f,m),{vertexShader:e,fragmentShader:t}}function W2(n,e,t,r,i){return(r||i||t)&&(n=n.replace(X3,`
${t}
void troikaOrigMain${e}() {`),n+=`
void main() {
  ${r}
  troikaOrigMain${e}();
  ${i}
}`),n}function PD(n,e){return n==="uniforms"?void 0:typeof e=="function"?e.toString():e}let RD=0;const j2=new Map;function ID(n){const e=JSON.stringify(n,PD);let t=j2.get(e);return t==null&&j2.set(e,t=++RD),t}function LD(){return typeof window>"u"&&(self.window=self),(function(n){var e={parse:function(i){var s=e._bin,a=new Uint8Array(i);if(s.readASCII(a,0,4)=="ttcf"){var o=4;s.readUshort(a,o),o+=2,s.readUshort(a,o),o+=2;var u=s.readUint(a,o);o+=4;for(var c=[],f=0;f<u;f++){var m=s.readUint(a,o);o+=4,c.push(e._readFont(a,m))}return c}return[e._readFont(a,0)]},_readFont:function(i,s){var a=e._bin,o=s;a.readFixed(i,s),s+=4;var u=a.readUshort(i,s);s+=2,a.readUshort(i,s),s+=2,a.readUshort(i,s),s+=2,a.readUshort(i,s),s+=2;for(var c=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],f={_data:i,_offset:o},m={},g=0;g<u;g++){var y=a.readASCII(i,s,4);s+=4,a.readUint(i,s),s+=4;var _=a.readUint(i,s);s+=4;var E=a.readUint(i,s);s+=4,m[y]={offset:_,length:E}}for(g=0;g<c.length;g++){var x=c[g];m[x]&&(f[x.trim()]=e[x.trim()].parse(i,m[x].offset,m[x].length,f))}return f},_tabOffset:function(i,s,a){for(var o=e._bin,u=o.readUshort(i,a+4),c=a+12,f=0;f<u;f++){var m=o.readASCII(i,c,4);c+=4,o.readUint(i,c),c+=4;var g=o.readUint(i,c);if(c+=4,o.readUint(i,c),c+=4,m==s)return g}return 0}};e._bin={readFixed:function(i,s){return(i[s]<<8|i[s+1])+(i[s+2]<<8|i[s+3])/65540},readF2dot14:function(i,s){return e._bin.readShort(i,s)/16384},readInt:function(i,s){return e._bin._view(i).getInt32(s)},readInt8:function(i,s){return e._bin._view(i).getInt8(s)},readShort:function(i,s){return e._bin._view(i).getInt16(s)},readUshort:function(i,s){return e._bin._view(i).getUint16(s)},readUshorts:function(i,s,a){for(var o=[],u=0;u<a;u++)o.push(e._bin.readUshort(i,s+2*u));return o},readUint:function(i,s){return e._bin._view(i).getUint32(s)},readUint64:function(i,s){return 4294967296*e._bin.readUint(i,s)+e._bin.readUint(i,s+4)},readASCII:function(i,s,a){for(var o="",u=0;u<a;u++)o+=String.fromCharCode(i[s+u]);return o},readUnicode:function(i,s,a){for(var o="",u=0;u<a;u++){var c=i[s++]<<8|i[s++];o+=String.fromCharCode(c)}return o},_tdec:typeof window<"u"&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(i,s,a){var o=e._bin._tdec;return o&&s==0&&a==i.length?o.decode(i):e._bin.readASCII(i,s,a)},readBytes:function(i,s,a){for(var o=[],u=0;u<a;u++)o.push(i[s+u]);return o},readASCIIArray:function(i,s,a){for(var o=[],u=0;u<a;u++)o.push(String.fromCharCode(i[s+u]));return o},_view:function(i){return i._dataView||(i._dataView=i.buffer?new DataView(i.buffer,i.byteOffset,i.byteLength):new DataView(new Uint8Array(i).buffer))}},e._lctf={},e._lctf.parse=function(i,s,a,o,u){var c=e._bin,f={},m=s;c.readFixed(i,s),s+=4;var g=c.readUshort(i,s);s+=2;var y=c.readUshort(i,s);s+=2;var _=c.readUshort(i,s);return s+=2,f.scriptList=e._lctf.readScriptList(i,m+g),f.featureList=e._lctf.readFeatureList(i,m+y),f.lookupList=e._lctf.readLookupList(i,m+_,u),f},e._lctf.readLookupList=function(i,s,a){var o=e._bin,u=s,c=[],f=o.readUshort(i,s);s+=2;for(var m=0;m<f;m++){var g=o.readUshort(i,s);s+=2;var y=e._lctf.readLookupTable(i,u+g,a);c.push(y)}return c},e._lctf.readLookupTable=function(i,s,a){var o=e._bin,u=s,c={tabs:[]};c.ltype=o.readUshort(i,s),s+=2,c.flag=o.readUshort(i,s),s+=2;var f=o.readUshort(i,s);s+=2;for(var m=c.ltype,g=0;g<f;g++){var y=o.readUshort(i,s);s+=2;var _=a(i,m,u+y,c);c.tabs.push(_)}return c},e._lctf.numOfOnes=function(i){for(var s=0,a=0;a<32;a++)(i>>>a&1)!=0&&s++;return s},e._lctf.readClassDef=function(i,s){var a=e._bin,o=[],u=a.readUshort(i,s);if(s+=2,u==1){var c=a.readUshort(i,s);s+=2;var f=a.readUshort(i,s);s+=2;for(var m=0;m<f;m++)o.push(c+m),o.push(c+m),o.push(a.readUshort(i,s)),s+=2}if(u==2){var g=a.readUshort(i,s);for(s+=2,m=0;m<g;m++)o.push(a.readUshort(i,s)),s+=2,o.push(a.readUshort(i,s)),s+=2,o.push(a.readUshort(i,s)),s+=2}return o},e._lctf.getInterval=function(i,s){for(var a=0;a<i.length;a+=3){var o=i[a],u=i[a+1];if(i[a+2],o<=s&&s<=u)return a}return-1},e._lctf.readCoverage=function(i,s){var a=e._bin,o={};o.fmt=a.readUshort(i,s),s+=2;var u=a.readUshort(i,s);return s+=2,o.fmt==1&&(o.tab=a.readUshorts(i,s,u)),o.fmt==2&&(o.tab=a.readUshorts(i,s,3*u)),o},e._lctf.coverageIndex=function(i,s){var a=i.tab;if(i.fmt==1)return a.indexOf(s);if(i.fmt==2){var o=e._lctf.getInterval(a,s);if(o!=-1)return a[o+2]+(s-a[o])}return-1},e._lctf.readFeatureList=function(i,s){var a=e._bin,o=s,u=[],c=a.readUshort(i,s);s+=2;for(var f=0;f<c;f++){var m=a.readASCII(i,s,4);s+=4;var g=a.readUshort(i,s);s+=2;var y=e._lctf.readFeatureTable(i,o+g);y.tag=m.trim(),u.push(y)}return u},e._lctf.readFeatureTable=function(i,s){var a=e._bin,o=s,u={},c=a.readUshort(i,s);s+=2,c>0&&(u.featureParams=o+c);var f=a.readUshort(i,s);s+=2,u.tab=[];for(var m=0;m<f;m++)u.tab.push(a.readUshort(i,s+2*m));return u},e._lctf.readScriptList=function(i,s){var a=e._bin,o=s,u={},c=a.readUshort(i,s);s+=2;for(var f=0;f<c;f++){var m=a.readASCII(i,s,4);s+=4;var g=a.readUshort(i,s);s+=2,u[m.trim()]=e._lctf.readScriptTable(i,o+g)}return u},e._lctf.readScriptTable=function(i,s){var a=e._bin,o=s,u={},c=a.readUshort(i,s);s+=2,c>0&&(u.default=e._lctf.readLangSysTable(i,o+c));var f=a.readUshort(i,s);s+=2;for(var m=0;m<f;m++){var g=a.readASCII(i,s,4);s+=4;var y=a.readUshort(i,s);s+=2,u[g.trim()]=e._lctf.readLangSysTable(i,o+y)}return u},e._lctf.readLangSysTable=function(i,s){var a=e._bin,o={};a.readUshort(i,s),s+=2,o.reqFeature=a.readUshort(i,s),s+=2;var u=a.readUshort(i,s);return s+=2,o.features=a.readUshorts(i,s,u),o},e.CFF={},e.CFF.parse=function(i,s,a){var o=e._bin;(i=new Uint8Array(i.buffer,s,a))[s=0],i[++s],i[++s],i[++s],s++;var u=[];s=e.CFF.readIndex(i,s,u);for(var c=[],f=0;f<u.length-1;f++)c.push(o.readASCII(i,s+u[f],u[f+1]-u[f]));s+=u[u.length-1];var m=[];s=e.CFF.readIndex(i,s,m);var g=[];for(f=0;f<m.length-1;f++)g.push(e.CFF.readDict(i,s+m[f],s+m[f+1]));s+=m[m.length-1];var y=g[0],_=[];s=e.CFF.readIndex(i,s,_);var E=[];for(f=0;f<_.length-1;f++)E.push(o.readASCII(i,s+_[f],_[f+1]-_[f]));if(s+=_[_.length-1],e.CFF.readSubrs(i,s,y),y.CharStrings){s=y.CharStrings,_=[],s=e.CFF.readIndex(i,s,_);var x=[];for(f=0;f<_.length-1;f++)x.push(o.readBytes(i,s+_[f],_[f+1]-_[f]));y.CharStrings=x}if(y.ROS){s=y.FDArray;var S=[];for(s=e.CFF.readIndex(i,s,S),y.FDArray=[],f=0;f<S.length-1;f++){var T=e.CFF.readDict(i,s+S[f],s+S[f+1]);e.CFF._readFDict(i,T,E),y.FDArray.push(T)}s+=S[S.length-1],s=y.FDSelect,y.FDSelect=[];var A=i[s];if(s++,A!=3)throw A;var P=o.readUshort(i,s);for(s+=2,f=0;f<P+1;f++)y.FDSelect.push(o.readUshort(i,s),i[s+2]),s+=3}return y.Encoding&&(y.Encoding=e.CFF.readEncoding(i,y.Encoding,y.CharStrings.length)),y.charset&&(y.charset=e.CFF.readCharset(i,y.charset,y.CharStrings.length)),e.CFF._readFDict(i,y,E),y},e.CFF._readFDict=function(i,s,a){var o;for(var u in s.Private&&(o=s.Private[1],s.Private=e.CFF.readDict(i,o,o+s.Private[0]),s.Private.Subrs&&e.CFF.readSubrs(i,o+s.Private.Subrs,s.Private)),s)["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(u)!=-1&&(s[u]=a[s[u]-426+35])},e.CFF.readSubrs=function(i,s,a){var o=e._bin,u=[];s=e.CFF.readIndex(i,s,u);var c,f=u.length;c=f<1240?107:f<33900?1131:32768,a.Bias=c,a.Subrs=[];for(var m=0;m<u.length-1;m++)a.Subrs.push(o.readBytes(i,s+u[m],u[m+1]-u[m]))},e.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],e.CFF.glyphByUnicode=function(i,s){for(var a=0;a<i.charset.length;a++)if(i.charset[a]==s)return a;return-1},e.CFF.glyphBySE=function(i,s){return s<0||s>255?-1:e.CFF.glyphByUnicode(i,e.CFF.tableSE[s])},e.CFF.readEncoding=function(i,s,a){e._bin;var o=[".notdef"],u=i[s];if(s++,u!=0)throw"error: unknown encoding format: "+u;var c=i[s];s++;for(var f=0;f<c;f++)o.push(i[s+f]);return o},e.CFF.readCharset=function(i,s,a){var o=e._bin,u=[".notdef"],c=i[s];if(s++,c==0)for(var f=0;f<a;f++){var m=o.readUshort(i,s);s+=2,u.push(m)}else{if(c!=1&&c!=2)throw"error: format: "+c;for(;u.length<a;){m=o.readUshort(i,s),s+=2;var g=0;for(c==1?(g=i[s],s++):(g=o.readUshort(i,s),s+=2),f=0;f<=g;f++)u.push(m),m++}}return u},e.CFF.readIndex=function(i,s,a){var o=e._bin,u=o.readUshort(i,s)+1,c=i[s+=2];if(s++,c==1)for(var f=0;f<u;f++)a.push(i[s+f]);else if(c==2)for(f=0;f<u;f++)a.push(o.readUshort(i,s+2*f));else if(c==3)for(f=0;f<u;f++)a.push(16777215&o.readUint(i,s+3*f-1));else if(u!=1)throw"unsupported offset size: "+c+", count: "+u;return(s+=u*c)-1},e.CFF.getCharString=function(i,s,a){var o=e._bin,u=i[s],c=i[s+1];i[s+2],i[s+3],i[s+4];var f=1,m=null,g=null;u<=20&&(m=u,f=1),u==12&&(m=100*u+c,f=2),21<=u&&u<=27&&(m=u,f=1),u==28&&(g=o.readShort(i,s+1),f=3),29<=u&&u<=31&&(m=u,f=1),32<=u&&u<=246&&(g=u-139,f=1),247<=u&&u<=250&&(g=256*(u-247)+c+108,f=2),251<=u&&u<=254&&(g=256*-(u-251)-c-108,f=2),u==255&&(g=o.readInt(i,s+1)/65535,f=5),a.val=g??"o"+m,a.size=f},e.CFF.readCharString=function(i,s,a){for(var o=s+a,u=e._bin,c=[];s<o;){var f=i[s],m=i[s+1];i[s+2],i[s+3],i[s+4];var g=1,y=null,_=null;f<=20&&(y=f,g=1),f==12&&(y=100*f+m,g=2),f!=19&&f!=20||(y=f,g=2),21<=f&&f<=27&&(y=f,g=1),f==28&&(_=u.readShort(i,s+1),g=3),29<=f&&f<=31&&(y=f,g=1),32<=f&&f<=246&&(_=f-139,g=1),247<=f&&f<=250&&(_=256*(f-247)+m+108,g=2),251<=f&&f<=254&&(_=256*-(f-251)-m-108,g=2),f==255&&(_=u.readInt(i,s+1)/65535,g=5),c.push(_??"o"+y),s+=g}return c},e.CFF.readDict=function(i,s,a){for(var o=e._bin,u={},c=[];s<a;){var f=i[s],m=i[s+1];i[s+2],i[s+3],i[s+4];var g=1,y=null,_=null;if(f==28&&(_=o.readShort(i,s+1),g=3),f==29&&(_=o.readInt(i,s+1),g=5),32<=f&&f<=246&&(_=f-139,g=1),247<=f&&f<=250&&(_=256*(f-247)+m+108,g=2),251<=f&&f<=254&&(_=256*-(f-251)-m-108,g=2),f==255)throw _=o.readInt(i,s+1)/65535,g=5,"unknown number";if(f==30){var E=[];for(g=1;;){var x=i[s+g];g++;var S=x>>4,T=15&x;if(S!=15&&E.push(S),T!=15&&E.push(T),T==15)break}for(var A="",P=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],L=0;L<E.length;L++)A+=P[E[L]];_=parseFloat(A)}f<=21&&(y=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][f],g=1,f==12&&(y=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][m],g=2)),y!=null?(u[y]=c.length==1?c[0]:c,c=[]):c.push(_),s+=g}return u},e.cmap={},e.cmap.parse=function(i,s,a){i=new Uint8Array(i.buffer,s,a),s=0;var o=e._bin,u={};o.readUshort(i,s),s+=2;var c=o.readUshort(i,s);s+=2;var f=[];u.tables=[];for(var m=0;m<c;m++){var g=o.readUshort(i,s);s+=2;var y=o.readUshort(i,s);s+=2;var _=o.readUint(i,s);s+=4;var E="p"+g+"e"+y,x=f.indexOf(_);if(x==-1){var S;x=u.tables.length,f.push(_);var T=o.readUshort(i,_);T==0?S=e.cmap.parse0(i,_):T==4?S=e.cmap.parse4(i,_):T==6?S=e.cmap.parse6(i,_):T==12?S=e.cmap.parse12(i,_):console.debug("unknown format: "+T,g,y,_),u.tables.push(S)}if(u[E]!=null)throw"multiple tables for one platform+encoding";u[E]=x}return u},e.cmap.parse0=function(i,s){var a=e._bin,o={};o.format=a.readUshort(i,s),s+=2;var u=a.readUshort(i,s);s+=2,a.readUshort(i,s),s+=2,o.map=[];for(var c=0;c<u-6;c++)o.map.push(i[s+c]);return o},e.cmap.parse4=function(i,s){var a=e._bin,o=s,u={};u.format=a.readUshort(i,s),s+=2;var c=a.readUshort(i,s);s+=2,a.readUshort(i,s),s+=2;var f=a.readUshort(i,s);s+=2;var m=f/2;u.searchRange=a.readUshort(i,s),s+=2,u.entrySelector=a.readUshort(i,s),s+=2,u.rangeShift=a.readUshort(i,s),s+=2,u.endCount=a.readUshorts(i,s,m),s+=2*m,s+=2,u.startCount=a.readUshorts(i,s,m),s+=2*m,u.idDelta=[];for(var g=0;g<m;g++)u.idDelta.push(a.readShort(i,s)),s+=2;for(u.idRangeOffset=a.readUshorts(i,s,m),s+=2*m,u.glyphIdArray=[];s<o+c;)u.glyphIdArray.push(a.readUshort(i,s)),s+=2;return u},e.cmap.parse6=function(i,s){var a=e._bin,o={};o.format=a.readUshort(i,s),s+=2,a.readUshort(i,s),s+=2,a.readUshort(i,s),s+=2,o.firstCode=a.readUshort(i,s),s+=2;var u=a.readUshort(i,s);s+=2,o.glyphIdArray=[];for(var c=0;c<u;c++)o.glyphIdArray.push(a.readUshort(i,s)),s+=2;return o},e.cmap.parse12=function(i,s){var a=e._bin,o={};o.format=a.readUshort(i,s),s+=2,s+=2,a.readUint(i,s),s+=4,a.readUint(i,s),s+=4;var u=a.readUint(i,s);s+=4,o.groups=[];for(var c=0;c<u;c++){var f=s+12*c,m=a.readUint(i,f+0),g=a.readUint(i,f+4),y=a.readUint(i,f+8);o.groups.push([m,g,y])}return o},e.glyf={},e.glyf.parse=function(i,s,a,o){for(var u=[],c=0;c<o.maxp.numGlyphs;c++)u.push(null);return u},e.glyf._parseGlyf=function(i,s){var a=e._bin,o=i._data,u=e._tabOffset(o,"glyf",i._offset)+i.loca[s];if(i.loca[s]==i.loca[s+1])return null;var c={};if(c.noc=a.readShort(o,u),u+=2,c.xMin=a.readShort(o,u),u+=2,c.yMin=a.readShort(o,u),u+=2,c.xMax=a.readShort(o,u),u+=2,c.yMax=a.readShort(o,u),u+=2,c.xMin>=c.xMax||c.yMin>=c.yMax)return null;if(c.noc>0){c.endPts=[];for(var f=0;f<c.noc;f++)c.endPts.push(a.readUshort(o,u)),u+=2;var m=a.readUshort(o,u);if(u+=2,o.length-u<m)return null;c.instructions=a.readBytes(o,u,m),u+=m;var g=c.endPts[c.noc-1]+1;for(c.flags=[],f=0;f<g;f++){var y=o[u];if(u++,c.flags.push(y),(8&y)!=0){var _=o[u];u++;for(var E=0;E<_;E++)c.flags.push(y),f++}}for(c.xs=[],f=0;f<g;f++){var x=(2&c.flags[f])!=0,S=(16&c.flags[f])!=0;x?(c.xs.push(S?o[u]:-o[u]),u++):S?c.xs.push(0):(c.xs.push(a.readShort(o,u)),u+=2)}for(c.ys=[],f=0;f<g;f++)x=(4&c.flags[f])!=0,S=(32&c.flags[f])!=0,x?(c.ys.push(S?o[u]:-o[u]),u++):S?c.ys.push(0):(c.ys.push(a.readShort(o,u)),u+=2);var T=0,A=0;for(f=0;f<g;f++)T+=c.xs[f],A+=c.ys[f],c.xs[f]=T,c.ys[f]=A}else{var P;c.parts=[];do{P=a.readUshort(o,u),u+=2;var L={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(c.parts.push(L),L.glyphIndex=a.readUshort(o,u),u+=2,1&P){var D=a.readShort(o,u);u+=2;var F=a.readShort(o,u);u+=2}else D=a.readInt8(o,u),u++,F=a.readInt8(o,u),u++;2&P?(L.m.tx=D,L.m.ty=F):(L.p1=D,L.p2=F),8&P?(L.m.a=L.m.d=a.readF2dot14(o,u),u+=2):64&P?(L.m.a=a.readF2dot14(o,u),u+=2,L.m.d=a.readF2dot14(o,u),u+=2):128&P&&(L.m.a=a.readF2dot14(o,u),u+=2,L.m.b=a.readF2dot14(o,u),u+=2,L.m.c=a.readF2dot14(o,u),u+=2,L.m.d=a.readF2dot14(o,u),u+=2)}while(32&P);if(256&P){var k=a.readUshort(o,u);for(u+=2,c.instr=[],f=0;f<k;f++)c.instr.push(o[u]),u++}}return c},e.GDEF={},e.GDEF.parse=function(i,s,a,o){var u=s;s+=4;var c=e._bin.readUshort(i,s);return{glyphClassDef:c===0?null:e._lctf.readClassDef(i,u+c)}},e.GPOS={},e.GPOS.parse=function(i,s,a,o){return e._lctf.parse(i,s,a,o,e.GPOS.subt)},e.GPOS.subt=function(i,s,a,o){var u=e._bin,c=a,f={};if(f.fmt=u.readUshort(i,a),a+=2,s==1||s==2||s==3||s==7||s==8&&f.fmt<=2){var m=u.readUshort(i,a);a+=2,f.coverage=e._lctf.readCoverage(i,m+c)}if(s==1&&f.fmt==1){var g=u.readUshort(i,a);a+=2,g!=0&&(f.pos=e.GPOS.readValueRecord(i,a,g))}else if(s==2&&f.fmt>=1&&f.fmt<=2){g=u.readUshort(i,a),a+=2;var y=u.readUshort(i,a);a+=2;var _=e._lctf.numOfOnes(g),E=e._lctf.numOfOnes(y);if(f.fmt==1){f.pairsets=[];var x=u.readUshort(i,a);a+=2;for(var S=0;S<x;S++){var T=c+u.readUshort(i,a);a+=2;var A=u.readUshort(i,T);T+=2;for(var P=[],L=0;L<A;L++){var D=u.readUshort(i,T);T+=2,g!=0&&(H=e.GPOS.readValueRecord(i,T,g),T+=2*_),y!=0&&(J=e.GPOS.readValueRecord(i,T,y),T+=2*E),P.push({gid2:D,val1:H,val2:J})}f.pairsets.push(P)}}if(f.fmt==2){var F=u.readUshort(i,a);a+=2;var k=u.readUshort(i,a);a+=2;var R=u.readUshort(i,a);a+=2;var U=u.readUshort(i,a);for(a+=2,f.classDef1=e._lctf.readClassDef(i,c+F),f.classDef2=e._lctf.readClassDef(i,c+k),f.matrix=[],S=0;S<R;S++){var V=[];for(L=0;L<U;L++){var H=null,J=null;g!=0&&(H=e.GPOS.readValueRecord(i,a,g),a+=2*_),y!=0&&(J=e.GPOS.readValueRecord(i,a,y),a+=2*E),V.push({val1:H,val2:J})}f.matrix.push(V)}}}else if(s==4&&f.fmt==1)f.markCoverage=e._lctf.readCoverage(i,u.readUshort(i,a)+c),f.baseCoverage=e._lctf.readCoverage(i,u.readUshort(i,a+2)+c),f.markClassCount=u.readUshort(i,a+4),f.markArray=e.GPOS.readMarkArray(i,u.readUshort(i,a+6)+c),f.baseArray=e.GPOS.readBaseArray(i,u.readUshort(i,a+8)+c,f.markClassCount);else if(s==6&&f.fmt==1)f.mark1Coverage=e._lctf.readCoverage(i,u.readUshort(i,a)+c),f.mark2Coverage=e._lctf.readCoverage(i,u.readUshort(i,a+2)+c),f.markClassCount=u.readUshort(i,a+4),f.mark1Array=e.GPOS.readMarkArray(i,u.readUshort(i,a+6)+c),f.mark2Array=e.GPOS.readBaseArray(i,u.readUshort(i,a+8)+c,f.markClassCount);else{if(s==9&&f.fmt==1){var $=u.readUshort(i,a);a+=2;var ae=u.readUint(i,a);if(a+=4,o.ltype==9)o.ltype=$;else if(o.ltype!=$)throw"invalid extension substitution";return e.GPOS.subt(i,o.ltype,c+ae)}console.debug("unsupported GPOS table LookupType",s,"format",f.fmt)}return f},e.GPOS.readValueRecord=function(i,s,a){var o=e._bin,u=[];return u.push(1&a?o.readShort(i,s):0),s+=1&a?2:0,u.push(2&a?o.readShort(i,s):0),s+=2&a?2:0,u.push(4&a?o.readShort(i,s):0),s+=4&a?2:0,u.push(8&a?o.readShort(i,s):0),s+=8&a?2:0,u},e.GPOS.readBaseArray=function(i,s,a){var o=e._bin,u=[],c=s,f=o.readUshort(i,s);s+=2;for(var m=0;m<f;m++){for(var g=[],y=0;y<a;y++)g.push(e.GPOS.readAnchorRecord(i,c+o.readUshort(i,s))),s+=2;u.push(g)}return u},e.GPOS.readMarkArray=function(i,s){var a=e._bin,o=[],u=s,c=a.readUshort(i,s);s+=2;for(var f=0;f<c;f++){var m=e.GPOS.readAnchorRecord(i,a.readUshort(i,s+2)+u);m.markClass=a.readUshort(i,s),o.push(m),s+=4}return o},e.GPOS.readAnchorRecord=function(i,s){var a=e._bin,o={};return o.fmt=a.readUshort(i,s),o.x=a.readShort(i,s+2),o.y=a.readShort(i,s+4),o},e.GSUB={},e.GSUB.parse=function(i,s,a,o){return e._lctf.parse(i,s,a,o,e.GSUB.subt)},e.GSUB.subt=function(i,s,a,o){var u=e._bin,c=a,f={};if(f.fmt=u.readUshort(i,a),a+=2,s!=1&&s!=2&&s!=4&&s!=5&&s!=6)return null;if(s==1||s==2||s==4||s==5&&f.fmt<=2||s==6&&f.fmt<=2){var m=u.readUshort(i,a);a+=2,f.coverage=e._lctf.readCoverage(i,c+m)}if(s==1&&f.fmt>=1&&f.fmt<=2){if(f.fmt==1)f.delta=u.readShort(i,a),a+=2;else if(f.fmt==2){var g=u.readUshort(i,a);a+=2,f.newg=u.readUshorts(i,a,g),a+=2*f.newg.length}}else if(s==2&&f.fmt==1){g=u.readUshort(i,a),a+=2,f.seqs=[];for(var y=0;y<g;y++){var _=u.readUshort(i,a)+c;a+=2;var E=u.readUshort(i,_);f.seqs.push(u.readUshorts(i,_+2,E))}}else if(s==4)for(f.vals=[],g=u.readUshort(i,a),a+=2,y=0;y<g;y++){var x=u.readUshort(i,a);a+=2,f.vals.push(e.GSUB.readLigatureSet(i,c+x))}else if(s==5&&f.fmt==2){if(f.fmt==2){var S=u.readUshort(i,a);a+=2,f.cDef=e._lctf.readClassDef(i,c+S),f.scset=[];var T=u.readUshort(i,a);for(a+=2,y=0;y<T;y++){var A=u.readUshort(i,a);a+=2,f.scset.push(A==0?null:e.GSUB.readSubClassSet(i,c+A))}}}else if(s==6&&f.fmt==3){if(f.fmt==3){for(y=0;y<3;y++){g=u.readUshort(i,a),a+=2;for(var P=[],L=0;L<g;L++)P.push(e._lctf.readCoverage(i,c+u.readUshort(i,a+2*L)));a+=2*g,y==0&&(f.backCvg=P),y==1&&(f.inptCvg=P),y==2&&(f.ahedCvg=P)}g=u.readUshort(i,a),a+=2,f.lookupRec=e.GSUB.readSubstLookupRecords(i,a,g)}}else{if(s==7&&f.fmt==1){var D=u.readUshort(i,a);a+=2;var F=u.readUint(i,a);if(a+=4,o.ltype==9)o.ltype=D;else if(o.ltype!=D)throw"invalid extension substitution";return e.GSUB.subt(i,o.ltype,c+F)}console.debug("unsupported GSUB table LookupType",s,"format",f.fmt)}return f},e.GSUB.readSubClassSet=function(i,s){var a=e._bin.readUshort,o=s,u=[],c=a(i,s);s+=2;for(var f=0;f<c;f++){var m=a(i,s);s+=2,u.push(e.GSUB.readSubClassRule(i,o+m))}return u},e.GSUB.readSubClassRule=function(i,s){var a=e._bin.readUshort,o={},u=a(i,s),c=a(i,s+=2);s+=2,o.input=[];for(var f=0;f<u-1;f++)o.input.push(a(i,s)),s+=2;return o.substLookupRecords=e.GSUB.readSubstLookupRecords(i,s,c),o},e.GSUB.readSubstLookupRecords=function(i,s,a){for(var o=e._bin.readUshort,u=[],c=0;c<a;c++)u.push(o(i,s),o(i,s+2)),s+=4;return u},e.GSUB.readChainSubClassSet=function(i,s){var a=e._bin,o=s,u=[],c=a.readUshort(i,s);s+=2;for(var f=0;f<c;f++){var m=a.readUshort(i,s);s+=2,u.push(e.GSUB.readChainSubClassRule(i,o+m))}return u},e.GSUB.readChainSubClassRule=function(i,s){for(var a=e._bin,o={},u=["backtrack","input","lookahead"],c=0;c<u.length;c++){var f=a.readUshort(i,s);s+=2,c==1&&f--,o[u[c]]=a.readUshorts(i,s,f),s+=2*o[u[c]].length}return f=a.readUshort(i,s),s+=2,o.subst=a.readUshorts(i,s,2*f),s+=2*o.subst.length,o},e.GSUB.readLigatureSet=function(i,s){var a=e._bin,o=s,u=[],c=a.readUshort(i,s);s+=2;for(var f=0;f<c;f++){var m=a.readUshort(i,s);s+=2,u.push(e.GSUB.readLigature(i,o+m))}return u},e.GSUB.readLigature=function(i,s){var a=e._bin,o={chain:[]};o.nglyph=a.readUshort(i,s),s+=2;var u=a.readUshort(i,s);s+=2;for(var c=0;c<u-1;c++)o.chain.push(a.readUshort(i,s)),s+=2;return o},e.head={},e.head.parse=function(i,s,a){var o=e._bin,u={};return o.readFixed(i,s),s+=4,u.fontRevision=o.readFixed(i,s),s+=4,o.readUint(i,s),s+=4,o.readUint(i,s),s+=4,u.flags=o.readUshort(i,s),s+=2,u.unitsPerEm=o.readUshort(i,s),s+=2,u.created=o.readUint64(i,s),s+=8,u.modified=o.readUint64(i,s),s+=8,u.xMin=o.readShort(i,s),s+=2,u.yMin=o.readShort(i,s),s+=2,u.xMax=o.readShort(i,s),s+=2,u.yMax=o.readShort(i,s),s+=2,u.macStyle=o.readUshort(i,s),s+=2,u.lowestRecPPEM=o.readUshort(i,s),s+=2,u.fontDirectionHint=o.readShort(i,s),s+=2,u.indexToLocFormat=o.readShort(i,s),s+=2,u.glyphDataFormat=o.readShort(i,s),s+=2,u},e.hhea={},e.hhea.parse=function(i,s,a){var o=e._bin,u={};return o.readFixed(i,s),s+=4,u.ascender=o.readShort(i,s),s+=2,u.descender=o.readShort(i,s),s+=2,u.lineGap=o.readShort(i,s),s+=2,u.advanceWidthMax=o.readUshort(i,s),s+=2,u.minLeftSideBearing=o.readShort(i,s),s+=2,u.minRightSideBearing=o.readShort(i,s),s+=2,u.xMaxExtent=o.readShort(i,s),s+=2,u.caretSlopeRise=o.readShort(i,s),s+=2,u.caretSlopeRun=o.readShort(i,s),s+=2,u.caretOffset=o.readShort(i,s),s+=2,s+=8,u.metricDataFormat=o.readShort(i,s),s+=2,u.numberOfHMetrics=o.readUshort(i,s),s+=2,u},e.hmtx={},e.hmtx.parse=function(i,s,a,o){for(var u=e._bin,c={aWidth:[],lsBearing:[]},f=0,m=0,g=0;g<o.maxp.numGlyphs;g++)g<o.hhea.numberOfHMetrics&&(f=u.readUshort(i,s),s+=2,m=u.readShort(i,s),s+=2),c.aWidth.push(f),c.lsBearing.push(m);return c},e.kern={},e.kern.parse=function(i,s,a,o){var u=e._bin,c=u.readUshort(i,s);if(s+=2,c==1)return e.kern.parseV1(i,s-2,a,o);var f=u.readUshort(i,s);s+=2;for(var m={glyph1:[],rval:[]},g=0;g<f;g++){s+=2,a=u.readUshort(i,s),s+=2;var y=u.readUshort(i,s);s+=2;var _=y>>>8;if((_&=15)!=0)throw"unknown kern table format: "+_;s=e.kern.readFormat0(i,s,m)}return m},e.kern.parseV1=function(i,s,a,o){var u=e._bin;u.readFixed(i,s),s+=4;var c=u.readUint(i,s);s+=4;for(var f={glyph1:[],rval:[]},m=0;m<c;m++){u.readUint(i,s),s+=4;var g=u.readUshort(i,s);s+=2,u.readUshort(i,s),s+=2;var y=g>>>8;if((y&=15)!=0)throw"unknown kern table format: "+y;s=e.kern.readFormat0(i,s,f)}return f},e.kern.readFormat0=function(i,s,a){var o=e._bin,u=-1,c=o.readUshort(i,s);s+=2,o.readUshort(i,s),s+=2,o.readUshort(i,s),s+=2,o.readUshort(i,s),s+=2;for(var f=0;f<c;f++){var m=o.readUshort(i,s);s+=2;var g=o.readUshort(i,s);s+=2;var y=o.readShort(i,s);s+=2,m!=u&&(a.glyph1.push(m),a.rval.push({glyph2:[],vals:[]}));var _=a.rval[a.rval.length-1];_.glyph2.push(g),_.vals.push(y),u=m}return s},e.loca={},e.loca.parse=function(i,s,a,o){var u=e._bin,c=[],f=o.head.indexToLocFormat,m=o.maxp.numGlyphs+1;if(f==0)for(var g=0;g<m;g++)c.push(u.readUshort(i,s+(g<<1))<<1);if(f==1)for(g=0;g<m;g++)c.push(u.readUint(i,s+(g<<2)));return c},e.maxp={},e.maxp.parse=function(i,s,a){var o=e._bin,u={},c=o.readUint(i,s);return s+=4,u.numGlyphs=o.readUshort(i,s),s+=2,c==65536&&(u.maxPoints=o.readUshort(i,s),s+=2,u.maxContours=o.readUshort(i,s),s+=2,u.maxCompositePoints=o.readUshort(i,s),s+=2,u.maxCompositeContours=o.readUshort(i,s),s+=2,u.maxZones=o.readUshort(i,s),s+=2,u.maxTwilightPoints=o.readUshort(i,s),s+=2,u.maxStorage=o.readUshort(i,s),s+=2,u.maxFunctionDefs=o.readUshort(i,s),s+=2,u.maxInstructionDefs=o.readUshort(i,s),s+=2,u.maxStackElements=o.readUshort(i,s),s+=2,u.maxSizeOfInstructions=o.readUshort(i,s),s+=2,u.maxComponentElements=o.readUshort(i,s),s+=2,u.maxComponentDepth=o.readUshort(i,s),s+=2),u},e.name={},e.name.parse=function(i,s,a){var o=e._bin,u={};o.readUshort(i,s),s+=2;var c=o.readUshort(i,s);s+=2,o.readUshort(i,s);for(var f,m=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],g=s+=2,y=0;y<c;y++){var _=o.readUshort(i,s);s+=2;var E=o.readUshort(i,s);s+=2;var x=o.readUshort(i,s);s+=2;var S=o.readUshort(i,s);s+=2;var T=o.readUshort(i,s);s+=2;var A=o.readUshort(i,s);s+=2;var P,L=m[S],D=g+12*c+A;if(_==0)P=o.readUnicode(i,D,T/2);else if(_==3&&E==0)P=o.readUnicode(i,D,T/2);else if(E==0)P=o.readASCII(i,D,T);else if(E==1)P=o.readUnicode(i,D,T/2);else if(E==3)P=o.readUnicode(i,D,T/2);else{if(_!=1)throw"unknown encoding "+E+", platformID: "+_;P=o.readASCII(i,D,T),console.debug("reading unknown MAC encoding "+E+" as ASCII")}var F="p"+_+","+x.toString(16);u[F]==null&&(u[F]={}),u[F][L!==void 0?L:S]=P,u[F]._lang=x}for(var k in u)if(u[k].postScriptName!=null&&u[k]._lang==1033)return u[k];for(var k in u)if(u[k].postScriptName!=null&&u[k]._lang==0)return u[k];for(var k in u)if(u[k].postScriptName!=null&&u[k]._lang==3084)return u[k];for(var k in u)if(u[k].postScriptName!=null)return u[k];for(var k in u){f=k;break}return console.debug("returning name table with languageID "+u[f]._lang),u[f]},e["OS/2"]={},e["OS/2"].parse=function(i,s,a){var o=e._bin.readUshort(i,s);s+=2;var u={};if(o==0)e["OS/2"].version0(i,s,u);else if(o==1)e["OS/2"].version1(i,s,u);else if(o==2||o==3||o==4)e["OS/2"].version2(i,s,u);else{if(o!=5)throw"unknown OS/2 table version: "+o;e["OS/2"].version5(i,s,u)}return u},e["OS/2"].version0=function(i,s,a){var o=e._bin;return a.xAvgCharWidth=o.readShort(i,s),s+=2,a.usWeightClass=o.readUshort(i,s),s+=2,a.usWidthClass=o.readUshort(i,s),s+=2,a.fsType=o.readUshort(i,s),s+=2,a.ySubscriptXSize=o.readShort(i,s),s+=2,a.ySubscriptYSize=o.readShort(i,s),s+=2,a.ySubscriptXOffset=o.readShort(i,s),s+=2,a.ySubscriptYOffset=o.readShort(i,s),s+=2,a.ySuperscriptXSize=o.readShort(i,s),s+=2,a.ySuperscriptYSize=o.readShort(i,s),s+=2,a.ySuperscriptXOffset=o.readShort(i,s),s+=2,a.ySuperscriptYOffset=o.readShort(i,s),s+=2,a.yStrikeoutSize=o.readShort(i,s),s+=2,a.yStrikeoutPosition=o.readShort(i,s),s+=2,a.sFamilyClass=o.readShort(i,s),s+=2,a.panose=o.readBytes(i,s,10),s+=10,a.ulUnicodeRange1=o.readUint(i,s),s+=4,a.ulUnicodeRange2=o.readUint(i,s),s+=4,a.ulUnicodeRange3=o.readUint(i,s),s+=4,a.ulUnicodeRange4=o.readUint(i,s),s+=4,a.achVendID=[o.readInt8(i,s),o.readInt8(i,s+1),o.readInt8(i,s+2),o.readInt8(i,s+3)],s+=4,a.fsSelection=o.readUshort(i,s),s+=2,a.usFirstCharIndex=o.readUshort(i,s),s+=2,a.usLastCharIndex=o.readUshort(i,s),s+=2,a.sTypoAscender=o.readShort(i,s),s+=2,a.sTypoDescender=o.readShort(i,s),s+=2,a.sTypoLineGap=o.readShort(i,s),s+=2,a.usWinAscent=o.readUshort(i,s),s+=2,a.usWinDescent=o.readUshort(i,s),s+=2},e["OS/2"].version1=function(i,s,a){var o=e._bin;return s=e["OS/2"].version0(i,s,a),a.ulCodePageRange1=o.readUint(i,s),s+=4,a.ulCodePageRange2=o.readUint(i,s),s+=4},e["OS/2"].version2=function(i,s,a){var o=e._bin;return s=e["OS/2"].version1(i,s,a),a.sxHeight=o.readShort(i,s),s+=2,a.sCapHeight=o.readShort(i,s),s+=2,a.usDefault=o.readUshort(i,s),s+=2,a.usBreak=o.readUshort(i,s),s+=2,a.usMaxContext=o.readUshort(i,s),s+=2},e["OS/2"].version5=function(i,s,a){var o=e._bin;return s=e["OS/2"].version2(i,s,a),a.usLowerOpticalPointSize=o.readUshort(i,s),s+=2,a.usUpperOpticalPointSize=o.readUshort(i,s),s+=2},e.post={},e.post.parse=function(i,s,a){var o=e._bin,u={};return u.version=o.readFixed(i,s),s+=4,u.italicAngle=o.readFixed(i,s),s+=4,u.underlinePosition=o.readShort(i,s),s+=2,u.underlineThickness=o.readShort(i,s),s+=2,u},e==null&&(e={}),e.U==null&&(e.U={}),e.U.codeToGlyph=function(i,s){var a=i.cmap,o=-1;if(a.p0e4!=null?o=a.p0e4:a.p3e1!=null?o=a.p3e1:a.p1e0!=null?o=a.p1e0:a.p0e3!=null&&(o=a.p0e3),o==-1)throw"no familiar platform and encoding!";var u=a.tables[o];if(u.format==0)return s>=u.map.length?0:u.map[s];if(u.format==4){for(var c=-1,f=0;f<u.endCount.length;f++)if(s<=u.endCount[f]){c=f;break}return c==-1||u.startCount[c]>s?0:65535&(u.idRangeOffset[c]!=0?u.glyphIdArray[s-u.startCount[c]+(u.idRangeOffset[c]>>1)-(u.idRangeOffset.length-c)]:s+u.idDelta[c])}if(u.format==12){if(s>u.groups[u.groups.length-1][1])return 0;for(f=0;f<u.groups.length;f++){var m=u.groups[f];if(m[0]<=s&&s<=m[1])return m[2]+(s-m[0])}return 0}throw"unknown cmap table format "+u.format},e.U.glyphToPath=function(i,s){var a={cmds:[],crds:[]};if(i.SVG&&i.SVG.entries[s]){var o=i.SVG.entries[s];return o==null?a:(typeof o=="string"&&(o=e.SVG.toPath(o),i.SVG.entries[s]=o),o)}if(i.CFF){var u={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:i.CFF.Private?i.CFF.Private.defaultWidthX:0,open:!1},c=i.CFF,f=i.CFF.Private;if(c.ROS){for(var m=0;c.FDSelect[m+2]<=s;)m+=2;f=c.FDArray[c.FDSelect[m+1]].Private}e.U._drawCFF(i.CFF.CharStrings[s],u,c,f,a)}else i.glyf&&e.U._drawGlyf(s,i,a);return a},e.U._drawGlyf=function(i,s,a){var o=s.glyf[i];o==null&&(o=s.glyf[i]=e.glyf._parseGlyf(s,i)),o!=null&&(o.noc>-1?e.U._simpleGlyph(o,a):e.U._compoGlyph(o,s,a))},e.U._simpleGlyph=function(i,s){for(var a=0;a<i.noc;a++){for(var o=a==0?0:i.endPts[a-1]+1,u=i.endPts[a],c=o;c<=u;c++){var f=c==o?u:c-1,m=c==u?o:c+1,g=1&i.flags[c],y=1&i.flags[f],_=1&i.flags[m],E=i.xs[c],x=i.ys[c];if(c==o)if(g){if(!y){e.U.P.moveTo(s,E,x);continue}e.U.P.moveTo(s,i.xs[f],i.ys[f])}else y?e.U.P.moveTo(s,i.xs[f],i.ys[f]):e.U.P.moveTo(s,(i.xs[f]+E)/2,(i.ys[f]+x)/2);g?y&&e.U.P.lineTo(s,E,x):_?e.U.P.qcurveTo(s,E,x,i.xs[m],i.ys[m]):e.U.P.qcurveTo(s,E,x,(E+i.xs[m])/2,(x+i.ys[m])/2)}e.U.P.closePath(s)}},e.U._compoGlyph=function(i,s,a){for(var o=0;o<i.parts.length;o++){var u={cmds:[],crds:[]},c=i.parts[o];e.U._drawGlyf(c.glyphIndex,s,u);for(var f=c.m,m=0;m<u.crds.length;m+=2){var g=u.crds[m],y=u.crds[m+1];a.crds.push(g*f.a+y*f.b+f.tx),a.crds.push(g*f.c+y*f.d+f.ty)}for(m=0;m<u.cmds.length;m++)a.cmds.push(u.cmds[m])}},e.U._getGlyphClass=function(i,s){var a=e._lctf.getInterval(s,i);return a==-1?0:s[a+2]},e.U._applySubs=function(i,s,a,o){for(var u=i.length-s-1,c=0;c<a.tabs.length;c++)if(a.tabs[c]!=null){var f,m=a.tabs[c];if(!m.coverage||(f=e._lctf.coverageIndex(m.coverage,i[s]))!=-1){if(a.ltype==1)i[s],m.fmt==1?i[s]=i[s]+m.delta:i[s]=m.newg[f];else if(a.ltype==4)for(var g=m.vals[f],y=0;y<g.length;y++){var _=g[y],E=_.chain.length;if(!(E>u)){for(var x=!0,S=0,T=0;T<E;T++){for(;i[s+S+(1+T)]==-1;)S++;_.chain[T]!=i[s+S+(1+T)]&&(x=!1)}if(x){for(i[s]=_.nglyph,T=0;T<E+S;T++)i[s+T+1]=-1;break}}}else if(a.ltype==5&&m.fmt==2)for(var A=e._lctf.getInterval(m.cDef,i[s]),P=m.cDef[A+2],L=m.scset[P],D=0;D<L.length;D++){var F=L[D],k=F.input;if(!(k.length>u)){for(x=!0,T=0;T<k.length;T++){var R=e._lctf.getInterval(m.cDef,i[s+1+T]);if(A==-1&&m.cDef[R+2]!=k[T]){x=!1;break}}if(x){var U=F.substLookupRecords;for(y=0;y<U.length;y+=2)U[y],U[y+1]}}}else if(a.ltype==6&&m.fmt==3){if(!e.U._glsCovered(i,m.backCvg,s-m.backCvg.length)||!e.U._glsCovered(i,m.inptCvg,s)||!e.U._glsCovered(i,m.ahedCvg,s+m.inptCvg.length))continue;var V=m.lookupRec;for(D=0;D<V.length;D+=2){A=V[D];var H=o[V[D+1]];e.U._applySubs(i,s+A,H,o)}}}}},e.U._glsCovered=function(i,s,a){for(var o=0;o<s.length;o++)if(e._lctf.coverageIndex(s[o],i[a+o])==-1)return!1;return!0},e.U.glyphsToPath=function(i,s,a){for(var o={cmds:[],crds:[]},u=0,c=0;c<s.length;c++){var f=s[c];if(f!=-1){for(var m=c<s.length-1&&s[c+1]!=-1?s[c+1]:0,g=e.U.glyphToPath(i,f),y=0;y<g.crds.length;y+=2)o.crds.push(g.crds[y]+u),o.crds.push(g.crds[y+1]);for(a&&o.cmds.push(a),y=0;y<g.cmds.length;y++)o.cmds.push(g.cmds[y]);a&&o.cmds.push("X"),u+=i.hmtx.aWidth[f],c<s.length-1&&(u+=e.U.getPairAdjustment(i,f,m))}}return o},e.U.P={},e.U.P.moveTo=function(i,s,a){i.cmds.push("M"),i.crds.push(s,a)},e.U.P.lineTo=function(i,s,a){i.cmds.push("L"),i.crds.push(s,a)},e.U.P.curveTo=function(i,s,a,o,u,c,f){i.cmds.push("C"),i.crds.push(s,a,o,u,c,f)},e.U.P.qcurveTo=function(i,s,a,o,u){i.cmds.push("Q"),i.crds.push(s,a,o,u)},e.U.P.closePath=function(i){i.cmds.push("Z")},e.U._drawCFF=function(i,s,a,o,u){for(var c=s.stack,f=s.nStems,m=s.haveWidth,g=s.width,y=s.open,_=0,E=s.x,x=s.y,S=0,T=0,A=0,P=0,L=0,D=0,F=0,k=0,R=0,U=0,V={val:0,size:0};_<i.length;){e.CFF.getCharString(i,_,V);var H=V.val;if(_+=V.size,H=="o1"||H=="o18")c.length%2!=0&&!m&&(g=c.shift()+o.nominalWidthX),f+=c.length>>1,c.length=0,m=!0;else if(H=="o3"||H=="o23")c.length%2!=0&&!m&&(g=c.shift()+o.nominalWidthX),f+=c.length>>1,c.length=0,m=!0;else if(H=="o4")c.length>1&&!m&&(g=c.shift()+o.nominalWidthX,m=!0),y&&e.U.P.closePath(u),x+=c.pop(),e.U.P.moveTo(u,E,x),y=!0;else if(H=="o5")for(;c.length>0;)E+=c.shift(),x+=c.shift(),e.U.P.lineTo(u,E,x);else if(H=="o6"||H=="o7")for(var J=c.length,$=H=="o6",ae=0;ae<J;ae++){var ne=c.shift();$?E+=ne:x+=ne,$=!$,e.U.P.lineTo(u,E,x)}else if(H=="o8"||H=="o24"){J=c.length;for(var oe=0;oe+6<=J;)S=E+c.shift(),T=x+c.shift(),A=S+c.shift(),P=T+c.shift(),E=A+c.shift(),x=P+c.shift(),e.U.P.curveTo(u,S,T,A,P,E,x),oe+=6;H=="o24"&&(E+=c.shift(),x+=c.shift(),e.U.P.lineTo(u,E,x))}else{if(H=="o11")break;if(H=="o1234"||H=="o1235"||H=="o1236"||H=="o1237")H=="o1234"&&(T=x,A=(S=E+c.shift())+c.shift(),U=P=T+c.shift(),D=P,k=x,E=(F=(L=(R=A+c.shift())+c.shift())+c.shift())+c.shift(),e.U.P.curveTo(u,S,T,A,P,R,U),e.U.P.curveTo(u,L,D,F,k,E,x)),H=="o1235"&&(S=E+c.shift(),T=x+c.shift(),A=S+c.shift(),P=T+c.shift(),R=A+c.shift(),U=P+c.shift(),L=R+c.shift(),D=U+c.shift(),F=L+c.shift(),k=D+c.shift(),E=F+c.shift(),x=k+c.shift(),c.shift(),e.U.P.curveTo(u,S,T,A,P,R,U),e.U.P.curveTo(u,L,D,F,k,E,x)),H=="o1236"&&(S=E+c.shift(),T=x+c.shift(),A=S+c.shift(),U=P=T+c.shift(),D=P,F=(L=(R=A+c.shift())+c.shift())+c.shift(),k=D+c.shift(),E=F+c.shift(),e.U.P.curveTo(u,S,T,A,P,R,U),e.U.P.curveTo(u,L,D,F,k,E,x)),H=="o1237"&&(S=E+c.shift(),T=x+c.shift(),A=S+c.shift(),P=T+c.shift(),R=A+c.shift(),U=P+c.shift(),L=R+c.shift(),D=U+c.shift(),F=L+c.shift(),k=D+c.shift(),Math.abs(F-E)>Math.abs(k-x)?E=F+c.shift():x=k+c.shift(),e.U.P.curveTo(u,S,T,A,P,R,U),e.U.P.curveTo(u,L,D,F,k,E,x));else if(H=="o14"){if(c.length>0&&!m&&(g=c.shift()+a.nominalWidthX,m=!0),c.length==4){var te=c.shift(),ie=c.shift(),Y=c.shift(),z=c.shift(),K=e.CFF.glyphBySE(a,Y),le=e.CFF.glyphBySE(a,z);e.U._drawCFF(a.CharStrings[K],s,a,o,u),s.x=te,s.y=ie,e.U._drawCFF(a.CharStrings[le],s,a,o,u)}y&&(e.U.P.closePath(u),y=!1)}else if(H=="o19"||H=="o20")c.length%2!=0&&!m&&(g=c.shift()+o.nominalWidthX),f+=c.length>>1,c.length=0,m=!0,_+=f+7>>3;else if(H=="o21")c.length>2&&!m&&(g=c.shift()+o.nominalWidthX,m=!0),x+=c.pop(),E+=c.pop(),y&&e.U.P.closePath(u),e.U.P.moveTo(u,E,x),y=!0;else if(H=="o22")c.length>1&&!m&&(g=c.shift()+o.nominalWidthX,m=!0),E+=c.pop(),y&&e.U.P.closePath(u),e.U.P.moveTo(u,E,x),y=!0;else if(H=="o25"){for(;c.length>6;)E+=c.shift(),x+=c.shift(),e.U.P.lineTo(u,E,x);S=E+c.shift(),T=x+c.shift(),A=S+c.shift(),P=T+c.shift(),E=A+c.shift(),x=P+c.shift(),e.U.P.curveTo(u,S,T,A,P,E,x)}else if(H=="o26")for(c.length%2&&(E+=c.shift());c.length>0;)S=E,T=x+c.shift(),E=A=S+c.shift(),x=(P=T+c.shift())+c.shift(),e.U.P.curveTo(u,S,T,A,P,E,x);else if(H=="o27")for(c.length%2&&(x+=c.shift());c.length>0;)T=x,A=(S=E+c.shift())+c.shift(),P=T+c.shift(),E=A+c.shift(),x=P,e.U.P.curveTo(u,S,T,A,P,E,x);else if(H=="o10"||H=="o29"){var me=H=="o10"?o:a;if(c.length==0)console.debug("error: empty stack");else{var ve=c.pop(),re=me.Subrs[ve+me.Bias];s.x=E,s.y=x,s.nStems=f,s.haveWidth=m,s.width=g,s.open=y,e.U._drawCFF(re,s,a,o,u),E=s.x,x=s.y,f=s.nStems,m=s.haveWidth,g=s.width,y=s.open}}else if(H=="o30"||H=="o31"){var he=c.length,ye=(oe=0,H=="o31");for(oe+=he-(J=-3&he);oe<J;)ye?(T=x,A=(S=E+c.shift())+c.shift(),x=(P=T+c.shift())+c.shift(),J-oe==5?(E=A+c.shift(),oe++):E=A,ye=!1):(S=E,T=x+c.shift(),A=S+c.shift(),P=T+c.shift(),E=A+c.shift(),J-oe==5?(x=P+c.shift(),oe++):x=P,ye=!0),e.U.P.curveTo(u,S,T,A,P,E,x),oe+=4}else{if((H+"").charAt(0)=="o")throw console.debug("Unknown operation: "+H,i),H;c.push(H)}}}s.x=E,s.y=x,s.nStems=f,s.haveWidth=m,s.width=g,s.open=y};var t=e,r={Typr:t};return n.Typr=t,n.default=r,Object.defineProperty(n,"__esModule",{value:!0}),n})({}).Typr}function ND(){return(function(n){var e=Uint8Array,t=Uint16Array,r=Uint32Array,i=new e([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),s=new e([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),a=new e([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),o=function(H,J){for(var $=new t(31),ae=0;ae<31;++ae)$[ae]=J+=1<<H[ae-1];var ne=new r($[30]);for(ae=1;ae<30;++ae)for(var oe=$[ae];oe<$[ae+1];++oe)ne[oe]=oe-$[ae]<<5|ae;return[$,ne]},u=o(i,2),c=u[0],f=u[1];c[28]=258,f[258]=28;for(var m=o(s,0)[0],g=new t(32768),y=0;y<32768;++y){var _=(43690&y)>>>1|(21845&y)<<1;_=(61680&(_=(52428&_)>>>2|(13107&_)<<2))>>>4|(3855&_)<<4,g[y]=((65280&_)>>>8|(255&_)<<8)>>>1}var E=function(H,J,$){for(var ae=H.length,ne=0,oe=new t(J);ne<ae;++ne)++oe[H[ne]-1];var te,ie=new t(J);for(ne=0;ne<J;++ne)ie[ne]=ie[ne-1]+oe[ne-1]<<1;{te=new t(1<<J);var Y=15-J;for(ne=0;ne<ae;++ne)if(H[ne])for(var z=ne<<4|H[ne],K=J-H[ne],le=ie[H[ne]-1]++<<K,me=le|(1<<K)-1;le<=me;++le)te[g[le]>>>Y]=z}return te},x=new e(288);for(y=0;y<144;++y)x[y]=8;for(y=144;y<256;++y)x[y]=9;for(y=256;y<280;++y)x[y]=7;for(y=280;y<288;++y)x[y]=8;var S=new e(32);for(y=0;y<32;++y)S[y]=5;var T=E(x,9),A=E(S,5),P=function(H){for(var J=H[0],$=1;$<H.length;++$)H[$]>J&&(J=H[$]);return J},L=function(H,J,$){var ae=J/8|0;return(H[ae]|H[ae+1]<<8)>>(7&J)&$},D=function(H,J){var $=J/8|0;return(H[$]|H[$+1]<<8|H[$+2]<<16)>>(7&J)},F=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],k=function(H,J,$){var ae=new Error(J||F[H]);if(ae.code=H,Error.captureStackTrace&&Error.captureStackTrace(ae,k),!$)throw ae;return ae},R=function(H,J,$){var ae=H.length;if(!ae||$&&!$.l&&ae<5)return J||new e(0);var ne=!J||$,oe=!$||$.i;$||($={}),J||(J=new e(3*ae));var te,ie=function(nt){var gt=J.length;if(nt>gt){var st=new e(Math.max(2*gt,nt));st.set(J),J=st}},Y=$.f||0,z=$.p||0,K=$.b||0,le=$.l,me=$.d,ve=$.m,re=$.n,he=8*ae;do{if(!le){$.f=Y=L(H,z,1);var ye=L(H,z+1,3);if(z+=3,!ye){var ze=H[(je=((te=z)/8|0)+(7&te&&1)+4)-4]|H[je-3]<<8,Ve=je+ze;if(Ve>ae){oe&&k(0);break}ne&&ie(K+ze),J.set(H.subarray(je,Ve),K),$.b=K+=ze,$.p=z=8*Ve;continue}if(ye==1)le=T,me=A,ve=9,re=5;else if(ye==2){var Ke=L(H,z,31)+257,Qe=L(H,z+10,15)+4,pt=Ke+L(H,z+5,31)+1;z+=14;for(var Ne=new e(pt),Be=new e(19),De=0;De<Qe;++De)Be[a[De]]=L(H,z+3*De,7);z+=3*Qe;var it=P(Be),Q=(1<<it)-1,at=E(Be,it);for(De=0;De<pt;){var je,Ce=at[L(H,z,Q)];if(z+=15&Ce,(je=Ce>>>4)<16)Ne[De++]=je;else{var He=0,q=0;for(je==16?(q=3+L(H,z,3),z+=2,He=Ne[De-1]):je==17?(q=3+L(H,z,7),z+=3):je==18&&(q=11+L(H,z,127),z+=7);q--;)Ne[De++]=He}}var B=Ne.subarray(0,Ke),ue=Ne.subarray(Ke);ve=P(B),re=P(ue),le=E(B,ve),me=E(ue,re)}else k(1);if(z>he){oe&&k(0);break}}ne&&ie(K+131072);for(var Re=(1<<ve)-1,Pe=(1<<re)-1,Te=z;;Te=z){var ot=(He=le[D(H,z)&Re])>>>4;if((z+=15&He)>he){oe&&k(0);break}if(He||k(2),ot<256)J[K++]=ot;else{if(ot==256){Te=z,le=null;break}var rt=ot-254;if(ot>264){var mt=i[De=ot-257];rt=L(H,z,(1<<mt)-1)+c[De],z+=mt}var Rt=me[D(H,z)&Pe],Ge=Rt>>>4;if(Rt||k(3),z+=15&Rt,ue=m[Ge],Ge>3&&(mt=s[Ge],ue+=D(H,z)&(1<<mt)-1,z+=mt),z>he){oe&&k(0);break}ne&&ie(K+131072);for(var Xe=K+rt;K<Xe;K+=4)J[K]=J[K-ue],J[K+1]=J[K+1-ue],J[K+2]=J[K+2-ue],J[K+3]=J[K+3-ue];K=Xe}}$.l=le,$.p=Te,$.b=K,le&&(Y=1,$.m=ve,$.d=me,$.n=re)}while(!Y);return K==J.length?J:(function(nt,gt,st){(st==null||st>nt.length)&&(st=nt.length);var Ot=new(nt instanceof t?t:nt instanceof r?r:e)(st-gt);return Ot.set(nt.subarray(gt,st)),Ot})(J,0,K)},U=new e(0),V=typeof TextDecoder<"u"&&new TextDecoder;try{V.decode(U,{stream:!0})}catch{}return n.convert_streams=function(H){var J=new DataView(H),$=0;function ae(){var Ke=J.getUint16($);return $+=2,Ke}function ne(){var Ke=J.getUint32($);return $+=4,Ke}function oe(Ke){ze.setUint16(Ve,Ke),Ve+=2}function te(Ke){ze.setUint32(Ve,Ke),Ve+=4}for(var ie={signature:ne(),flavor:ne(),length:ne(),numTables:ae(),reserved:ae(),totalSfntSize:ne(),majorVersion:ae(),minorVersion:ae(),metaOffset:ne(),metaLength:ne(),metaOrigLength:ne(),privOffset:ne(),privLength:ne()},Y=0;Math.pow(2,Y)<=ie.numTables;)Y++;Y--;for(var z=16*Math.pow(2,Y),K=16*ie.numTables-z,le=12,me=[],ve=0;ve<ie.numTables;ve++)me.push({tag:ne(),offset:ne(),compLength:ne(),origLength:ne(),origChecksum:ne()}),le+=16;var re,he=new Uint8Array(12+16*me.length+me.reduce((function(Ke,Qe){return Ke+Qe.origLength+4}),0)),ye=he.buffer,ze=new DataView(ye),Ve=0;return te(ie.flavor),oe(ie.numTables),oe(z),oe(Y),oe(K),me.forEach((function(Ke){te(Ke.tag),te(Ke.origChecksum),te(le),te(Ke.origLength),Ke.outOffset=le,(le+=Ke.origLength)%4!=0&&(le+=4-le%4)})),me.forEach((function(Ke){var Qe,pt=H.slice(Ke.offset,Ke.offset+Ke.compLength);if(Ke.compLength!=Ke.origLength){var Ne=new Uint8Array(Ke.origLength);Qe=new Uint8Array(pt,2),R(Qe,Ne)}else Ne=new Uint8Array(pt);he.set(Ne,Ke.outOffset);var Be=0;(le=Ke.outOffset+Ke.origLength)%4!=0&&(Be=4-le%4),he.set(new Uint8Array(Be).buffer,Ke.outOffset+Ke.origLength),re=le+Be})),ye.slice(0,re)},Object.defineProperty(n,"__esModule",{value:!0}),n})({}).convert_streams}function DD(n,e){const t={M:2,L:2,Q:4,C:6,Z:0},r={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},i=1,s=2,a=4,o=8,u=16,c=32;let f;function m(F){if(!f){const k={R:s,L:i,D:a,C:u,U:c,T:o};f=new Map;for(let R in r){let U=0;r[R].split(",").forEach(V=>{let[H,J]=V.split("+");H=parseInt(H,36),J=J?parseInt(J,36):0,f.set(U+=H,k[R]);for(let $=J;$--;)f.set(++U,k[R])})}}return f.get(F)||c}const g=1,y=2,_=3,E=4,x=[null,"isol","init","fina","medi"];function S(F){const k=new Uint8Array(F.length);let R=c,U=g,V=-1;for(let H=0;H<F.length;H++){const J=F.codePointAt(H);let $=m(J)|0,ae=g;$&o||(R&(i|a|u)?$&(s|a|u)?(ae=_,(U===g||U===_)&&k[V]++):$&(i|c)&&(U===y||U===E)&&k[V]--:R&(s|c)&&(U===y||U===E)&&k[V]--,U=k[H]=ae,R=$,V=H,J>65535&&H++)}return k}function T(F,k){const R=[];for(let V=0;V<k.length;V++){const H=k.codePointAt(V);H>65535&&V++,R.push(n.U.codeToGlyph(F,H))}const U=F.GSUB;if(U){const{lookupList:V,featureList:H}=U;let J;const $=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,ae=[];H.forEach(ne=>{if($.test(ne.tag))for(let oe=0;oe<ne.tab.length;oe++){if(ae[ne.tab[oe]])continue;ae[ne.tab[oe]]=!0;const te=V[ne.tab[oe]],ie=/^(isol|init|fina|medi)$/.test(ne.tag);ie&&!J&&(J=S(k));for(let Y=0;Y<R.length;Y++)(!J||!ie||x[J[Y]]===ne.tag)&&n.U._applySubs(R,Y,te,V)}})}return R}function A(F,k){const R=new Int16Array(k.length*3);let U=0;for(;U<k.length;U++){const $=k[U];if($===-1)continue;R[U*3+2]=F.hmtx.aWidth[$];const ae=F.GPOS;if(ae){const ne=ae.lookupList;for(let oe=0;oe<ne.length;oe++){const te=ne[oe];for(let ie=0;ie<te.tabs.length;ie++){const Y=te.tabs[ie];if(te.ltype===1){if(n._lctf.coverageIndex(Y.coverage,$)!==-1&&Y.pos){J(Y.pos,U);break}}else if(te.ltype===2){let z=null,K=V();if(K!==-1){const le=n._lctf.coverageIndex(Y.coverage,k[K]);if(le!==-1){if(Y.fmt===1){const me=Y.pairsets[le];for(let ve=0;ve<me.length;ve++)me[ve].gid2===$&&(z=me[ve])}else if(Y.fmt===2){const me=n.U._getGlyphClass(k[K],Y.classDef1),ve=n.U._getGlyphClass($,Y.classDef2);z=Y.matrix[me][ve]}if(z){z.val1&&J(z.val1,K),z.val2&&J(z.val2,U);break}}}}else if(te.ltype===4){const z=n._lctf.coverageIndex(Y.markCoverage,$);if(z!==-1){const K=V(H),le=K===-1?-1:n._lctf.coverageIndex(Y.baseCoverage,k[K]);if(le!==-1){const me=Y.markArray[z],ve=Y.baseArray[le][me.markClass];R[U*3]=ve.x-me.x+R[K*3]-R[K*3+2],R[U*3+1]=ve.y-me.y+R[K*3+1];break}}}else if(te.ltype===6){const z=n._lctf.coverageIndex(Y.mark1Coverage,$);if(z!==-1){const K=V();if(K!==-1){const le=k[K];if(P(F,le)===3){const me=n._lctf.coverageIndex(Y.mark2Coverage,le);if(me!==-1){const ve=Y.mark1Array[z],re=Y.mark2Array[me][ve.markClass];R[U*3]=re.x-ve.x+R[K*3]-R[K*3+2],R[U*3+1]=re.y-ve.y+R[K*3+1];break}}}}}}}}else if(F.kern&&!F.cff){const ne=V();if(ne!==-1){const oe=F.kern.glyph1.indexOf(k[ne]);if(oe!==-1){const te=F.kern.rval[oe].glyph2.indexOf($);te!==-1&&(R[ne*3+2]+=F.kern.rval[oe].vals[te])}}}}return R;function V($){for(let ae=U-1;ae>=0;ae--)if(k[ae]!==-1&&(!$||$(k[ae])))return ae;return-1}function H($){return P(F,$)===1}function J($,ae){for(let ne=0;ne<3;ne++)R[ae*3+ne]+=$[ne]||0}}function P(F,k){const R=F.GDEF&&F.GDEF.glyphClassDef;return R?n.U._getGlyphClass(k,R):0}function L(...F){for(let k=0;k<F.length;k++)if(typeof F[k]=="number")return F[k]}function D(F){const k=Object.create(null),R=F["OS/2"],U=F.hhea,V=F.head.unitsPerEm,H=L(R&&R.sTypoAscender,U&&U.ascender,V),J={unitsPerEm:V,ascender:H,descender:L(R&&R.sTypoDescender,U&&U.descender,0),capHeight:L(R&&R.sCapHeight,H),xHeight:L(R&&R.sxHeight,H),lineGap:L(R&&R.sTypoLineGap,U&&U.lineGap),supportsCodePoint($){return n.U.codeToGlyph(F,$)>0},forEachGlyph($,ae,ne,oe){let te=0;const ie=1/J.unitsPerEm*ae,Y=T(F,$);let z=0;const K=A(F,Y);return Y.forEach((le,me)=>{if(le!==-1){let ve=k[le];if(!ve){const{cmds:re,crds:he}=n.U.glyphToPath(F,le);let ye="",ze=0;for(let Ne=0,Be=re.length;Ne<Be;Ne++){const De=t[re[Ne]];ye+=re[Ne];for(let it=1;it<=De;it++)ye+=(it>1?",":"")+he[ze++]}let Ve,Ke,Qe,pt;if(he.length){Ve=Ke=1/0,Qe=pt=-1/0;for(let Ne=0,Be=he.length;Ne<Be;Ne+=2){let De=he[Ne],it=he[Ne+1];De<Ve&&(Ve=De),it<Ke&&(Ke=it),De>Qe&&(Qe=De),it>pt&&(pt=it)}}else Ve=Qe=Ke=pt=0;ve=k[le]={index:le,advanceWidth:F.hmtx.aWidth[le],xMin:Ve,yMin:Ke,xMax:Qe,yMax:pt,path:ye}}oe.call(null,ve,te+K[me*3]*ie,K[me*3+1]*ie,z),te+=K[me*3+2]*ie,ne&&(te+=ne*ae)}z+=$.codePointAt(z)>65535?2:1}),te}};return J}return function(k){const R=new Uint8Array(k,0,4),U=n._bin.readASCII(R,0,4);if(U==="wOFF")k=e(k);else if(U==="wOF2")throw new Error("woff2 fonts not supported");return D(n.parse(k)[0])}}const UD=Yf({name:"Typr Font Parser",dependencies:[LD,ND,DD],init(n,e,t){const r=n(),i=e();return t(r,i)}});function FD(){return(function(n){var e=function(){this.buckets=new Map};e.prototype.add=function(A){var P=A>>5;this.buckets.set(P,(this.buckets.get(P)||0)|1<<(31&A))},e.prototype.has=function(A){var P=this.buckets.get(A>>5);return P!==void 0&&(P&1<<(31&A))!=0},e.prototype.serialize=function(){var A=[];return this.buckets.forEach((function(P,L){A.push((+L).toString(36)+":"+P.toString(36))})),A.join(",")},e.prototype.deserialize=function(A){var P=this;this.buckets.clear(),A.split(",").forEach((function(L){var D=L.split(":");P.buckets.set(parseInt(D[0],36),parseInt(D[1],36))}))};var t=Math.pow(2,8),r=t-1,i=~r;function s(A){var P=(function(D){return D&i})(A).toString(16),L=(function(D){return(D&i)+t-1})(A).toString(16);return"codepoint-index/plane"+(A>>16)+"/"+P+"-"+L+".json"}function a(A,P){var L=A&r,D=P.codePointAt(L/6|0);return((D=(D||48)-48)&1<<L%6)!=0}function o(A,P){var L;(L=A,L.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map((function(D){return D.split("-").map((function(F){return parseInt(F.trim(),16)}))}))).forEach((function(D){var F=D[0],k=D[1];k===void 0&&(k=F),P(F,k)}))}function u(A,P){o(A,(function(L,D){for(var F=L;F<=D;F++)P(F)}))}var c={},f={},m=new WeakMap,g="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function y(A){var P=m.get(A);return P||(P=new e,u(A.ranges,(function(L){return P.add(L)})),m.set(A,P)),P}var _,E=new Map;function x(A,P,L){return A[P]?P:A[L]?L:(function(D){for(var F in D)return F})(A)}function S(A,P){var L=P;if(!A.includes(L)){L=1/0;for(var D=0;D<A.length;D++)Math.abs(A[D]-P)<Math.abs(L-P)&&(L=A[D])}return L}function T(A){return _||(_=new Set,u("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",(function(P){_.add(P)}))),_.has(A)}return n.CodePointSet=e,n.clearCache=function(){c={},f={}},n.getFontsForString=function(A,P){P===void 0&&(P={});var L,D=P.lang;D===void 0&&(D=new RegExp("\\p{Script=Hangul}","u").test(L=A)?"ko":new RegExp("\\p{Script=Hiragana}|\\p{Script=Katakana}","u").test(L)?"ja":"en");var F=P.category;F===void 0&&(F="sans-serif");var k=P.style;k===void 0&&(k="normal");var R=P.weight;R===void 0&&(R=400);var U=(P.dataUrl||g).replace(/\/$/g,""),V=new Map,H=new Uint8Array(A.length),J={},$={},ae=new Array(A.length),ne=new Map,oe=!1;function te(z){var K=E.get(z);return K||(K=fetch(U+"/"+z).then((function(le){if(!le.ok)throw new Error(le.statusText);return le.json().then((function(me){if(!Array.isArray(me)||me[0]!==1)throw new Error("Incorrect schema version; need 1, got "+me[0]);return me[1]}))})).catch((function(le){if(U!==g)return oe||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+U+'", trying default CDN. '+le.message),oe=!0),U=g,E.delete(z),te(z);throw le})),E.set(z,K)),K}for(var ie=function(z){var K=A.codePointAt(z),le=s(K);ae[z]=le,c[le]||ne.has(le)||ne.set(le,te(le).then((function(me){c[le]=me}))),K>65535&&(z++,Y=z)},Y=0;Y<A.length;Y++)ie(Y);return Promise.all(ne.values()).then((function(){ne.clear();for(var z=function(le){var me=A.codePointAt(le),ve=null,re=c[ae[le]],he=void 0;for(var ye in re){var ze=$[ye];if(ze===void 0&&(ze=$[ye]=new RegExp(ye).test(D||"en")),ze){for(var Ve in he=ye,re[ye])if(a(me,re[ye][Ve])){ve=Ve;break}break}}if(!ve){e:for(var Ke in re)if(Ke!==he){for(var Qe in re[Ke])if(a(me,re[Ke][Qe])){ve=Qe;break e}}}ve||(console.debug("No font coverage for U+"+me.toString(16)),ve="latin"),ae[le]=ve,f[ve]||ne.has(ve)||ne.set(ve,te("font-meta/"+ve+".json").then((function(pt){f[ve]=pt}))),me>65535&&(le++,K=le)},K=0;K<A.length;K++)z(K);return Promise.all(ne.values())})).then((function(){for(var z,K=null,le=0;le<A.length;le++){var me=A.codePointAt(le);if(K&&(T(me)||y(K).has(me)))H[le]=H[le-1];else{K=f[ae[le]];var ve=J[K.id];if(!ve){var re=K.typeforms,he=x(re,F,"sans-serif"),ye=x(re[he],k,"normal"),ze=S((z=re[he])===null||z===void 0?void 0:z[ye],R);ve=J[K.id]=U+"/font-files/"+K.id+"/"+he+"."+ye+"."+ze+".woff"}var Ve=V.get(ve);Ve==null&&(Ve=V.size,V.set(ve,Ve)),H[le]=Ve}me>65535&&(le++,H[le]=H[le-1])}return{fontUrls:Array.from(V.keys()),chars:H}}))},Object.defineProperty(n,"__esModule",{value:!0}),n})({})}function OD(n,e){const t=Object.create(null),r=Object.create(null);function i(a,o){const u=c=>{console.error(`Failure loading font ${a}`,c)};try{const c=new XMLHttpRequest;c.open("get",a,!0),c.responseType="arraybuffer",c.onload=function(){if(c.status>=400)u(new Error(c.statusText));else if(c.status>0)try{const f=n(c.response);f.src=a,o(f)}catch(f){u(f)}},c.onerror=u,c.send()}catch(c){u(c)}}function s(a,o){let u=t[a];u?o(u):r[a]?r[a].push(o):(r[a]=[o],i(a,c=>{c.src=a,t[a]=c,r[a].forEach(f=>f(c)),delete r[a]}))}return function(a,o,{lang:u,fonts:c=[],style:f="normal",weight:m="normal",unicodeFontsURL:g}={}){const y=new Uint8Array(a.length),_=[];a.length||T();const E=new Map,x=[];if(f!=="italic"&&(f="normal"),typeof m!="number"&&(m=m==="bold"?700:400),c&&!Array.isArray(c)&&(c=[c]),c=c.slice().filter(P=>!P.lang||P.lang.test(u)).reverse(),c.length){let F=0;(function k(R=0){for(let U=R,V=a.length;U<V;U++){const H=a.codePointAt(U);if(F===1&&_[y[U-1]].supportsCodePoint(H)||U>0&&/\s/.test(a[U]))y[U]=y[U-1],F===2&&(x[x.length-1][1]=U);else for(let J=y[U],$=c.length;J<=$;J++)if(J===$){const ae=F===2?x[x.length-1]:x[x.length]=[U,U];ae[1]=U,F=2}else{y[U]=J;const{src:ae,unicodeRange:ne}=c[J];if(!ne||A(H,ne)){const oe=t[ae];if(!oe){s(ae,()=>{k(U)});return}if(oe.supportsCodePoint(H)){let te=E.get(oe);typeof te!="number"&&(te=_.length,_.push(oe),E.set(oe,te)),y[U]=te,F=1;break}}}H>65535&&U+1<V&&(y[U+1]=y[U],U++,F===2&&(x[x.length-1][1]=U))}S()})()}else x.push([0,a.length-1]),S();function S(){if(x.length){const P=x.map(L=>a.substring(L[0],L[1]+1)).join(`
`);e.getFontsForString(P,{lang:u||void 0,style:f,weight:m,dataUrl:g}).then(({fontUrls:L,chars:D})=>{const F=_.length;let k=0;x.forEach(U=>{for(let V=0,H=U[1]-U[0];V<=H;V++)y[U[0]+V]=D[k++]+F;k++});let R=0;L.forEach((U,V)=>{s(U,H=>{_[V+F]=H,++R===L.length&&T()})})})}else T()}function T(){o({chars:y,fonts:_})}function A(P,L){for(let D=0;D<L.length;D++){const[F,k=F]=L[D];if(F<=P&&P<=k)return!0}return!1}}}const kD=Yf({name:"FontResolver",dependencies:[OD,UD,FD],init(n,e,t){return n(e,t())}});function zD(n,e){const r=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,i="[^\\S\\u00A0]",s=new RegExp(`${i}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function a({text:_,lang:E,fonts:x,style:S,weight:T,preResolvedFonts:A,unicodeFontsURL:P},L){const D=({chars:F,fonts:k})=>{let R,U;const V=[];for(let H=0;H<F.length;H++)F[H]!==U?(U=F[H],V.push(R={start:H,end:H,fontObj:k[F[H]]})):R.end=H;L(V)};A?D(A):n(_,D,{lang:E,fonts:x,style:S,weight:T,unicodeFontsURL:P})}function o({text:_="",font:E,lang:x,sdfGlyphSize:S=64,fontSize:T=400,fontWeight:A=1,fontStyle:P="normal",letterSpacing:L=0,lineHeight:D="normal",maxWidth:F=1/0,direction:k,textAlign:R="left",textIndent:U=0,whiteSpace:V="normal",overflowWrap:H="normal",anchorX:J=0,anchorY:$=0,metricsOnly:ae=!1,unicodeFontsURL:ne,preResolvedFonts:oe=null,includeCaretPositions:te=!1,chunkedBoundsSize:ie=8192,colorRanges:Y=null},z){const K=m(),le={fontLoad:0,typesetting:0};_.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),_=_.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),T=+T,L=+L,F=+F,D=D||"normal",U=+U,a({text:_,lang:x,style:P,weight:A,fonts:typeof E=="string"?[{src:E}]:E,unicodeFontsURL:ne,preResolvedFonts:oe},me=>{le.fontLoad=m()-K;const ve=isFinite(F);let re=null,he=null,ye=null,ze=null,Ve=null,Ke=null,Qe=null,pt=null,Ne=0,Be=0,De=V!=="nowrap";const it=new Map,Q=m();let at=U,je=0,Ce=new g;const He=[Ce];me.forEach(Pe=>{const{fontObj:Te}=Pe,{ascender:ot,descender:rt,unitsPerEm:mt,lineGap:Rt,capHeight:Ge,xHeight:Xe}=Te;let nt=it.get(Te);if(!nt){const Ee=T/mt,et=D==="normal"?(ot-rt+Rt)*Ee:D*T,Pt=(et-(ot-rt)*Ee)/2,tt=Math.min(et,(ot-rt)*Ee),ke=(ot+rt)/2*Ee+tt/2;nt={index:it.size,src:Te.src,fontObj:Te,fontSizeMult:Ee,unitsPerEm:mt,ascender:ot*Ee,descender:rt*Ee,capHeight:Ge*Ee,xHeight:Xe*Ee,lineHeight:et,baseline:-Pt-ot*Ee,caretTop:ke,caretBottom:ke-tt},it.set(Te,nt)}const{fontSizeMult:gt}=nt,st=_.slice(Pe.start,Pe.end+1);let Ot,pe;Te.forEachGlyph(st,T,L,(Ee,et,Pt,tt)=>{et+=je,tt+=Pe.start,Ot=et,pe=Ee;const ke=_.charAt(tt),dt=Ee.advanceWidth*gt,kt=Ce.count;let zt;if("isEmpty"in Ee||(Ee.isWhitespace=!!ke&&new RegExp(i).test(ke),Ee.canBreakAfter=!!ke&&s.test(ke),Ee.isEmpty=Ee.xMin===Ee.xMax||Ee.yMin===Ee.yMax||r.test(ke)),!Ee.isWhitespace&&!Ee.isEmpty&&Be++,De&&ve&&!Ee.isWhitespace&&et+dt+at>F&&kt){if(Ce.glyphAt(kt-1).glyphObj.canBreakAfter)zt=new g,at=-et;else for(let zn=kt;zn--;)if(zn===0&&H==="break-word"){zt=new g,at=-et;break}else if(Ce.glyphAt(zn).glyphObj.canBreakAfter){zt=Ce.splitAt(zn+1);const Un=zt.glyphAt(0).x;at-=Un;for(let Kn=zt.count;Kn--;)zt.glyphAt(Kn).x-=Un;break}zt&&(Ce.isSoftWrapped=!0,Ce=zt,He.push(Ce),Ne=F)}let nn=Ce.glyphAt(Ce.count);nn.glyphObj=Ee,nn.x=et+at,nn.y=Pt,nn.width=dt,nn.charIndex=tt,nn.fontData=nt,ke===`
`&&(Ce=new g,He.push(Ce),at=-(et+dt+L*T)+U)}),je=Ot+pe.advanceWidth*gt+L*T});let q=0;He.forEach(Pe=>{let Te=!0;for(let ot=Pe.count;ot--;){const rt=Pe.glyphAt(ot);Te&&!rt.glyphObj.isWhitespace&&(Pe.width=rt.x+rt.width,Pe.width>Ne&&(Ne=Pe.width),Te=!1);let{lineHeight:mt,capHeight:Rt,xHeight:Ge,baseline:Xe}=rt.fontData;mt>Pe.lineHeight&&(Pe.lineHeight=mt);const nt=Xe-Pe.baseline;nt<0&&(Pe.baseline+=nt,Pe.cap+=nt,Pe.ex+=nt),Pe.cap=Math.max(Pe.cap,Pe.baseline+Rt),Pe.ex=Math.max(Pe.ex,Pe.baseline+Ge)}Pe.baseline-=q,Pe.cap-=q,Pe.ex-=q,q+=Pe.lineHeight});let B=0,ue=0;if(J&&(typeof J=="number"?B=-J:typeof J=="string"&&(B=-Ne*(J==="left"?0:J==="center"?.5:J==="right"?1:c(J)))),$&&(typeof $=="number"?ue=-$:typeof $=="string"&&(ue=$==="top"?0:$==="top-baseline"?-He[0].baseline:$==="top-cap"?-He[0].cap:$==="top-ex"?-He[0].ex:$==="middle"?q/2:$==="bottom"?q:$==="bottom-baseline"?-He[He.length-1].baseline:c($)*q)),!ae){const Pe=e.getEmbeddingLevels(_,k);re=new Uint16Array(Be),he=new Uint8Array(Be),ye=new Float32Array(Be*2),ze={},Qe=[1/0,1/0,-1/0,-1/0],pt=[],te&&(Ke=new Float32Array(_.length*4)),Y&&(Ve=new Uint8Array(Be*3));let Te=0,ot=-1,rt=-1,mt,Rt;if(He.forEach((Ge,Xe)=>{let{count:nt,width:gt}=Ge;if(nt>0){let st=0;for(let tt=nt;tt--&&Ge.glyphAt(tt).glyphObj.isWhitespace;)st++;let Ot=0,pe=0;if(R==="center")Ot=(Ne-gt)/2;else if(R==="right")Ot=Ne-gt;else if(R==="justify"&&Ge.isSoftWrapped){let tt=0;for(let ke=nt-st;ke--;)Ge.glyphAt(ke).glyphObj.isWhitespace&&tt++;pe=(Ne-gt)/tt}if(pe||Ot){let tt=0;for(let ke=0;ke<nt;ke++){let dt=Ge.glyphAt(ke);const kt=dt.glyphObj;dt.x+=Ot+tt,pe!==0&&kt.isWhitespace&&ke<nt-st&&(tt+=pe,dt.width+=pe)}}const Ee=e.getReorderSegments(_,Pe,Ge.glyphAt(0).charIndex,Ge.glyphAt(Ge.count-1).charIndex);for(let tt=0;tt<Ee.length;tt++){const[ke,dt]=Ee[tt];let kt=1/0,zt=-1/0;for(let nn=0;nn<nt;nn++)if(Ge.glyphAt(nn).charIndex>=ke){let zn=nn,Un=nn;for(;Un<nt;Un++){let Kn=Ge.glyphAt(Un);if(Kn.charIndex>dt)break;Un<nt-st&&(kt=Math.min(kt,Kn.x),zt=Math.max(zt,Kn.x+Kn.width))}for(let Kn=zn;Kn<Un;Kn++){const Si=Ge.glyphAt(Kn);Si.x=zt-(Si.x+Si.width-kt)}break}}let et;const Pt=tt=>et=tt;for(let tt=0;tt<nt;tt++){const ke=Ge.glyphAt(tt);et=ke.glyphObj;const dt=et.index,kt=Pe.levels[ke.charIndex]&1;if(kt){const zt=e.getMirroredCharacter(_[ke.charIndex]);zt&&ke.fontData.fontObj.forEachGlyph(zt,0,0,Pt)}if(te){const{charIndex:zt,fontData:nn}=ke,zn=ke.x+B,Un=ke.x+ke.width+B;Ke[zt*4]=kt?Un:zn,Ke[zt*4+1]=kt?zn:Un,Ke[zt*4+2]=Ge.baseline+nn.caretBottom+ue,Ke[zt*4+3]=Ge.baseline+nn.caretTop+ue;const Kn=zt-ot;Kn>1&&f(Ke,ot,Kn),ot=zt}if(Y){const{charIndex:zt}=ke;for(;zt>rt;)rt++,Y.hasOwnProperty(rt)&&(Rt=Y[rt])}if(!et.isWhitespace&&!et.isEmpty){const zt=Te++,{fontSizeMult:nn,src:zn,index:Un}=ke.fontData,Kn=ze[zn]||(ze[zn]={});Kn[dt]||(Kn[dt]={path:et.path,pathBounds:[et.xMin,et.yMin,et.xMax,et.yMax]});const Si=ke.x+B,Di=ke.y+Ge.baseline+ue;ye[zt*2]=Si,ye[zt*2+1]=Di;const Ai=Si+et.xMin*nn,Mi=Di+et.yMin*nn,ri=Si+et.xMax*nn,on=Di+et.yMax*nn;Ai<Qe[0]&&(Qe[0]=Ai),Mi<Qe[1]&&(Qe[1]=Mi),ri>Qe[2]&&(Qe[2]=ri),on>Qe[3]&&(Qe[3]=on),zt%ie===0&&(mt={start:zt,end:zt,rect:[1/0,1/0,-1/0,-1/0]},pt.push(mt)),mt.end++;const li=mt.rect;if(Ai<li[0]&&(li[0]=Ai),Mi<li[1]&&(li[1]=Mi),ri>li[2]&&(li[2]=ri),on>li[3]&&(li[3]=on),re[zt]=dt,he[zt]=Un,Y){const Xr=zt*3;Ve[Xr]=Rt>>16&255,Ve[Xr+1]=Rt>>8&255,Ve[Xr+2]=Rt&255}}}}}),Ke){const Ge=_.length-ot;Ge>1&&f(Ke,ot,Ge)}}const Re=[];it.forEach(({index:Pe,src:Te,unitsPerEm:ot,ascender:rt,descender:mt,lineHeight:Rt,capHeight:Ge,xHeight:Xe})=>{Re[Pe]={src:Te,unitsPerEm:ot,ascender:rt,descender:mt,lineHeight:Rt,capHeight:Ge,xHeight:Xe}}),le.typesetting=m()-Q,z({glyphIds:re,glyphFontIndices:he,glyphPositions:ye,glyphData:ze,fontData:Re,caretPositions:Ke,glyphColors:Ve,chunkedBounds:pt,fontSize:T,topBaseline:ue+He[0].baseline,blockBounds:[B,ue-q,B+Ne,ue],visibleBounds:Qe,timings:le})})}function u(_,E){o({..._,metricsOnly:!0},x=>{const[S,T,A,P]=x.blockBounds;E({width:A-S,height:P-T})})}function c(_){let E=_.match(/^([\d.]+)%$/),x=E?parseFloat(E[1]):NaN;return isNaN(x)?0:x/100}function f(_,E,x){const S=_[E*4],T=_[E*4+1],A=_[E*4+2],P=_[E*4+3],L=(T-S)/x;for(let D=0;D<x;D++){const F=(E+D)*4;_[F]=S+L*D,_[F+1]=S+L*(D+1),_[F+2]=A,_[F+3]=P}}function m(){return(self.performance||Date).now()}function g(){this.data=[]}const y=["glyphObj","x","y","width","charIndex","fontData"];return g.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/y.length)},glyphAt(_){let E=g.flyweight;return E.data=this.data,E.index=_,E},splitAt(_){let E=new g;return E.data=this.data.splice(_*y.length),E}},g.flyweight=y.reduce((_,E,x,S)=>(Object.defineProperty(_,E,{get(){return this.data[this.index*y.length+x]},set(T){this.data[this.index*y.length+x]=T}}),_),{data:null,index:0}),{typeset:o,measure:u}}const Hc=()=>(self.performance||Date).now(),p1=j3();let X2;function BD(n,e,t,r,i,s,a,o,u,c,f=!0){return f?VD(n,e,t,r,i,s,a,o,u,c).then(null,m=>(X2||(console.warn("WebGL SDF generation failed, falling back to JS",m),X2=!0),Y2(n,e,t,r,i,s,a,o,u,c))):Y2(n,e,t,r,i,s,a,o,u,c)}const xg=[],GD=5;let N_=0;function q3(){const n=Hc();for(;xg.length&&Hc()-n<GD;)xg.shift()();N_=xg.length?setTimeout(q3,0):0}const VD=(...n)=>new Promise((e,t)=>{xg.push(()=>{const r=Hc();try{p1.webgl.generateIntoCanvas(...n),e({timing:Hc()-r})}catch(i){t(i)}}),N_||(N_=setTimeout(q3,0))}),HD=4,WD=2e3,q2={};let jD=0;function Y2(n,e,t,r,i,s,a,o,u,c){const f="TroikaTextSDFGenerator_JS_"+jD++%HD;let m=q2[f];return m||(m=q2[f]={workerModule:Yf({name:f,workerId:f,dependencies:[j3,Hc],init(g,y){const _=g().javascript.generate;return function(...E){const x=y();return{textureData:_(...E),timing:y()-x}}},getTransferables(g){return[g.textureData.buffer]}}),requests:0,idleTimer:null}),m.requests++,clearTimeout(m.idleTimer),m.workerModule(n,e,t,r,i,s).then(({textureData:g,timing:y})=>{const _=Hc(),E=new Uint8Array(g.length*4);for(let x=0;x<g.length;x++)E[x*4+c]=g[x];return p1.webglUtils.renderImageData(a,E,o,u,n,e,1<<3-c),y+=Hc()-_,--m.requests===0&&(m.idleTimer=setTimeout(()=>{MD(f)},WD)),{timing:y}})}function XD(n){n._warm||(p1.webgl.isSupported(n),n._warm=!0)}const qD=p1.webglUtils.resizeWebGLCanvasWithoutClearing,cp={unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},YD=new jt;function mf(){return(self.performance||Date).now()}const Z2=Object.create(null);function Y3(n,e){n=KD({},n);const t=mf(),r=[];if(n.font&&r.push({label:"user",src:QD(n.font)}),n.font=r,n.text=""+n.text,n.sdfGlyphSize=n.sdfGlyphSize||cp.sdfGlyphSize,n.unicodeFontsURL=n.unicodeFontsURL||cp.unicodeFontsURL,n.colorRanges!=null){let g={};for(let y in n.colorRanges)if(n.colorRanges.hasOwnProperty(y)){let _=n.colorRanges[y];typeof _!="number"&&(_=YD.set(_).getHex()),g[y]=_}n.colorRanges=g}Object.freeze(n);const{textureWidth:i,sdfExponent:s}=cp,{sdfGlyphSize:a}=n,o=i/a*4;let u=Z2[a];if(!u){const g=document.createElement("canvas");g.width=i,g.height=a*256/o,u=Z2[a]={glyphCount:0,sdfGlyphSize:a,sdfCanvas:g,sdfTexture:new ei(g,void 0,void 0,void 0,Dn,Dn),contextLost:!1,glyphsByFont:new Map},u.sdfTexture.generateMipmaps=!1,ZD(u)}const{sdfTexture:c,sdfCanvas:f}=u;K3(n).then(g=>{const{glyphIds:y,glyphFontIndices:_,fontData:E,glyphPositions:x,fontSize:S,timings:T}=g,A=[],P=new Float32Array(y.length*4);let L=0,D=0;const F=mf(),k=E.map(J=>{let $=u.glyphsByFont.get(J.src);return $||u.glyphsByFont.set(J.src,$=new Map),$});y.forEach((J,$)=>{const ae=_[$],{src:ne,unitsPerEm:oe}=E[ae];let te=k[ae].get(J);if(!te){const{path:le,pathBounds:me}=g.glyphData[ne][J],ve=Math.max(me[2]-me[0],me[3]-me[1])/a*(cp.sdfMargin*a+.5),re=u.glyphCount++,he=[me[0]-ve,me[1]-ve,me[2]+ve,me[3]+ve];k[ae].set(J,te={path:le,atlasIndex:re,sdfViewBox:he}),A.push(te)}const{sdfViewBox:ie}=te,Y=x[D++],z=x[D++],K=S/oe;P[L++]=Y+ie[0]*K,P[L++]=z+ie[1]*K,P[L++]=Y+ie[2]*K,P[L++]=z+ie[3]*K,y[$]=te.atlasIndex}),T.quads=(T.quads||0)+(mf()-F);const R=mf();T.sdf={};const U=f.height,V=Math.ceil(u.glyphCount/o),H=Math.pow(2,Math.ceil(Math.log2(V*a)));H>U&&(console.info(`Increasing SDF texture size ${U}->${H}`),qD(f,i,H),c.dispose()),Promise.all(A.map(J=>Z3(J,u,n.gpuAccelerateSDF).then(({timing:$})=>{T.sdf[J.atlasIndex]=$}))).then(()=>{A.length&&!u.contextLost&&(J3(u),c.needsUpdate=!0),T.sdfTotal=mf()-R,T.total=mf()-t,e(Object.freeze({parameters:n,sdfTexture:c,sdfGlyphSize:a,sdfExponent:s,glyphBounds:P,glyphAtlasIndices:y,glyphColors:g.glyphColors,caretPositions:g.caretPositions,chunkedBounds:g.chunkedBounds,ascender:g.ascender,descender:g.descender,lineHeight:g.lineHeight,capHeight:g.capHeight,xHeight:g.xHeight,topBaseline:g.topBaseline,blockBounds:g.blockBounds,visibleBounds:g.visibleBounds,timings:g.timings}))})}),Promise.resolve().then(()=>{u.contextLost||XD(f)})}function Z3({path:n,atlasIndex:e,sdfViewBox:t},{sdfGlyphSize:r,sdfCanvas:i,contextLost:s},a){if(s)return Promise.resolve({timing:-1});const{textureWidth:o,sdfExponent:u}=cp,c=Math.max(t[2]-t[0],t[3]-t[1]),f=Math.floor(e/4),m=f%(o/r)*r,g=Math.floor(f/(o/r))*r,y=e%4;return BD(r,r,n,t,c,u,i,m,g,y,a)}function ZD(n){const e=n.sdfCanvas;e.addEventListener("webglcontextlost",t=>{console.log("Context Lost",t),t.preventDefault(),n.contextLost=!0}),e.addEventListener("webglcontextrestored",t=>{console.log("Context Restored",t),n.contextLost=!1;const r=[];n.glyphsByFont.forEach(i=>{i.forEach(s=>{r.push(Z3(s,n,!0))})}),Promise.all(r).then(()=>{J3(n),n.sdfTexture.needsUpdate=!0})})}function JD({font:n,characters:e,sdfGlyphSize:t},r){let i=Array.isArray(e)?e.join(`
`):""+e;Y3({font:n,sdfGlyphSize:t,text:i},r)}function KD(n,e){for(let t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return n}let sg;function QD(n){return sg||(sg=typeof document>"u"?{}:document.createElement("a")),sg.href=n,sg.href}function J3(n){if(typeof createImageBitmap!="function"){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:e,sdfTexture:t}=n,{width:r,height:i}=e,s=n.sdfCanvas.getContext("webgl");let a=t.image.data;(!a||a.length!==r*i*4)&&(a=new Uint8Array(r*i*4),t.image={width:r,height:i,data:a},t.flipY=!1,t.isDataTexture=!0),s.readPixels(0,0,r,i,s.RGBA,s.UNSIGNED_BYTE,a)}}const $D=Yf({name:"Typesetter",dependencies:[zD,kD,ED],init(n,e,t){return n(e,t())}}),K3=Yf({name:"Typesetter",dependencies:[$D],init(n){return function(e){return new Promise(t=>{n.typeset(e,t)})}},getTransferables(n){const e=[];for(let t in n)n[t]&&n[t].buffer&&e.push(n[t].buffer);return e}});K3.onMainThread;const J2={};function eU(n){let e=J2[n];return e||(e=J2[n]=new po(1,1,n,n).translate(.5,.5,0)),e}const tU="aTroikaGlyphBounds",K2="aTroikaGlyphIndex",nU="aTroikaGlyphColor";class iU extends Ex{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new Dr,this.boundingBox=new Nr}computeBoundingSphere(){}computeBoundingBox(){}set detail(e){if(e!==this._detail){this._detail=e,(typeof e!="number"||e<1)&&(e=1);let t=eU(e);["position","normal","uv"].forEach(r=>{this.attributes[r]=t.attributes[r].clone()}),this.setIndex(t.getIndex().clone())}}get detail(){return this._detail}set curveRadius(e){e!==this._curveRadius&&(this._curveRadius=e,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(e,t,r,i,s){this.updateAttributeData(tU,e,4),this.updateAttributeData(K2,t,1),this.updateAttributeData(nU,s,3),this._blockBounds=r,this._chunkedBounds=i,this.instanceCount=t.length,this._updateBounds()}_updateBounds(){const e=this._blockBounds;if(e){const{curveRadius:t,boundingBox:r}=this;if(t){const{PI:i,floor:s,min:a,max:o,sin:u,cos:c}=Math,f=i/2,m=i*2,g=Math.abs(t),y=e[0]/g,_=e[2]/g,E=s((y+f)/m)!==s((_+f)/m)?-g:a(u(y)*g,u(_)*g),x=s((y-f)/m)!==s((_-f)/m)?g:o(u(y)*g,u(_)*g),S=s((y+i)/m)!==s((_+i)/m)?g*2:o(g-c(y)*g,g-c(_)*g);r.min.set(E,e[1],t<0?-S:0),r.max.set(x,e[3],t<0?0:S)}else r.min.set(e[0],e[1],0),r.max.set(e[2],e[3],0);r.getBoundingSphere(this.boundingSphere)}}applyClipRect(e){let t=this.getAttribute(K2).count,r=this._chunkedBounds;if(r)for(let i=r.length;i--;){t=r[i].end;let s=r[i].rect;if(s[1]<e.w&&s[3]>e.y&&s[0]<e.z&&s[2]>e.x)break}this.instanceCount=t}updateAttributeData(e,t,r){const i=this.getAttribute(e);t?i&&i.array.length===t.length?(i.array.set(t),i.needsUpdate=!0):(this.setAttribute(e,new qc(t,r)),delete this._maxInstanceCount,this.dispose()):i&&this.deleteAttribute(e)}}const rU=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaEdgeOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,sU=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaEdgeOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaEdgeOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,aU=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaEdgeOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,oU=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaEdgeOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`;function lU(n){const e=L_(n,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new ct},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new $n(0,0,0,0)},uTroikaClipRect:{value:new $n(0,0,0,0)},uTroikaEdgeOffset:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new ct},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new jt},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new Tn},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:rU,vertexTransform:sU,fragmentDefs:aU,fragmentColorTransform:oU,customRewriter({vertexShader:t,fragmentShader:r}){let i=/\buniform\s+vec3\s+diffuse\b/;return i.test(r)&&(r=r.replace(i,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),i.test(t)||(t=t.replace(X3,`uniform vec3 diffuse;
$&
vTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;
`))),{vertexShader:t,fragmentShader:r}}});return e.transparent=!0,e.forceSinglePass=!0,Object.defineProperties(e,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),e}const Ox=new Ho({color:16777215,side:Ea,transparent:!0}),Q2=8421504,$2=new vn,ag=new X,t_=new X,rp=[],uU=new X,n_="+x+y";function ew(n){return Array.isArray(n)?n[0]:n}let Q3=()=>{const n=new pi(new po(1,1),Ox);return Q3=()=>n,n},$3=()=>{const n=new pi(new po(1,1,32,1),Ox);return $3=()=>n,n};const cU={type:"syncstart"},hU={type:"synccomplete"},eT=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],fU=eT.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");let tT=class extends pi{constructor(){const e=new iU;super(e,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=Q2,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=n_,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(e){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(e):(this._isSyncing=!0,this.dispatchEvent(cU),Y3({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},t=>{this._isSyncing=!1,this._textRenderInfo=t,this.geometry.updateGlyphs(t.glyphBounds,t.glyphAtlasIndices,t.blockBounds,t.chunkedBounds,t.glyphColors);const r=this._queuedSyncs;r&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{r.forEach(i=>i&&i())})),this.dispatchEvent(hU),e&&e()})))}onBeforeRender(e,t,r,i,s,a){this.sync(),s.isTroikaTextMaterial&&this._prepareForRender(s)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}createDerivedMaterial(e){return lU(e)}get material(){let e=this._derivedMaterial;const t=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=Ox.clone());if((!e||!e.isDerivedFrom(t))&&(e=this._derivedMaterial=this.createDerivedMaterial(t),t.addEventListener("dispose",function r(){t.removeEventListener("dispose",r),e.dispose()})),this.hasOutline()){let r=e._outlineMtl;return r||(r=e._outlineMtl=Object.create(e,{id:{value:e.id+.1}}),r.isTextOutlineMaterial=!0,r.depthWrite=!1,r.map=null,e.addEventListener("dispose",function i(){e.removeEventListener("dispose",i),r.dispose()})),[r,e]}else return e}set material(e){e&&e.isTroikaTextMaterial?(this._derivedMaterial=e,this._baseMaterial=e.baseMaterial):this._baseMaterial=e}hasOutline(){return!!(this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY)}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(e){this.geometry.detail=e}get curveRadius(){return this.geometry.curveRadius}set curveRadius(e){this.geometry.curveRadius=e}get customDepthMaterial(){return ew(this.material).getDepthMaterial()}set customDepthMaterial(e){}get customDistanceMaterial(){return ew(this.material).getDistanceMaterial()}set customDistanceMaterial(e){}_prepareForRender(e){const t=e.isTextOutlineMaterial,r=e.uniforms,i=this.textRenderInfo;if(i){const{sdfTexture:o,blockBounds:u}=i;r.uTroikaSDFTexture.value=o,r.uTroikaSDFTextureSize.value.set(o.image.width,o.image.height),r.uTroikaSDFGlyphSize.value=i.sdfGlyphSize,r.uTroikaSDFExponent.value=i.sdfExponent,r.uTroikaTotalBounds.value.fromArray(u),r.uTroikaUseGlyphColors.value=!t&&!!i.glyphColors;let c=0,f=0,m=0,g,y,_,E=0,x=0;if(t){let{outlineWidth:T,outlineOffsetX:A,outlineOffsetY:P,outlineBlur:L,outlineOpacity:D}=this;c=this._parsePercent(T)||0,f=Math.max(0,this._parsePercent(L)||0),g=D,E=this._parsePercent(A)||0,x=this._parsePercent(P)||0}else m=Math.max(0,this._parsePercent(this.strokeWidth)||0),m&&(_=this.strokeColor,r.uTroikaStrokeColor.value.set(_??Q2),y=this.strokeOpacity,y==null&&(y=1)),g=this.fillOpacity;r.uTroikaEdgeOffset.value=c,r.uTroikaPositionOffset.value.set(E,x),r.uTroikaBlurRadius.value=f,r.uTroikaStrokeWidth.value=m,r.uTroikaStrokeOpacity.value=y,r.uTroikaFillOpacity.value=g??1,r.uTroikaCurveRadius.value=this.curveRadius||0;let S=this.clipRect;if(S&&Array.isArray(S)&&S.length===4)r.uTroikaClipRect.value.fromArray(S);else{const T=(this.fontSize||.1)*100;r.uTroikaClipRect.value.set(u[0]-T,u[1]-T,u[2]+T,u[3]+T)}this.geometry.applyClipRect(r.uTroikaClipRect.value)}r.uTroikaSDFDebug.value=!!this.debugSDF,e.polygonOffset=!!this.depthOffset,e.polygonOffsetFactor=e.polygonOffsetUnits=this.depthOffset||0;const s=t?this.outlineColor||0:this.color;if(s==null)delete e.color;else{const o=e.hasOwnProperty("color")?e.color:e.color=new jt;(s!==o._input||typeof s=="object")&&o.set(o._input=s)}let a=this.orientation||n_;if(a!==e._orientation){let o=r.uTroikaOrient.value;a=a.replace(/[^-+xyz]/g,"");let u=a!==n_&&a.match(/^([-+])([xyz])([-+])([xyz])$/);if(u){let[,c,f,m,g]=u;ag.set(0,0,0)[f]=c==="-"?1:-1,t_.set(0,0,0)[g]=m==="-"?-1:1,$2.lookAt(uU,ag.cross(t_),t_),o.setFromMatrix4($2)}else o.identity();e._orientation=a}}_parsePercent(e){if(typeof e=="string"){let t=e.match(/^(-?[\d.]+)%$/),r=t?parseFloat(t[1]):NaN;e=(isNaN(r)?0:r/100)*this.fontSize}return e}localPositionToTextCoords(e,t=new ct){t.copy(e);const r=this.curveRadius;return r&&(t.x=Math.atan2(e.x,Math.abs(r)-Math.abs(e.z))*Math.abs(r)),t}worldPositionToTextCoords(e,t=new ct){return ag.copy(e),this.localPositionToTextCoords(this.worldToLocal(ag),t)}raycast(e,t){const{textRenderInfo:r,curveRadius:i}=this;if(r){const s=r.blockBounds,a=i?$3():Q3(),o=a.geometry,{position:u,uv:c}=o.attributes;for(let f=0;f<c.count;f++){let m=s[0]+c.getX(f)*(s[2]-s[0]);const g=s[1]+c.getY(f)*(s[3]-s[1]);let y=0;i&&(y=i-Math.cos(m/i)*i,m=Math.sin(m/i)*i),u.setXYZ(f,m,g,y)}o.boundingSphere=this.geometry.boundingSphere,o.boundingBox=this.geometry.boundingBox,a.matrixWorld=this.matrixWorld,a.material.side=this.material.side,rp.length=0,a.raycast(e,rp);for(let f=0;f<rp.length;f++)rp[f].object=this,t.push(rp[f])}}copy(e){const t=this.geometry;return super.copy(e),this.geometry=t,fU.forEach(r=>{this[r]=e[r]}),this}clone(){return new this.constructor().copy(this)}};eT.forEach(n=>{const e="_private_"+n;Object.defineProperty(tT.prototype,n,{get(){return this[e]},set(t){t!==this[e]&&(this[e]=t,this._needsSync=!0)}})});new Nr;new jt;const og=se.forwardRef(({sdfGlyphSize:n=64,anchorX:e="center",anchorY:t="middle",font:r,fontSize:i=1,children:s,characters:a,onSync:o,...u},c)=>{const f=Zc(({invalidate:_})=>_),[m]=se.useState(()=>new tT),[g,y]=se.useMemo(()=>{const _=[];let E="";return se.Children.forEach(s,x=>{typeof x=="string"||typeof x=="number"?E+=x:_.push(x)}),[_,E]},[s]);return y3(()=>new Promise(_=>JD({font:r,characters:a},_)),["troika-text",r,a]),se.useLayoutEffect(()=>void m.sync(()=>{f(),o&&o(m)})),se.useEffect(()=>()=>m.dispose(),[m]),se.createElement("primitive",yv({object:m,ref:c,font:r,text:y,anchorX:e,anchorY:t,fontSize:i,sdfGlyphSize:n},u),g)}),dU=3e3,pU=3001,nT=(n,e,t)=>{let r;switch(n){case Rr:r=new Uint8ClampedArray(e*t*4);break;case Vi:r=new Uint16Array(e*t*4);break;case ca:r=new Uint32Array(e*t*4);break;case Lv:r=new Int8Array(e*t*4);break;case Nv:r=new Int16Array(e*t*4);break;case t0:r=new Int32Array(e*t*4);break;case bi:r=new Float32Array(e*t*4);break;default:throw new Error("Unsupported data type")}return r};let lg;const mU=(n,e,t,r)=>{if(lg!==void 0)return lg;const i=new ws(1,1,r);e.setRenderTarget(i);const s=new pi(new po,new Ho({color:16777215}));e.render(s,t),e.setRenderTarget(null);const a=nT(n,i.width,i.height);return e.readRenderTargetPixels(i,0,0,i.width,i.height,a),i.dispose(),s.geometry.dispose(),s.material.dispose(),lg=a[0]!==0,lg};class kx{_renderer;_rendererIsDisposable=!1;_material;_scene;_camera;_quad;_renderTarget;_width;_height;_type;_colorSpace;_supportsReadPixels=!0;constructor(e){this._width=e.width,this._height=e.height,this._type=e.type,this._colorSpace=e.colorSpace;const t={format:Ki,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:e.renderTargetOptions?.anisotropy!==void 0?e.renderTargetOptions?.anisotropy:1,generateMipmaps:e.renderTargetOptions?.generateMipmaps!==void 0?e.renderTargetOptions?.generateMipmaps:!1,magFilter:e.renderTargetOptions?.magFilter!==void 0?e.renderTargetOptions?.magFilter:Dn,minFilter:e.renderTargetOptions?.minFilter!==void 0?e.renderTargetOptions?.minFilter:Dn,samples:e.renderTargetOptions?.samples!==void 0?e.renderTargetOptions?.samples:void 0,wrapS:e.renderTargetOptions?.wrapS!==void 0?e.renderTargetOptions?.wrapS:Gi,wrapT:e.renderTargetOptions?.wrapT!==void 0?e.renderTargetOptions?.wrapT:Gi};if(this._material=e.material,e.renderer?this._renderer=e.renderer:(this._renderer=kx.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new a0,this._camera=new th,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!mU(this._type,this._renderer,this._camera,t)){let r;switch(this._type){case Vi:r=this._renderer.extensions.has("EXT_color_buffer_float")?bi:void 0;break}r!==void 0?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${bi}`),this._type=r):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new pi(new po,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new ws(this.width,this.height,t),this._renderTarget.texture.mapping=e.renderTargetOptions?.mapping!==void 0?e.renderTargetOptions?.mapping:wu}static instantiateRenderer(){const e=new Lx;return e.setSize(128,128),e}render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(e){throw this._renderer.setRenderTarget(null),e}this._renderer.setRenderTarget(null)};toArray(){if(!this._supportsReadPixels)throw new Error("Can't read pixels in this browser");const e=nT(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,e),e}toDataTexture(e){const t=new Aa(this.toArray(),this.width,this.height,Ki,this._type,e?.mapping||wu,e?.wrapS||Gi,e?.wrapT||Gi,e?.magFilter||Dn,e?.minFilter||Dn,e?.anisotropy||1,zo);return t.generateMipmaps=e?.generateMipmaps!==void 0?e?.generateMipmaps:!1,t}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(e){this.disposeOnDemandRenderer(),e&&this.renderTarget.dispose(),this.material instanceof Es&&Object.values(this.material.uniforms).forEach(t=>{t.value instanceof ei&&t.value.dispose()}),Object.values(this.material).forEach(t=>{t instanceof ei&&t.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(e){this._width=e,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(e){this._height=e,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(e){this._renderTarget=e,this._width=e.width,this._height=e.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}class iT extends Error{}class rT extends Error{}const sp=(n,e,t)=>{const r=new RegExp(`${e}="([^"]*)"`,"i").exec(n);if(r)return r[1];const i=new RegExp(`<${e}[^>]*>([\\s\\S]*?)</${e}>`,"i").exec(n);if(i){const s=i[1].match(/<rdf:li>([^<]*)<\/rdf:li>/g);return s&&s.length===3?s.map(a=>a.replace(/<\/?rdf:li>/g,"")):i[1].trim()}if(t!==void 0)return t;throw new Error(`Can't find ${e} in gainmap metadata`)},gU=n=>{let e;typeof TextDecoder<"u"?e=new TextDecoder().decode(n):e=n.toString();let t=e.indexOf("<x:xmpmeta");for(;t!==-1;){const r=e.indexOf("x:xmpmeta>",t),i=e.slice(t,r+10);try{const s=sp(i,"hdrgm:GainMapMin","0"),a=sp(i,"hdrgm:GainMapMax"),o=sp(i,"hdrgm:Gamma","1"),u=sp(i,"hdrgm:OffsetSDR","0.015625"),c=sp(i,"hdrgm:OffsetHDR","0.015625"),f=/hdrgm:HDRCapacityMin="([^"]*)"/.exec(i),m=f?f[1]:"0",g=/hdrgm:HDRCapacityMax="([^"]*)"/.exec(i);if(!g)throw new Error("Incomplete gainmap metadata");const y=g[1];return{gainMapMin:Array.isArray(s)?s.map(_=>parseFloat(_)):[parseFloat(s),parseFloat(s),parseFloat(s)],gainMapMax:Array.isArray(a)?a.map(_=>parseFloat(_)):[parseFloat(a),parseFloat(a),parseFloat(a)],gamma:Array.isArray(o)?o.map(_=>parseFloat(_)):[parseFloat(o),parseFloat(o),parseFloat(o)],offsetSdr:Array.isArray(u)?u.map(_=>parseFloat(_)):[parseFloat(u),parseFloat(u),parseFloat(u)],offsetHdr:Array.isArray(c)?c.map(_=>parseFloat(_)):[parseFloat(c),parseFloat(c),parseFloat(c)],hdrCapacityMin:parseFloat(m),hdrCapacityMax:parseFloat(y)}}catch{}t=e.indexOf("<x:xmpmeta",r)}};class vU{options;constructor(e){this.options={debug:e&&e.debug!==void 0?e.debug:!1,extractFII:e&&e.extractFII!==void 0?e.extractFII:!0,extractNonFII:e&&e.extractNonFII!==void 0?e.extractNonFII:!0}}extract(e){return new Promise((t,r)=>{const i=this.options.debug,s=new DataView(e.buffer);if(s.getUint16(0)!==65496){r(new Error("Not a valid jpeg"));return}const a=s.byteLength;let o=2,u=0,c;for(;o<a;){if(++u>250){r(new Error(`Found no marker after ${u} loops `));return}if(s.getUint8(o)!==255){r(new Error(`Not a valid marker at offset 0x${o.toString(16)}, found: 0x${s.getUint8(o).toString(16)}`));return}if(c=s.getUint8(o+1),i&&console.log(`Marker: ${c.toString(16)}`),c===226){i&&console.log("Found APP2 marker (0xffe2)");const f=o+4;if(s.getUint32(f)===1297106432){const m=f+4;let g;if(s.getUint16(m)===18761)g=!1;else if(s.getUint16(m)===19789)g=!0;else{r(new Error("No valid endianness marker found in TIFF header"));return}if(s.getUint16(m+2,!g)!==42){r(new Error("Not valid TIFF data! (no 0x002A marker)"));return}const y=s.getUint32(m+4,!g);if(y<8){r(new Error("Not valid TIFF data! (First offset less than 8)"));return}const _=m+y,E=s.getUint16(_,!g),x=_+2;let S=0;for(let L=x;L<x+12*E;L+=12)s.getUint16(L,!g)===45057&&(S=s.getUint32(L+8,!g));const A=_+2+E*12+4,P=[];for(let L=A;L<A+S*16;L+=16){const D={MPType:s.getUint32(L,!g),size:s.getUint32(L+4,!g),dataOffset:s.getUint32(L+8,!g),dependantImages:s.getUint32(L+12,!g),start:-1,end:-1,isFII:!1};D.dataOffset?(D.start=m+D.dataOffset,D.isFII=!1):(D.start=0,D.isFII=!0),D.end=D.start+D.size,P.push(D)}if(this.options.extractNonFII&&P.length){const L=new Blob([s]),D=[];for(const F of P){if(F.isFII&&!this.options.extractFII)continue;const k=L.slice(F.start,F.end+1,"image/jpeg");D.push(k)}t(D)}}}o+=2+s.getUint16(o+2)}})}}const yU=async n=>{const e=gU(n);if(!e)throw new rT("Gain map XMP metadata not found");const r=await new vU({extractFII:!0,extractNonFII:!0}).extract(n);if(r.length!==2)throw new iT("Gain map recovery image not found");return{sdr:new Uint8Array(await r[0].arrayBuffer()),gainMap:new Uint8Array(await r[1].arrayBuffer()),metadata:e}},tw=n=>new Promise((e,t)=>{const r=document.createElement("img");r.onload=()=>{e(r)},r.onerror=i=>{t(i)},r.src=URL.createObjectURL(n)});class _U extends bs{_renderer;_renderTargetOptions;_internalLoadingManager;_config;constructor(e,t){super(t),this._config=e,e.renderer&&(this._renderer=e.renderer),this._internalLoadingManager=new c1}setRenderer(e){return this._renderer=e,this}setRenderTargetOptions(e){return this._renderTargetOptions=e,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: A Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");const e=this._config.createMaterial({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new ei,sdr:new ei});return this._config.createQuadRenderer({width:16,height:16,type:Vi,colorSpace:zo,material:e,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async processImages(e,t,r){const i=t?new Blob([t],{type:"image/jpeg"}):void 0,s=new Blob([e],{type:"image/jpeg"});let a,o,u=!1;if(typeof createImageBitmap>"u"){const c=await Promise.all([i?tw(i):Promise.resolve(void 0),tw(s)]);o=c[0],a=c[1],u=r==="flipY"}else{const c=await Promise.all([i?createImageBitmap(i,{imageOrientation:r||"flipY"}):Promise.resolve(void 0),createImageBitmap(s,{imageOrientation:r||"flipY"})]);o=c[0],a=c[1]}return{sdrImage:a,gainMapImage:o,needsFlip:u}}createTextures(e,t,r){const i=new ei(t||new ImageData(2,2),wu,Gi,Gi,Dn,d_,Ki,Rr,1,zo);i.flipY=r,i.needsUpdate=!0;const s=new ei(e,wu,Gi,Gi,Dn,d_,Ki,Rr,1,rs);return s.flipY=r,s.needsUpdate=!0,{gainMap:i,sdr:s}}updateQuadRenderer(e,t,r,i,s){e.width=t.width,e.height=t.height,e.material.gainMap=r,e.material.sdr=i,e.material.gainMapMin=s.gainMapMin,e.material.gainMapMax=s.gainMapMax,e.material.offsetHdr=s.offsetHdr,e.material.offsetSdr=s.offsetSdr,e.material.gamma=s.gamma,e.material.hdrCapacityMin=s.hdrCapacityMin,e.material.hdrCapacityMax=s.hdrCapacityMax,e.material.maxDisplayBoost=Math.pow(2,s.hdrCapacityMax),e.material.needsUpdate=!0}}const xU=`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,SU=`
// min half float value
#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )
// max half float value
#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )

uniform sampler2D sdr;
uniform sampler2D gainMap;
uniform vec3 gamma;
uniform vec3 offsetHdr;
uniform vec3 offsetSdr;
uniform vec3 gainMapMin;
uniform vec3 gainMapMax;
uniform float weightFactor;

varying vec2 vUv;

void main() {
  vec3 rgb = texture2D( sdr, vUv ).rgb;
  vec3 recovery = texture2D( gainMap, vUv ).rgb;
  vec3 logRecovery = pow( recovery, gamma );
  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;
  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;
  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));
  gl_FragColor = vec4( clampedHdrColor , 1.0 );
}
`;class MU extends Es{_maxDisplayBoost;_hdrCapacityMin;_hdrCapacityMax;constructor({gamma:e,offsetHdr:t,offsetSdr:r,gainMapMin:i,gainMapMax:s,maxDisplayBoost:a,hdrCapacityMin:o,hdrCapacityMax:u,sdr:c,gainMap:f}){super({name:"GainMapDecoderMaterial",vertexShader:xU,fragmentShader:SU,uniforms:{sdr:{value:c},gainMap:{value:f},gamma:{value:new X(1/e[0],1/e[1],1/e[2])},offsetHdr:{value:new X().fromArray(t)},offsetSdr:{value:new X().fromArray(r)},gainMapMin:{value:new X().fromArray(i)},gainMapMax:{value:new X().fromArray(s)},weightFactor:{value:(Math.log2(a)-o)/(u-o)}},blending:uo,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=a,this._hdrCapacityMin=o,this._hdrCapacityMax=u,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(e){this.uniforms.sdr.value=e}get gainMap(){return this.uniforms.gainMap.value}set gainMap(e){this.uniforms.gainMap.value=e}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(e){this.uniforms.offsetHdr.value.fromArray(e)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(e){this.uniforms.offsetSdr.value.fromArray(e)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(e){this.uniforms.gainMapMin.value.fromArray(e)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(e){this.uniforms.gainMapMax.value.fromArray(e)}get gamma(){const e=this.uniforms.gamma.value;return[1/e.x,1/e.y,1/e.z]}set gamma(e){const t=this.uniforms.gamma.value;t.x=1/e[0],t.y=1/e[1],t.z=1/e[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(e){this._hdrCapacityMin=e,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(e){this._hdrCapacityMax=e,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(e){this._maxDisplayBoost=Math.max(1,Math.min(65504,e)),this.calculateWeight()}calculateWeight(){const e=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,e))}}class sT extends _U{constructor(e,t){super({renderer:e,createMaterial:r=>new MU(r),createQuadRenderer:r=>new kx(r)},t)}async render(e,t,r,i){const{sdrImage:s,gainMapImage:a,needsFlip:o}=await this.processImages(r,i,"flipY"),{gainMap:u,sdr:c}=this.createTextures(s,a,o);this.updateQuadRenderer(e,s,u,c,t),e.render()}}class wU extends sT{load([e,t,r],i,s,a){const o=this.prepareQuadRenderer();let u,c,f;const m=async()=>{if(u&&c&&f){try{await this.render(o,f,u,c)}catch(R){this.manager.itemError(e),this.manager.itemError(t),this.manager.itemError(r),typeof a=="function"&&a(R),o.disposeOnDemandRenderer();return}typeof i=="function"&&i(o),this.manager.itemEnd(e),this.manager.itemEnd(t),this.manager.itemEnd(r),o.disposeOnDemandRenderer()}};let g=!0,y=0,_=0,E=!0,x=0,S=0,T=!0,A=0,P=0;const L=()=>{if(typeof s=="function"){const R=y+x+A,U=_+S+P,V=g&&E&&T;s(new ProgressEvent("progress",{lengthComputable:V,loaded:U,total:R}))}};this.manager.itemStart(e),this.manager.itemStart(t),this.manager.itemStart(r);const D=new ua(this._internalLoadingManager);D.setResponseType("arraybuffer"),D.setRequestHeader(this.requestHeader),D.setPath(this.path),D.setWithCredentials(this.withCredentials),D.load(e,async R=>{if(typeof R=="string")throw new Error("Invalid sdr buffer");u=R,await m()},R=>{g=R.lengthComputable,_=R.loaded,y=R.total,L()},R=>{this.manager.itemError(e),typeof a=="function"&&a(R)});const F=new ua(this._internalLoadingManager);F.setResponseType("arraybuffer"),F.setRequestHeader(this.requestHeader),F.setPath(this.path),F.setWithCredentials(this.withCredentials),F.load(t,async R=>{if(typeof R=="string")throw new Error("Invalid gainmap buffer");c=R,await m()},R=>{E=R.lengthComputable,S=R.loaded,x=R.total,L()},R=>{this.manager.itemError(t),typeof a=="function"&&a(R)});const k=new ua(this._internalLoadingManager);return k.setRequestHeader(this.requestHeader),k.setPath(this.path),k.setWithCredentials(this.withCredentials),k.load(r,async R=>{if(typeof R!="string")throw new Error("Invalid metadata string");f=JSON.parse(R),await m()},R=>{T=R.lengthComputable,P=R.loaded,A=R.total,L()},R=>{this.manager.itemError(r),typeof a=="function"&&a(R)}),o}}class EU extends sT{load(e,t,r,i){const s=this.prepareQuadRenderer(),a=new ua(this._internalLoadingManager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(this.withCredentials),this.manager.itemStart(e),a.load(e,async o=>{if(typeof o=="string")throw new Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");const u=new Uint8Array(o);let c,f,m;try{const g=await yU(u);c=g.sdr,f=g.gainMap,m=g.metadata}catch(g){if(g instanceof rT||g instanceof iT)console.warn(`Failure to reconstruct an HDR image from ${e}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),m={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},c=u;else throw g}try{await this.render(s,m,c.buffer,f?.buffer)}catch(g){this.manager.itemError(e),typeof i=="function"&&i(g),s.disposeOnDemandRenderer();return}typeof t=="function"&&t(s),this.manager.itemEnd(e),s.disposeOnDemandRenderer()},r,o=>{this.manager.itemError(e),typeof i=="function"&&i(o)}),s}}const Yp={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},aT="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",Pf=n=>Array.isArray(n),zx=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"];function m1({files:n=zx,path:e="",preset:t=void 0,encoding:r=void 0,extensions:i}={}){let s=null,a=!1;t&&(Bx(t),n=Yp[t],e=aT),a=Pf(n);const{extension:o,isCubemap:u}=Gx(n);if(s=Vx(o),!s)throw new Error("useEnvironment: Unrecognized file extension: "+n);const c=Zc(y=>y.gl);se.useLayoutEffect(()=>{if(o!=="webp"&&o!=="jpg"&&o!=="jpeg")return;function y(){Au.clear(s,a?[n]:n)}c.domElement.addEventListener("webglcontextlost",y,{once:!0})},[n,c.domElement]);const f=Au(s,a?[n]:n,y=>{(o==="webp"||o==="jpg"||o==="jpeg")&&y.setRenderer(c),y.setPath==null||y.setPath(e),i&&i(y)});let m=a?f[0]:f;if(o==="jpg"||o==="jpeg"||o==="webp"){var g;m=(g=m.renderTarget)==null?void 0:g.texture}return m.mapping=u?ho:Lf,"colorSpace"in m?m.colorSpace=r??u?"srgb":"srgb-linear":m.encoding=r??u?pU:dU,m}const TU={files:zx,path:"",preset:void 0,extensions:void 0};m1.preload=n=>{const e={...TU,...n};let{files:t,path:r=""}=e;const{preset:i,extensions:s}=e;i&&(Bx(i),t=Yp[i],r=aT);const{extension:a}=Gx(t);if(a==="webp"||a==="jpg"||a==="jpeg")throw new Error("useEnvironment: Preloading gainmaps is not supported");const o=Vx(a);if(!o)throw new Error("useEnvironment: Unrecognized file extension: "+t);Au.preload(o,Pf(t)?[t]:t,u=>{u.setPath==null||u.setPath(r),s&&s(u)})};const bU={files:zx,preset:void 0};m1.clear=n=>{const e={...bU,...n};let{files:t}=e;const{preset:r}=e;r&&(Bx(r),t=Yp[r]);const{extension:i}=Gx(t),s=Vx(i);if(!s)throw new Error("useEnvironment: Unrecognized file extension: "+t);Au.clear(s,Pf(t)?[t]:t)};function Bx(n){if(!(n in Yp))throw new Error("Preset must be one of: "+Object.keys(Yp).join(", "))}function Gx(n){var e;const t=Pf(n)&&n.length===6,r=Pf(n)&&n.length===3&&n.some(a=>a.endsWith("json")),i=Pf(n)?n[0]:n;return{extension:t?"cube":r?"webp":i.startsWith("data:application/exr")?"exr":i.startsWith("data:application/hdr")?"hdr":i.startsWith("data:image/jpeg")?"jpg":(e=i.split(".").pop())==null||(e=e.split("?"))==null||(e=e.shift())==null?void 0:e.toLowerCase(),isCubemap:t,isGainmap:r}}function Vx(n){return n==="cube"?ZE:n==="hdr"?gD:n==="exr"?vD:n==="jpg"||n==="jpeg"?EU:n==="webp"?wU:null}const AU=n=>n.current&&n.current.isScene,CU=n=>AU(n)?n.current:n;function Hx(n,e,t,r,i={}){var s,a,o,u;i={backgroundBlurriness:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...i};const c=CU(e||t),f=c.background,m=c.environment,g={backgroundBlurriness:c.backgroundBlurriness,backgroundIntensity:c.backgroundIntensity,backgroundRotation:(s=(a=c.backgroundRotation)==null||a.clone==null?void 0:a.clone())!==null&&s!==void 0?s:[0,0,0],environmentIntensity:c.environmentIntensity,environmentRotation:(o=(u=c.environmentRotation)==null||u.clone==null?void 0:u.clone())!==null&&o!==void 0?o:[0,0,0]};return n!=="only"&&(c.environment=r),n&&(c.background=r),mu(c,i),()=>{n!=="only"&&(c.environment=m),n&&(c.background=f),mu(c,g)}}function Wx({scene:n,background:e=!1,map:t,...r}){const i=Zc(s=>s.scene);return se.useLayoutEffect(()=>{if(t)return Hx(e,n,i,t,r)}),null}function oT({background:n=!1,scene:e,blur:t,backgroundBlurriness:r,backgroundIntensity:i,backgroundRotation:s,environmentIntensity:a,environmentRotation:o,...u}){const c=m1(u),f=Zc(m=>m.scene);return se.useLayoutEffect(()=>Hx(n,e,f,c,{backgroundBlurriness:t??r,backgroundIntensity:i,backgroundRotation:s,environmentIntensity:a,environmentRotation:o})),se.useEffect(()=>()=>{c.dispose()},[c]),null}function PU({children:n,near:e=.1,far:t=1e3,resolution:r=256,frames:i=1,map:s,background:a=!1,blur:o,backgroundBlurriness:u,backgroundIntensity:c,backgroundRotation:f,environmentIntensity:m,environmentRotation:g,scene:y,files:_,path:E,preset:x=void 0,extensions:S}){const T=Zc(k=>k.gl),A=Zc(k=>k.scene),P=se.useRef(null),[L]=se.useState(()=>new a0),D=se.useMemo(()=>{const k=new Hv(r);return k.texture.type=Vi,k},[r]);se.useEffect(()=>()=>{D.dispose()},[D]),se.useLayoutEffect(()=>{if(i===1){const k=T.autoClear;T.autoClear=!0,P.current.update(T,L),T.autoClear=k}return Hx(a,y,A,D.texture,{backgroundBlurriness:o??u,backgroundIntensity:c,backgroundRotation:f,environmentIntensity:m,environmentRotation:g})},[n,L,D.texture,y,A,a,i,T]);let F=1;return oi(()=>{if(i===1/0||F<i){const k=T.autoClear;T.autoClear=!0,P.current.update(T,L),T.autoClear=k,F++}}),se.createElement(se.Fragment,null,LN(se.createElement(se.Fragment,null,n,se.createElement("cubeCamera",{ref:P,args:[e,t,D]}),_||x?se.createElement(oT,{background:!0,files:_,preset:x,path:E,extensions:S}):s?se.createElement(Wx,{background:!0,map:s,extensions:S}):null),L))}function RU(n){var e,t,r,i;const s=m1(n),a=n.map||s;se.useMemo(()=>x3({GroundProjectedEnvImpl:mD}),[]),se.useEffect(()=>()=>{s.dispose()},[s]);const o=se.useMemo(()=>[a],[a]),u=(e=n.ground)==null?void 0:e.height,c=(t=n.ground)==null?void 0:t.radius,f=(r=(i=n.ground)==null?void 0:i.scale)!==null&&r!==void 0?r:1e3;return se.createElement(se.Fragment,null,se.createElement(Wx,yv({},n,{map:a})),se.createElement("groundProjectedEnvImpl",{args:o,scale:f,height:u,radius:c}))}function IU(n){return n.ground?se.createElement(RU,n):n.map?se.createElement(Wx,n):n.children?se.createElement(PU,n):se.createElement(oT,n)}const Tl=[{id:"cyclist-hazard",title:"Cyclist Hazard",description:"Watch out for the cyclist ahead!"},{id:"pedestrian-island",title:"Pedestrian Crossing (Island)",description:"Stop until the pedestrian reaches the island, then proceed safely."},{id:"t-intersection-right",title:"T-Intersection (Right Turn)",description:"Give way to ALL traffic. Turn Right. Watch for oncoming traffic and other turning vehicles!"},{id:"t-intersection-give-way",title:"T-Intersection (Give Way)",description:"Give way to traffic from your right. Go straight or turn left."},{id:"stop-sign-cross-traffic",title:"Stop Sign (Cross Traffic)",description:"Come to a complete stop and give way to cross traffic before proceeding."},{id:"giveway-merge-traffic",title:"Give Way (Merge Traffic)",description:"Give way to continuous traffic flow from your right. Merge safely onto the main road."},{id:"giveway-right-to-left",title:"Give Way (Right-to-Left)",description:"You are at the intersection. Give way to the car approaching from your right before proceeding straight."},{id:"four-way-give-way",title:"Four-Way Give Way",description:"At this four-way intersection, give way to traffic from your right and proceed straight."},{id:"train-crossing",title:"Train Crossing",description:"Stop at the tracks and wait for the train to pass safely before proceeding."},{id:"t-intersection-left-oncoming",title:"T-Intersection (Left Turn, Oncoming)",description:"Prepare to turn left. Give way to oncoming traffic before turning."},{id:"giveway",title:"Give Way",description:"Give way to crossing traffic."},{id:"t-intersection",title:"T-Intersection",description:"Give way to traffic. Turn Left."},{id:"roundabout",title:"Roundabout",description:"Take the 3rd exit (Right Turn)."},{id:"pedestrian",title:"Pedestrian Crossing",description:"Stop for the pedestrian."},{id:"parking",title:"Parallel Parking",description:"Park in the green box between the cars."},{id:"stop-sign",title:"Stop Sign",description:"Come to a complete stop at the line."}],Ht=eD((n,e)=>({currentScenario:"menu",currentLevelIndex:0,levelStatus:"playing",message:"Welcome! Select a scenario.",score:100,telemetry:{speed:0,position:{x:0,y:0,z:0},indicators:{left:!1,right:!1}},isPaused:!1,flags:{},retryCount:0,mapType:"satellite",setMessage:t=>n({message:t}),setScore:t=>n({score:t}),updateTelemetry:t=>n(r=>({telemetry:{...r.telemetry,...t}})),setFlag:(t,r)=>n(i=>({flags:{...i.flags,[t]:r}})),setMapType:t=>n({mapType:t}),startCareer:()=>{n({currentLevelIndex:0,currentScenario:Tl[0].id,levelStatus:"playing",message:Tl[0].description,score:100,isPaused:!1,flags:{},retryCount:0})},nextLevel:()=>{const t=e().currentLevelIndex+1;t<Tl.length?n({currentLevelIndex:t,currentScenario:Tl[t].id,levelStatus:"playing",message:Tl[t].description,score:100,isPaused:!1,flags:{},retryCount:0}):n({currentScenario:"menu",message:"Career Completed! Well done.",isPaused:!1,flags:{},retryCount:0})},retryLevel:()=>{const t=e().currentLevelIndex;n(r=>({levelStatus:"playing",message:Tl[t].description,score:100,isPaused:!1,flags:{},retryCount:r.retryCount+1}))},passLevel:()=>{n({levelStatus:"passed",message:"PASSED! Press Next to continue.",isPaused:!1})},failLevel:t=>{n({levelStatus:"failed",message:`FAILED: ${t}`,score:0,isPaused:!1})},goToMenu:()=>{n({currentScenario:"menu",message:"Welcome",isPaused:!1,flags:{},retryCount:0})},selectScenario:t=>{n({currentScenario:t,levelStatus:"playing",message:"",score:100,isPaused:!1,flags:{},retryCount:0})},togglePause:()=>{n(t=>({isPaused:!t.isPaused}))}})),LU=(n,e)=>{const t=n.position.clone().sub(n.size.clone().multiplyScalar(.5)),r=n.position.clone().add(n.size.clone().multiplyScalar(.5)),i=e.position.clone().sub(e.size.clone().multiplyScalar(.5)),s=e.position.clone().add(e.size.clone().multiplyScalar(.5));return r.x>i.x&&t.x<s.x&&r.y>i.y&&t.y<s.y&&r.z>i.z&&t.z<s.z};class NU{objects=new Map;registerObject(e){this.objects.set(e.id,e)}unregisterObject(e){this.objects.delete(e)}getObject(e){return this.objects.get(e)}update(e){this.objects.forEach(t=>{this.objects.forEach(r=>{t.id!==r.id&&LU(t,r)&&(t.onCollide?.(r),r.onCollide?.(t))})})}queryObjectsInArea(e,t,r){const i=[];return this.objects.forEach(s=>{if(s.id===r)return;const a=s.position.clone().sub(s.size.clone().multiplyScalar(.5)),o=s.position.clone().add(s.size.clone().multiplyScalar(.5));o.x>e.x&&a.x<t.x&&o.y>e.y&&a.y<t.y&&o.z>e.z&&a.z<t.z&&i.push(s)}),i}}const Yt=new NU,en=({position:n=[0,0,0],rotation:e=[0,0,0],length:t=10})=>{const r=se.useRef(null),i=se.useRef(`straightRoad_${Math.random().toFixed(5)}`),s=new X(10,.1,t);return se.useEffect(()=>{if(!r.current)return;const a=new xn().setFromEuler(new Qi(...e)),o={id:i.current,position:r.current.position,quaternion:a,size:s,type:"road",onCollide:u=>{}};return Yt.registerObject(o),()=>{Yt.unregisterObject(i.current)}},[n,e,t]),O.jsxs("group",{ref:r,position:n,rotation:e,userData:{type:"road"},children:[O.jsxs("mesh",{rotation:[-Math.PI/2,0,0],receiveShadow:!0,children:[O.jsx("planeGeometry",{args:[10,t]}),O.jsx("meshStandardMaterial",{color:"#333333"})]}),Array.from({length:Math.floor(t/2)}).map((a,o)=>O.jsxs("mesh",{position:[0,.01,-t/2+1+o*2],rotation:[-Math.PI/2,0,0],children:[O.jsx("planeGeometry",{args:[.1,1]}),O.jsx("meshStandardMaterial",{color:"white"})]},o)),O.jsxs("mesh",{position:[-4.8,.01,0],rotation:[-Math.PI/2,0,0],children:[O.jsx("planeGeometry",{args:[.1,t]}),O.jsx("meshStandardMaterial",{color:"white"})]}),O.jsxs("mesh",{position:[4.8,.01,0],rotation:[-Math.PI/2,0,0],children:[O.jsx("planeGeometry",{args:[.1,t]}),O.jsx("meshStandardMaterial",{color:"white"})]})]})},Nu=({position:n=[0,0,0],rotation:e=[0,0,0]})=>{const t=se.useRef(null),r=se.useRef(`intersection_${Math.random().toFixed(5)}`),i=new X(10.2,.1,10.2);return se.useEffect(()=>{if(!t.current)return;const s=new xn().setFromEuler(new Qi(...e)),a={id:r.current,position:t.current.position,quaternion:s,size:i,type:"intersection",onCollide:o=>{}};return Yt.registerObject(a),()=>{Yt.unregisterObject(r.current)}},[n,e]),O.jsx("group",{ref:t,position:n,rotation:e,userData:{type:"intersection"},children:O.jsxs("mesh",{rotation:[-Math.PI/2,0,0],receiveShadow:!0,children:[O.jsx("planeGeometry",{args:[10.2,10.2]}),O.jsx("meshStandardMaterial",{color:"#333333"})]})})},Du=({position:n,rotation:e=[0,0,0]})=>{const t=se.useRef(null),r=se.useRef(`giveWaySign_${Math.random().toFixed(5)}`),i=new X(.8,2.5,.05);return se.useEffect(()=>{if(!t.current)return;const s=new xn().setFromEuler(new Qi(...e)),a={id:r.current,position:t.current.position,quaternion:s,size:i,type:"sign",onCollide:o=>{}};return Yt.registerObject(a),()=>{Yt.unregisterObject(r.current)}},[n,e]),O.jsxs("group",{ref:t,position:n,rotation:e,userData:{type:"sign"},children:[O.jsxs("mesh",{position:[0,1,0],children:[O.jsx("cylinderGeometry",{args:[.05,.05,2]}),O.jsx("meshStandardMaterial",{color:"gray"})]}),O.jsxs("mesh",{position:[0,2,0],rotation:[Math.PI/2,0,0],children:[O.jsx("cylinderGeometry",{args:[.4,.4,.05,3]}),O.jsx("meshStandardMaterial",{color:"white"})]}),O.jsxs("mesh",{position:[0,2,.03],rotation:[Math.PI/2,0,0],children:[O.jsx("cylinderGeometry",{args:[.3,.3,.05,3]}),O.jsx("meshStandardMaterial",{color:"red"})]}),O.jsxs("mesh",{position:[0,2,.04],rotation:[Math.PI/2,0,0],children:[O.jsx("cylinderGeometry",{args:[.2,.2,.05,3]}),O.jsx("meshStandardMaterial",{color:"white"})]})]})},DU=()=>{const[n,e]=se.useState({forward:!1,backward:!1,left:!1,right:!1,brake:!1,indicateLeft:!1,indicateRight:!1});return se.useEffect(()=>{const t=i=>{switch(i.key.toLowerCase()){case"w":case"arrowup":e(s=>({...s,forward:!0}));break;case"s":case"arrowdown":e(s=>({...s,backward:!0}));break;case"a":case"arrowleft":e(s=>({...s,left:!0}));break;case"d":case"arrowright":e(s=>({...s,right:!0}));break;case" ":e(s=>({...s,brake:!0}));break;case"q":e(s=>({...s,indicateLeft:!s.indicateLeft,indicateRight:!1}));break;case"e":e(s=>({...s,indicateRight:!s.indicateRight,indicateLeft:!1}));break}},r=i=>{switch(i.key.toLowerCase()){case"w":case"arrowup":e(s=>({...s,forward:!1}));break;case"s":case"arrowdown":e(s=>({...s,backward:!1}));break;case"a":case"arrowleft":e(s=>({...s,left:!1}));break;case"d":case"arrowright":e(s=>({...s,right:!1}));break;case" ":e(s=>({...s,brake:!1}));break}};return window.addEventListener("keydown",t),window.addEventListener("keyup",r),()=>{window.removeEventListener("keydown",t),window.removeEventListener("keyup",r)}},[]),n},jr=({position:n=[0,1,0],rotation:e=[0,0,0]})=>{const t=se.useRef(null),r=se.useRef(null),i=se.useRef(null),s=se.useRef(new xn().setFromEuler(new Qi(...e))),a=DU(),{camera:o}=Zc(),u=Ht(S=>S.updateTelemetry),c=Ht(S=>S.failLevel),f=Ht(S=>S.levelStatus),m=se.useRef(new X(0,0,0)),g=se.useRef(0),[y,_]=se.useState(!1),E=se.useRef(`playerCar_${Math.random().toFixed(5)}`),x=new X(2,1,4);return se.useEffect(()=>{const S=setInterval(()=>_(T=>!T),400);return()=>clearInterval(S)},[]),se.useEffect(()=>{if(!t.current)return;const S={id:E.current,position:t.current.position,quaternion:s.current,size:x,type:"playerCar",onCollide:T=>{f==="playing"&&(T.type==="roadBoundary"?c("You drove off the road!"):T.type==="aiCar"||T.type==="stationaryAICar"?c("You crashed into another car!"):T.type==="pedestrian"?c("You hit a pedestrian! major fail."):T.type==="cyclist"&&c("You hit a cyclist! major fail."))}};return Yt.registerObject(S),()=>{Yt.unregisterObject(E.current)}},[c,f]),oi((S,T)=>{if(!t.current||f!=="playing")return;const{forward:A,backward:P,left:L,right:D,brake:F,indicateLeft:k,indicateRight:R}=a,U=30,V=35,H=-10,J=50,$=10,ae=Math.PI/6,ne=2*T,oe=3,te=1,ie=new X(0,0,-1).applyQuaternion(s.current);let Y=m.current.dot(ie);if(L?g.current+=ne:D?g.current-=ne:Math.abs(g.current)>.01?g.current-=Math.sign(g.current)*ne*2:g.current=0,g.current=Math.max(-ae,Math.min(ae,g.current)),A?Y+=U*T:P&&(Y-=U*T),F&&(Y>0?Y-=J*T:Y<0&&(Y+=J*T),Math.abs(Y)<1&&(Y=0)),!A&&!P&&!F&&(Math.abs(Y)>$*T?Y-=Math.sign(Y)*$*T:Y=0),Y=Math.max(H,Math.min(V,Y)),Math.abs(Y)>.1){const ve=oe/Math.tan(g.current),re=Y/ve*T;if(Math.abs(re)>1e-4){const he=new xn().setFromAxisAngle(new X(0,1,0),re);s.current.multiply(he),t.current.quaternion.copy(s.current)}}const z=new X(0,0,-1).applyQuaternion(s.current);m.current.copy(z).multiplyScalar(Y),t.current.position.add(m.current.clone().multiplyScalar(T)),r.current&&i.current&&(r.current.rotation.y=g.current*te,i.current.rotation.y=g.current*te),u({speed:Y,position:{x:t.current.position.x,y:t.current.position.y,z:t.current.position.z},indicators:{left:k,right:R}});const K=Yt.getObject(E.current);K&&(K.position.copy(t.current.position),K.quaternion.copy(t.current.quaternion));const le=new X(0,5,10).applyQuaternion(s.current),me=t.current.position.clone().add(le);o.position.lerp(me,.1),o.lookAt(t.current.position)}),O.jsxs("group",{ref:t,position:n,userData:{type:"playerCar"},children:[O.jsxs("mesh",{position:[0,.5,0],castShadow:!0,children:[O.jsx("boxGeometry",{args:[2,1,4]}),O.jsx("meshStandardMaterial",{color:"#2196F3"})]}),O.jsxs("group",{children:[O.jsxs("mesh",{position:[-1.1,.25,1.2],rotation:[0,0,Math.PI/2],children:[O.jsx("cylinderGeometry",{args:[.35,.35,.4,16]}),O.jsx("meshStandardMaterial",{color:"black"})]}),O.jsxs("mesh",{position:[1.1,.25,1.2],rotation:[0,0,Math.PI/2],children:[O.jsx("cylinderGeometry",{args:[.35,.35,.4,16]}),O.jsx("meshStandardMaterial",{color:"black"})]}),O.jsx("group",{ref:r,position:[-1.1,.25,-1.2],children:O.jsxs("mesh",{rotation:[0,0,Math.PI/2],children:[O.jsx("cylinderGeometry",{args:[.35,.35,.4,16]}),O.jsx("meshStandardMaterial",{color:"black"})]})}),O.jsx("group",{ref:i,position:[1.1,.25,-1.2],children:O.jsxs("mesh",{rotation:[0,0,Math.PI/2],children:[O.jsx("cylinderGeometry",{args:[.35,.35,.4,16]}),O.jsx("meshStandardMaterial",{color:"black"})]})})]}),O.jsxs("mesh",{position:[0,.9,-.5],children:[O.jsx("boxGeometry",{args:[1.8,.6,1.5]}),O.jsx("meshStandardMaterial",{color:"#87CEEB",transparent:!0,opacity:.7})]}),O.jsxs("mesh",{position:[-.9,.5,-2.05],children:[O.jsx("boxGeometry",{args:[.4,.2,.1]}),O.jsx("meshStandardMaterial",{color:a.indicateLeft&&y?"#FFAA00":"#333",emissive:a.indicateLeft&&y?"#FFAA00":"#000",emissiveIntensity:2})]}),O.jsxs("mesh",{position:[-.9,.5,2.05],children:[O.jsx("boxGeometry",{args:[.4,.2,.1]}),O.jsx("meshStandardMaterial",{color:a.indicateLeft&&y?"#FFAA00":"#333",emissive:a.indicateLeft&&y?"#FFAA00":"#000",emissiveIntensity:2})]}),O.jsxs("mesh",{position:[.9,.5,-2.05],children:[O.jsx("boxGeometry",{args:[.4,.2,.1]}),O.jsx("meshStandardMaterial",{color:a.indicateRight&&y?"#FFAA00":"#333",emissive:a.indicateRight&&y?"#FFAA00":"#000",emissiveIntensity:2})]}),O.jsxs("mesh",{position:[.9,.5,2.05],children:[O.jsx("boxGeometry",{args:[.4,.2,.1]}),O.jsx("meshStandardMaterial",{color:a.indicateRight&&y?"#FFAA00":"#333",emissive:a.indicateRight&&y?"#FFAA00":"#000",emissiveIntensity:2})]})]})},_v=({position:n=[0,1,0],rotation:e=[0,0,0],color:t="#2196F3",indicatingLeft:r=!1,indicatingRight:i=!1,userData:s={type:"car"}})=>{const[a,o]=se.useState(!1),u=se.useRef(`stationaryAICar_${Math.random().toFixed(5)}`),c=new X(2,1,4),f=new xn().setFromEuler(new Qi(...e)),m=se.useRef(null);return se.useEffect(()=>{const g=setInterval(()=>{o(y=>!y)},400);return()=>clearInterval(g)},[]),se.useEffect(()=>{if(!m.current)return;const g={id:u.current,position:m.current.position,quaternion:f,size:c,type:s.type};return Yt.registerObject(g),()=>{Yt.unregisterObject(u.current)}},[f,s.type]),O.jsxs("group",{ref:m,position:n,quaternion:f,userData:s,children:[O.jsxs("mesh",{position:[0,.5,0],castShadow:!0,children:[O.jsx("boxGeometry",{args:[2,1,4]}),O.jsx("meshStandardMaterial",{color:t})]}),O.jsxs("mesh",{position:[-1.1,.25,1.2],rotation:[0,0,Math.PI/2],children:[O.jsx("cylinderGeometry",{args:[.35,.35,.4,16]}),O.jsx("meshStandardMaterial",{color:"black"})]}),O.jsxs("mesh",{position:[1.1,.25,1.2],rotation:[0,0,Math.PI/2],children:[O.jsx("cylinderGeometry",{args:[.35,.35,.4,16]}),O.jsx("meshStandardMaterial",{color:"black"})]}),O.jsxs("mesh",{position:[-1.1,.25,-1.2],rotation:[0,0,Math.PI/2],children:[O.jsx("cylinderGeometry",{args:[.35,.35,.4,16]}),O.jsx("meshStandardMaterial",{color:"black"})]}),O.jsxs("mesh",{position:[1.1,.25,-1.2],rotation:[0,0,Math.PI/2],children:[O.jsx("cylinderGeometry",{args:[.35,.35,.4,16]}),O.jsx("meshStandardMaterial",{color:"black"})]}),O.jsxs("mesh",{position:[0,.9,-.5],children:[O.jsx("boxGeometry",{args:[1.8,.6,1.5]}),O.jsx("meshStandardMaterial",{color:"#87CEEB",transparent:!0,opacity:.7})]}),O.jsxs("mesh",{position:[-.9,.5,-2.05],children:[O.jsx("boxGeometry",{args:[.4,.2,.1]}),O.jsx("meshStandardMaterial",{color:r&&a?"#FFAA00":"#333",emissive:r&&a?"#FFAA00":"#000",emissiveIntensity:2})]}),O.jsxs("mesh",{position:[-.9,.5,2.05],children:[O.jsx("boxGeometry",{args:[.4,.2,.1]}),O.jsx("meshStandardMaterial",{color:r&&a?"#FFAA00":"#333",emissive:r&&a?"#FFAA00":"#000",emissiveIntensity:2})]}),O.jsxs("mesh",{position:[.9,.5,-2.05],children:[O.jsx("boxGeometry",{args:[.4,.2,.1]}),O.jsx("meshStandardMaterial",{color:i&&a?"#FFAA00":"#333",emissive:i&&a?"#FFAA00":"#000",emissiveIntensity:2})]}),O.jsxs("mesh",{position:[.9,.5,2.05],children:[O.jsx("boxGeometry",{args:[.4,.2,.1]}),O.jsx("meshStandardMaterial",{color:i&&a?"#FFAA00":"#333",emissive:i&&a?"#FFAA00":"#000",emissiveIntensity:2})]})]})},UU=()=>{const{setMessage:n,passLevel:e,failLevel:t}=Ht(),r=se.useRef(!1),i=se.useRef(!1),[s,a]=se.useState(!1),o=se.useRef(!1),u=se.useRef(`grass_${Math.random().toFixed(5)}`),c=new X(100,1,100),f=new X(0,-.6,-10);return se.useEffect(()=>{n("Scenario: T-Intersection. You are approaching a Give Way. Turn Left. Watch for traffic!")},[n]),se.useEffect(()=>{const m={id:u.current,position:f,quaternion:new xn,size:c,type:"grass",onCollide:g=>{g.type==="playerCar"&&t("You drove off the road!")}};return Yt.registerObject(m),()=>{Yt.unregisterObject(u.current)}},[t]),oi(()=>{if(s||o.current)return;const m=Ht.getState().telemetry;if(!m||!m.position)return;const{position:g,speed:y,indicators:_}=m,E=g.z;if(E<0&&E>-10&&y<.1&&(r.current||(r.current=!0,n("Stopped. Safe to proceed."))),g.z>-8&&_.left&&(i.current=!0),g.z<-8&&!i.current&&!o.current){t("You did not indicate left!"),o.current=!0,a(!0);return}g.x<-15&&(e(),o.current=!0,a(!0)),g.z<-30&&(t("You went straight! You were supposed to turn left."),o.current=!0,a(!0)),g.x>15&&(t("You turned right! You were supposed to turn left."),o.current=!0,a(!0))}),O.jsxs("group",{children:[O.jsxs("mesh",{position:f,receiveShadow:!0,children:[O.jsx("boxGeometry",{args:[100,1,100]}),O.jsx("meshStandardMaterial",{color:"#558b2f"})]}),O.jsx(en,{position:[-10,0,-10],rotation:[0,Math.PI/2,0],length:10}),O.jsx(en,{position:[10,0,-10],rotation:[0,Math.PI/2,0],length:10}),O.jsx(Nu,{position:[0,0,-10]}),O.jsx(en,{position:[0,0,0],length:10}),O.jsx(en,{position:[0,0,10],length:10}),O.jsx(Du,{position:[-5.5,0,-1],rotation:[0,0,0]}),O.jsx(_v,{position:[-7.5,.2,-12.5],rotation:[0,3*Math.PI/2,0],color:"orange",indicatingLeft:!1,indicatingRight:!0}),O.jsx(jr,{position:[-2.5,1,9]})]})},FU=({position:n=[0,0,0]})=>{const e=se.useRef(null),t=se.useRef(`roundabout_${Math.random().toFixed(5)}`),r=new X(20,.5,20);return se.useEffect(()=>{if(!e.current)return;const i={id:t.current,position:e.current.position,quaternion:new xn,size:r,type:"roundabout",onCollide:s=>{}};return Yt.registerObject(i),()=>{Yt.unregisterObject(t.current)}},[n]),O.jsxs("group",{ref:e,position:n,userData:{type:"roundabout"},children:[O.jsxs("mesh",{rotation:[-Math.PI/2,0,0],receiveShadow:!0,children:[O.jsx("ringGeometry",{args:[4,10,32]}),O.jsx("meshStandardMaterial",{color:"#333333"})]}),O.jsxs("mesh",{rotation:[-Math.PI/2,0,0],position:[0,.2,0],castShadow:!0,children:[O.jsx("cylinderGeometry",{args:[4,4,.4,32]}),O.jsx("meshStandardMaterial",{color:"#4CAF50"})]})]})},OU=()=>{const{setMessage:n,telemetry:e,passLevel:t,failLevel:r}=Ht(),[i,s]=se.useState(!1),[a,o]=se.useState(!1),u=se.useRef(!1),c=se.useRef(`grass_${Math.random().toFixed(5)}`),f=new X(200,1,200),m=new X(0,-.6,-20);return se.useEffect(()=>{n("Scenario: Roundabout. Turn Right (3rd Exit). Indicate correctly!")},[n]),se.useEffect(()=>{const g={id:c.current,position:m,quaternion:new xn,size:f,type:"grass",onCollide:y=>{y.type==="playerCar"&&r("You drove off the road!")}};return Yt.registerObject(g),()=>{Yt.unregisterObject(c.current)}},[r]),oi(()=>{if(a||u.current)return;const{position:g,indicators:y}=e;g.z<-10&&!i&&(s(!0),y.right),i&&(g.x>15&&(y.left?t():r("You failed to indicate left before exiting!"),u.current=!0,o(!0)),g.x<-15&&(r("Wrong exit! You turned left."),u.current=!0,o(!0)),g.z<-35&&(r("Wrong exit! You went straight."),u.current=!0,o(!0)))}),O.jsxs("group",{children:[O.jsxs("mesh",{position:m,receiveShadow:!0,children:[O.jsx("boxGeometry",{args:[200,1,200]}),O.jsx("meshStandardMaterial",{color:"#558b2f"})]}),O.jsx(FU,{position:[0,0,-20]}),O.jsx(en,{position:[0,0,0],length:20}),O.jsx(en,{position:[0,0,-40],length:20}),O.jsx(en,{position:[20,0,-20],rotation:[0,Math.PI/2,0],length:20}),O.jsx(en,{position:[-20,0,-20],rotation:[0,Math.PI/2,0],length:20}),O.jsx(_v,{position:[-12.5,.2,-21.5],rotation:[0,3*Math.PI/2,0],color:"orange",indicatingLeft:!0,indicatingRight:!1}),O.jsx(jr,{position:[-2.5,1,9]})]})},xv=6371e3,Ir=-41.28889,Lr=174.77722,Sv=150;function js(n,e,t=Ir,r=Lr){const i=(e-r)*(Math.PI/180)*xv*Math.cos(t*Math.PI/180),s=-(n-t)*(Math.PI/180)*xv;return{x:i,z:s}}function lT(n,e,t=Ir,r=Lr){const i=t-e/xv*(180/Math.PI),s=r+n/(xv*Math.cos(t*Math.PI/180))*(180/Math.PI);return{lat:i,lon:s}}function kU(n,e,t){const r=Math.pow(2,t),i=n*Math.PI/180,s=Math.floor(r*((e+180)/360)),a=Math.floor(r*(1-Math.log(Math.tan(i)+1/Math.cos(i))/Math.PI)/2);return{x:s,y:a}}function nw(n,e,t){const r=Math.pow(2,t),i=n/r*360-180;return{lat:Math.atan(Math.sinh(Math.PI*(1-2*e/r)))*180/Math.PI,lon:i}}function Vf(n,e){const t=Math.floor(n/Sv),r=Math.floor(e/Sv);return`${t},${r}`}function jx(n,e,t=1){const r=Math.floor(n/Sv),i=Math.floor(e/Sv),s=[];for(let a=-t;a<=t;a++)for(let o=-t;o<=t;o++)s.push(`${r+a},${i+o}`);return s}const zU=20,BU=.3,iw=.15,GU=({features:n})=>{const[e,t]=se.useState([]),r=se.useRef(null),i=se.useMemo(()=>{if(!n||n.length===0)return{};const s=new Map,a=u=>(s.has(u)||s.set(u,{roadPositions:[],roadIndices:[],roadVertexCount:0,markingPositions:[],markingIndices:[],markingVertexCount:0}),s.get(u));n.forEach(u=>{if(!u.geometry)return;const c=u.geometry.type,f=u.geometry.coordinates,m=g=>{for(let y=0;y<g.length-1;y++){const _=g[y],E=g[y+1],x=new X,S=new X,T=js(_[1],_[0],Ir,Lr),A=js(E[1],E[0],Ir,Lr);x.set(T.x,.1,T.z),S.set(A.x,.1,A.z);const P=(x.x+S.x)/2,L=(x.z+S.z)/2,D=Vf(P,L),F=a(D),k=new X().subVectors(S,x),R=new X(-k.z,0,k.x).normalize(),U=R.clone().multiplyScalar(zU/2),V=new X().subVectors(x,U),H=new X().addVectors(x,U),J=new X().subVectors(S,U),$=new X().addVectors(S,U);F.roadPositions.push(V.x,V.y,V.z,H.x,H.y,H.z,J.x,J.y,J.z,$.x,$.y,$.z),F.roadIndices.push(F.roadVertexCount+0,F.roadVertexCount+1,F.roadVertexCount+2,F.roadVertexCount+1,F.roadVertexCount+3,F.roadVertexCount+2),F.roadVertexCount+=4;const ae=R.clone().multiplyScalar(BU/2),ne=x.clone().setY(iw),oe=S.clone().setY(iw),te=new X().subVectors(ne,ae),ie=new X().addVectors(ne,ae),Y=new X().subVectors(oe,ae),z=new X().addVectors(oe,ae);F.markingPositions.push(te.x,te.y,te.z,ie.x,ie.y,ie.z,Y.x,Y.y,Y.z,z.x,z.y,z.z),F.markingIndices.push(F.markingVertexCount+0,F.markingVertexCount+1,F.markingVertexCount+2,F.markingVertexCount+1,F.markingVertexCount+3,F.markingVertexCount+2),F.markingVertexCount+=4}};c==="LineString"?m(f):c==="MultiLineString"&&f.forEach(g=>{m(g)})});const o={};return s.forEach((u,c)=>{const f=new Sn;f.setAttribute("position",new Jt(u.roadPositions,3)),f.setIndex(u.roadIndices),f.computeVertexNormals();const m=new Sn;m.setAttribute("position",new Jt(u.markingPositions,3)),m.setIndex(u.markingIndices),m.computeVertexNormals(),o[c]={road:f,marking:m}}),o},[n]);return oi(()=>{const{x:s,z:a}=Ht.getState().telemetry.position,o=Vf(s,a);if(o!==r.current){r.current=o;const u=jx(s,a,1);t(u)}}),O.jsx("group",{children:e.map(s=>{const a=i[s];return a?O.jsxs("group",{children:[O.jsx("mesh",{geometry:a.road,children:O.jsx("meshStandardMaterial",{color:"#424242"})}),O.jsx("mesh",{geometry:a.marking,children:O.jsx("meshStandardMaterial",{color:"#FFFFFF"})})]},s):null})})},VU=15,HU=15,WU=Uo.memo(({position:n,rotation:e,roadName:t,crossRoadNames:r})=>O.jsxs("group",{position:n,rotation:e,children:[O.jsxs("mesh",{position:[0,-1.5,0],children:[O.jsx("cylinderGeometry",{args:[.1,.1,4]}),O.jsx("meshStandardMaterial",{color:"#555"})]}),O.jsxs("group",{position:[0,.8,0],rotation:[0,Math.PI/2,0],children:[O.jsxs("mesh",{children:[O.jsx("boxGeometry",{args:[1.8,.4,.05]}),O.jsx("meshStandardMaterial",{color:"#006633"})]}),O.jsx(og,{position:[0,0,.06],fontSize:.2,color:"white",anchorX:"center",anchorY:"middle",children:t}),O.jsx(og,{position:[0,0,-.06],rotation:[0,Math.PI,0],fontSize:.2,color:"white",anchorX:"center",anchorY:"middle",children:t})]}),O.jsxs("group",{position:[0,1.3,0],children:[O.jsxs("mesh",{children:[O.jsx("boxGeometry",{args:[1.8,.4,.05]}),O.jsx("meshStandardMaterial",{color:"#006633"})]}),O.jsx(og,{position:[0,0,.06],fontSize:.2,color:"white",anchorX:"center",anchorY:"middle",children:r}),O.jsx(og,{position:[0,0,-.06],rotation:[0,Math.PI,0],fontSize:.2,color:"white",anchorX:"center",anchorY:"middle",children:r})]})]})),jU=({features:n})=>{const[e,t]=se.useState([]),r=se.useRef(null),i=se.useMemo(()=>{if(!n||n.length===0)return new Map;const s=new Map,a=new Map,o=new Set,u=(c,f)=>`${Math.round(c)},${Math.round(f)}`;return n.forEach(c=>{if(!c.geometry||!c.properties?.name)return;const f=c.properties.name,m=c.geometry.coordinates,g=c.geometry.type,y=_=>{if(_.length<2)return;const E=js(_[0][1],_[0][0],Ir,Lr),x=u(E.x,E.z);a.has(x)||a.set(x,new Set),a.get(x).add(f);const S=js(_[_.length-1][1],_[_.length-1][0],Ir,Lr),T=u(S.x,S.z);a.has(T)||a.set(T,new Set),a.get(T).add(f)};g==="LineString"?y(m):g==="MultiLineString"&&m.forEach(_=>y(_))}),n.forEach((c,f)=>{if(!c.geometry||!c.properties?.name)return;const m=c.properties.name,g=c.geometry.coordinates,y=c.geometry.type,_=(x,S,T)=>{const A=js(x[1],x[0],Ir,Lr),P=u(A.x,A.z),L=a.get(P);if(!L||L.size<2)return;const D=Array.from(L).filter(te=>te!==m);if(D.length===0)return;const F=`${m}-${f}-${T}-${x[0]}-${x[1]}`;if(o.has(F))return;o.add(F);const k=js(S[1],S[0],Ir,Lr),R=new X(A.x,0,A.z),U=new X(k.x,0,k.z),V=new X().subVectors(R,U).normalize(),H=new X(0,1,0).cross(V).normalize(),J=R.clone().sub(V.multiplyScalar(HU)).add(H.multiplyScalar(VU)),ae=[0,Math.atan2(V.x,V.z),0],ne={position:[J.x,3,J.z],rotation:ae,roadName:m,crossRoadNames:D[0],key:F},oe=Vf(J.x,J.z);s.has(oe)||s.set(oe,[]),s.get(oe).push(ne)},E=x=>{x.length<2||(_(x[0],x[1],"start"),_(x[x.length-1],x[x.length-2],"end"))};y==="LineString"?E(g):y==="MultiLineString"&&g.forEach(x=>E(x))}),s},[n]);return oi(()=>{const{x:s,z:a}=Ht.getState().telemetry.position,o=Vf(s,a);if(o!==r.current){r.current=o;const u=jx(s,a,1);t(u)}}),O.jsx("group",{children:e.map(s=>{const a=i.get(s);return a?O.jsx("group",{children:a.map(o=>O.jsx(WU,{position:o.position,rotation:o.rotation,roadName:o.roadName,crossRoadNames:o.crossRoadNames},o.key))},s):null})})},Sg=17,ug=3,XU=({x:n,y:e})=>{const t=`https://tile.openstreetmap.org/${Sg}/${n}/${e}.png`,r=Au(Sx,t),{lat:i,lon:s}=nw(n,e,Sg),{x:a,z:o}=js(i,s,Ir,Lr),u=nw(n+1,e+1,Sg),c=js(u.lat,u.lon,Ir,Lr),f=Math.abs(c.x-a),m=Math.abs(c.z-o),g=a+f/2,y=o+(c.z-o)/2;return O.jsxs("mesh",{position:[g,-.5,y],rotation:[-Math.PI/2,0,0],receiveShadow:!0,children:[O.jsx("planeGeometry",{args:[f,m]}),O.jsx("meshStandardMaterial",{map:r})]})},qU=()=>{const[n,e]=se.useState([]),t=se.useRef(null);return oi(()=>{const{x:r,z:i}=Ht.getState().telemetry.position,{lat:s,lon:a}=lT(r,i,Ir,Lr),o=kU(s,a,Sg);if(!t.current||t.current.x!==o.x||t.current.y!==o.y){t.current=o;const u=[];for(let c=-ug;c<=ug;c++)for(let f=-ug;f<=ug;f++){const m=o.x+c,g=o.y+f;u.push({x:m,y:g,key:`${m}-${g}`})}e(u)}}),O.jsx("group",{children:n.map(r=>O.jsx(XU,{x:r.x,y:r.y},r.key))})};function YU(n){n("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),n("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),n("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs");for(var e=1;e<=60;++e)n("EPSG:"+(32600+e),"+proj=utm +zone="+e+" +datum=WGS84 +units=m"),n("EPSG:"+(32700+e),"+proj=utm +zone="+e+" +south +datum=WGS84 +units=m");n("EPSG:5041","+title=WGS 84 / UPS North (E,N) +proj=stere +lat_0=90 +lon_0=0 +k=0.994 +x_0=2000000 +y_0=2000000 +datum=WGS84 +units=m"),n("EPSG:5042","+title=WGS 84 / UPS South (E,N) +proj=stere +lat_0=-90 +lon_0=0 +k=0.994 +x_0=2000000 +y_0=2000000 +datum=WGS84 +units=m"),n.WGS84=n["EPSG:4326"],n["EPSG:3785"]=n["EPSG:3857"],n.GOOGLE=n["EPSG:3857"],n["EPSG:900913"]=n["EPSG:3857"],n["EPSG:102113"]=n["EPSG:3857"]}var Jc=1,Kc=2,Rf=3,ZU=4,D_=5,rw=6378137,JU=6356752314e-3,sw=.0066943799901413165,bp=484813681109536e-20,_t=Math.PI/2,KU=.16666666666666666,QU=.04722222222222222,$U=.022156084656084655,Lt=1e-10,Bi=.017453292519943295,Xs=57.29577951308232,Zn=Math.PI/4,Zp=Math.PI*2,Zi=3.14159265359,qs={};qs.greenwich=0;qs.lisbon=-9.131906111111;qs.paris=2.337229166667;qs.bogota=-74.080916666667;qs.madrid=-3.687938888889;qs.rome=12.452333333333;qs.bern=7.439583333333;qs.jakarta=106.807719444444;qs.ferro=-17.666666666667;qs.brussels=4.367975;qs.stockholm=18.058277777778;qs.athens=23.7163375;qs.oslo=10.722916666667;const eF={mm:{to_meter:.001},cm:{to_meter:.01},ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937},fath:{to_meter:1.8288},kmi:{to_meter:1852},"us-ch":{to_meter:20.1168402336805},"us-mi":{to_meter:1609.34721869444},km:{to_meter:1e3},"ind-ft":{to_meter:.30479841},"ind-yd":{to_meter:.91439523},mi:{to_meter:1609.344},yd:{to_meter:.9144},ch:{to_meter:20.1168},link:{to_meter:.201168},dm:{to_meter:.1},in:{to_meter:.0254},"ind-ch":{to_meter:20.11669506},"us-in":{to_meter:.025400050800101},"us-yd":{to_meter:.914401828803658}};var aw=/[\s_\-\/\(\)]/g;function Cu(n,e){if(n[e])return n[e];for(var t=Object.keys(n),r=e.toLowerCase().replace(aw,""),i=-1,s,a;++i<t.length;)if(s=t[i],a=s.toLowerCase().replace(aw,""),a===r)return n[s]}function U_(n){var e={},t=n.split("+").map(function(o){return o.trim()}).filter(function(o){return o}).reduce(function(o,u){var c=u.split("=");return c.push(!0),o[c[0].toLowerCase()]=c[1],o},{}),r,i,s,a={proj:"projName",datum:"datumCode",rf:function(o){e.rf=parseFloat(o)},lat_0:function(o){e.lat0=o*Bi},lat_1:function(o){e.lat1=o*Bi},lat_2:function(o){e.lat2=o*Bi},lat_ts:function(o){e.lat_ts=o*Bi},lon_0:function(o){e.long0=o*Bi},lon_1:function(o){e.long1=o*Bi},lon_2:function(o){e.long2=o*Bi},alpha:function(o){e.alpha=parseFloat(o)*Bi},gamma:function(o){e.rectified_grid_angle=parseFloat(o)*Bi},lonc:function(o){e.longc=o*Bi},x_0:function(o){e.x0=parseFloat(o)},y_0:function(o){e.y0=parseFloat(o)},k_0:function(o){e.k0=parseFloat(o)},k:function(o){e.k0=parseFloat(o)},a:function(o){e.a=parseFloat(o)},b:function(o){e.b=parseFloat(o)},r:function(o){e.a=e.b=parseFloat(o)},r_a:function(){e.R_A=!0},zone:function(o){e.zone=parseInt(o,10)},south:function(){e.utmSouth=!0},towgs84:function(o){e.datum_params=o.split(",").map(function(u){return parseFloat(u)})},to_meter:function(o){e.to_meter=parseFloat(o)},units:function(o){e.units=o;var u=Cu(eF,o);u&&(e.to_meter=u.to_meter)},from_greenwich:function(o){e.from_greenwich=o*Bi},pm:function(o){var u=Cu(qs,o);e.from_greenwich=(u||parseFloat(o))*Bi},nadgrids:function(o){o==="@null"?e.datumCode="none":e.nadgrids=o},axis:function(o){var u="ewnsud";o.length===3&&u.indexOf(o.substr(0,1))!==-1&&u.indexOf(o.substr(1,1))!==-1&&u.indexOf(o.substr(2,1))!==-1&&(e.axis=o)},approx:function(){e.approx=!0},over:function(){e.over=!0}};for(r in t)i=t[r],r in a?(s=a[r],typeof s=="function"?s(i):e[s]=i):e[r]=i;return typeof e.datumCode=="string"&&e.datumCode!=="WGS84"&&(e.datumCode=e.datumCode.toLowerCase()),e.projStr=n,e}class uT{static getId(e){const t=e.find(r=>Array.isArray(r)&&r[0]==="ID");return t&&t.length>=3?{authority:t[1],code:parseInt(t[2],10)}:null}static convertUnit(e,t="unit"){if(!e||e.length<3)return{type:t,name:"unknown",conversion_factor:null};const r=e[1],i=parseFloat(e[2])||null,s=e.find(o=>Array.isArray(o)&&o[0]==="ID"),a=s?{authority:s[1],code:parseInt(s[2],10)}:null;return{type:t,name:r,conversion_factor:i,id:a}}static convertAxis(e){const t=e[1]||"Unknown";let r;const i=t.match(/^\((.)\)$/);if(i){const c=i[1].toUpperCase();if(c==="E")r="east";else if(c==="N")r="north";else if(c==="U")r="up";else throw new Error(`Unknown axis abbreviation: ${c}`)}else r=e[2]?e[2].toLowerCase():"unknown";const s=e.find(c=>Array.isArray(c)&&c[0]==="ORDER"),a=s?parseInt(s[1],10):null,o=e.find(c=>Array.isArray(c)&&(c[0]==="LENGTHUNIT"||c[0]==="ANGLEUNIT"||c[0]==="SCALEUNIT")),u=this.convertUnit(o);return{name:t,direction:r,unit:u,order:a}}static extractAxes(e){return e.filter(t=>Array.isArray(t)&&t[0]==="AXIS").map(t=>this.convertAxis(t)).sort((t,r)=>(t.order||0)-(r.order||0))}static convert(e,t={}){switch(e[0]){case"PROJCRS":t.type="ProjectedCRS",t.name=e[1],t.base_crs=e.find(g=>Array.isArray(g)&&g[0]==="BASEGEOGCRS")?this.convert(e.find(g=>Array.isArray(g)&&g[0]==="BASEGEOGCRS")):null,t.conversion=e.find(g=>Array.isArray(g)&&g[0]==="CONVERSION")?this.convert(e.find(g=>Array.isArray(g)&&g[0]==="CONVERSION")):null;const r=e.find(g=>Array.isArray(g)&&g[0]==="CS");r&&(t.coordinate_system={type:r[1],axis:this.extractAxes(e)});const i=e.find(g=>Array.isArray(g)&&g[0]==="LENGTHUNIT");if(i){const g=this.convertUnit(i);t.coordinate_system.unit=g}t.id=this.getId(e);break;case"BASEGEOGCRS":case"GEOGCRS":t.type="GeographicCRS",t.name=e[1];const s=e.find(g=>Array.isArray(g)&&(g[0]==="DATUM"||g[0]==="ENSEMBLE"));if(s){const g=this.convert(s);s[0]==="ENSEMBLE"?t.datum_ensemble=g:t.datum=g;const y=e.find(_=>Array.isArray(_)&&_[0]==="PRIMEM");y&&y[1]!=="Greenwich"&&(g.prime_meridian={name:y[1],longitude:parseFloat(y[2])})}t.coordinate_system={type:"ellipsoidal",axis:this.extractAxes(e)},t.id=this.getId(e);break;case"DATUM":t.type="GeodeticReferenceFrame",t.name=e[1],t.ellipsoid=e.find(g=>Array.isArray(g)&&g[0]==="ELLIPSOID")?this.convert(e.find(g=>Array.isArray(g)&&g[0]==="ELLIPSOID")):null;break;case"ENSEMBLE":t.type="DatumEnsemble",t.name=e[1],t.members=e.filter(g=>Array.isArray(g)&&g[0]==="MEMBER").map(g=>({type:"DatumEnsembleMember",name:g[1],id:this.getId(g)}));const a=e.find(g=>Array.isArray(g)&&g[0]==="ENSEMBLEACCURACY");a&&(t.accuracy=parseFloat(a[1]));const o=e.find(g=>Array.isArray(g)&&g[0]==="ELLIPSOID");o&&(t.ellipsoid=this.convert(o)),t.id=this.getId(e);break;case"ELLIPSOID":t.type="Ellipsoid",t.name=e[1],t.semi_major_axis=parseFloat(e[2]),t.inverse_flattening=parseFloat(e[3]),e.find(g=>Array.isArray(g)&&g[0]==="LENGTHUNIT")&&this.convert(e.find(g=>Array.isArray(g)&&g[0]==="LENGTHUNIT"),t);break;case"CONVERSION":t.type="Conversion",t.name=e[1],t.method=e.find(g=>Array.isArray(g)&&g[0]==="METHOD")?this.convert(e.find(g=>Array.isArray(g)&&g[0]==="METHOD")):null,t.parameters=e.filter(g=>Array.isArray(g)&&g[0]==="PARAMETER").map(g=>this.convert(g));break;case"METHOD":t.type="Method",t.name=e[1],t.id=this.getId(e);break;case"PARAMETER":t.type="Parameter",t.name=e[1],t.value=parseFloat(e[2]),t.unit=this.convertUnit(e.find(g=>Array.isArray(g)&&(g[0]==="LENGTHUNIT"||g[0]==="ANGLEUNIT"||g[0]==="SCALEUNIT"))),t.id=this.getId(e);break;case"BOUNDCRS":t.type="BoundCRS";const u=e.find(g=>Array.isArray(g)&&g[0]==="SOURCECRS");if(u){const g=u.find(y=>Array.isArray(y));t.source_crs=g?this.convert(g):null}const c=e.find(g=>Array.isArray(g)&&g[0]==="TARGETCRS");if(c){const g=c.find(y=>Array.isArray(y));t.target_crs=g?this.convert(g):null}const f=e.find(g=>Array.isArray(g)&&g[0]==="ABRIDGEDTRANSFORMATION");f?t.transformation=this.convert(f):t.transformation=null;break;case"ABRIDGEDTRANSFORMATION":if(t.type="Transformation",t.name=e[1],t.method=e.find(g=>Array.isArray(g)&&g[0]==="METHOD")?this.convert(e.find(g=>Array.isArray(g)&&g[0]==="METHOD")):null,t.parameters=e.filter(g=>Array.isArray(g)&&(g[0]==="PARAMETER"||g[0]==="PARAMETERFILE")).map(g=>{if(g[0]==="PARAMETER")return this.convert(g);if(g[0]==="PARAMETERFILE")return{name:g[1],value:g[2],id:{authority:"EPSG",code:8656}}}),t.parameters.length===7){const g=t.parameters[6];g.name==="Scale difference"&&(g.value=Math.round((g.value-1)*1e12)/1e6)}t.id=this.getId(e);break;case"AXIS":t.coordinate_system||(t.coordinate_system={type:"unspecified",axis:[]}),t.coordinate_system.axis.push(this.convertAxis(e));break;case"LENGTHUNIT":const m=this.convertUnit(e,"LinearUnit");t.coordinate_system&&t.coordinate_system.axis&&t.coordinate_system.axis.forEach(g=>{g.unit||(g.unit=m)}),m.conversion_factor&&m.conversion_factor!==1&&t.semi_major_axis&&(t.semi_major_axis={value:t.semi_major_axis,unit:m});break;default:t.keyword=e[0];break}return t}}class tF extends uT{static convert(e,t={}){return super.convert(e,t),t.coordinate_system&&t.coordinate_system.subtype==="Cartesian"&&delete t.coordinate_system,t.usage&&delete t.usage,t}}class nF extends uT{static convert(e,t={}){super.convert(e,t);const r=e.find(s=>Array.isArray(s)&&s[0]==="CS");r&&(t.coordinate_system={subtype:r[1],axis:this.extractAxes(e)});const i=e.find(s=>Array.isArray(s)&&s[0]==="USAGE");if(i){const s=i.find(u=>Array.isArray(u)&&u[0]==="SCOPE"),a=i.find(u=>Array.isArray(u)&&u[0]==="AREA"),o=i.find(u=>Array.isArray(u)&&u[0]==="BBOX");t.usage={},s&&(t.usage.scope=s[1]),a&&(t.usage.area=a[1]),o&&(t.usage.bbox=o.slice(1))}return t}}function iF(n){return n.find(e=>Array.isArray(e)&&e[0]==="USAGE")?"2019":(n.find(e=>Array.isArray(e)&&e[0]==="CS")||n[0]==="BOUNDCRS"||n[0]==="PROJCRS"||n[0]==="GEOGCRS","2015")}function rF(n){return(iF(n)==="2019"?nF:tF).convert(n)}function sF(n){const e=n.toUpperCase();return e.includes("PROJCRS")||e.includes("GEOGCRS")||e.includes("BOUNDCRS")||e.includes("VERTCRS")||e.includes("LENGTHUNIT")||e.includes("ANGLEUNIT")||e.includes("SCALEUNIT")?"WKT2":(e.includes("PROJCS")||e.includes("GEOGCS")||e.includes("LOCAL_CS")||e.includes("VERT_CS")||e.includes("UNIT"),"WKT1")}var Jp=1,cT=2,hT=3,Mv=4,fT=5,Xx=-1,aF=/\s/,oF=/[A-Za-z]/,lF=/[A-Za-z84_]/,g1=/[,\]]/,dT=/[\d\.E\-\+]/;function Rl(n){if(typeof n!="string")throw new Error("not a string");this.text=n.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=Jp}Rl.prototype.readCharicter=function(){var n=this.text[this.place++];if(this.state!==Mv)for(;aF.test(n);){if(this.place>=this.text.length)return;n=this.text[this.place++]}switch(this.state){case Jp:return this.neutral(n);case cT:return this.keyword(n);case Mv:return this.quoted(n);case fT:return this.afterquote(n);case hT:return this.number(n);case Xx:return}};Rl.prototype.afterquote=function(n){if(n==='"'){this.word+='"',this.state=Mv;return}if(g1.test(n)){this.word=this.word.trim(),this.afterItem(n);return}throw new Error(`havn't handled "`+n+'" in afterquote yet, index '+this.place)};Rl.prototype.afterItem=function(n){if(n===","){this.word!==null&&this.currentObject.push(this.word),this.word=null,this.state=Jp;return}if(n==="]"){this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=Jp,this.currentObject=this.stack.pop(),this.currentObject||(this.state=Xx);return}};Rl.prototype.number=function(n){if(dT.test(n)){this.word+=n;return}if(g1.test(n)){this.word=parseFloat(this.word),this.afterItem(n);return}throw new Error(`havn't handled "`+n+'" in number yet, index '+this.place)};Rl.prototype.quoted=function(n){if(n==='"'){this.state=fT;return}this.word+=n};Rl.prototype.keyword=function(n){if(lF.test(n)){this.word+=n;return}if(n==="["){var e=[];e.push(this.word),this.level++,this.root===null?this.root=e:this.currentObject.push(e),this.stack.push(this.currentObject),this.currentObject=e,this.state=Jp;return}if(g1.test(n)){this.afterItem(n);return}throw new Error(`havn't handled "`+n+'" in keyword yet, index '+this.place)};Rl.prototype.neutral=function(n){if(oF.test(n)){this.word=n,this.state=cT;return}if(n==='"'){this.word="",this.state=Mv;return}if(dT.test(n)){this.word=n,this.state=hT;return}if(g1.test(n)){this.afterItem(n);return}throw new Error(`havn't handled "`+n+'" in neutral yet, index '+this.place)};Rl.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===Xx)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function uF(n){var e=new Rl(n);return e.output()}function i_(n,e,t){Array.isArray(e)&&(t.unshift(e),e=null);var r=e?{}:n,i=t.reduce(function(s,a){return wf(a,s),s},r);e&&(n[e]=i)}function wf(n,e){if(!Array.isArray(n)){e[n]=!0;return}var t=n.shift();if(t==="PARAMETER"&&(t=n.shift()),n.length===1){if(Array.isArray(n[0])){e[t]={},wf(n[0],e[t]);return}e[t]=n[0];return}if(!n.length){e[t]=!0;return}if(t==="TOWGS84"){e[t]=n;return}if(t==="AXIS"){t in e||(e[t]=[]),e[t].push(n);return}Array.isArray(t)||(e[t]={});var r;switch(t){case"UNIT":case"PRIMEM":case"VERT_DATUM":e[t]={name:n[0].toLowerCase(),convert:n[1]},n.length===3&&wf(n[2],e[t]);return;case"SPHEROID":case"ELLIPSOID":e[t]={name:n[0],a:n[1],rf:n[2]},n.length===4&&wf(n[3],e[t]);return;case"EDATUM":case"ENGINEERINGDATUM":case"LOCAL_DATUM":case"DATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":n[0]=["name",n[0]],i_(e,t,n);return;case"COMPD_CS":case"COMPOUNDCRS":case"FITTED_CS":case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"ENGCRS":case"ENGINEERINGCRS":n[0]=["name",n[0]],i_(e,t,n),e[t].type=t;return;default:for(r=-1;++r<n.length;)if(!Array.isArray(n[r]))return wf(n,e[t]);return i_(e,t,n)}}var cF=.017453292519943295;function ao(n){return n*cF}function pT(n){const e=(n.projName||"").toLowerCase().replace(/_/g," ");!n.long0&&n.longc&&(e==="albers conic equal area"||e==="lambert azimuthal equal area")&&(n.long0=n.longc),!n.lat_ts&&n.lat1&&(e==="stereographic south pole"||e==="polar stereographic (variant b)")?(n.lat0=ao(n.lat1>0?90:-90),n.lat_ts=n.lat1,delete n.lat1):!n.lat_ts&&n.lat0&&(e==="polar stereographic"||e==="polar stereographic (variant a)")&&(n.lat_ts=n.lat0,n.lat0=ao(n.lat0>0?90:-90),delete n.lat1)}function ow(n){let e={units:null,to_meter:void 0};return typeof n=="string"?(e.units=n.toLowerCase(),e.units==="metre"&&(e.units="meter"),e.units==="meter"&&(e.to_meter=1)):n&&n.name&&(e.units=n.name.toLowerCase(),e.units==="metre"&&(e.units="meter"),e.to_meter=n.conversion_factor),e}function lw(n){return typeof n=="object"?n.value*n.unit.conversion_factor:n}function uw(n,e){n.ellipsoid.radius?(e.a=n.ellipsoid.radius,e.rf=0):(e.a=lw(n.ellipsoid.semi_major_axis),n.ellipsoid.inverse_flattening!==void 0?e.rf=n.ellipsoid.inverse_flattening:n.ellipsoid.semi_major_axis!==void 0&&n.ellipsoid.semi_minor_axis!==void 0&&(e.rf=e.a/(e.a-lw(n.ellipsoid.semi_minor_axis))))}function wv(n,e={}){return!n||typeof n!="object"?n:n.type==="BoundCRS"?(wv(n.source_crs,e),n.transformation&&(n.transformation.method&&n.transformation.method.name==="NTv2"?e.nadgrids=n.transformation.parameters[0].value:e.datum_params=n.transformation.parameters.map(t=>t.value)),e):(Object.keys(n).forEach(t=>{const r=n[t];if(r!==null)switch(t){case"name":if(e.srsCode)break;e.name=r,e.srsCode=r;break;case"type":r==="GeographicCRS"?e.projName="longlat":r==="ProjectedCRS"&&n.conversion&&n.conversion.method&&(e.projName=n.conversion.method.name);break;case"datum":case"datum_ensemble":r.ellipsoid&&(e.ellps=r.ellipsoid.name,uw(r,e)),r.prime_meridian&&(e.from_greenwich=r.prime_meridian.longitude*Math.PI/180);break;case"ellipsoid":e.ellps=r.name,uw(r,e);break;case"prime_meridian":e.long0=(r.longitude||0)*Math.PI/180;break;case"coordinate_system":if(r.axis){if(e.axis=r.axis.map(i=>{const s=i.direction;if(s==="east")return"e";if(s==="north")return"n";if(s==="west")return"w";if(s==="south")return"s";throw new Error(`Unknown axis direction: ${s}`)}).join("")+"u",r.unit){const{units:i,to_meter:s}=ow(r.unit);e.units=i,e.to_meter=s}else if(r.axis[0]&&r.axis[0].unit){const{units:i,to_meter:s}=ow(r.axis[0].unit);e.units=i,e.to_meter=s}}break;case"id":r.authority&&r.code&&(e.title=r.authority+":"+r.code);break;case"conversion":r.method&&r.method.name&&(e.projName=r.method.name),r.parameters&&r.parameters.forEach(i=>{const s=i.name.toLowerCase().replace(/\s+/g,"_"),a=i.value;i.unit&&i.unit.conversion_factor?e[s]=a*i.unit.conversion_factor:i.unit==="degree"?e[s]=a*Math.PI/180:e[s]=a});break;case"unit":r.name&&(e.units=r.name.toLowerCase(),e.units==="metre"&&(e.units="meter")),r.conversion_factor&&(e.to_meter=r.conversion_factor);break;case"base_crs":wv(r,e),e.datumCode=r.id?r.id.authority+"_"+r.id.code:r.name;break}}),e.latitude_of_false_origin!==void 0&&(e.lat0=e.latitude_of_false_origin),e.longitude_of_false_origin!==void 0&&(e.long0=e.longitude_of_false_origin),e.latitude_of_standard_parallel!==void 0&&(e.lat0=e.latitude_of_standard_parallel,e.lat1=e.latitude_of_standard_parallel),e.latitude_of_1st_standard_parallel!==void 0&&(e.lat1=e.latitude_of_1st_standard_parallel),e.latitude_of_2nd_standard_parallel!==void 0&&(e.lat2=e.latitude_of_2nd_standard_parallel),e.latitude_of_projection_centre!==void 0&&(e.lat0=e.latitude_of_projection_centre),e.longitude_of_projection_centre!==void 0&&(e.longc=e.longitude_of_projection_centre),e.easting_at_false_origin!==void 0&&(e.x0=e.easting_at_false_origin),e.northing_at_false_origin!==void 0&&(e.y0=e.northing_at_false_origin),e.latitude_of_natural_origin!==void 0&&(e.lat0=e.latitude_of_natural_origin),e.longitude_of_natural_origin!==void 0&&(e.long0=e.longitude_of_natural_origin),e.longitude_of_origin!==void 0&&(e.long0=e.longitude_of_origin),e.false_easting!==void 0&&(e.x0=e.false_easting),e.easting_at_projection_centre&&(e.x0=e.easting_at_projection_centre),e.false_northing!==void 0&&(e.y0=e.false_northing),e.northing_at_projection_centre&&(e.y0=e.northing_at_projection_centre),e.standard_parallel_1!==void 0&&(e.lat1=e.standard_parallel_1),e.standard_parallel_2!==void 0&&(e.lat2=e.standard_parallel_2),e.scale_factor_at_natural_origin!==void 0&&(e.k0=e.scale_factor_at_natural_origin),e.scale_factor_at_projection_centre!==void 0&&(e.k0=e.scale_factor_at_projection_centre),e.scale_factor_on_pseudo_standard_parallel!==void 0&&(e.k0=e.scale_factor_on_pseudo_standard_parallel),e.azimuth!==void 0&&(e.alpha=e.azimuth),e.azimuth_at_projection_centre!==void 0&&(e.alpha=e.azimuth_at_projection_centre),e.angle_from_rectified_to_skew_grid&&(e.rectified_grid_angle=e.angle_from_rectified_to_skew_grid),pT(e),e)}var hF=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function fF(n,e){var t=e[0],r=e[1];!(t in n)&&r in n&&(n[t]=n[r],e.length===3&&(n[t]=e[2](n[t])))}function mT(n){for(var e=Object.keys(n),t=0,r=e.length;t<r;++t){var i=e[t];hF.indexOf(i)!==-1&&dF(n[i]),typeof n[i]=="object"&&mT(n[i])}}function dF(n){if(n.AUTHORITY){var e=Object.keys(n.AUTHORITY)[0];e&&e in n.AUTHORITY&&(n.title=e+":"+n.AUTHORITY[e])}if(n.type==="GEOGCS"?n.projName="longlat":n.type==="LOCAL_CS"?(n.projName="identity",n.local=!0):typeof n.PROJECTION=="object"?n.projName=Object.keys(n.PROJECTION)[0]:n.projName=n.PROJECTION,n.AXIS){for(var t="",r=0,i=n.AXIS.length;r<i;++r){var s=[n.AXIS[r][0].toLowerCase(),n.AXIS[r][1].toLowerCase()];s[0].indexOf("north")!==-1||(s[0]==="y"||s[0]==="lat")&&s[1]==="north"?t+="n":s[0].indexOf("south")!==-1||(s[0]==="y"||s[0]==="lat")&&s[1]==="south"?t+="s":s[0].indexOf("east")!==-1||(s[0]==="x"||s[0]==="lon")&&s[1]==="east"?t+="e":(s[0].indexOf("west")!==-1||(s[0]==="x"||s[0]==="lon")&&s[1]==="west")&&(t+="w")}t.length===2&&(t+="u"),t.length===3&&(n.axis=t)}n.UNIT&&(n.units=n.UNIT.name.toLowerCase(),n.units==="metre"&&(n.units="meter"),n.UNIT.convert&&(n.type==="GEOGCS"?n.DATUM&&n.DATUM.SPHEROID&&(n.to_meter=n.UNIT.convert*n.DATUM.SPHEROID.a):n.to_meter=n.UNIT.convert));var a=n.GEOGCS;n.type==="GEOGCS"&&(a=n),a&&(a.DATUM?n.datumCode=a.DATUM.name.toLowerCase():n.datumCode=a.name.toLowerCase(),n.datumCode.slice(0,2)==="d_"&&(n.datumCode=n.datumCode.slice(2)),n.datumCode==="new_zealand_1949"&&(n.datumCode="nzgd49"),(n.datumCode==="wgs_1984"||n.datumCode==="world_geodetic_system_1984")&&(n.PROJECTION==="Mercator_Auxiliary_Sphere"&&(n.sphere=!0),n.datumCode="wgs84"),n.datumCode==="belge_1972"&&(n.datumCode="rnb72"),a.DATUM&&a.DATUM.SPHEROID&&(n.ellps=a.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),n.ellps.toLowerCase().slice(0,13)==="international"&&(n.ellps="intl"),n.a=a.DATUM.SPHEROID.a,n.rf=parseFloat(a.DATUM.SPHEROID.rf,10)),a.DATUM&&a.DATUM.TOWGS84&&(n.datum_params=a.DATUM.TOWGS84),~n.datumCode.indexOf("osgb_1936")&&(n.datumCode="osgb36"),~n.datumCode.indexOf("osni_1952")&&(n.datumCode="osni52"),(~n.datumCode.indexOf("tm65")||~n.datumCode.indexOf("geodetic_datum_of_1965"))&&(n.datumCode="ire65"),n.datumCode==="ch1903+"&&(n.datumCode="ch1903"),~n.datumCode.indexOf("israel")&&(n.datumCode="isr93")),n.b&&!isFinite(n.b)&&(n.b=n.a),n.rectified_grid_angle&&(n.rectified_grid_angle=ao(n.rectified_grid_angle));function o(f){var m=n.to_meter||1;return f*m}var u=function(f){return fF(n,f)},c=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",ao],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",ao],["x0","false_easting",o],["y0","false_northing",o],["long0","central_meridian",ao],["lat0","latitude_of_origin",ao],["lat0","standard_parallel_1",ao],["lat1","standard_parallel_1",ao],["lat2","standard_parallel_2",ao],["azimuth","Azimuth"],["alpha","azimuth",ao],["srsCode","name"]];c.forEach(u),pT(n)}function Ev(n){if(typeof n=="object")return wv(n);const e=sF(n);var t=uF(n);if(e==="WKT2"){const s=rF(t);return wv(s)}var r=t[0],i={};return wf(t,i),mT(i),i[r]}function Wr(n){var e=this;if(arguments.length===2){var t=arguments[1];typeof t=="string"?t.charAt(0)==="+"?Wr[n]=U_(arguments[1]):Wr[n]=Ev(arguments[1]):t&&typeof t=="object"&&!("projName"in t)?Wr[n]=Ev(arguments[1]):(Wr[n]=t,t||delete Wr[n])}else if(arguments.length===1){if(Array.isArray(n))return n.map(function(r){return Array.isArray(r)?Wr.apply(e,r):Wr(r)});if(typeof n=="string"){if(n in Wr)return Wr[n]}else"EPSG"in n?Wr["EPSG:"+n.EPSG]=n:"ESRI"in n?Wr["ESRI:"+n.ESRI]=n:"IAU2000"in n?Wr["IAU2000:"+n.IAU2000]=n:console.log(n);return}}YU(Wr);function pF(n){return typeof n=="string"}function mF(n){return n in Wr}function gF(n){return n.indexOf("+")!==0&&n.indexOf("[")!==-1||typeof n=="object"&&!("srsCode"in n)}var vF=["3857","900913","3785","102113"];function yF(n){var e=Cu(n,"authority");if(e){var t=Cu(e,"epsg");return t&&vF.indexOf(t)>-1}}function _F(n){var e=Cu(n,"extension");if(e)return Cu(e,"proj4")}function xF(n){return n[0]==="+"}function SF(n){if(pF(n)){if(mF(n))return Wr[n];if(gF(n)){var e=Ev(n);if(yF(e))return Wr["EPSG:3857"];var t=_F(e);return t?U_(t):e}if(xF(n))return U_(n)}else return"projName"in n?n:Ev(n)}function cw(n,e){n=n||{};var t,r;if(!e)return n;for(r in e)t=e[r],t!==void 0&&(n[r]=t);return n}function Bo(n,e,t){var r=n*e;return t/Math.sqrt(1-r*r)}function g0(n){return n<0?-1:1}function Vt(n,e){return e||Math.abs(n)<=Zi?n:n-g0(n)*Zp}function co(n,e,t){var r=n*t,i=.5*n;return r=Math.pow((1-r)/(1+r),i),Math.tan(.5*(_t-e))/r}function Kp(n,e){for(var t=.5*n,r,i,s=_t-2*Math.atan(e),a=0;a<=15;a++)if(r=n*Math.sin(s),i=_t-2*Math.atan(e*Math.pow((1-r)/(1+r),t))-s,s+=i,Math.abs(i)<=1e-10)return s;return-9999}function MF(){var n=this.b/this.a;this.es=1-n*n,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=Bo(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)}function wF(n){var e=n.x,t=n.y;if(t*Xs>90&&t*Xs<-90&&e*Xs>180&&e*Xs<-180)return null;var r,i;if(Math.abs(Math.abs(t)-_t)<=Lt)return null;if(this.sphere)r=this.x0+this.a*this.k0*Vt(e-this.long0,this.over),i=this.y0+this.a*this.k0*Math.log(Math.tan(Zn+.5*t));else{var s=Math.sin(t),a=co(this.e,t,s);r=this.x0+this.a*this.k0*Vt(e-this.long0,this.over),i=this.y0-this.a*this.k0*Math.log(a)}return n.x=r,n.y=i,n}function EF(n){var e=n.x-this.x0,t=n.y-this.y0,r,i;if(this.sphere)i=_t-2*Math.atan(Math.exp(-t/(this.a*this.k0)));else{var s=Math.exp(-t/(this.a*this.k0));if(i=Kp(this.e,s),i===-9999)return null}return r=Vt(this.long0+e/(this.a*this.k0),this.over),n.x=r,n.y=i,n}var TF=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","Mercator_Variant_A","merc"];const bF={init:MF,forward:wF,inverse:EF,names:TF};function AF(){}function hw(n){return n}var gT=["longlat","identity"];const CF={init:AF,forward:hw,inverse:hw,names:gT};var PF=[bF,CF],Ic={},Ef=[];function vT(n,e){var t=Ef.length;return n.names?(Ef[t]=n,n.names.forEach(function(r){Ic[r.toLowerCase()]=t}),this):(console.log(e),!0)}function yT(n){return n.replace(/[-\(\)\s]+/g," ").trim().replace(/ /g,"_")}function RF(n){if(!n)return!1;var e=n.toLowerCase();if(typeof Ic[e]<"u"&&Ef[Ic[e]]||(e=yT(e),e in Ic&&Ef[Ic[e]]))return Ef[Ic[e]]}function IF(){PF.forEach(vT)}const LF={start:IF,add:vT,get:RF};var _T={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"},andrae:{a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"},clrk80:{a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk80ign:{a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"},clrk58:{a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:63558348467e-4,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"},WGS84:{a:6378137,rf:298.257223563,ellipseName:"WGS 84"},sphere:{a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"}};const NF=_T.WGS84;function DF(n,e,t,r){var i=n*n,s=e*e,a=(i-s)/i,o=0;r?(n*=1-a*(KU+a*(QU+a*$U)),i=n*n,a=0):o=Math.sqrt(a);var u=(i-s)/s;return{es:a,e:o,ep2:u}}function UF(n,e,t,r,i){if(!n){var s=Cu(_T,r);s||(s=NF),n=s.a,e=s.b,t=s.rf}return t&&!e&&(e=(1-1/t)*n),(t===0||Math.abs(n-e)<Lt)&&(i=!0,e=n),{a:n,b:e,rf:t,sphere:i}}var Mg={wgs84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},ch1903:{towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},ggrs87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},nad83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},nad27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"},mgi:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"},osni52:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},rassadiran:{towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},osgb36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Ordnance Survey of Great Britain 1936"},s_jtsk:{towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},beduaram:{towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},gunung_segara:{towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},rnb72:{towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"},EPSG_5451:{towgs84:"6.41,-49.05,-11.28,1.5657,0.5242,6.9718,-5.7649"},IGNF_LURESG:{towgs84:"-192.986,13.673,-39.309,-0.4099,-2.9332,2.6881,0.43"},EPSG_4614:{towgs84:"-119.4248,-303.65872,-11.00061,1.164298,0.174458,1.096259,3.657065"},EPSG_4615:{towgs84:"-494.088,-312.129,279.877,-1.423,-1.013,1.59,-0.748"},ESRI_37241:{towgs84:"-76.822,257.457,-12.817,2.136,-0.033,-2.392,-0.031"},ESRI_37249:{towgs84:"-440.296,58.548,296.265,1.128,10.202,4.559,-0.438"},ESRI_37245:{towgs84:"-511.151,-181.269,139.609,1.05,2.703,1.798,3.071"},EPSG_4178:{towgs84:"24.9,-126.4,-93.2,-0.063,-0.247,-0.041,1.01"},EPSG_4622:{towgs84:"-472.29,-5.63,-304.12,0.4362,-0.8374,0.2563,1.8984"},EPSG_4625:{towgs84:"126.93,547.94,130.41,-2.7867,5.1612,-0.8584,13.8227"},EPSG_5252:{towgs84:"0.023,0.036,-0.068,0.00176,0.00912,-0.01136,0.00439"},EPSG_4314:{towgs84:"597.1,71.4,412.1,0.894,0.068,-1.563,7.58"},EPSG_4282:{towgs84:"-178.3,-316.7,-131.5,5.278,6.077,10.979,19.166"},EPSG_4231:{towgs84:"-83.11,-97.38,-117.22,0.0276,-0.2167,0.2147,0.1218"},EPSG_4274:{towgs84:"-230.994,102.591,25.199,0.633,-0.239,0.9,1.95"},EPSG_4134:{towgs84:"-180.624,-225.516,173.919,-0.81,-1.898,8.336,16.71006"},EPSG_4254:{towgs84:"18.38,192.45,96.82,0.056,-0.142,-0.2,-0.0013"},EPSG_4159:{towgs84:"-194.513,-63.978,-25.759,-3.4027,3.756,-3.352,-0.9175"},EPSG_4687:{towgs84:"0.072,-0.507,-0.245,0.0183,-0.0003,0.007,-0.0093"},EPSG_4227:{towgs84:"-83.58,-397.54,458.78,-17.595,-2.847,4.256,3.225"},EPSG_4746:{towgs84:"599.4,72.4,419.2,-0.062,-0.022,-2.723,6.46"},EPSG_4745:{towgs84:"612.4,77,440.2,-0.054,0.057,-2.797,2.55"},EPSG_6311:{towgs84:"8.846,-4.394,-1.122,-0.00237,-0.146528,0.130428,0.783926"},EPSG_4289:{towgs84:"565.7381,50.4018,465.2904,-1.91514,1.60363,-9.09546,4.07244"},EPSG_4230:{towgs84:"-68.863,-134.888,-111.49,-0.53,-0.14,0.57,-3.4"},EPSG_4154:{towgs84:"-123.02,-158.95,-168.47"},EPSG_4156:{towgs84:"570.8,85.7,462.8,4.998,1.587,5.261,3.56"},EPSG_4299:{towgs84:"482.5,-130.6,564.6,-1.042,-0.214,-0.631,8.15"},EPSG_4179:{towgs84:"33.4,-146.6,-76.3,-0.359,-0.053,0.844,-0.84"},EPSG_4313:{towgs84:"-106.8686,52.2978,-103.7239,0.3366,-0.457,1.8422,-1.2747"},EPSG_4194:{towgs84:"163.511,127.533,-159.789"},EPSG_4195:{towgs84:"105,326,-102.5"},EPSG_4196:{towgs84:"-45,417,-3.5"},EPSG_4611:{towgs84:"-162.619,-276.959,-161.764,0.067753,-2.243649,-1.158827,-1.094246"},EPSG_4633:{towgs84:"137.092,131.66,91.475,-1.9436,-11.5993,-4.3321,-7.4824"},EPSG_4641:{towgs84:"-408.809,366.856,-412.987,1.8842,-0.5308,2.1655,-121.0993"},EPSG_4643:{towgs84:"-480.26,-438.32,-643.429,16.3119,20.1721,-4.0349,-111.7002"},EPSG_4300:{towgs84:"482.5,-130.6,564.6,-1.042,-0.214,-0.631,8.15"},EPSG_4188:{towgs84:"482.5,-130.6,564.6,-1.042,-0.214,-0.631,8.15"},EPSG_4660:{towgs84:"982.6087,552.753,-540.873,32.39344,-153.25684,-96.2266,16.805"},EPSG_4662:{towgs84:"97.295,-263.247,310.882,-1.5999,0.8386,3.1409,13.3259"},EPSG_3906:{towgs84:"577.88891,165.22205,391.18289,4.9145,-0.94729,-13.05098,7.78664"},EPSG_4307:{towgs84:"-209.3622,-87.8162,404.6198,0.0046,3.4784,0.5805,-1.4547"},EPSG_6892:{towgs84:"-76.269,-16.683,68.562,-6.275,10.536,-4.286,-13.686"},EPSG_4690:{towgs84:"221.597,152.441,176.523,2.403,1.3893,0.884,11.4648"},EPSG_4691:{towgs84:"218.769,150.75,176.75,3.5231,2.0037,1.288,10.9817"},EPSG_4629:{towgs84:"72.51,345.411,79.241,-1.5862,-0.8826,-0.5495,1.3653"},EPSG_4630:{towgs84:"165.804,216.213,180.26,-0.6251,-0.4515,-0.0721,7.4111"},EPSG_4692:{towgs84:"217.109,86.452,23.711,0.0183,-0.0003,0.007,-0.0093"},EPSG_9333:{towgs84:"0,0,0,-8.393,0.749,-10.276,0"},EPSG_9059:{towgs84:"0,0,0"},EPSG_4312:{towgs84:"601.705,84.263,485.227,4.7354,1.3145,5.393,-2.3887"},EPSG_4123:{towgs84:"-96.062,-82.428,-121.753,4.801,0.345,-1.376,1.496"},EPSG_4309:{towgs84:"-124.45,183.74,44.64,-0.4384,0.5446,-0.9706,-2.1365"},ESRI_104106:{towgs84:"-283.088,-70.693,117.445,-1.157,0.059,-0.652,-4.058"},EPSG_4281:{towgs84:"-219.247,-73.802,269.529"},EPSG_4322:{towgs84:"0,0,4.5"},EPSG_4324:{towgs84:"0,0,1.9"},EPSG_4284:{towgs84:"43.822,-108.842,-119.585,1.455,-0.761,0.737,0.549"},EPSG_4277:{towgs84:"446.448,-125.157,542.06,0.15,0.247,0.842,-20.489"},EPSG_4207:{towgs84:"-282.1,-72.2,120,-1.529,0.145,-0.89,-4.46"},EPSG_4688:{towgs84:"347.175,1077.618,2623.677,33.9058,-70.6776,9.4013,186.0647"},EPSG_4689:{towgs84:"410.793,54.542,80.501,-2.5596,-2.3517,-0.6594,17.3218"},EPSG_4720:{towgs84:"0,0,4.5"},EPSG_4273:{towgs84:"278.3,93,474.5,7.889,0.05,-6.61,6.21"},EPSG_4240:{towgs84:"204.64,834.74,293.8"},EPSG_4817:{towgs84:"278.3,93,474.5,7.889,0.05,-6.61,6.21"},ESRI_104131:{towgs84:"426.62,142.62,460.09,4.98,4.49,-12.42,-17.1"},EPSG_4265:{towgs84:"-104.1,-49.1,-9.9,0.971,-2.917,0.714,-11.68"},EPSG_4263:{towgs84:"-111.92,-87.85,114.5,1.875,0.202,0.219,0.032"},EPSG_4298:{towgs84:"-689.5937,623.84046,-65.93566,-0.02331,1.17094,-0.80054,5.88536"},EPSG_4270:{towgs84:"-253.4392,-148.452,386.5267,0.15605,0.43,-0.1013,-0.0424"},EPSG_4229:{towgs84:"-121.8,98.1,-10.7"},EPSG_4220:{towgs84:"-55.5,-348,-229.2"},EPSG_4214:{towgs84:"12.646,-155.176,-80.863"},EPSG_4232:{towgs84:"-345,3,223"},EPSG_4238:{towgs84:"-1.977,-13.06,-9.993,0.364,0.254,0.689,-1.037"},EPSG_4168:{towgs84:"-170,33,326"},EPSG_4131:{towgs84:"199,931,318.9"},EPSG_4152:{towgs84:"-0.9102,2.0141,0.5602,0.029039,0.010065,0.010101,0"},EPSG_5228:{towgs84:"572.213,85.334,461.94,4.9732,1.529,5.2484,3.5378"},EPSG_8351:{towgs84:"485.021,169.465,483.839,7.786342,4.397554,4.102655,0"},EPSG_4683:{towgs84:"-127.62,-67.24,-47.04,-3.068,4.903,1.578,-1.06"},EPSG_4133:{towgs84:"0,0,0"},EPSG_7373:{towgs84:"0.819,-0.5762,-1.6446,-0.00378,-0.03317,0.00318,0.0693"},EPSG_9075:{towgs84:"-0.9102,2.0141,0.5602,0.029039,0.010065,0.010101,0"},EPSG_9072:{towgs84:"-0.9102,2.0141,0.5602,0.029039,0.010065,0.010101,0"},EPSG_9294:{towgs84:"1.16835,-1.42001,-2.24431,-0.00822,-0.05508,0.01818,0.23388"},EPSG_4212:{towgs84:"-267.434,173.496,181.814,-13.4704,8.7154,7.3926,14.7492"},EPSG_4191:{towgs84:"-44.183,-0.58,-38.489,2.3867,2.7072,-3.5196,-8.2703"},EPSG_4237:{towgs84:"52.684,-71.194,-13.975,-0.312,-0.1063,-0.3729,1.0191"},EPSG_4740:{towgs84:"-1.08,-0.27,-0.9"},EPSG_4124:{towgs84:"419.3836,99.3335,591.3451,0.850389,1.817277,-7.862238,-0.99496"},EPSG_5681:{towgs84:"584.9636,107.7175,413.8067,1.1155,0.2824,-3.1384,7.9922"},EPSG_4141:{towgs84:"23.772,17.49,17.859,-0.3132,-1.85274,1.67299,-5.4262"},EPSG_4204:{towgs84:"-85.645,-273.077,-79.708,2.289,-1.421,2.532,3.194"},EPSG_4319:{towgs84:"226.702,-193.337,-35.371,-2.229,-4.391,9.238,0.9798"},EPSG_4200:{towgs84:"24.82,-131.21,-82.66"},EPSG_4130:{towgs84:"0,0,0"},EPSG_4127:{towgs84:"-82.875,-57.097,-156.768,-2.158,1.524,-0.982,-0.359"},EPSG_4149:{towgs84:"674.374,15.056,405.346"},EPSG_4617:{towgs84:"-0.991,1.9072,0.5129,1.25033e-7,4.6785e-8,5.6529e-8,0"},EPSG_4663:{towgs84:"-210.502,-66.902,-48.476,2.094,-15.067,-5.817,0.485"},EPSG_4664:{towgs84:"-211.939,137.626,58.3,-0.089,0.251,0.079,0.384"},EPSG_4665:{towgs84:"-105.854,165.589,-38.312,-0.003,-0.026,0.024,-0.048"},EPSG_4666:{towgs84:"631.392,-66.551,481.442,1.09,-4.445,-4.487,-4.43"},EPSG_4756:{towgs84:"-192.873,-39.382,-111.202,-0.00205,-0.0005,0.00335,0.0188"},EPSG_4723:{towgs84:"-179.483,-69.379,-27.584,-7.862,8.163,6.042,-13.925"},EPSG_4726:{towgs84:"8.853,-52.644,180.304,-0.393,-2.323,2.96,-24.081"},EPSG_4267:{towgs84:"-8.0,160.0,176.0"},EPSG_5365:{towgs84:"-0.16959,0.35312,0.51846,0.03385,-0.16325,0.03446,0.03693"},EPSG_4218:{towgs84:"304.5,306.5,-318.1"},EPSG_4242:{towgs84:"-33.722,153.789,94.959,-8.581,-4.478,4.54,8.95"},EPSG_4216:{towgs84:"-292.295,248.758,429.447,4.9971,2.99,6.6906,1.0289"},ESRI_104105:{towgs84:"631.392,-66.551,481.442,1.09,-4.445,-4.487,-4.43"},ESRI_104129:{towgs84:"0,0,0"},EPSG_4673:{towgs84:"174.05,-25.49,112.57"},EPSG_4202:{towgs84:"-124,-60,154"},EPSG_4203:{towgs84:"-117.763,-51.51,139.061,0.292,0.443,0.277,-0.191"},EPSG_3819:{towgs84:"595.48,121.69,515.35,4.115,-2.9383,0.853,-3.408"},EPSG_8694:{towgs84:"-93.799,-132.737,-219.073,-1.844,0.648,-6.37,-0.169"},EPSG_4145:{towgs84:"275.57,676.78,229.6"},EPSG_4283:{towgs84:"61.55,-10.87,-40.19,39.4924,32.7221,32.8979,-9.994"},EPSG_4317:{towgs84:"2.3287,-147.0425,-92.0802,-0.3092483,0.32482185,0.49729934,5.68906266"},EPSG_4272:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993"},EPSG_4248:{towgs84:"-307.7,265.3,-363.5"},EPSG_5561:{towgs84:"24,-121,-76"},EPSG_5233:{towgs84:"-0.293,766.95,87.713,0.195704,1.695068,3.473016,-0.039338"},ESRI_104130:{towgs84:"-86,-98,-119"},ESRI_104102:{towgs84:"682,-203,480"},ESRI_37207:{towgs84:"7,-10,-26"},EPSG_4675:{towgs84:"59.935,118.4,-10.871"},ESRI_104109:{towgs84:"-89.121,-348.182,260.871"},ESRI_104112:{towgs84:"-185.583,-230.096,281.361"},ESRI_104113:{towgs84:"25.1,-275.6,222.6"},IGNF_WGS72G:{towgs84:"0,12,6"},IGNF_NTFG:{towgs84:"-168,-60,320"},IGNF_EFATE57G:{towgs84:"-127,-769,472"},IGNF_PGP50G:{towgs84:"324.8,153.6,172.1"},IGNF_REUN47G:{towgs84:"94,-948,-1262"},IGNF_CSG67G:{towgs84:"-186,230,110"},IGNF_GUAD48G:{towgs84:"-467,-16,-300"},IGNF_TAHI51G:{towgs84:"162,117,154"},IGNF_TAHAAG:{towgs84:"65,342,77"},IGNF_NUKU72G:{towgs84:"84,274,65"},IGNF_PETRELS72G:{towgs84:"365,194,166"},IGNF_WALL78G:{towgs84:"253,-133,-127"},IGNF_MAYO50G:{towgs84:"-382,-59,-262"},IGNF_TANNAG:{towgs84:"-139,-967,436"},IGNF_IGN72G:{towgs84:"-13,-348,292"},IGNF_ATIGG:{towgs84:"1118,23,66"},IGNF_FANGA84G:{towgs84:"150.57,158.33,118.32"},IGNF_RUSAT84G:{towgs84:"202.13,174.6,-15.74"},IGNF_KAUE70G:{towgs84:"126.74,300.1,-75.49"},IGNF_MOP90G:{towgs84:"-10.8,-1.8,12.77"},IGNF_MHPF67G:{towgs84:"338.08,212.58,-296.17"},IGNF_TAHI79G:{towgs84:"160.61,116.05,153.69"},IGNF_ANAA92G:{towgs84:"1.5,3.84,4.81"},IGNF_MARQUI72G:{towgs84:"330.91,-13.92,58.56"},IGNF_APAT86G:{towgs84:"143.6,197.82,74.05"},IGNF_TUBU69G:{towgs84:"237.17,171.61,-77.84"},IGNF_STPM50G:{towgs84:"11.363,424.148,373.13"},EPSG_4150:{towgs84:"674.374,15.056,405.346"},EPSG_4754:{towgs84:"-208.4058,-109.8777,-2.5764"},ESRI_104101:{towgs84:"374,150,588"},EPSG_4693:{towgs84:"0,-0.15,0.68"},EPSG_6207:{towgs84:"293.17,726.18,245.36"},EPSG_4153:{towgs84:"-133.63,-157.5,-158.62"},EPSG_4132:{towgs84:"-241.54,-163.64,396.06"},EPSG_4221:{towgs84:"-154.5,150.7,100.4"},EPSG_4266:{towgs84:"-80.7,-132.5,41.1"},EPSG_4193:{towgs84:"-70.9,-151.8,-41.4"},EPSG_5340:{towgs84:"-0.41,0.46,-0.35"},EPSG_4246:{towgs84:"-294.7,-200.1,525.5"},EPSG_4318:{towgs84:"-3.2,-5.7,2.8"},EPSG_4121:{towgs84:"-199.87,74.79,246.62"},EPSG_4223:{towgs84:"-260.1,5.5,432.2"},EPSG_4158:{towgs84:"-0.465,372.095,171.736"},EPSG_4285:{towgs84:"-128.16,-282.42,21.93"},EPSG_4613:{towgs84:"-404.78,685.68,45.47"},EPSG_4607:{towgs84:"195.671,332.517,274.607"},EPSG_4475:{towgs84:"-381.788,-57.501,-256.673"},EPSG_4208:{towgs84:"-157.84,308.54,-146.6"},EPSG_4743:{towgs84:"70.995,-335.916,262.898"},EPSG_4710:{towgs84:"-323.65,551.39,-491.22"},EPSG_7881:{towgs84:"-0.077,0.079,0.086"},EPSG_4682:{towgs84:"283.729,735.942,261.143"},EPSG_4739:{towgs84:"-156,-271,-189"},EPSG_4679:{towgs84:"-80.01,253.26,291.19"},EPSG_4750:{towgs84:"-56.263,16.136,-22.856"},EPSG_4644:{towgs84:"-10.18,-350.43,291.37"},EPSG_4695:{towgs84:"-103.746,-9.614,-255.95"},EPSG_4292:{towgs84:"-355,21,72"},EPSG_4302:{towgs84:"-61.702,284.488,472.052"},EPSG_4143:{towgs84:"-124.76,53,466.79"},EPSG_4606:{towgs84:"-153,153,307"},EPSG_4699:{towgs84:"-770.1,158.4,-498.2"},EPSG_4247:{towgs84:"-273.5,110.6,-357.9"},EPSG_4160:{towgs84:"8.88,184.86,106.69"},EPSG_4161:{towgs84:"-233.43,6.65,173.64"},EPSG_9251:{towgs84:"-9.5,122.9,138.2"},EPSG_9253:{towgs84:"-78.1,101.6,133.3"},EPSG_4297:{towgs84:"-198.383,-240.517,-107.909"},EPSG_4269:{towgs84:"0,0,0"},EPSG_4301:{towgs84:"-147,506,687"},EPSG_4618:{towgs84:"-59,-11,-52"},EPSG_4612:{towgs84:"0,0,0"},EPSG_4678:{towgs84:"44.585,-131.212,-39.544"},EPSG_4250:{towgs84:"-130,29,364"},EPSG_4144:{towgs84:"214,804,268"},EPSG_4147:{towgs84:"-17.51,-108.32,-62.39"},EPSG_4259:{towgs84:"-254.1,-5.36,-100.29"},EPSG_4164:{towgs84:"-76,-138,67"},EPSG_4211:{towgs84:"-378.873,676.002,-46.255"},EPSG_4182:{towgs84:"-422.651,-172.995,84.02"},EPSG_4224:{towgs84:"-143.87,243.37,-33.52"},EPSG_4225:{towgs84:"-205.57,168.77,-4.12"},EPSG_5527:{towgs84:"-67.35,3.88,-38.22"},EPSG_4752:{towgs84:"98,390,-22"},EPSG_4310:{towgs84:"-30,190,89"},EPSG_9248:{towgs84:"-192.26,65.72,132.08"},EPSG_4680:{towgs84:"124.5,-63.5,-281"},EPSG_4701:{towgs84:"-79.9,-158,-168.9"},EPSG_4706:{towgs84:"-146.21,112.63,4.05"},EPSG_4805:{towgs84:"682,-203,480"},EPSG_4201:{towgs84:"-165,-11,206"},EPSG_4210:{towgs84:"-157,-2,-299"},EPSG_4183:{towgs84:"-104,167,-38"},EPSG_4139:{towgs84:"11,72,-101"},EPSG_4668:{towgs84:"-86,-98,-119"},EPSG_4717:{towgs84:"-2,151,181"},EPSG_4732:{towgs84:"102,52,-38"},EPSG_4280:{towgs84:"-377,681,-50"},EPSG_4209:{towgs84:"-138,-105,-289"},EPSG_4261:{towgs84:"31,146,47"},EPSG_4658:{towgs84:"-73,46,-86"},EPSG_4721:{towgs84:"265.025,384.929,-194.046"},EPSG_4222:{towgs84:"-136,-108,-292"},EPSG_4601:{towgs84:"-255,-15,71"},EPSG_4602:{towgs84:"725,685,536"},EPSG_4603:{towgs84:"72,213.7,93"},EPSG_4605:{towgs84:"9,183,236"},EPSG_4621:{towgs84:"137,248,-430"},EPSG_4657:{towgs84:"-28,199,5"},EPSG_4316:{towgs84:"103.25,-100.4,-307.19"},EPSG_4642:{towgs84:"-13,-348,292"},EPSG_4698:{towgs84:"145,-187,103"},EPSG_4192:{towgs84:"-206.1,-174.7,-87.7"},EPSG_4311:{towgs84:"-265,120,-358"},EPSG_4135:{towgs84:"58,-283,-182"},ESRI_104138:{towgs84:"198,-226,-347"},EPSG_4245:{towgs84:"-11,851,5"},EPSG_4142:{towgs84:"-125,53,467"},EPSG_4213:{towgs84:"-106,-87,188"},EPSG_4253:{towgs84:"-133,-77,-51"},EPSG_4129:{towgs84:"-132,-110,-335"},EPSG_4713:{towgs84:"-77,-128,142"},EPSG_4239:{towgs84:"217,823,299"},EPSG_4146:{towgs84:"295,736,257"},EPSG_4155:{towgs84:"-83,37,124"},EPSG_4165:{towgs84:"-173,253,27"},EPSG_4672:{towgs84:"175,-38,113"},EPSG_4236:{towgs84:"-637,-549,-203"},EPSG_4251:{towgs84:"-90,40,88"},EPSG_4271:{towgs84:"-2,374,172"},EPSG_4175:{towgs84:"-88,4,101"},EPSG_4716:{towgs84:"298,-304,-375"},EPSG_4315:{towgs84:"-23,259,-9"},EPSG_4744:{towgs84:"-242.2,-144.9,370.3"},EPSG_4244:{towgs84:"-97,787,86"},EPSG_4293:{towgs84:"616,97,-251"},EPSG_4714:{towgs84:"-127,-769,472"},EPSG_4736:{towgs84:"260,12,-147"},EPSG_6883:{towgs84:"-235,-110,393"},EPSG_6894:{towgs84:"-63,176,185"},EPSG_4205:{towgs84:"-43,-163,45"},EPSG_4256:{towgs84:"41,-220,-134"},EPSG_4262:{towgs84:"639,405,60"},EPSG_4604:{towgs84:"174,359,365"},EPSG_4169:{towgs84:"-115,118,426"},EPSG_4620:{towgs84:"-106,-129,165"},EPSG_4184:{towgs84:"-203,141,53"},EPSG_4616:{towgs84:"-289,-124,60"},EPSG_9403:{towgs84:"-307,-92,127"},EPSG_4684:{towgs84:"-133,-321,50"},EPSG_4708:{towgs84:"-491,-22,435"},EPSG_4707:{towgs84:"114,-116,-333"},EPSG_4709:{towgs84:"145,75,-272"},EPSG_4712:{towgs84:"-205,107,53"},EPSG_4711:{towgs84:"124,-234,-25"},EPSG_4718:{towgs84:"230,-199,-752"},EPSG_4719:{towgs84:"211,147,111"},EPSG_4724:{towgs84:"208,-435,-229"},EPSG_4725:{towgs84:"189,-79,-202"},EPSG_4735:{towgs84:"647,1777,-1124"},EPSG_4722:{towgs84:"-794,119,-298"},EPSG_4728:{towgs84:"-307,-92,127"},EPSG_4734:{towgs84:"-632,438,-609"},EPSG_4727:{towgs84:"912,-58,1227"},EPSG_4729:{towgs84:"185,165,42"},EPSG_4730:{towgs84:"170,42,84"},EPSG_4733:{towgs84:"276,-57,149"},ESRI_37218:{towgs84:"230,-199,-752"},ESRI_37240:{towgs84:"-7,215,225"},ESRI_37221:{towgs84:"252,-209,-751"},ESRI_4305:{towgs84:"-123,-206,219"},ESRI_104139:{towgs84:"-73,-247,227"},EPSG_4748:{towgs84:"51,391,-36"},EPSG_4219:{towgs84:"-384,664,-48"},EPSG_4255:{towgs84:"-333,-222,114"},EPSG_4257:{towgs84:"-587.8,519.75,145.76"},EPSG_4646:{towgs84:"-963,510,-359"},EPSG_6881:{towgs84:"-24,-203,268"},EPSG_6882:{towgs84:"-183,-15,273"},EPSG_4715:{towgs84:"-104,-129,239"},IGNF_RGF93GDD:{towgs84:"0,0,0"},IGNF_RGM04GDD:{towgs84:"0,0,0"},IGNF_RGSPM06GDD:{towgs84:"0,0,0"},IGNF_RGTAAF07GDD:{towgs84:"0,0,0"},IGNF_RGFG95GDD:{towgs84:"0,0,0"},IGNF_RGNCG:{towgs84:"0,0,0"},IGNF_RGPFGDD:{towgs84:"0,0,0"},IGNF_ETRS89G:{towgs84:"0,0,0"},IGNF_RGR92GDD:{towgs84:"0,0,0"},EPSG_4173:{towgs84:"0,0,0"},EPSG_4180:{towgs84:"0,0,0"},EPSG_4619:{towgs84:"0,0,0"},EPSG_4667:{towgs84:"0,0,0"},EPSG_4075:{towgs84:"0,0,0"},EPSG_6706:{towgs84:"0,0,0"},EPSG_7798:{towgs84:"0,0,0"},EPSG_4661:{towgs84:"0,0,0"},EPSG_4669:{towgs84:"0,0,0"},EPSG_8685:{towgs84:"0,0,0"},EPSG_4151:{towgs84:"0,0,0"},EPSG_9702:{towgs84:"0,0,0"},EPSG_4758:{towgs84:"0,0,0"},EPSG_4761:{towgs84:"0,0,0"},EPSG_4765:{towgs84:"0,0,0"},EPSG_8997:{towgs84:"0,0,0"},EPSG_4023:{towgs84:"0,0,0"},EPSG_4670:{towgs84:"0,0,0"},EPSG_4694:{towgs84:"0,0,0"},EPSG_4148:{towgs84:"0,0,0"},EPSG_4163:{towgs84:"0,0,0"},EPSG_4167:{towgs84:"0,0,0"},EPSG_4189:{towgs84:"0,0,0"},EPSG_4190:{towgs84:"0,0,0"},EPSG_4176:{towgs84:"0,0,0"},EPSG_4659:{towgs84:"0,0,0"},EPSG_3824:{towgs84:"0,0,0"},EPSG_3889:{towgs84:"0,0,0"},EPSG_4046:{towgs84:"0,0,0"},EPSG_4081:{towgs84:"0,0,0"},EPSG_4558:{towgs84:"0,0,0"},EPSG_4483:{towgs84:"0,0,0"},EPSG_5013:{towgs84:"0,0,0"},EPSG_5264:{towgs84:"0,0,0"},EPSG_5324:{towgs84:"0,0,0"},EPSG_5354:{towgs84:"0,0,0"},EPSG_5371:{towgs84:"0,0,0"},EPSG_5373:{towgs84:"0,0,0"},EPSG_5381:{towgs84:"0,0,0"},EPSG_5393:{towgs84:"0,0,0"},EPSG_5489:{towgs84:"0,0,0"},EPSG_5593:{towgs84:"0,0,0"},EPSG_6135:{towgs84:"0,0,0"},EPSG_6365:{towgs84:"0,0,0"},EPSG_5246:{towgs84:"0,0,0"},EPSG_7886:{towgs84:"0,0,0"},EPSG_8431:{towgs84:"0,0,0"},EPSG_8427:{towgs84:"0,0,0"},EPSG_8699:{towgs84:"0,0,0"},EPSG_8818:{towgs84:"0,0,0"},EPSG_4757:{towgs84:"0,0,0"},EPSG_9140:{towgs84:"0,0,0"},EPSG_8086:{towgs84:"0,0,0"},EPSG_4686:{towgs84:"0,0,0"},EPSG_4737:{towgs84:"0,0,0"},EPSG_4702:{towgs84:"0,0,0"},EPSG_4747:{towgs84:"0,0,0"},EPSG_4749:{towgs84:"0,0,0"},EPSG_4674:{towgs84:"0,0,0"},EPSG_4755:{towgs84:"0,0,0"},EPSG_4759:{towgs84:"0,0,0"},EPSG_4762:{towgs84:"0,0,0"},EPSG_4763:{towgs84:"0,0,0"},EPSG_4764:{towgs84:"0,0,0"},EPSG_4166:{towgs84:"0,0,0"},EPSG_4170:{towgs84:"0,0,0"},EPSG_5546:{towgs84:"0,0,0"},EPSG_7844:{towgs84:"0,0,0"},EPSG_4818:{towgs84:"589,76,480"}};for(var FF in Mg){var r_=Mg[FF];r_.datumName&&(Mg[r_.datumName]=r_)}function OF(n,e,t,r,i,s,a){var o={};return n===void 0||n==="none"?o.datum_type=D_:o.datum_type=ZU,e&&(o.datum_params=e.map(parseFloat),(o.datum_params[0]!==0||o.datum_params[1]!==0||o.datum_params[2]!==0)&&(o.datum_type=Jc),o.datum_params.length>3&&(o.datum_params[3]!==0||o.datum_params[4]!==0||o.datum_params[5]!==0||o.datum_params[6]!==0)&&(o.datum_type=Kc,o.datum_params[3]*=bp,o.datum_params[4]*=bp,o.datum_params[5]*=bp,o.datum_params[6]=o.datum_params[6]/1e6+1)),a&&(o.datum_type=Rf,o.grids=a),o.a=t,o.b=r,o.es=i,o.ep2=s,o}var qx={};function kF(n,e,t){return e instanceof ArrayBuffer?zF(n,e,t):{ready:BF(n,e)}}function zF(n,e,t){var r=!0;t!==void 0&&t.includeErrorFields===!1&&(r=!1);var i=new DataView(e),s=HF(i),a=WF(i,s),o=jF(i,a,s,r),u={header:a,subgrids:o};return qx[n]=u,u}async function BF(n,e){for(var t=[],r=await e.getImageCount(),i=r-1;i>=0;i--){var s=await e.getImage(i),a=await s.readRasters(),o=a,u=[s.getWidth(),s.getHeight()],c=s.getBoundingBox().map(fw),f=[s.fileDirectory.ModelPixelScale[0],s.fileDirectory.ModelPixelScale[1]].map(fw),m=c[0]+(u[0]-1)*f[0],g=c[3]-(u[1]-1)*f[1],y=o[0],_=o[1],E=[];for(let T=u[1]-1;T>=0;T--)for(let A=u[0]-1;A>=0;A--){var x=T*u[0]+A;E.push([-Su(_[x]),Su(y[x])])}t.push({del:f,lim:u,ll:[-m,g],cvs:E})}var S={header:{nSubgrids:r},subgrids:t};return qx[n]=S,S}function GF(n){if(n===void 0)return null;var e=n.split(",");return e.map(VF)}function VF(n){if(n.length===0)return null;var e=n[0]==="@";return e&&(n=n.slice(1)),n==="null"?{name:"null",mandatory:!e,grid:null,isNull:!0}:{name:n,mandatory:!e,grid:qx[n]||null,isNull:!1}}function fw(n){return n*Math.PI/180}function Su(n){return n/3600*Math.PI/180}function HF(n){var e=n.getInt32(8,!1);return e===11?!1:(e=n.getInt32(8,!0),e!==11&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function WF(n,e){return{nFields:n.getInt32(8,e),nSubgridFields:n.getInt32(24,e),nSubgrids:n.getInt32(40,e),shiftType:F_(n,56,64).trim(),fromSemiMajorAxis:n.getFloat64(120,e),fromSemiMinorAxis:n.getFloat64(136,e),toSemiMajorAxis:n.getFloat64(152,e),toSemiMinorAxis:n.getFloat64(168,e)}}function F_(n,e,t){return String.fromCharCode.apply(null,new Uint8Array(n.buffer.slice(e,t)))}function jF(n,e,t,r){for(var i=176,s=[],a=0;a<e.nSubgrids;a++){var o=qF(n,i,t),u=YF(n,i,o,t,r),c=Math.round(1+(o.upperLongitude-o.lowerLongitude)/o.longitudeInterval),f=Math.round(1+(o.upperLatitude-o.lowerLatitude)/o.latitudeInterval);s.push({ll:[Su(o.lowerLongitude),Su(o.lowerLatitude)],del:[Su(o.longitudeInterval),Su(o.latitudeInterval)],lim:[c,f],count:o.gridNodeCount,cvs:XF(u)});var m=16;r===!1&&(m=8),i+=176+o.gridNodeCount*m}return s}function XF(n){return n.map(function(e){return[Su(e.longitudeShift),Su(e.latitudeShift)]})}function qF(n,e,t){return{name:F_(n,e+8,e+16).trim(),parent:F_(n,e+24,e+24+8).trim(),lowerLatitude:n.getFloat64(e+72,t),upperLatitude:n.getFloat64(e+88,t),lowerLongitude:n.getFloat64(e+104,t),upperLongitude:n.getFloat64(e+120,t),latitudeInterval:n.getFloat64(e+136,t),longitudeInterval:n.getFloat64(e+152,t),gridNodeCount:n.getInt32(e+168,t)}}function YF(n,e,t,r,i){var s=e+176,a=16;i===!1&&(a=8);for(var o=[],u=0;u<t.gridNodeCount;u++){var c={latitudeShift:n.getFloat32(s+u*a,r),longitudeShift:n.getFloat32(s+u*a+4,r)};i!==!1&&(c.latitudeAccuracy=n.getFloat32(s+u*a+8,r),c.longitudeAccuracy=n.getFloat32(s+u*a+12,r)),o.push(c)}return o}function Ca(n,e){if(!(this instanceof Ca))return new Ca(n);this.forward=null,this.inverse=null,this.init=null,this.name,this.names=null,this.title,e=e||function(c){if(c)throw c};var t=SF(n);if(typeof t!="object"){e("Could not parse to valid json: "+n);return}var r=Ca.projections.get(t.projName);if(!r){e("Could not get projection name from: "+n);return}if(t.datumCode&&t.datumCode!=="none"){var i=Cu(Mg,t.datumCode);i&&(t.datum_params=t.datum_params||(i.towgs84?i.towgs84.split(","):null),t.ellps=i.ellipse,t.datumName=i.datumName?i.datumName:t.datumCode)}t.k0=t.k0||1,t.axis=t.axis||"enu",t.ellps=t.ellps||"wgs84",t.lat1=t.lat1||t.lat0;var s=UF(t.a,t.b,t.rf,t.ellps,t.sphere),a=DF(s.a,s.b,s.rf,t.R_A),o=GF(t.nadgrids),u=t.datum||OF(t.datumCode,t.datum_params,s.a,s.b,a.es,a.ep2,o);cw(this,t),cw(this,r),this.a=s.a,this.b=s.b,this.rf=s.rf,this.sphere=s.sphere,this.es=a.es,this.e=a.e,this.ep2=a.ep2,this.datum=u,"init"in this&&typeof this.init=="function"&&this.init(),e(null,this)}Ca.projections=LF;Ca.projections.start();function ZF(n,e){return n.datum_type!==e.datum_type||n.a!==e.a||Math.abs(n.es-e.es)>5e-11?!1:n.datum_type===Jc?n.datum_params[0]===e.datum_params[0]&&n.datum_params[1]===e.datum_params[1]&&n.datum_params[2]===e.datum_params[2]:n.datum_type===Kc?n.datum_params[0]===e.datum_params[0]&&n.datum_params[1]===e.datum_params[1]&&n.datum_params[2]===e.datum_params[2]&&n.datum_params[3]===e.datum_params[3]&&n.datum_params[4]===e.datum_params[4]&&n.datum_params[5]===e.datum_params[5]&&n.datum_params[6]===e.datum_params[6]:!0}function xT(n,e,t){var r=n.x,i=n.y,s=n.z?n.z:0,a,o,u,c;if(i<-_t&&i>-1.001*_t)i=-_t;else if(i>_t&&i<1.001*_t)i=_t;else{if(i<-_t)return{x:-1/0,y:-1/0,z:n.z};if(i>_t)return{x:1/0,y:1/0,z:n.z}}return r>Math.PI&&(r-=2*Math.PI),o=Math.sin(i),c=Math.cos(i),u=o*o,a=t/Math.sqrt(1-e*u),{x:(a+s)*c*Math.cos(r),y:(a+s)*c*Math.sin(r),z:(a*(1-e)+s)*o}}function ST(n,e,t,r){var i=1e-12,s=i*i,a=30,o,u,c,f,m,g,y,_,E,x,S,T,A,P=n.x,L=n.y,D=n.z?n.z:0,F,k,R;if(o=Math.sqrt(P*P+L*L),u=Math.sqrt(P*P+L*L+D*D),o/t<i){if(F=0,u/t<i)return k=_t,R=-r,{x:n.x,y:n.y,z:n.z}}else F=Math.atan2(L,P);c=D/u,f=o/u,m=1/Math.sqrt(1-e*(2-e)*f*f),_=f*(1-e)*m,E=c*m,A=0;do A++,y=t/Math.sqrt(1-e*E*E),R=o*_+D*E-y*(1-e*E*E),g=e*y/(y+R),m=1/Math.sqrt(1-g*(2-g)*f*f),x=f*(1-g)*m,S=c*m,T=S*_-x*E,_=x,E=S;while(T*T>s&&A<a);return k=Math.atan(S/Math.abs(x)),{x:F,y:k,z:R}}function JF(n,e,t){if(e===Jc)return{x:n.x+t[0],y:n.y+t[1],z:n.z+t[2]};if(e===Kc){var r=t[0],i=t[1],s=t[2],a=t[3],o=t[4],u=t[5],c=t[6];return{x:c*(n.x-u*n.y+o*n.z)+r,y:c*(u*n.x+n.y-a*n.z)+i,z:c*(-o*n.x+a*n.y+n.z)+s}}}function KF(n,e,t){if(e===Jc)return{x:n.x-t[0],y:n.y-t[1],z:n.z-t[2]};if(e===Kc){var r=t[0],i=t[1],s=t[2],a=t[3],o=t[4],u=t[5],c=t[6],f=(n.x-r)/c,m=(n.y-i)/c,g=(n.z-s)/c;return{x:f+u*m-o*g,y:-u*f+m+a*g,z:o*f-a*m+g}}}function cg(n){return n===Jc||n===Kc}function QF(n,e,t){if(ZF(n,e)||n.datum_type===D_||e.datum_type===D_)return t;var r=n.a,i=n.es;if(n.datum_type===Rf){var s=dw(n,!1,t);if(s!==0)return;r=rw,i=sw}var a=e.a,o=e.b,u=e.es;if(e.datum_type===Rf&&(a=rw,o=JU,u=sw),i===u&&r===a&&!cg(n.datum_type)&&!cg(e.datum_type))return t;if(t=xT(t,i,r),cg(n.datum_type)&&(t=JF(t,n.datum_type,n.datum_params)),cg(e.datum_type)&&(t=KF(t,e.datum_type,e.datum_params)),t=ST(t,u,a,o),e.datum_type===Rf){var c=dw(e,!0,t);if(c!==0)return}return t}function dw(n,e,t){if(n.grids===null||n.grids.length===0)return console.log("Grid shift grids not found"),-1;var r={x:-t.x,y:t.y},i={x:Number.NaN,y:Number.NaN},s=[];e:for(var a=0;a<n.grids.length;a++){var o=n.grids[a];if(s.push(o.name),o.isNull){i=r;break}if(o.grid===null){if(o.mandatory)return console.log("Unable to find mandatory grid '"+o.name+"'"),-1;continue}for(var u=o.grid.subgrids,c=0,f=u.length;c<f;c++){var m=u[c],g=(Math.abs(m.del[1])+Math.abs(m.del[0]))/1e4,y=m.ll[0]-g,_=m.ll[1]-g,E=m.ll[0]+(m.lim[0]-1)*m.del[0]+g,x=m.ll[1]+(m.lim[1]-1)*m.del[1]+g;if(!(_>r.y||y>r.x||x<r.y||E<r.x)&&(i=$F(r,e,m),!isNaN(i.x)))break e}}return isNaN(i.x)?(console.log("Failed to find a grid shift table for location '"+-r.x*Xs+" "+r.y*Xs+" tried: '"+s+"'"),-1):(t.x=-i.x,t.y=i.y,0)}function $F(n,e,t){var r={x:Number.NaN,y:Number.NaN};if(isNaN(n.x))return r;var i={x:n.x,y:n.y};i.x-=t.ll[0],i.y-=t.ll[1],i.x=Vt(i.x-Math.PI)+Math.PI;var s=pw(i,t);if(e){if(isNaN(s.x))return r;s.x=i.x-s.x,s.y=i.y-s.y;var a=9,o=1e-12,u,c;do{if(c=pw(s,t),isNaN(c.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}u={x:i.x-(c.x+s.x),y:i.y-(c.y+s.y)},s.x+=u.x,s.y+=u.y}while(a--&&Math.abs(u.x)>o&&Math.abs(u.y)>o);if(a<0)return console.log("Inverse grid shift iterator failed to converge."),r;r.x=Vt(s.x+t.ll[0]),r.y=s.y+t.ll[1]}else isNaN(s.x)||(r.x=n.x+s.x,r.y=n.y+s.y);return r}function pw(n,e){var t={x:n.x/e.del[0],y:n.y/e.del[1]},r={x:Math.floor(t.x),y:Math.floor(t.y)},i={x:t.x-1*r.x,y:t.y-1*r.y},s={x:Number.NaN,y:Number.NaN},a;if(r.x<0||r.x>=e.lim[0]||r.y<0||r.y>=e.lim[1])return s;a=r.y*e.lim[0]+r.x;var o={x:e.cvs[a][0],y:e.cvs[a][1]};a++;var u={x:e.cvs[a][0],y:e.cvs[a][1]};a+=e.lim[0];var c={x:e.cvs[a][0],y:e.cvs[a][1]};a--;var f={x:e.cvs[a][0],y:e.cvs[a][1]},m=i.x*i.y,g=i.x*(1-i.y),y=(1-i.x)*(1-i.y),_=(1-i.x)*i.y;return s.x=y*o.x+g*u.x+_*f.x+m*c.x,s.y=y*o.y+g*u.y+_*f.y+m*c.y,s}function mw(n,e,t){var r=t.x,i=t.y,s=t.z||0,a,o,u,c={};for(u=0;u<3;u++)if(!(e&&u===2&&t.z===void 0))switch(u===0?(a=r,"ew".indexOf(n.axis[u])!==-1?o="x":o="y"):u===1?(a=i,"ns".indexOf(n.axis[u])!==-1?o="y":o="x"):(a=s,o="z"),n.axis[u]){case"e":c[o]=a;break;case"w":c[o]=-a;break;case"n":c[o]=a;break;case"s":c[o]=-a;break;case"u":t[o]!==void 0&&(c.z=a);break;case"d":t[o]!==void 0&&(c.z=-a);break;default:return null}return c}function MT(n){var e={x:n[0],y:n[1]};return n.length>2&&(e.z=n[2]),n.length>3&&(e.m=n[3]),e}function e8(n){gw(n.x),gw(n.y)}function gw(n){if(typeof Number.isFinite=="function"){if(Number.isFinite(n))return;throw new TypeError("coordinates must be finite numbers")}if(typeof n!="number"||n!==n||!isFinite(n))throw new TypeError("coordinates must be finite numbers")}function t8(n,e){return(n.datum.datum_type===Jc||n.datum.datum_type===Kc||n.datum.datum_type===Rf)&&e.datumCode!=="WGS84"||(e.datum.datum_type===Jc||e.datum.datum_type===Kc||e.datum.datum_type===Rf)&&n.datumCode!=="WGS84"}function Tv(n,e,t,r){var i;Array.isArray(t)?t=MT(t):t={x:t.x,y:t.y,z:t.z,m:t.m};var s=t.z!==void 0;if(e8(t),n.datum&&e.datum&&t8(n,e)&&(i=new Ca("WGS84"),t=Tv(n,i,t,r),n=i),r&&n.axis!=="enu"&&(t=mw(n,!1,t)),n.projName==="longlat")t={x:t.x*Bi,y:t.y*Bi,z:t.z||0};else if(n.to_meter&&(t={x:t.x*n.to_meter,y:t.y*n.to_meter,z:t.z||0}),t=n.inverse(t),!t)return;if(n.from_greenwich&&(t.x+=n.from_greenwich),t=QF(n.datum,e.datum,t),!!t)return t=t,e.from_greenwich&&(t={x:t.x-e.from_greenwich,y:t.y,z:t.z||0}),e.projName==="longlat"?t={x:t.x*Xs,y:t.y*Xs,z:t.z||0}:(t=e.forward(t),e.to_meter&&(t={x:t.x/e.to_meter,y:t.y/e.to_meter,z:t.z||0})),r&&e.axis!=="enu"?mw(e,!0,t):(t&&!s&&delete t.z,t)}var vw=Ca("WGS84");function s_(n,e,t,r){var i,s,a;return Array.isArray(t)?(i=Tv(n,e,t,r)||{x:NaN,y:NaN},t.length>2?typeof n.name<"u"&&n.name==="geocent"||typeof e.name<"u"&&e.name==="geocent"?typeof i.z=="number"?[i.x,i.y,i.z].concat(t.slice(3)):[i.x,i.y,t[2]].concat(t.slice(3)):[i.x,i.y].concat(t.slice(2)):[i.x,i.y]):(s=Tv(n,e,t,r),a=Object.keys(t),a.length===2||a.forEach(function(o){if(typeof n.name<"u"&&n.name==="geocent"||typeof e.name<"u"&&e.name==="geocent"){if(o==="x"||o==="y"||o==="z")return}else if(o==="x"||o==="y")return;s[o]=t[o]}),s)}function hg(n){return n instanceof Ca?n:typeof n=="object"&&"oProj"in n?n.oProj:Ca(n)}function n8(n,e,t){var r,i,s=!1,a;return typeof e>"u"?(i=hg(n),r=vw,s=!0):(typeof e.x<"u"||Array.isArray(e))&&(t=e,i=hg(n),r=vw,s=!0),r||(r=hg(n)),i||(i=hg(e)),t?s_(r,i,t):(a={forward:function(o,u){return s_(r,i,o,u)},inverse:function(o,u){return s_(i,r,o,u)}},s&&(a.oProj=i),a)}var yw=6,wT="AJSAJS",ET="AFAFAF",Tf=65,Vs=73,wa=79,hp=86,fp=90;const i8={forward:TT,inverse:r8,toPoint:bT};function TT(n,e){return e=e||5,o8(s8({lat:n[1],lon:n[0]}),e)}function r8(n){var e=Yx(CT(n.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat,e.lon,e.lat]:[e.left,e.bottom,e.right,e.top]}function bT(n){var e=Yx(CT(n.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat]:[(e.left+e.right)/2,(e.top+e.bottom)/2]}function a_(n){return n*(Math.PI/180)}function _w(n){return 180*(n/Math.PI)}function s8(n){var e=n.lat,t=n.lon,r=6378137,i=.00669438,s=.9996,a,o,u,c,f,m,g,y=a_(e),_=a_(t),E,x;x=Math.floor((t+180)/6)+1,t===180&&(x=60),e>=56&&e<64&&t>=3&&t<12&&(x=32),e>=72&&e<84&&(t>=0&&t<9?x=31:t>=9&&t<21?x=33:t>=21&&t<33?x=35:t>=33&&t<42&&(x=37)),a=(x-1)*6-180+3,E=a_(a),o=i/(1-i),u=r/Math.sqrt(1-i*Math.sin(y)*Math.sin(y)),c=Math.tan(y)*Math.tan(y),f=o*Math.cos(y)*Math.cos(y),m=Math.cos(y)*(_-E),g=r*((1-i/4-3*i*i/64-5*i*i*i/256)*y-(3*i/8+3*i*i/32+45*i*i*i/1024)*Math.sin(2*y)+(15*i*i/256+45*i*i*i/1024)*Math.sin(4*y)-35*i*i*i/3072*Math.sin(6*y));var S=s*u*(m+(1-c+f)*m*m*m/6+(5-18*c+c*c+72*f-58*o)*m*m*m*m*m/120)+5e5,T=s*(g+u*Math.tan(y)*(m*m/2+(5-c+9*f+4*f*f)*m*m*m*m/24+(61-58*c+c*c+600*f-330*o)*m*m*m*m*m*m/720));return e<0&&(T+=1e7),{northing:Math.round(T),easting:Math.round(S),zoneNumber:x,zoneLetter:a8(e)}}function Yx(n){var e=n.northing,t=n.easting,r=n.zoneLetter,i=n.zoneNumber;if(i<0||i>60)return null;var s=.9996,a=6378137,o=.00669438,u,c=(1-Math.sqrt(1-o))/(1+Math.sqrt(1-o)),f,m,g,y,_,E,x,S,T,A=t-5e5,P=e;r<"N"&&(P-=1e7),x=(i-1)*6-180+3,u=o/(1-o),E=P/s,S=E/(a*(1-o/4-3*o*o/64-5*o*o*o/256)),T=S+(3*c/2-27*c*c*c/32)*Math.sin(2*S)+(21*c*c/16-55*c*c*c*c/32)*Math.sin(4*S)+151*c*c*c/96*Math.sin(6*S),f=a/Math.sqrt(1-o*Math.sin(T)*Math.sin(T)),m=Math.tan(T)*Math.tan(T),g=u*Math.cos(T)*Math.cos(T),y=a*(1-o)/Math.pow(1-o*Math.sin(T)*Math.sin(T),1.5),_=A/(f*s);var L=T-f*Math.tan(T)/y*(_*_/2-(5+3*m+10*g-4*g*g-9*u)*_*_*_*_/24+(61+90*m+298*g+45*m*m-252*u-3*g*g)*_*_*_*_*_*_/720);L=_w(L);var D=(_-(1+2*m+g)*_*_*_/6+(5-2*g+28*m-3*g*g+8*u+24*m*m)*_*_*_*_*_/120)/Math.cos(T);D=x+_w(D);var F;if(n.accuracy){var k=Yx({northing:n.northing+n.accuracy,easting:n.easting+n.accuracy,zoneLetter:n.zoneLetter,zoneNumber:n.zoneNumber});F={top:k.lat,right:k.lon,bottom:L,left:D}}else F={lat:L,lon:D};return F}function a8(n){var e="Z";return 84>=n&&n>=72?e="X":72>n&&n>=64?e="W":64>n&&n>=56?e="V":56>n&&n>=48?e="U":48>n&&n>=40?e="T":40>n&&n>=32?e="S":32>n&&n>=24?e="R":24>n&&n>=16?e="Q":16>n&&n>=8?e="P":8>n&&n>=0?e="N":0>n&&n>=-8?e="M":-8>n&&n>=-16?e="L":-16>n&&n>=-24?e="K":-24>n&&n>=-32?e="J":-32>n&&n>=-40?e="H":-40>n&&n>=-48?e="G":-48>n&&n>=-56?e="F":-56>n&&n>=-64?e="E":-64>n&&n>=-72?e="D":-72>n&&n>=-80&&(e="C"),e}function o8(n,e){var t="00000"+n.easting,r="00000"+n.northing;return n.zoneNumber+n.zoneLetter+l8(n.easting,n.northing,n.zoneNumber)+t.substr(t.length-5,e)+r.substr(r.length-5,e)}function l8(n,e,t){var r=AT(t),i=Math.floor(n/1e5),s=Math.floor(e/1e5)%20;return u8(i,s,r)}function AT(n){var e=n%yw;return e===0&&(e=yw),e}function u8(n,e,t){var r=t-1,i=wT.charCodeAt(r),s=ET.charCodeAt(r),a=i+n-1,o=s+e,u=!1;a>fp&&(a=a-fp+Tf-1,u=!0),(a===Vs||i<Vs&&a>Vs||(a>Vs||i<Vs)&&u)&&a++,(a===wa||i<wa&&a>wa||(a>wa||i<wa)&&u)&&(a++,a===Vs&&a++),a>fp&&(a=a-fp+Tf-1),o>hp?(o=o-hp+Tf-1,u=!0):u=!1,(o===Vs||s<Vs&&o>Vs||(o>Vs||s<Vs)&&u)&&o++,(o===wa||s<wa&&o>wa||(o>wa||s<wa)&&u)&&(o++,o===Vs&&o++),o>hp&&(o=o-hp+Tf-1);var c=String.fromCharCode(a)+String.fromCharCode(o);return c}function CT(n){if(n&&n.length===0)throw"MGRSPoint coverting from nothing";for(var e=n.length,t=null,r="",i,s=0;!/[A-Z]/.test(i=n.charAt(s));){if(s>=2)throw"MGRSPoint bad conversion from: "+n;r+=i,s++}var a=parseInt(r,10);if(s===0||s+3>e)throw"MGRSPoint bad conversion from: "+n;var o=n.charAt(s++);if(o<="A"||o==="B"||o==="Y"||o>="Z"||o==="I"||o==="O")throw"MGRSPoint zone letter "+o+" not handled: "+n;t=n.substring(s,s+=2);for(var u=AT(a),c=c8(t.charAt(0),u),f=h8(t.charAt(1),u);f<f8(o);)f+=2e6;var m=e-s;if(m%2!==0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+n;var g=m/2,y=0,_=0,E,x,S,T,A;return g>0&&(E=1e5/Math.pow(10,g),x=n.substring(s,s+g),y=parseFloat(x)*E,S=n.substring(s+g),_=parseFloat(S)*E),T=y+c,A=_+f,{easting:T,northing:A,zoneLetter:o,zoneNumber:a,accuracy:E}}function c8(n,e){for(var t=wT.charCodeAt(e-1),r=1e5,i=!1;t!==n.charCodeAt(0);){if(t++,t===Vs&&t++,t===wa&&t++,t>fp){if(i)throw"Bad character: "+n;t=Tf,i=!0}r+=1e5}return r}function h8(n,e){if(n>"V")throw"MGRSPoint given invalid Northing "+n;for(var t=ET.charCodeAt(e-1),r=0,i=!1;t!==n.charCodeAt(0);){if(t++,t===Vs&&t++,t===wa&&t++,t>hp){if(i)throw"Bad character: "+n;t=Tf,i=!0}r+=1e5}return r}function f8(n){var e;switch(n){case"C":e=11e5;break;case"D":e=2e6;break;case"E":e=28e5;break;case"F":e=37e5;break;case"G":e=46e5;break;case"H":e=55e5;break;case"J":e=64e5;break;case"K":e=73e5;break;case"L":e=82e5;break;case"M":e=91e5;break;case"N":e=0;break;case"P":e=8e5;break;case"Q":e=17e5;break;case"R":e=26e5;break;case"S":e=35e5;break;case"T":e=44e5;break;case"U":e=53e5;break;case"V":e=62e5;break;case"W":e=7e6;break;case"X":e=79e5;break;default:e=-1}if(e>=0)return e;throw"Invalid zone letter: "+n}function Hf(n,e,t){if(!(this instanceof Hf))return new Hf(n,e,t);if(Array.isArray(n))this.x=n[0],this.y=n[1],this.z=n[2]||0;else if(typeof n=="object")this.x=n.x,this.y=n.y,this.z=n.z||0;else if(typeof n=="string"&&typeof e>"u"){var r=n.split(",");this.x=parseFloat(r[0]),this.y=parseFloat(r[1]),this.z=parseFloat(r[2])||0}else this.x=n,this.y=e,this.z=t||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}Hf.fromMGRS=function(n){return new Hf(bT(n))};Hf.prototype.toMGRS=function(n){return TT([this.x,this.y],n)};var d8=1,p8=.25,xw=.046875,Sw=.01953125,Mw=.01068115234375,m8=.75,g8=.46875,v8=.013020833333333334,y8=.007120768229166667,_8=.3645833333333333,x8=.005696614583333333,S8=.3076171875;function Zx(n){var e=[];e[0]=d8-n*(p8+n*(xw+n*(Sw+n*Mw))),e[1]=n*(m8-n*(xw+n*(Sw+n*Mw)));var t=n*n;return e[2]=t*(g8-n*(v8+n*y8)),t*=n,e[3]=t*(_8-n*x8),e[4]=t*n*S8,e}function Zf(n,e,t,r){return t*=e,e*=e,r[0]*n-t*(r[1]+e*(r[2]+e*(r[3]+e*r[4])))}var M8=20;function Jx(n,e,t){for(var r=1/(1-e),i=n,s=M8;s;--s){var a=Math.sin(i),o=1-e*a*a;if(o=(Zf(i,a,Math.cos(i),t)-n)*(o*Math.sqrt(o))*r,i-=o,Math.abs(o)<Lt)return i}return i}function w8(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=Zx(this.es),this.ml0=Zf(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function E8(n){var e=n.x,t=n.y,r=Vt(e-this.long0,this.over),i,s,a,o=Math.sin(t),u=Math.cos(t);if(this.es){var f=u*r,m=Math.pow(f,2),g=this.ep2*Math.pow(u,2),y=Math.pow(g,2),_=Math.abs(u)>Lt?Math.tan(t):0,E=Math.pow(_,2),x=Math.pow(E,2);i=1-this.es*Math.pow(o,2),f=f/Math.sqrt(i);var S=Zf(t,o,u,this.en);s=this.a*(this.k0*f*(1+m/6*(1-E+g+m/20*(5-18*E+x+14*g-58*E*g+m/42*(61+179*x-x*E-479*E)))))+this.x0,a=this.a*(this.k0*(S-this.ml0+o*r*f/2*(1+m/12*(5-E+9*g+4*y+m/30*(61+x-58*E+270*g-330*E*g+m/56*(1385+543*x-x*E-3111*E))))))+this.y0}else{var c=u*Math.sin(r);if(Math.abs(Math.abs(c)-1)<Lt)return 93;if(s=.5*this.a*this.k0*Math.log((1+c)/(1-c))+this.x0,a=u*Math.cos(r)/Math.sqrt(1-Math.pow(c,2)),c=Math.abs(a),c>=1){if(c-1>Lt)return 93;a=0}else a=Math.acos(a);t<0&&(a=-a),a=this.a*this.k0*(a-this.lat0)+this.y0}return n.x=s,n.y=a,n}function T8(n){var e,t,r,i,s=(n.x-this.x0)*(1/this.a),a=(n.y-this.y0)*(1/this.a);if(this.es)if(e=this.ml0+a/this.k0,t=Jx(e,this.es,this.en),Math.abs(t)<_t){var m=Math.sin(t),g=Math.cos(t),y=Math.abs(g)>Lt?Math.tan(t):0,_=this.ep2*Math.pow(g,2),E=Math.pow(_,2),x=Math.pow(y,2),S=Math.pow(x,2);e=1-this.es*Math.pow(m,2);var T=s*Math.sqrt(e)/this.k0,A=Math.pow(T,2);e=e*y,r=t-e*A/(1-this.es)*.5*(1-A/12*(5+3*x-9*_*x+_-4*E-A/30*(61+90*x-252*_*x+45*S+46*_-A/56*(1385+3633*x+4095*S+1574*S*x)))),i=Vt(this.long0+T*(1-A/6*(1+2*x+_-A/20*(5+28*x+24*S+8*_*x+6*_-A/42*(61+662*x+1320*S+720*S*x))))/g,this.over)}else r=_t*g0(a),i=0;else{var o=Math.exp(s/this.k0),u=.5*(o-1/o),c=this.lat0+a/this.k0,f=Math.cos(c);e=Math.sqrt((1-Math.pow(f,2))/(1+Math.pow(u,2))),r=Math.asin(e),a<0&&(r=-r),u===0&&f===0?i=0:i=Vt(Math.atan2(u,f)+this.long0,this.over)}return n.x=i,n.y=r,n}var b8=["Fast_Transverse_Mercator","Fast Transverse Mercator"];const wg={init:w8,forward:E8,inverse:T8,names:b8};function PT(n){var e=Math.exp(n);return e=(e-1/e)/2,e}function Ws(n,e){n=Math.abs(n),e=Math.abs(e);var t=Math.max(n,e),r=Math.min(n,e)/(t||1);return t*Math.sqrt(1+Math.pow(r,2))}function A8(n){var e=1+n,t=e-1;return t===0?n:n*Math.log(e)/t}function C8(n){var e=Math.abs(n);return e=A8(e*(1+e/(Ws(1,e)+1))),n<0?-e:e}function Kx(n,e){for(var t=2*Math.cos(2*e),r=n.length-1,i=n[r],s=0,a;--r>=0;)a=-s+t*i+n[r],s=i,i=a;return e+a*Math.sin(2*e)}function P8(n,e){for(var t=2*Math.cos(e),r=n.length-1,i=n[r],s=0,a;--r>=0;)a=-s+t*i+n[r],s=i,i=a;return Math.sin(e)*a}function R8(n){var e=Math.exp(n);return e=(e+1/e)/2,e}function RT(n,e,t){for(var r=Math.sin(e),i=Math.cos(e),s=PT(t),a=R8(t),o=2*i*a,u=-2*r*s,c=n.length-1,f=n[c],m=0,g=0,y=0,_,E;--c>=0;)_=g,E=m,g=f,m=y,f=-_+o*g-u*m+n[c],y=-E+u*g+o*m;return o=r*a,u=i*s,[o*f-u*y,o*y+u*f]}function I8(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(wg.init.apply(this),this.forward=wg.forward,this.inverse=wg.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var n=this.es/(1+Math.sqrt(1-this.es)),e=n/(2-n),t=e;this.cgb[0]=e*(2+e*(-2/3+e*(-2+e*(116/45+e*(26/45+e*(-2854/675)))))),this.cbg[0]=e*(-2+e*(2/3+e*(4/3+e*(-82/45+e*(32/45+e*(4642/4725)))))),t=t*e,this.cgb[1]=t*(7/3+e*(-8/5+e*(-227/45+e*(2704/315+e*(2323/945))))),this.cbg[1]=t*(5/3+e*(-16/15+e*(-13/9+e*(904/315+e*(-1522/945))))),t=t*e,this.cgb[2]=t*(56/15+e*(-136/35+e*(-1262/105+e*(73814/2835)))),this.cbg[2]=t*(-26/15+e*(34/21+e*(8/5+e*(-12686/2835)))),t=t*e,this.cgb[3]=t*(4279/630+e*(-332/35+e*(-399572/14175))),this.cbg[3]=t*(1237/630+e*(-12/5+e*(-24832/14175))),t=t*e,this.cgb[4]=t*(4174/315+e*(-144838/6237)),this.cbg[4]=t*(-734/315+e*(109598/31185)),t=t*e,this.cgb[5]=t*(601676/22275),this.cbg[5]=t*(444337/155925),t=Math.pow(e,2),this.Qn=this.k0/(1+e)*(1+t*(1/4+t*(1/64+t/256))),this.utg[0]=e*(-.5+e*(2/3+e*(-37/96+e*(1/360+e*(81/512+e*(-96199/604800)))))),this.gtu[0]=e*(.5+e*(-2/3+e*(5/16+e*(41/180+e*(-127/288+e*(7891/37800)))))),this.utg[1]=t*(-1/48+e*(-1/15+e*(437/1440+e*(-46/105+e*(1118711/3870720))))),this.gtu[1]=t*(13/48+e*(-3/5+e*(557/1440+e*(281/630+e*(-1983433/1935360))))),t=t*e,this.utg[2]=t*(-17/480+e*(37/840+e*(209/4480+e*(-5569/90720)))),this.gtu[2]=t*(61/240+e*(-103/140+e*(15061/26880+e*(167603/181440)))),t=t*e,this.utg[3]=t*(-4397/161280+e*(11/504+e*(830251/7257600))),this.gtu[3]=t*(49561/161280+e*(-179/168+e*(6601661/7257600))),t=t*e,this.utg[4]=t*(-4583/161280+e*(108847/3991680)),this.gtu[4]=t*(34729/80640+e*(-3418889/1995840)),t=t*e,this.utg[5]=t*(-20648693/638668800),this.gtu[5]=t*(212378941/319334400);var r=Kx(this.cbg,this.lat0);this.Zb=-this.Qn*(r+P8(this.gtu,2*r))}function L8(n){var e=Vt(n.x-this.long0,this.over),t=n.y;t=Kx(this.cbg,t);var r=Math.sin(t),i=Math.cos(t),s=Math.sin(e),a=Math.cos(e);t=Math.atan2(r,a*i),e=Math.atan2(s*i,Ws(r,i*a)),e=C8(Math.tan(e));var o=RT(this.gtu,2*t,2*e);t=t+o[0],e=e+o[1];var u,c;return Math.abs(e)<=2.623395162778?(u=this.a*(this.Qn*e)+this.x0,c=this.a*(this.Qn*t+this.Zb)+this.y0):(u=1/0,c=1/0),n.x=u,n.y=c,n}function N8(n){var e=(n.x-this.x0)*(1/this.a),t=(n.y-this.y0)*(1/this.a);t=(t-this.Zb)/this.Qn,e=e/this.Qn;var r,i;if(Math.abs(e)<=2.623395162778){var s=RT(this.utg,2*t,2*e);t=t+s[0],e=e+s[1],e=Math.atan(PT(e));var a=Math.sin(t),o=Math.cos(t),u=Math.sin(e),c=Math.cos(e);t=Math.atan2(a*c,Ws(u,c*o)),e=Math.atan2(u,c*o),r=Vt(e+this.long0,this.over),i=Kx(this.cgb,t)}else r=1/0,i=1/0;return n.x=r,n.y=i,n}var D8=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"];const Eg={init:I8,forward:L8,inverse:N8,names:D8};function U8(n,e){if(n===void 0){if(n=Math.floor((Vt(e)+Math.PI)*30/Math.PI)+1,n<0)return 0;if(n>60)return 60}return n}var F8="etmerc";function O8(){var n=U8(this.zone,this.long0);if(n===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(n)-183)*Bi,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,Eg.init.apply(this),this.forward=Eg.forward,this.inverse=Eg.inverse}var k8=["Universal Transverse Mercator System","utm"];const z8={init:O8,names:k8,dependsOn:F8};function Qx(n,e){return Math.pow((1-n)/(1+n),e)}var B8=20;function G8(){var n=Math.sin(this.lat0),e=Math.cos(this.lat0);e*=e,this.rc=Math.sqrt(1-this.es)/(1-this.es*n*n),this.C=Math.sqrt(1+this.es*e*e/(1-this.es)),this.phic0=Math.asin(n/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+Zn)/(Math.pow(Math.tan(.5*this.lat0+Zn),this.C)*Qx(this.e*n,this.ratexp))}function V8(n){var e=n.x,t=n.y;return n.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*t+Zn),this.C)*Qx(this.e*Math.sin(t),this.ratexp))-_t,n.x=this.C*e,n}function H8(n){for(var e=1e-14,t=n.x/this.C,r=n.y,i=Math.pow(Math.tan(.5*r+Zn)/this.K,1/this.C),s=B8;s>0&&(r=2*Math.atan(i*Qx(this.e*Math.sin(n.y),-.5*this.e))-_t,!(Math.abs(r-n.y)<e));--s)n.y=r;return s?(n.x=t,n.y=r,n):null}const $x={init:G8,forward:V8,inverse:H8};function W8(){$x.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function j8(n){var e,t,r,i;return n.x=Vt(n.x-this.long0,this.over),$x.forward.apply(this,[n]),e=Math.sin(n.y),t=Math.cos(n.y),r=Math.cos(n.x),i=this.k0*this.R2/(1+this.sinc0*e+this.cosc0*t*r),n.x=i*t*Math.sin(n.x),n.y=i*(this.cosc0*e-this.sinc0*t*r),n.x=this.a*n.x+this.x0,n.y=this.a*n.y+this.y0,n}function X8(n){var e,t,r,i,s;if(n.x=(n.x-this.x0)/this.a,n.y=(n.y-this.y0)/this.a,n.x/=this.k0,n.y/=this.k0,s=Ws(n.x,n.y)){var a=2*Math.atan2(s,this.R2);e=Math.sin(a),t=Math.cos(a),i=Math.asin(t*this.sinc0+n.y*e*this.cosc0/s),r=Math.atan2(n.x*e,s*this.cosc0*t-n.y*this.sinc0*e)}else i=this.phic0,r=0;return n.x=r,n.y=i,$x.inverse.apply(this,[n]),n.x=Vt(n.x+this.long0,this.over),n}var q8=["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"];const Y8={init:W8,forward:j8,inverse:X8,names:q8};function eS(n,e,t){return e*=t,Math.tan(.5*(_t+n))*Math.pow((1-e)/(1+e),.5*t)}function Z8(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=Lt&&(this.k0=.5*(1+g0(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=Lt&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=Lt&&Math.abs(Math.cos(this.lat_ts))>Lt&&(this.k0=.5*this.cons*Bo(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/co(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=Bo(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(eS(this.lat0,this.sinlat0,this.e))-_t,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function J8(n){var e=n.x,t=n.y,r=Math.sin(t),i=Math.cos(t),s,a,o,u,c,f,m=Vt(e-this.long0,this.over);return Math.abs(Math.abs(e-this.long0)-Math.PI)<=Lt&&Math.abs(t+this.lat0)<=Lt?(n.x=NaN,n.y=NaN,n):this.sphere?(s=2*this.k0/(1+this.sinlat0*r+this.coslat0*i*Math.cos(m)),n.x=this.a*s*i*Math.sin(m)+this.x0,n.y=this.a*s*(this.coslat0*r-this.sinlat0*i*Math.cos(m))+this.y0,n):(a=2*Math.atan(eS(t,r,this.e))-_t,u=Math.cos(a),o=Math.sin(a),Math.abs(this.coslat0)<=Lt?(c=co(this.e,t*this.con,this.con*r),f=2*this.a*this.k0*c/this.cons,n.x=this.x0+f*Math.sin(e-this.long0),n.y=this.y0-this.con*f*Math.cos(e-this.long0),n):(Math.abs(this.sinlat0)<Lt?(s=2*this.a*this.k0/(1+u*Math.cos(m)),n.y=s*o):(s=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*o+this.cosX0*u*Math.cos(m))),n.y=s*(this.cosX0*o-this.sinX0*u*Math.cos(m))+this.y0),n.x=s*u*Math.sin(m)+this.x0,n))}function K8(n){n.x-=this.x0,n.y-=this.y0;var e,t,r,i,s,a=Math.sqrt(n.x*n.x+n.y*n.y);if(this.sphere){var o=2*Math.atan(a/(2*this.a*this.k0));return e=this.long0,t=this.lat0,a<=Lt?(n.x=e,n.y=t,n):(t=Math.asin(Math.cos(o)*this.sinlat0+n.y*Math.sin(o)*this.coslat0/a),Math.abs(this.coslat0)<Lt?this.lat0>0?e=Vt(this.long0+Math.atan2(n.x,-1*n.y),this.over):e=Vt(this.long0+Math.atan2(n.x,n.y),this.over):e=Vt(this.long0+Math.atan2(n.x*Math.sin(o),a*this.coslat0*Math.cos(o)-n.y*this.sinlat0*Math.sin(o)),this.over),n.x=e,n.y=t,n)}else if(Math.abs(this.coslat0)<=Lt){if(a<=Lt)return t=this.lat0,e=this.long0,n.x=e,n.y=t,n;n.x*=this.con,n.y*=this.con,r=a*this.cons/(2*this.a*this.k0),t=this.con*Kp(this.e,r),e=this.con*Vt(this.con*this.long0+Math.atan2(n.x,-1*n.y),this.over)}else i=2*Math.atan(a*this.cosX0/(2*this.a*this.k0*this.ms1)),e=this.long0,a<=Lt?s=this.X0:(s=Math.asin(Math.cos(i)*this.sinX0+n.y*Math.sin(i)*this.cosX0/a),e=Vt(this.long0+Math.atan2(n.x*Math.sin(i),a*this.cosX0*Math.cos(i)-n.y*this.sinX0*Math.sin(i)),this.over)),t=-1*Kp(this.e,Math.tan(.5*(_t+s)));return n.x=e,n.y=t,n}var Q8=["stere","Stereographic_South_Pole","Polar_Stereographic_variant_A","Polar_Stereographic_variant_B","Polar_Stereographic"];const $8={init:Z8,forward:J8,inverse:K8,names:Q8,ssfn_:eS};function eO(){var n=this.lat0;this.lambda0=this.long0;var e=Math.sin(n),t=this.a,r=this.rf,i=1/r,s=2*i-Math.pow(i,2),a=this.e=Math.sqrt(s);this.R=this.k0*t*Math.sqrt(1-s)/(1-s*Math.pow(e,2)),this.alpha=Math.sqrt(1+s/(1-s)*Math.pow(Math.cos(n),4)),this.b0=Math.asin(e/this.alpha);var o=Math.log(Math.tan(Math.PI/4+this.b0/2)),u=Math.log(Math.tan(Math.PI/4+n/2)),c=Math.log((1+a*e)/(1-a*e));this.K=o-this.alpha*u+this.alpha*a/2*c}function tO(n){var e=Math.log(Math.tan(Math.PI/4-n.y/2)),t=this.e/2*Math.log((1+this.e*Math.sin(n.y))/(1-this.e*Math.sin(n.y))),r=-this.alpha*(e+t)+this.K,i=2*(Math.atan(Math.exp(r))-Math.PI/4),s=this.alpha*(n.x-this.lambda0),a=Math.atan(Math.sin(s)/(Math.sin(this.b0)*Math.tan(i)+Math.cos(this.b0)*Math.cos(s))),o=Math.asin(Math.cos(this.b0)*Math.sin(i)-Math.sin(this.b0)*Math.cos(i)*Math.cos(s));return n.y=this.R/2*Math.log((1+Math.sin(o))/(1-Math.sin(o)))+this.y0,n.x=this.R*a+this.x0,n}function nO(n){for(var e=n.x-this.x0,t=n.y-this.y0,r=e/this.R,i=2*(Math.atan(Math.exp(t/this.R))-Math.PI/4),s=Math.asin(Math.cos(this.b0)*Math.sin(i)+Math.sin(this.b0)*Math.cos(i)*Math.cos(r)),a=Math.atan(Math.sin(r)/(Math.cos(this.b0)*Math.cos(r)-Math.sin(this.b0)*Math.tan(i))),o=this.lambda0+a/this.alpha,u=0,c=s,f=-1e3,m=0;Math.abs(c-f)>1e-7;){if(++m>20)return;u=1/this.alpha*(Math.log(Math.tan(Math.PI/4+s/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(c))/2)),f=c,c=2*Math.atan(Math.exp(u))-Math.PI/2}return n.x=o,n.y=c,n}var iO=["somerc"];const rO={init:eO,forward:tO,inverse:nO,names:iO};var yf=1e-7;function sO(n){var e=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_variant_A","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],t=typeof n.projName=="object"?Object.keys(n.projName)[0]:n.projName;return"no_uoff"in n||"no_off"in n||e.indexOf(t)!==-1||e.indexOf(yT(t))!==-1}function aO(){var n,e,t,r,i,s,a,o,u,c,f=0,m,g=0,y=0,_=0,E=0,x=0,S=0;this.no_off=sO(this),this.no_rot="no_rot"in this;var T=!1;"alpha"in this&&(T=!0);var A=!1;if("rectified_grid_angle"in this&&(A=!0),T&&(S=this.alpha),A&&(f=this.rectified_grid_angle),T||A)g=this.longc;else if(y=this.long1,E=this.lat1,_=this.long2,x=this.lat2,Math.abs(E-x)<=yf||(n=Math.abs(E))<=yf||Math.abs(n-_t)<=yf||Math.abs(Math.abs(this.lat0)-_t)<=yf||Math.abs(Math.abs(x)-_t)<=yf)throw new Error;var P=1-this.es;e=Math.sqrt(P),Math.abs(this.lat0)>Lt?(o=Math.sin(this.lat0),t=Math.cos(this.lat0),n=1-this.es*o*o,this.B=t*t,this.B=Math.sqrt(1+this.es*this.B*this.B/P),this.A=this.B*this.k0*e/n,r=this.B*e/(t*Math.sqrt(n)),i=r*r-1,i<=0?i=0:(i=Math.sqrt(i),this.lat0<0&&(i=-i)),this.E=i+=r,this.E*=Math.pow(co(this.e,this.lat0,o),this.B)):(this.B=1/e,this.A=this.k0,this.E=r=i=1),T||A?(T?(m=Math.asin(Math.sin(S)/r),A||(f=S)):(m=f,S=Math.asin(r*Math.sin(m))),this.lam0=g-Math.asin(.5*(i-1/i)*Math.tan(m))/this.B):(s=Math.pow(co(this.e,E,Math.sin(E)),this.B),a=Math.pow(co(this.e,x,Math.sin(x)),this.B),i=this.E/s,u=(a-s)/(a+s),c=this.E*this.E,c=(c-a*s)/(c+a*s),n=y-_,n<-Math.PI?_-=Zp:n>Math.PI&&(_+=Zp),this.lam0=Vt(.5*(y+_)-Math.atan(c*Math.tan(.5*this.B*(y-_))/u)/this.B,this.over),m=Math.atan(2*Math.sin(this.B*Vt(y-this.lam0,this.over))/(i-1/i)),f=S=Math.asin(r*Math.sin(m))),this.singam=Math.sin(m),this.cosgam=Math.cos(m),this.sinrot=Math.sin(f),this.cosrot=Math.cos(f),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(r*r-1)/Math.cos(S))),this.lat0<0&&(this.u_0=-this.u_0)),i=.5*m,this.v_pole_n=this.ArB*Math.log(Math.tan(Zn-i)),this.v_pole_s=this.ArB*Math.log(Math.tan(Zn+i))}function oO(n){var e={},t,r,i,s,a,o,u,c;if(n.x=n.x-this.lam0,Math.abs(Math.abs(n.y)-_t)>Lt){if(a=this.E/Math.pow(co(this.e,n.y,Math.sin(n.y)),this.B),o=1/a,t=.5*(a-o),r=.5*(a+o),s=Math.sin(this.B*n.x),i=(t*this.singam-s*this.cosgam)/r,Math.abs(Math.abs(i)-1)<Lt)throw new Error;c=.5*this.ArB*Math.log((1-i)/(1+i)),o=Math.cos(this.B*n.x),Math.abs(o)<yf?u=this.A*n.x:u=this.ArB*Math.atan2(t*this.cosgam+s*this.singam,o)}else c=n.y>0?this.v_pole_n:this.v_pole_s,u=this.ArB*n.y;return this.no_rot?(e.x=u,e.y=c):(u-=this.u_0,e.x=c*this.cosrot+u*this.sinrot,e.y=u*this.cosrot-c*this.sinrot),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e}function lO(n){var e,t,r,i,s,a,o,u={};if(n.x=(n.x-this.x0)*(1/this.a),n.y=(n.y-this.y0)*(1/this.a),this.no_rot?(t=n.y,e=n.x):(t=n.x*this.cosrot-n.y*this.sinrot,e=n.y*this.cosrot+n.x*this.sinrot+this.u_0),r=Math.exp(-this.BrA*t),i=.5*(r-1/r),s=.5*(r+1/r),a=Math.sin(this.BrA*e),o=(a*this.cosgam+i*this.singam)/s,Math.abs(Math.abs(o)-1)<Lt)u.x=0,u.y=o<0?-_t:_t;else{if(u.y=this.E/Math.sqrt((1+o)/(1-o)),u.y=Kp(this.e,Math.pow(u.y,1/this.B)),u.y===1/0)throw new Error;u.x=-this.rB*Math.atan2(i*this.cosgam-a*this.singam,Math.cos(this.BrA*e))}return u.x+=this.lam0,u}var uO=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_variant_A","Hotine_Oblique_Mercator_Variant_B","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"];const cO={init:aO,forward:oO,inverse:lO,names:uO};function hO(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<Lt)){var n=this.b/this.a;this.e=Math.sqrt(1-n*n);var e=Math.sin(this.lat1),t=Math.cos(this.lat1),r=Bo(this.e,e,t),i=co(this.e,this.lat1,e),s=Math.sin(this.lat2),a=Math.cos(this.lat2),o=Bo(this.e,s,a),u=co(this.e,this.lat2,s),c=Math.abs(Math.abs(this.lat0)-_t)<Lt?0:co(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>Lt?this.ns=Math.log(r/o)/Math.log(i/u):this.ns=e,isNaN(this.ns)&&(this.ns=e),this.f0=r/(this.ns*Math.pow(i,this.ns)),this.rh=this.a*this.f0*Math.pow(c,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function fO(n){var e=n.x,t=n.y;Math.abs(2*Math.abs(t)-Math.PI)<=Lt&&(t=g0(t)*(_t-2*Lt));var r=Math.abs(Math.abs(t)-_t),i,s;if(r>Lt)i=co(this.e,t,Math.sin(t)),s=this.a*this.f0*Math.pow(i,this.ns);else{if(r=t*this.ns,r<=0)return null;s=0}var a=this.ns*Vt(e-this.long0,this.over);return n.x=this.k0*(s*Math.sin(a))+this.x0,n.y=this.k0*(this.rh-s*Math.cos(a))+this.y0,n}function dO(n){var e,t,r,i,s,a=(n.x-this.x0)/this.k0,o=this.rh-(n.y-this.y0)/this.k0;this.ns>0?(e=Math.sqrt(a*a+o*o),t=1):(e=-Math.sqrt(a*a+o*o),t=-1);var u=0;if(e!==0&&(u=Math.atan2(t*a,t*o)),e!==0||this.ns>0){if(t=1/this.ns,r=Math.pow(e/(this.a*this.f0),t),i=Kp(this.e,r),i===-9999)return null}else i=-_t;return s=Vt(u/this.ns+this.long0,this.over),n.x=s,n.y=i,n}var pO=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"];const mO={init:hO,forward:fO,inverse:dO,names:pO};function gO(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.7417649320975901-.308341501185665),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function vO(n){var e,t,r,i,s,a,o,u=n.x,c=n.y,f=Vt(u-this.long0,this.over);return e=Math.pow((1+this.e*Math.sin(c))/(1-this.e*Math.sin(c)),this.alfa*this.e/2),t=2*(Math.atan(this.k*Math.pow(Math.tan(c/2+this.s45),this.alfa)/e)-this.s45),r=-f*this.alfa,i=Math.asin(Math.cos(this.ad)*Math.sin(t)+Math.sin(this.ad)*Math.cos(t)*Math.cos(r)),s=Math.asin(Math.cos(t)*Math.sin(r)/Math.cos(i)),a=this.n*s,o=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(i/2+this.s45),this.n),n.y=o*Math.cos(a)/1,n.x=o*Math.sin(a)/1,this.czech||(n.y*=-1,n.x*=-1),n}function yO(n){var e,t,r,i,s,a,o,u,c=n.x;n.x=n.y,n.y=c,this.czech||(n.y*=-1,n.x*=-1),a=Math.sqrt(n.x*n.x+n.y*n.y),s=Math.atan2(n.y,n.x),i=s/Math.sin(this.s0),r=2*(Math.atan(Math.pow(this.ro0/a,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),e=Math.asin(Math.cos(this.ad)*Math.sin(r)-Math.sin(this.ad)*Math.cos(r)*Math.cos(i)),t=Math.asin(Math.cos(r)*Math.sin(i)/Math.cos(e)),n.x=this.long0-t/this.alfa,o=e,u=0;var f=0;do n.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(e/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(o))/(1-this.e*Math.sin(o)),this.e/2))-this.s45),Math.abs(o-n.y)<1e-10&&(u=1),o=n.y,f+=1;while(u===0&&f<15);return f>=15?null:n}var _O=["Krovak","krovak"];const xO={init:gO,forward:vO,inverse:yO,names:_O};function Ss(n,e,t,r,i){return n*i-e*Math.sin(2*i)+t*Math.sin(4*i)-r*Math.sin(6*i)}function v0(n){return 1-.25*n*(1+n/16*(3+1.25*n))}function y0(n){return .375*n*(1+.25*n*(1+.46875*n))}function _0(n){return .05859375*n*n*(1+.75*n)}function x0(n){return n*n*n*(35/3072)}function tS(n,e,t){var r=e*t;return n/Math.sqrt(1-r*r)}function Uu(n){return Math.abs(n)<_t?n:n-g0(n)*Math.PI}function bv(n,e,t,r,i){var s,a;s=n/e;for(var o=0;o<15;o++)if(a=(n-(e*s-t*Math.sin(2*s)+r*Math.sin(4*s)-i*Math.sin(6*s)))/(e-2*t*Math.cos(2*s)+4*r*Math.cos(4*s)-6*i*Math.cos(6*s)),s+=a,Math.abs(a)<=1e-10)return s;return NaN}function SO(){this.sphere||(this.e0=v0(this.es),this.e1=y0(this.es),this.e2=_0(this.es),this.e3=x0(this.es),this.ml0=this.a*Ss(this.e0,this.e1,this.e2,this.e3,this.lat0))}function MO(n){var e,t,r=n.x,i=n.y;if(r=Vt(r-this.long0,this.over),this.sphere)e=this.a*Math.asin(Math.cos(i)*Math.sin(r)),t=this.a*(Math.atan2(Math.tan(i),Math.cos(r))-this.lat0);else{var s=Math.sin(i),a=Math.cos(i),o=tS(this.a,this.e,s),u=Math.tan(i)*Math.tan(i),c=r*Math.cos(i),f=c*c,m=this.es*a*a/(1-this.es),g=this.a*Ss(this.e0,this.e1,this.e2,this.e3,i);e=o*c*(1-f*u*(1/6-(8-u+8*m)*f/120)),t=g-this.ml0+o*s/a*f*(.5+(5-u+6*m)*f/24)}return n.x=e+this.x0,n.y=t+this.y0,n}function wO(n){n.x-=this.x0,n.y-=this.y0;var e=n.x/this.a,t=n.y/this.a,r,i;if(this.sphere){var s=t+this.lat0;r=Math.asin(Math.sin(s)*Math.cos(e)),i=Math.atan2(Math.tan(e),Math.cos(s))}else{var a=this.ml0/this.a+t,o=bv(a,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(o)-_t)<=Lt)return n.x=this.long0,n.y=_t,t<0&&(n.y*=-1),n;var u=tS(this.a,this.e,Math.sin(o)),c=u*u*u/this.a/this.a*(1-this.es),f=Math.pow(Math.tan(o),2),m=e*this.a/u,g=m*m;r=o-u*Math.tan(o)/c*m*m*(.5-(1+3*f)*m*m/24),i=m*(1-g*(f/3+(1+3*f)*f*g/15))/Math.cos(o)}return n.x=Vt(i+this.long0,this.over),n.y=Uu(r),n}var EO=["Cassini","Cassini_Soldner","cass"];const TO={init:SO,forward:MO,inverse:wO,names:EO};function Mu(n,e){var t;return n>1e-7?(t=n*e,(1-n*n)*(e/(1-t*t)-.5/n*Math.log((1-t)/(1+t)))):2*e}var O_=1,k_=2,z_=3,Tg=4;function bO(){var n=Math.abs(this.lat0);if(Math.abs(n-_t)<Lt?this.mode=this.lat0<0?O_:k_:Math.abs(n)<Lt?this.mode=z_:this.mode=Tg,this.es>0){var e;switch(this.qp=Mu(this.e,1),this.mmf=.5/(1-this.es),this.apa=UO(this.es),this.mode){case k_:this.dd=1;break;case O_:this.dd=1;break;case z_:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case Tg:this.rq=Math.sqrt(.5*this.qp),e=Math.sin(this.lat0),this.sinb1=Mu(this.e,e)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*e*e)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd;break}}else this.mode===Tg&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function AO(n){var e,t,r,i,s,a,o,u,c,f,m=n.x,g=n.y;if(m=Vt(m-this.long0,this.over),this.sphere){if(s=Math.sin(g),f=Math.cos(g),r=Math.cos(m),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(t=this.mode===this.EQUIT?1+f*r:1+this.sinph0*s+this.cosph0*f*r,t<=Lt)return null;t=Math.sqrt(2/t),e=t*f*Math.sin(m),t*=this.mode===this.EQUIT?s:this.cosph0*s-this.sinph0*f*r}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(r=-r),Math.abs(g+this.lat0)<Lt)return null;t=Zn-g*.5,t=2*(this.mode===this.S_POLE?Math.cos(t):Math.sin(t)),e=t*Math.sin(m),t*=r}}else{switch(o=0,u=0,c=0,r=Math.cos(m),i=Math.sin(m),s=Math.sin(g),a=Mu(this.e,s),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(o=a/this.qp,u=Math.sqrt(1-o*o)),this.mode){case this.OBLIQ:c=1+this.sinb1*o+this.cosb1*u*r;break;case this.EQUIT:c=1+u*r;break;case this.N_POLE:c=_t+g,a=this.qp-a;break;case this.S_POLE:c=g-_t,a=this.qp+a;break}if(Math.abs(c)<Lt)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:c=Math.sqrt(2/c),this.mode===this.OBLIQ?t=this.ymf*c*(this.cosb1*o-this.sinb1*u*r):t=(c=Math.sqrt(2/(1+u*r)))*o*this.ymf,e=this.xmf*c*u*i;break;case this.N_POLE:case this.S_POLE:a>=0?(e=(c=Math.sqrt(a))*i,t=r*(this.mode===this.S_POLE?c:-c)):e=t=0;break}}return n.x=this.a*e+this.x0,n.y=this.a*t+this.y0,n}function CO(n){n.x-=this.x0,n.y-=this.y0;var e=n.x/this.a,t=n.y/this.a,r,i,s,a,o,u,c;if(this.sphere){var f=0,m,g=0;if(m=Math.sqrt(e*e+t*t),i=m*.5,i>1)return null;switch(i=2*Math.asin(i),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(g=Math.sin(i),f=Math.cos(i)),this.mode){case this.EQUIT:i=Math.abs(m)<=Lt?0:Math.asin(t*g/m),e*=g,t=f*m;break;case this.OBLIQ:i=Math.abs(m)<=Lt?this.lat0:Math.asin(f*this.sinph0+t*g*this.cosph0/m),e*=g*this.cosph0,t=(f-Math.sin(i)*this.sinph0)*m;break;case this.N_POLE:t=-t,i=_t-i;break;case this.S_POLE:i-=_t;break}r=t===0&&(this.mode===this.EQUIT||this.mode===this.OBLIQ)?0:Math.atan2(e,t)}else{if(c=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(e/=this.dd,t*=this.dd,u=Math.sqrt(e*e+t*t),u<Lt)return n.x=this.long0,n.y=this.lat0,n;a=2*Math.asin(.5*u/this.rq),s=Math.cos(a),e*=a=Math.sin(a),this.mode===this.OBLIQ?(c=s*this.sinb1+t*a*this.cosb1/u,o=this.qp*c,t=u*this.cosb1*s-t*this.sinb1*a):(c=t*a/u,o=this.qp*c,t=u*s)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(t=-t),o=e*e+t*t,!o)return n.x=this.long0,n.y=this.lat0,n;c=1-o/this.qp,this.mode===this.S_POLE&&(c=-c)}r=Math.atan2(e,t),i=FO(Math.asin(c),this.apa)}return n.x=Vt(this.long0+r,this.over),n.y=i,n}var PO=.3333333333333333,RO=.17222222222222222,IO=.10257936507936508,LO=.06388888888888888,NO=.0664021164021164,DO=.016415012942191543;function UO(n){var e,t=[];return t[0]=n*PO,e=n*n,t[0]+=e*RO,t[1]=e*LO,e*=n,t[0]+=e*IO,t[1]+=e*NO,t[2]=e*DO,t}function FO(n,e){var t=n+n;return n+e[0]*Math.sin(t)+e[1]*Math.sin(t+t)+e[2]*Math.sin(t+t+t)}var OO=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"];const kO={init:bO,forward:AO,inverse:CO,names:OO,S_POLE:O_,N_POLE:k_,EQUIT:z_,OBLIQ:Tg};function Pu(n){return Math.abs(n)>1&&(n=n>1?1:-1),Math.asin(n)}function zO(){Math.abs(this.lat1+this.lat2)<Lt||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=Bo(this.e3,this.sin_po,this.cos_po),this.qs1=Mu(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=Bo(this.e3,this.sin_po,this.cos_po),this.qs2=Mu(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=Mu(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>Lt?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function BO(n){var e=n.x,t=n.y;this.sin_phi=Math.sin(t),this.cos_phi=Math.cos(t);var r=Mu(this.e3,this.sin_phi),i=this.a*Math.sqrt(this.c-this.ns0*r)/this.ns0,s=this.ns0*Vt(e-this.long0,this.over),a=i*Math.sin(s)+this.x0,o=this.rh-i*Math.cos(s)+this.y0;return n.x=a,n.y=o,n}function GO(n){var e,t,r,i,s,a;return n.x-=this.x0,n.y=this.rh-n.y+this.y0,this.ns0>=0?(e=Math.sqrt(n.x*n.x+n.y*n.y),r=1):(e=-Math.sqrt(n.x*n.x+n.y*n.y),r=-1),i=0,e!==0&&(i=Math.atan2(r*n.x,r*n.y)),r=e*this.ns0/this.a,this.sphere?a=Math.asin((this.c-r*r)/(2*this.ns0)):(t=(this.c-r*r)/this.ns0,a=this.phi1z(this.e3,t)),s=Vt(i/this.ns0+this.long0,this.over),n.x=s,n.y=a,n}function VO(n,e){var t,r,i,s,a,o=Pu(.5*e);if(n<Lt)return o;for(var u=n*n,c=1;c<=25;c++)if(t=Math.sin(o),r=Math.cos(o),i=n*t,s=1-i*i,a=.5*s*s/r*(e/(1-u)-t/s+.5/n*Math.log((1-i)/(1+i))),o=o+a,Math.abs(a)<=1e-7)return o;return null}var HO=["Albers_Conic_Equal_Area","Albers_Equal_Area","Albers","aea"];const WO={init:zO,forward:BO,inverse:GO,names:HO,phi1z:VO};function jO(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function XO(n){var e,t,r,i,s,a,o,u,c=n.x,f=n.y;return r=Vt(c-this.long0,this.over),e=Math.sin(f),t=Math.cos(f),i=Math.cos(r),a=this.sin_p14*e+this.cos_p14*t*i,s=1,a>0||Math.abs(a)<=Lt?(o=this.x0+this.a*s*t*Math.sin(r)/a,u=this.y0+this.a*s*(this.cos_p14*e-this.sin_p14*t*i)/a):(o=this.x0+this.infinity_dist*t*Math.sin(r),u=this.y0+this.infinity_dist*(this.cos_p14*e-this.sin_p14*t*i)),n.x=o,n.y=u,n}function qO(n){var e,t,r,i,s,a;return n.x=(n.x-this.x0)/this.a,n.y=(n.y-this.y0)/this.a,n.x/=this.k0,n.y/=this.k0,(e=Math.sqrt(n.x*n.x+n.y*n.y))?(i=Math.atan2(e,this.rc),t=Math.sin(i),r=Math.cos(i),a=Pu(r*this.sin_p14+n.y*t*this.cos_p14/e),s=Math.atan2(n.x*t,e*this.cos_p14*r-n.y*this.sin_p14*t),s=Vt(this.long0+s,this.over)):(a=this.phic0,s=0),n.x=s,n.y=a,n}var YO=["gnom"];const ZO={init:jO,forward:XO,inverse:qO,names:YO};function JO(n,e){var t=1-(1-n*n)/(2*n)*Math.log((1-n)/(1+n));if(Math.abs(Math.abs(e)-t)<1e-6)return e<0?-1*_t:_t;for(var r=Math.asin(.5*e),i,s,a,o,u=0;u<30;u++)if(s=Math.sin(r),a=Math.cos(r),o=n*s,i=Math.pow(1-o*o,2)/(2*a)*(e/(1-n*n)-s/(1-o*o)+.5/n*Math.log((1-o)/(1+o))),r+=i,Math.abs(i)<=1e-10)return r;return NaN}function KO(){this.sphere||(this.k0=Bo(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function QO(n){var e=n.x,t=n.y,r,i,s=Vt(e-this.long0,this.over);if(this.sphere)r=this.x0+this.a*s*Math.cos(this.lat_ts),i=this.y0+this.a*Math.sin(t)/Math.cos(this.lat_ts);else{var a=Mu(this.e,Math.sin(t));r=this.x0+this.a*this.k0*s,i=this.y0+this.a*a*.5/this.k0}return n.x=r,n.y=i,n}function $O(n){n.x-=this.x0,n.y-=this.y0;var e,t;return this.sphere?(e=Vt(this.long0+n.x/this.a/Math.cos(this.lat_ts),this.over),t=Math.asin(n.y/this.a*Math.cos(this.lat_ts))):(t=JO(this.e,2*n.y*this.k0/this.a),e=Vt(this.long0+n.x/(this.a*this.k0),this.over)),n.x=e,n.y=t,n}var e6=["cea"];const t6={init:KO,forward:QO,inverse:$O,names:e6};function n6(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function i6(n){var e=n.x,t=n.y,r=Vt(e-this.long0,this.over),i=Uu(t-this.lat0);return n.x=this.x0+this.a*r*this.rc,n.y=this.y0+this.a*i,n}function r6(n){var e=n.x,t=n.y;return n.x=Vt(this.long0+(e-this.x0)/(this.a*this.rc),this.over),n.y=Uu(this.lat0+(t-this.y0)/this.a),n}var s6=["Equirectangular","Equidistant_Cylindrical","Equidistant_Cylindrical_Spherical","eqc"];const a6={init:n6,forward:i6,inverse:r6,names:s6};var ww=20;function o6(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=v0(this.es),this.e1=y0(this.es),this.e2=_0(this.es),this.e3=x0(this.es),this.ml0=this.a*Ss(this.e0,this.e1,this.e2,this.e3,this.lat0)}function l6(n){var e=n.x,t=n.y,r,i,s,a=Vt(e-this.long0,this.over);if(s=a*Math.sin(t),this.sphere)Math.abs(t)<=Lt?(r=this.a*a,i=-1*this.a*this.lat0):(r=this.a*Math.sin(s)/Math.tan(t),i=this.a*(Uu(t-this.lat0)+(1-Math.cos(s))/Math.tan(t)));else if(Math.abs(t)<=Lt)r=this.a*a,i=-1*this.ml0;else{var o=tS(this.a,this.e,Math.sin(t))/Math.tan(t);r=o*Math.sin(s),i=this.a*Ss(this.e0,this.e1,this.e2,this.e3,t)-this.ml0+o*(1-Math.cos(s))}return n.x=r+this.x0,n.y=i+this.y0,n}function u6(n){var e,t,r,i,s,a,o,u,c;if(r=n.x-this.x0,i=n.y-this.y0,this.sphere)if(Math.abs(i+this.a*this.lat0)<=Lt)e=Vt(r/this.a+this.long0,this.over),t=0;else{a=this.lat0+i/this.a,o=r*r/this.a/this.a+a*a,u=a;var f;for(s=ww;s;--s)if(f=Math.tan(u),c=-1*(a*(u*f+1)-u-.5*(u*u+o)*f)/((u-a)/f-1),u+=c,Math.abs(c)<=Lt){t=u;break}e=Vt(this.long0+Math.asin(r*Math.tan(u)/this.a)/Math.sin(t),this.over)}else if(Math.abs(i+this.ml0)<=Lt)t=0,e=Vt(this.long0+r/this.a,this.over);else{a=(this.ml0+i)/this.a,o=r*r/this.a/this.a+a*a,u=a;var m,g,y,_,E;for(s=ww;s;--s)if(E=this.e*Math.sin(u),m=Math.sqrt(1-E*E)*Math.tan(u),g=this.a*Ss(this.e0,this.e1,this.e2,this.e3,u),y=this.e0-2*this.e1*Math.cos(2*u)+4*this.e2*Math.cos(4*u)-6*this.e3*Math.cos(6*u),_=g/this.a,c=(a*(m*_+1)-_-.5*m*(_*_+o))/(this.es*Math.sin(2*u)*(_*_+o-2*a*_)/(4*m)+(a-_)*(m*y-2/Math.sin(2*u))-y),u-=c,Math.abs(c)<=Lt){t=u;break}m=Math.sqrt(1-this.es*Math.pow(Math.sin(t),2))*Math.tan(t),e=Vt(this.long0+Math.asin(r*m/this.a)/Math.sin(t),this.over)}return n.x=e,n.y=t,n}var c6=["Polyconic","American_Polyconic","poly"];const h6={init:o6,forward:l6,inverse:u6,names:c6};function f6(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function d6(n){var e,t=n.x,r=n.y,i=r-this.lat0,s=t-this.long0,a=i/bp*1e-5,o=s,u=1,c=0;for(e=1;e<=10;e++)u=u*a,c=c+this.A[e]*u;var f=c,m=o,g=1,y=0,_,E,x=0,S=0;for(e=1;e<=6;e++)_=g*f-y*m,E=y*f+g*m,g=_,y=E,x=x+this.B_re[e]*g-this.B_im[e]*y,S=S+this.B_im[e]*g+this.B_re[e]*y;return n.x=S*this.a+this.x0,n.y=x*this.a+this.y0,n}function p6(n){var e,t=n.x,r=n.y,i=t-this.x0,s=r-this.y0,a=s/this.a,o=i/this.a,u=1,c=0,f,m,g=0,y=0;for(e=1;e<=6;e++)f=u*a-c*o,m=c*a+u*o,u=f,c=m,g=g+this.C_re[e]*u-this.C_im[e]*c,y=y+this.C_im[e]*u+this.C_re[e]*c;for(var _=0;_<this.iterations;_++){var E=g,x=y,S,T,A=a,P=o;for(e=2;e<=6;e++)S=E*g-x*y,T=x*g+E*y,E=S,x=T,A=A+(e-1)*(this.B_re[e]*E-this.B_im[e]*x),P=P+(e-1)*(this.B_im[e]*E+this.B_re[e]*x);E=1,x=0;var L=this.B_re[1],D=this.B_im[1];for(e=2;e<=6;e++)S=E*g-x*y,T=x*g+E*y,E=S,x=T,L=L+e*(this.B_re[e]*E-this.B_im[e]*x),D=D+e*(this.B_im[e]*E+this.B_re[e]*x);var F=L*L+D*D;g=(A*L+P*D)/F,y=(P*L-A*D)/F}var k=g,R=y,U=1,V=0;for(e=1;e<=9;e++)U=U*k,V=V+this.D[e]*U;var H=this.lat0+V*bp*1e5,J=this.long0+R;return n.x=J,n.y=H,n}var m6=["New_Zealand_Map_Grid","nzmg"];const g6={init:f6,forward:d6,inverse:p6,names:m6};function v6(){}function y6(n){var e=n.x,t=n.y,r=Vt(e-this.long0,this.over),i=this.x0+this.a*r,s=this.y0+this.a*Math.log(Math.tan(Math.PI/4+t/2.5))*1.25;return n.x=i,n.y=s,n}function _6(n){n.x-=this.x0,n.y-=this.y0;var e=Vt(this.long0+n.x/this.a,this.over),t=2.5*(Math.atan(Math.exp(.8*n.y/this.a))-Math.PI/4);return n.x=e,n.y=t,n}var x6=["Miller_Cylindrical","mill"];const S6={init:v6,forward:y6,inverse:_6,names:x6};var M6=20;function w6(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=Zx(this.es)}function E6(n){var e,t,r=n.x,i=n.y;if(r=Vt(r-this.long0,this.over),this.sphere){if(!this.m)i=this.n!==1?Math.asin(this.n*Math.sin(i)):i;else for(var s=this.n*Math.sin(i),a=M6;a;--a){var o=(this.m*i+Math.sin(i)-s)/(this.m+Math.cos(i));if(i-=o,Math.abs(o)<Lt)break}e=this.a*this.C_x*r*(this.m+Math.cos(i)),t=this.a*this.C_y*i}else{var u=Math.sin(i),c=Math.cos(i);t=this.a*Zf(i,u,c,this.en),e=this.a*r*c/Math.sqrt(1-this.es*u*u)}return n.x=e,n.y=t,n}function T6(n){var e,t,r,i;return n.x-=this.x0,r=n.x/this.a,n.y-=this.y0,e=n.y/this.a,this.sphere?(e/=this.C_y,r=r/(this.C_x*(this.m+Math.cos(e))),this.m?e=Pu((this.m*e+Math.sin(e))/this.n):this.n!==1&&(e=Pu(Math.sin(e)/this.n)),r=Vt(r+this.long0,this.over),e=Uu(e)):(e=Jx(n.y/this.a,this.es,this.en),i=Math.abs(e),i<_t?(i=Math.sin(e),t=this.long0+n.x*Math.sqrt(1-this.es*i*i)/(this.a*Math.cos(e)),r=Vt(t,this.over)):i-Lt<_t&&(r=this.long0)),n.x=r,n.y=e,n}var b6=["Sinusoidal","sinu"];const A6={init:w6,forward:E6,inverse:T6,names:b6};function C6(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0}function P6(n){for(var e=n.x,t=n.y,r=Vt(e-this.long0,this.over),i=t,s=Math.PI*Math.sin(t);;){var a=-(i+Math.sin(i)-s)/(1+Math.cos(i));if(i+=a,Math.abs(a)<Lt)break}i/=2,Math.PI/2-Math.abs(t)<Lt&&(r=0);var o=.900316316158*this.a*r*Math.cos(i)+this.x0,u=1.4142135623731*this.a*Math.sin(i)+this.y0;return n.x=o,n.y=u,n}function R6(n){var e,t;n.x-=this.x0,n.y-=this.y0,t=n.y/(1.4142135623731*this.a),Math.abs(t)>.999999999999&&(t=.999999999999),e=Math.asin(t);var r=Vt(this.long0+n.x/(.900316316158*this.a*Math.cos(e)),this.over);r<-Math.PI&&(r=-Math.PI),r>Math.PI&&(r=Math.PI),t=(2*e+Math.sin(2*e))/Math.PI,Math.abs(t)>1&&(t=1);var i=Math.asin(t);return n.x=r,n.y=i,n}var I6=["Mollweide","moll"];const L6={init:C6,forward:P6,inverse:R6,names:I6};function N6(){Math.abs(this.lat1+this.lat2)<Lt||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=v0(this.es),this.e1=y0(this.es),this.e2=_0(this.es),this.e3=x0(this.es),this.sin_phi=Math.sin(this.lat1),this.cos_phi=Math.cos(this.lat1),this.ms1=Bo(this.e,this.sin_phi,this.cos_phi),this.ml1=Ss(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<Lt?this.ns=this.sin_phi:(this.sin_phi=Math.sin(this.lat2),this.cos_phi=Math.cos(this.lat2),this.ms2=Bo(this.e,this.sin_phi,this.cos_phi),this.ml2=Ss(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=Ss(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function D6(n){var e=n.x,t=n.y,r;if(this.sphere)r=this.a*(this.g-t);else{var i=Ss(this.e0,this.e1,this.e2,this.e3,t);r=this.a*(this.g-i)}var s=this.ns*Vt(e-this.long0,this.over),a=this.x0+r*Math.sin(s),o=this.y0+this.rh-r*Math.cos(s);return n.x=a,n.y=o,n}function U6(n){n.x-=this.x0,n.y=this.rh-n.y+this.y0;var e,t,r,i;this.ns>=0?(t=Math.sqrt(n.x*n.x+n.y*n.y),e=1):(t=-Math.sqrt(n.x*n.x+n.y*n.y),e=-1);var s=0;if(t!==0&&(s=Math.atan2(e*n.x,e*n.y)),this.sphere)return i=Vt(this.long0+s/this.ns,this.over),r=Uu(this.g-t/this.a),n.x=i,n.y=r,n;var a=this.g-t/this.a;return r=bv(a,this.e0,this.e1,this.e2,this.e3),i=Vt(this.long0+s/this.ns,this.over),n.x=i,n.y=r,n}var F6=["Equidistant_Conic","eqdc"];const O6={init:N6,forward:D6,inverse:U6,names:F6};function k6(){this.R=this.a}function z6(n){var e=n.x,t=n.y,r=Vt(e-this.long0,this.over),i,s;Math.abs(t)<=Lt&&(i=this.x0+this.R*r,s=this.y0);var a=Pu(2*Math.abs(t/Math.PI));(Math.abs(r)<=Lt||Math.abs(Math.abs(t)-_t)<=Lt)&&(i=this.x0,t>=0?s=this.y0+Math.PI*this.R*Math.tan(.5*a):s=this.y0+Math.PI*this.R*-Math.tan(.5*a));var o=.5*Math.abs(Math.PI/r-r/Math.PI),u=o*o,c=Math.sin(a),f=Math.cos(a),m=f/(c+f-1),g=m*m,y=m*(2/c-1),_=y*y,E=Math.PI*this.R*(o*(m-_)+Math.sqrt(u*(m-_)*(m-_)-(_+u)*(g-_)))/(_+u);r<0&&(E=-E),i=this.x0+E;var x=u+m;return E=Math.PI*this.R*(y*x-o*Math.sqrt((_+u)*(u+1)-x*x))/(_+u),t>=0?s=this.y0+E:s=this.y0-E,n.x=i,n.y=s,n}function B6(n){var e,t,r,i,s,a,o,u,c,f,m,g,y;return n.x-=this.x0,n.y-=this.y0,m=Math.PI*this.R,r=n.x/m,i=n.y/m,s=r*r+i*i,a=-Math.abs(i)*(1+s),o=a-2*i*i+r*r,u=-2*a+1+2*i*i+s*s,y=i*i/u+(2*o*o*o/u/u/u-9*a*o/u/u)/27,c=(a-o*o/3/u)/u,f=2*Math.sqrt(-c/3),m=3*y/c/f,Math.abs(m)>1&&(m>=0?m=1:m=-1),g=Math.acos(m)/3,n.y>=0?t=(-f*Math.cos(g+Math.PI/3)-o/3/u)*Math.PI:t=-(-f*Math.cos(g+Math.PI/3)-o/3/u)*Math.PI,Math.abs(r)<Lt?e=this.long0:e=Vt(this.long0+Math.PI*(s-1+Math.sqrt(1+2*(r*r-i*i)+s*s))/2/r,this.over),n.x=e,n.y=t,n}var G6=["Van_der_Grinten_I","VanDerGrinten","Van_der_Grinten","vandg"];const V6={init:k6,forward:z6,inverse:B6,names:G6};function H6(n,e,t,r,i,s){const a=r-e,o=Math.atan((1-s)*Math.tan(n)),u=Math.atan((1-s)*Math.tan(t)),c=Math.sin(o),f=Math.cos(o),m=Math.sin(u),g=Math.cos(u);let y=a,_,E=100,x,S,T,A,P,L,D,F,k,R,U,V,H,J;do{if(x=Math.sin(y),S=Math.cos(y),T=Math.sqrt(g*x*(g*x)+(f*m-c*g*S)*(f*m-c*g*S)),T===0)return{azi1:0,s12:0};A=c*m+f*g*S,P=Math.atan2(T,A),L=f*g*x/T,D=1-L*L,F=D!==0?A-2*c*m/D:0,k=s/16*D*(4+s*(4-3*D)),_=y,y=a+(1-k)*s*L*(P+k*T*(F+k*A*(-1+2*F*F)))}while(Math.abs(y-_)>1e-12&&--E>0);return E===0?{azi1:NaN,s12:NaN}:(R=D*(i*i-i*(1-s)*(i*(1-s)))/(i*(1-s)*(i*(1-s))),U=1+R/16384*(4096+R*(-768+R*(320-175*R))),V=R/1024*(256+R*(-128+R*(74-47*R))),H=V*T*(F+V/4*(A*(-1+2*F*F)-V/6*F*(-3+4*T*T)*(-3+4*F*F))),J=i*(1-s)*U*(P-H),{azi1:Math.atan2(g*x,f*m-c*g*S),s12:J})}function W6(n,e,t,r,i,s){const a=Math.atan((1-s)*Math.tan(n)),o=Math.sin(a),u=Math.cos(a),c=Math.sin(t),f=Math.cos(t),m=Math.atan2(o,u*f),g=u*c,y=1-g*g,_=y*(i*i-i*(1-s)*(i*(1-s)))/(i*(1-s)*(i*(1-s))),E=1+_/16384*(4096+_*(-768+_*(320-175*_))),x=_/1024*(256+_*(-128+_*(74-47*_)));let S=r/(i*(1-s)*E),T,A=100,P,L,D,F;do P=Math.cos(2*m+S),L=Math.sin(S),D=Math.cos(S),F=x*L*(P+x/4*(D*(-1+2*P*P)-x/6*P*(-3+4*L*L)*(-3+4*P*P))),T=S,S=r/(i*(1-s)*E)+F;while(Math.abs(S-T)>1e-12&&--A>0);if(A===0)return{lat2:NaN,lon2:NaN};const k=o*L-u*D*f,R=Math.atan2(o*D+u*L*f,(1-s)*Math.sqrt(g*g+k*k)),U=Math.atan2(L*c,u*D-o*L*f),V=s/16*y*(4+s*(4-3*y)),H=U-(1-V)*s*g*(S+V*L*(P+V*D*(-1+2*P*P))),J=e+H;return{lat2:R,lon2:J}}function j6(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0),this.f=this.es/(1+Math.sqrt(1-this.es))}function X6(n){var e=n.x,t=n.y,r=Math.sin(n.y),i=Math.cos(n.y),s=Vt(e-this.long0,this.over),a,o,u,c,f,m,g,y,_,E,x;return this.sphere?Math.abs(this.sin_p12-1)<=Lt?(n.x=this.x0+this.a*(_t-t)*Math.sin(s),n.y=this.y0-this.a*(_t-t)*Math.cos(s),n):Math.abs(this.sin_p12+1)<=Lt?(n.x=this.x0+this.a*(_t+t)*Math.sin(s),n.y=this.y0+this.a*(_t+t)*Math.cos(s),n):(_=this.sin_p12*r+this.cos_p12*i*Math.cos(s),g=Math.acos(_),y=g?g/Math.sin(g):1,n.x=this.x0+this.a*y*i*Math.sin(s),n.y=this.y0+this.a*y*(this.cos_p12*r-this.sin_p12*i*Math.cos(s)),n):(a=v0(this.es),o=y0(this.es),u=_0(this.es),c=x0(this.es),Math.abs(this.sin_p12-1)<=Lt?(f=this.a*Ss(a,o,u,c,_t),m=this.a*Ss(a,o,u,c,t),n.x=this.x0+(f-m)*Math.sin(s),n.y=this.y0-(f-m)*Math.cos(s),n):Math.abs(this.sin_p12+1)<=Lt?(f=this.a*Ss(a,o,u,c,_t),m=this.a*Ss(a,o,u,c,t),n.x=this.x0+(f+m)*Math.sin(s),n.y=this.y0+(f+m)*Math.cos(s),n):Math.abs(e)<Lt&&Math.abs(t-this.lat0)<Lt?(n.x=n.y=0,n):(E=H6(this.lat0,this.long0,t,e,this.a,this.f),x=E.azi1,n.x=E.s12*Math.sin(x),n.y=E.s12*Math.cos(x),n))}function q6(n){n.x-=this.x0,n.y-=this.y0;var e,t,r,i,s,a,o,u,c,f,m,g,y,_,E,x;return this.sphere?(e=Math.sqrt(n.x*n.x+n.y*n.y),e>2*_t*this.a?void 0:(t=e/this.a,r=Math.sin(t),i=Math.cos(t),s=this.long0,Math.abs(e)<=Lt?a=this.lat0:(a=Pu(i*this.sin_p12+n.y*r*this.cos_p12/e),o=Math.abs(this.lat0)-_t,Math.abs(o)<=Lt?this.lat0>=0?s=Vt(this.long0+Math.atan2(n.x,-n.y),this.over):s=Vt(this.long0-Math.atan2(-n.x,n.y),this.over):s=Vt(this.long0+Math.atan2(n.x*r,e*this.cos_p12*i-n.y*this.sin_p12*r),this.over)),n.x=s,n.y=a,n)):(u=v0(this.es),c=y0(this.es),f=_0(this.es),m=x0(this.es),Math.abs(this.sin_p12-1)<=Lt?(g=this.a*Ss(u,c,f,m,_t),e=Math.sqrt(n.x*n.x+n.y*n.y),y=g-e,a=bv(y/this.a,u,c,f,m),s=Vt(this.long0+Math.atan2(n.x,-1*n.y),this.over),n.x=s,n.y=a,n):Math.abs(this.sin_p12+1)<=Lt?(g=this.a*Ss(u,c,f,m,_t),e=Math.sqrt(n.x*n.x+n.y*n.y),y=e-g,a=bv(y/this.a,u,c,f,m),s=Vt(this.long0+Math.atan2(n.x,n.y),this.over),n.x=s,n.y=a,n):(_=Math.atan2(n.x,n.y),E=Math.sqrt(n.x*n.x+n.y*n.y),x=W6(this.lat0,this.long0,_,E,this.a,this.f),n.x=x.lon2,n.y=x.lat2,n))}var Y6=["Azimuthal_Equidistant","aeqd"];const Z6={init:j6,forward:X6,inverse:q6,names:Y6};function J6(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function K6(n){var e,t,r,i,s,a,o,u,c=n.x,f=n.y;return r=Vt(c-this.long0,this.over),e=Math.sin(f),t=Math.cos(f),i=Math.cos(r),a=this.sin_p14*e+this.cos_p14*t*i,s=1,(a>0||Math.abs(a)<=Lt)&&(o=this.a*s*t*Math.sin(r),u=this.y0+this.a*s*(this.cos_p14*e-this.sin_p14*t*i)),n.x=o,n.y=u,n}function Q6(n){var e,t,r,i,s,a,o;return n.x-=this.x0,n.y-=this.y0,e=Math.sqrt(n.x*n.x+n.y*n.y),t=Pu(e/this.a),r=Math.sin(t),i=Math.cos(t),a=this.long0,Math.abs(e)<=Lt?(o=this.lat0,n.x=a,n.y=o,n):(o=Pu(i*this.sin_p14+n.y*r*this.cos_p14/e),s=Math.abs(this.lat0)-_t,Math.abs(s)<=Lt?(this.lat0>=0?a=Vt(this.long0+Math.atan2(n.x,-n.y),this.over):a=Vt(this.long0-Math.atan2(-n.x,n.y),this.over),n.x=a,n.y=o,n):(a=Vt(this.long0+Math.atan2(n.x*r,e*this.cos_p14*i-n.y*this.sin_p14*r),this.over),n.x=a,n.y=o,n))}var $6=["ortho"];const ek={init:J6,forward:K6,inverse:Q6,names:$6};var Li={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},Jn={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function tk(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=_t-Zn/2?this.face=Li.TOP:this.lat0<=-(_t-Zn/2)?this.face=Li.BOTTOM:Math.abs(this.long0)<=Zn?this.face=Li.FRONT:Math.abs(this.long0)<=_t+Zn?this.face=this.long0>0?Li.RIGHT:Li.LEFT:this.face=Li.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function nk(n){var e={x:0,y:0},t,r,i,s,a,o,u={value:0};if(n.x-=this.long0,this.es!==0?t=Math.atan(this.one_minus_f_squared*Math.tan(n.y)):t=n.y,r=n.x,this.face===Li.TOP)s=_t-t,r>=Zn&&r<=_t+Zn?(u.value=Jn.AREA_0,i=r-_t):r>_t+Zn||r<=-(_t+Zn)?(u.value=Jn.AREA_1,i=r>0?r-Zi:r+Zi):r>-(_t+Zn)&&r<=-Zn?(u.value=Jn.AREA_2,i=r+_t):(u.value=Jn.AREA_3,i=r);else if(this.face===Li.BOTTOM)s=_t+t,r>=Zn&&r<=_t+Zn?(u.value=Jn.AREA_0,i=-r+_t):r<Zn&&r>=-Zn?(u.value=Jn.AREA_1,i=-r):r<-Zn&&r>=-(_t+Zn)?(u.value=Jn.AREA_2,i=-r-_t):(u.value=Jn.AREA_3,i=r>0?-r+Zi:-r-Zi);else{var c,f,m,g,y,_,E;this.face===Li.RIGHT?r=If(r,+_t):this.face===Li.BACK?r=If(r,+Zi):this.face===Li.LEFT&&(r=If(r,-_t)),g=Math.sin(t),y=Math.cos(t),_=Math.sin(r),E=Math.cos(r),c=y*E,f=y*_,m=g,this.face===Li.FRONT?(s=Math.acos(c),i=fg(s,m,f,u)):this.face===Li.RIGHT?(s=Math.acos(f),i=fg(s,m,-c,u)):this.face===Li.BACK?(s=Math.acos(-c),i=fg(s,m,-f,u)):this.face===Li.LEFT?(s=Math.acos(-f),i=fg(s,m,c,u)):(s=i=0,u.value=Jn.AREA_0)}return o=Math.atan(12/Zi*(i+Math.acos(Math.sin(i)*Math.cos(Zn))-_t)),a=Math.sqrt((1-Math.cos(s))/(Math.cos(o)*Math.cos(o))/(1-Math.cos(Math.atan(1/Math.cos(i))))),u.value===Jn.AREA_1?o+=_t:u.value===Jn.AREA_2?o+=Zi:u.value===Jn.AREA_3&&(o+=1.5*Zi),e.x=a*Math.cos(o),e.y=a*Math.sin(o),e.x=e.x*this.a+this.x0,e.y=e.y*this.a+this.y0,n.x=e.x,n.y=e.y,n}function ik(n){var e={lam:0,phi:0},t,r,i,s,a,o,u,c,f,m={value:0};if(n.x=(n.x-this.x0)/this.a,n.y=(n.y-this.y0)/this.a,r=Math.atan(Math.sqrt(n.x*n.x+n.y*n.y)),t=Math.atan2(n.y,n.x),n.x>=0&&n.x>=Math.abs(n.y)?m.value=Jn.AREA_0:n.y>=0&&n.y>=Math.abs(n.x)?(m.value=Jn.AREA_1,t-=_t):n.x<0&&-n.x>=Math.abs(n.y)?(m.value=Jn.AREA_2,t=t<0?t+Zi:t-Zi):(m.value=Jn.AREA_3,t+=_t),f=Zi/12*Math.tan(t),a=Math.sin(f)/(Math.cos(f)-1/Math.sqrt(2)),o=Math.atan(a),i=Math.cos(t),s=Math.tan(r),u=1-i*i*s*s*(1-Math.cos(Math.atan(1/Math.cos(o)))),u<-1?u=-1:u>1&&(u=1),this.face===Li.TOP)c=Math.acos(u),e.phi=_t-c,m.value===Jn.AREA_0?e.lam=o+_t:m.value===Jn.AREA_1?e.lam=o<0?o+Zi:o-Zi:m.value===Jn.AREA_2?e.lam=o-_t:e.lam=o;else if(this.face===Li.BOTTOM)c=Math.acos(u),e.phi=c-_t,m.value===Jn.AREA_0?e.lam=-o+_t:m.value===Jn.AREA_1?e.lam=-o:m.value===Jn.AREA_2?e.lam=-o-_t:e.lam=o<0?-o-Zi:-o+Zi;else{var g,y,_;g=u,f=g*g,f>=1?_=0:_=Math.sqrt(1-f)*Math.sin(o),f+=_*_,f>=1?y=0:y=Math.sqrt(1-f),m.value===Jn.AREA_1?(f=y,y=-_,_=f):m.value===Jn.AREA_2?(y=-y,_=-_):m.value===Jn.AREA_3&&(f=y,y=_,_=-f),this.face===Li.RIGHT?(f=g,g=-y,y=f):this.face===Li.BACK?(g=-g,y=-y):this.face===Li.LEFT&&(f=g,g=y,y=-f),e.phi=Math.acos(-_)-_t,e.lam=Math.atan2(y,g),this.face===Li.RIGHT?e.lam=If(e.lam,-_t):this.face===Li.BACK?e.lam=If(e.lam,-Zi):this.face===Li.LEFT&&(e.lam=If(e.lam,+_t))}if(this.es!==0){var E,x,S;E=e.phi<0?1:0,x=Math.tan(e.phi),S=this.b/Math.sqrt(x*x+this.one_minus_f_squared),e.phi=Math.atan(Math.sqrt(this.a*this.a-S*S)/(this.one_minus_f*S)),E&&(e.phi=-e.phi)}return e.lam+=this.long0,n.x=e.lam,n.y=e.phi,n}function fg(n,e,t,r){var i;return n<Lt?(r.value=Jn.AREA_0,i=0):(i=Math.atan2(e,t),Math.abs(i)<=Zn?r.value=Jn.AREA_0:i>Zn&&i<=_t+Zn?(r.value=Jn.AREA_1,i-=_t):i>_t+Zn||i<=-(_t+Zn)?(r.value=Jn.AREA_2,i=i>=0?i-Zi:i+Zi):(r.value=Jn.AREA_3,i+=_t)),i}function If(n,e){var t=n+e;return t<-Zi?t+=Zp:t>+Zi&&(t-=Zp),t}var rk=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"];const sk={init:tk,forward:nk,inverse:ik,names:rk};var B_=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],dp=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],IT=.8487,LT=1.3523,NT=Xs/5,ak=1/NT,bf=18,Av=function(n,e){return n[0]+e*(n[1]+e*(n[2]+e*n[3]))},ok=function(n,e){return n[1]+e*(2*n[2]+e*3*n[3])};function lk(n,e,t,r){for(var i=e;r;--r){var s=n(i);if(i-=s,Math.abs(s)<t)break}return i}function uk(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"}function ck(n){var e=Vt(n.x-this.long0,this.over),t=Math.abs(n.y),r=Math.floor(t*NT);r<0?r=0:r>=bf&&(r=bf-1),t=Xs*(t-ak*r);var i={x:Av(B_[r],t)*e,y:Av(dp[r],t)};return n.y<0&&(i.y=-i.y),i.x=i.x*this.a*IT+this.x0,i.y=i.y*this.a*LT+this.y0,i}function hk(n){var e={x:(n.x-this.x0)/(this.a*IT),y:Math.abs(n.y-this.y0)/(this.a*LT)};if(e.y>=1)e.x/=B_[bf][0],e.y=n.y<0?-_t:_t;else{var t=Math.floor(e.y*bf);for(t<0?t=0:t>=bf&&(t=bf-1);;)if(dp[t][0]>e.y)--t;else if(dp[t+1][0]<=e.y)++t;else break;var r=dp[t],i=5*(e.y-r[0])/(dp[t+1][0]-r[0]);i=lk(function(s){return(Av(r,s)-e.y)/ok(r,s)},i,Lt,100),e.x/=Av(B_[t],i),e.y=(5*t+i)*Bi,n.y<0&&(e.y=-e.y)}return e.x=Vt(e.x+this.long0,this.over),e}var fk=["Robinson","robin"];const dk={init:uk,forward:ck,inverse:hk,names:fk};function pk(){this.name="geocent"}function mk(n){var e=xT(n,this.es,this.a);return e}function gk(n){var e=ST(n,this.es,this.a,this.b);return e}var vk=["Geocentric","geocentric","geocent","Geocent"];const yk={init:pk,forward:mk,inverse:gk,names:vk};var is={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},ap={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};function _k(){if(Object.keys(ap).forEach((function(t){if(typeof this[t]>"u")this[t]=ap[t].def;else{if(ap[t].num&&isNaN(this[t]))throw new Error("Invalid parameter value, must be numeric "+t+" = "+this[t]);ap[t].num&&(this[t]=parseFloat(this[t]))}ap[t].degrees&&(this[t]=this[t]*Bi)}).bind(this)),Math.abs(Math.abs(this.lat0)-_t)<Lt?this.mode=this.lat0<0?is.S_POLE:is.N_POLE:Math.abs(this.lat0)<Lt?this.mode=is.EQUIT:(this.mode=is.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var n=this.tilt,e=this.azi;this.cg=Math.cos(e),this.sg=Math.sin(e),this.cw=Math.cos(n),this.sw=Math.sin(n)}function xk(n){n.x-=this.long0;var e=Math.sin(n.y),t=Math.cos(n.y),r=Math.cos(n.x),i,s;switch(this.mode){case is.OBLIQ:s=this.sinph0*e+this.cosph0*t*r;break;case is.EQUIT:s=t*r;break;case is.S_POLE:s=-e;break;case is.N_POLE:s=e;break}switch(s=this.pn1/(this.p-s),i=s*t*Math.sin(n.x),this.mode){case is.OBLIQ:s*=this.cosph0*e-this.sinph0*t*r;break;case is.EQUIT:s*=e;break;case is.N_POLE:s*=-(t*r);break;case is.S_POLE:s*=t*r;break}var a,o;return a=s*this.cg+i*this.sg,o=1/(a*this.sw*this.h1+this.cw),i=(i*this.cg-s*this.sg)*this.cw*o,s=a*o,n.x=i*this.a,n.y=s*this.a,n}function Sk(n){n.x/=this.a,n.y/=this.a;var e={x:n.x,y:n.y},t,r,i;i=1/(this.pn1-n.y*this.sw),t=this.pn1*n.x*i,r=this.pn1*n.y*this.cw*i,n.x=t*this.cg+r*this.sg,n.y=r*this.cg-t*this.sg;var s=Ws(n.x,n.y);if(Math.abs(s)<Lt)e.x=0,e.y=n.y;else{var a,o;switch(o=1-s*s*this.pfact,o=(this.p-Math.sqrt(o))/(this.pn1/s+s/this.pn1),a=Math.sqrt(1-o*o),this.mode){case is.OBLIQ:e.y=Math.asin(a*this.sinph0+n.y*o*this.cosph0/s),n.y=(a-this.sinph0*Math.sin(e.y))*s,n.x*=o*this.cosph0;break;case is.EQUIT:e.y=Math.asin(n.y*o/s),n.y=a*s,n.x*=o;break;case is.N_POLE:e.y=Math.asin(a),n.y=-n.y;break;case is.S_POLE:e.y=-Math.asin(a);break}e.x=Math.atan2(n.x,n.y)}return n.x=e.x+this.long0,n.y=e.y,n}var Mk=["Tilted_Perspective","tpers"];const wk={init:_k,forward:xk,inverse:Sk,names:Mk};function Ek(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var n=1-this.es,e=1/n;this.radius_p=Math.sqrt(n),this.radius_p2=n,this.radius_p_inv2=e,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")}function Tk(n){var e=n.x,t=n.y,r,i,s,a;if(e=e-this.long0,this.shape==="ellipse"){t=Math.atan(this.radius_p2*Math.tan(t));var o=this.radius_p/Ws(this.radius_p*Math.cos(t),Math.sin(t));if(i=o*Math.cos(e)*Math.cos(t),s=o*Math.sin(e)*Math.cos(t),a=o*Math.sin(t),(this.radius_g-i)*i-s*s-a*a*this.radius_p_inv2<0)return n.x=Number.NaN,n.y=Number.NaN,n;r=this.radius_g-i,this.flip_axis?(n.x=this.radius_g_1*Math.atan(s/Ws(a,r)),n.y=this.radius_g_1*Math.atan(a/r)):(n.x=this.radius_g_1*Math.atan(s/r),n.y=this.radius_g_1*Math.atan(a/Ws(s,r)))}else this.shape==="sphere"&&(r=Math.cos(t),i=Math.cos(e)*r,s=Math.sin(e)*r,a=Math.sin(t),r=this.radius_g-i,this.flip_axis?(n.x=this.radius_g_1*Math.atan(s/Ws(a,r)),n.y=this.radius_g_1*Math.atan(a/r)):(n.x=this.radius_g_1*Math.atan(s/r),n.y=this.radius_g_1*Math.atan(a/Ws(s,r))));return n.x=n.x*this.a,n.y=n.y*this.a,n}function bk(n){var e=-1,t=0,r=0,i,s,a,o;if(n.x=n.x/this.a,n.y=n.y/this.a,this.shape==="ellipse"){this.flip_axis?(r=Math.tan(n.y/this.radius_g_1),t=Math.tan(n.x/this.radius_g_1)*Ws(1,r)):(t=Math.tan(n.x/this.radius_g_1),r=Math.tan(n.y/this.radius_g_1)*Ws(1,t));var u=r/this.radius_p;if(i=t*t+u*u+e*e,s=2*this.radius_g*e,a=s*s-4*i*this.C,a<0)return n.x=Number.NaN,n.y=Number.NaN,n;o=(-s-Math.sqrt(a))/(2*i),e=this.radius_g+o*e,t*=o,r*=o,n.x=Math.atan2(t,e),n.y=Math.atan(r*Math.cos(n.x)/e),n.y=Math.atan(this.radius_p_inv2*Math.tan(n.y))}else if(this.shape==="sphere"){if(this.flip_axis?(r=Math.tan(n.y/this.radius_g_1),t=Math.tan(n.x/this.radius_g_1)*Math.sqrt(1+r*r)):(t=Math.tan(n.x/this.radius_g_1),r=Math.tan(n.y/this.radius_g_1)*Math.sqrt(1+t*t)),i=t*t+r*r+e*e,s=2*this.radius_g*e,a=s*s-4*i*this.C,a<0)return n.x=Number.NaN,n.y=Number.NaN,n;o=(-s-Math.sqrt(a))/(2*i),e=this.radius_g+o*e,t*=o,r*=o,n.x=Math.atan2(t,e),n.y=Math.atan(r*Math.cos(n.x)/e)}return n.x=n.x+this.long0,n}var Ak=["Geostationary Satellite View","Geostationary_Satellite","geos"];const Ck={init:Ek,forward:Tk,inverse:bk,names:Ak};var Ap=1.340264,Cp=-.081106,Pp=893e-6,Rp=.003796,Cv=Math.sqrt(3)/2;function Pk(){this.es=0,this.long0=this.long0!==void 0?this.long0:0,this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0}function Rk(n){var e=Vt(n.x-this.long0,this.over),t=n.y,r=Math.asin(Cv*Math.sin(t)),i=r*r,s=i*i*i;return n.x=e*Math.cos(r)/(Cv*(Ap+3*Cp*i+s*(7*Pp+9*Rp*i))),n.y=r*(Ap+Cp*i+s*(Pp+Rp*i)),n.x=this.a*n.x+this.x0,n.y=this.a*n.y+this.y0,n}function Ik(n){n.x=(n.x-this.x0)/this.a,n.y=(n.y-this.y0)/this.a;var e=1e-9,t=12,r=n.y,i,s,a,o,u,c;for(c=0;c<t&&(i=r*r,s=i*i*i,a=r*(Ap+Cp*i+s*(Pp+Rp*i))-n.y,o=Ap+3*Cp*i+s*(7*Pp+9*Rp*i),r-=u=a/o,!(Math.abs(u)<e));++c);return i=r*r,s=i*i*i,n.x=Cv*n.x*(Ap+3*Cp*i+s*(7*Pp+9*Rp*i))/Math.cos(r),n.y=Math.asin(Math.sin(r)/Cv),n.x=Vt(n.x+this.long0,this.over),n}var Lk=["eqearth","Equal Earth","Equal_Earth"];const Nk={init:Pk,forward:Rk,inverse:Ik,names:Lk};var Qp=1e-10;function Dk(){var n;if(this.phi1=this.lat1,Math.abs(this.phi1)<Qp)throw new Error;this.es?(this.en=Zx(this.es),this.m1=Zf(this.phi1,this.am1=Math.sin(this.phi1),n=Math.cos(this.phi1),this.en),this.am1=n/(Math.sqrt(1-this.es*this.am1*this.am1)*this.am1),this.inverse=Fk,this.forward=Uk):(Math.abs(this.phi1)+Qp>=_t?this.cphi1=0:this.cphi1=1/Math.tan(this.phi1),this.inverse=kk,this.forward=Ok)}function Uk(n){var e=Vt(n.x-(this.long0||0),this.over),t=n.y,r,i,s;return r=this.am1+this.m1-Zf(t,i=Math.sin(t),s=Math.cos(t),this.en),i=s*e/(r*Math.sqrt(1-this.es*i*i)),n.x=r*Math.sin(i),n.y=this.am1-r*Math.cos(i),n.x=this.a*n.x+(this.x0||0),n.y=this.a*n.y+(this.y0||0),n}function Fk(n){n.x=(n.x-(this.x0||0))/this.a,n.y=(n.y-(this.y0||0))/this.a;var e,t,r,i;if(t=Ws(n.x,n.y=this.am1-n.y),i=Jx(this.am1+this.m1-t,this.es,this.en),(e=Math.abs(i))<_t)e=Math.sin(i),r=t*Math.atan2(n.x,n.y)*Math.sqrt(1-this.es*e*e)/Math.cos(i);else if(Math.abs(e-_t)<=Qp)r=0;else throw new Error;return n.x=Vt(r+(this.long0||0),this.over),n.y=Uu(i),n}function Ok(n){var e=Vt(n.x-(this.long0||0),this.over),t=n.y,r,i;return i=this.cphi1+this.phi1-t,Math.abs(i)>Qp?(n.x=i*Math.sin(r=e*Math.cos(t)/i),n.y=this.cphi1-i*Math.cos(r)):n.x=n.y=0,n.x=this.a*n.x+(this.x0||0),n.y=this.a*n.y+(this.y0||0),n}function kk(n){n.x=(n.x-(this.x0||0))/this.a,n.y=(n.y-(this.y0||0))/this.a;var e,t,r=Ws(n.x,n.y=this.cphi1-n.y);if(t=this.cphi1+this.phi1-r,Math.abs(t)>_t)throw new Error;return Math.abs(Math.abs(t)-_t)<=Qp?e=0:e=r*Math.atan2(n.x,n.y)/Math.cos(t),n.x=Vt(e+(this.long0||0),this.over),n.y=Uu(t),n}var zk=["bonne","Bonne (Werner lat_1=90)"];const Bk={init:Dk,names:zk},Ew={OBLIQUE:{forward:jk,inverse:qk},TRANSVERSE:{forward:Xk,inverse:Yk}},Pv={ROTATE:{o_alpha:"oAlpha",o_lon_c:"oLongC",o_lat_c:"oLatC"},NEW_POLE:{o_lat_p:"oLatP",o_lon_p:"oLongP"},NEW_EQUATOR:{o_lon_1:"oLong1",o_lat_1:"oLat1",o_lon_2:"oLong2",o_lat_2:"oLat2"}};function Gk(){if(this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.title=this.title||"General Oblique Transformation",this.isIdentity=gT.includes(this.o_proj),!this.o_proj)throw new Error("Missing parameter: o_proj");if(this.o_proj==="ob_tran")throw new Error("Invalid value for o_proj: "+this.o_proj);const n=this.projStr.replace("+proj=ob_tran","").replace("+o_proj=","+proj=").trim(),e=Ca(n);if(!e)throw new Error("Invalid parameter: o_proj. Unknown projection "+this.o_proj);e.long0=0,this.obliqueProjection=e;let t;const r=Object.keys(Pv),i=o=>{if(typeof this[o]>"u")return;const u=parseFloat(this[o])*Bi;if(isNaN(u))throw new Error("Invalid value for "+o+": "+this[o]);return u};for(let o=0;o<r.length;o++){const u=r[o],c=Pv[u],f=Object.entries(c);if(f.some(([g])=>typeof this[g]<"u")){t=c;for(let g=0;g<f.length;g++){const[y,_]=f[g],E=i(y);if(typeof E>"u")throw new Error("Missing parameter: "+y+".");this[_]=E}break}}if(!t)throw new Error("No valid parameters provided for ob_tran projection.");const{lamp:s,phip:a}=Wk(this,t);this.lamp=s,Math.abs(a)>Lt?(this.cphip=Math.cos(a),this.sphip=Math.sin(a),this.projectionType=Ew.OBLIQUE):this.projectionType=Ew.TRANSVERSE}function Vk(n){return this.projectionType.forward(this,n)}function Hk(n){return this.projectionType.inverse(this,n)}function Wk(n,e){let t,r;if(e===Pv.ROTATE){let i=n.oLongC,s=n.oLatC,a=n.oAlpha;if(Math.abs(Math.abs(s)-_t)<=Lt)throw new Error("Invalid value for o_lat_c: "+n.o_lat_c+" should be < 90");r=i+Math.atan2(-1*Math.cos(a),-1*Math.sin(a)*Math.sin(s)),t=Math.asin(Math.cos(s)*Math.sin(a))}else if(e===Pv.NEW_POLE)r=n.oLongP,t=n.oLatP;else{let i=n.oLong1,s=n.oLat1,a=n.oLong2,o=n.oLat2,u=Math.abs(s);if(Math.abs(s)>_t-Lt)throw new Error("Invalid value for o_lat_1: "+n.o_lat_1+" should be < 90");if(Math.abs(o)>_t-Lt)throw new Error("Invalid value for o_lat_2: "+n.o_lat_2+" should be < 90");if(Math.abs(s-o)<Lt)throw new Error("Invalid value for o_lat_1 and o_lat_2: o_lat_1 should be different from o_lat_2");if(u<Lt)throw new Error("Invalid value for o_lat_1: o_lat_1 should be different from zero");r=Math.atan2(Math.cos(s)*Math.sin(o)*Math.cos(i)-Math.sin(s)*Math.cos(o)*Math.cos(a),Math.sin(s)*Math.cos(o)*Math.sin(a)-Math.cos(s)*Math.sin(o)*Math.sin(i)),t=Math.atan(-1*Math.cos(r-i)/Math.tan(s))}return{lamp:r,phip:t}}function jk(n,e){let{x:t,y:r}=e;t+=n.long0;const i=Math.cos(t),s=Math.sin(r),a=Math.cos(r);e.x=Vt(Math.atan2(a*Math.sin(t),n.sphip*a*i+n.cphip*s)+n.lamp),e.y=Math.asin(n.sphip*s-n.cphip*a*i);const o=n.obliqueProjection.forward(e);return n.isIdentity&&(o.x*=Xs,o.y*=Xs),o}function Xk(n,e){let{x:t,y:r}=e;t+=n.long0;const i=Math.cos(r),s=Math.cos(t);e.x=Vt(Math.atan2(i*Math.sin(t),Math.sin(r))+n.lamp),e.y=Math.asin(-1*i*s);const a=n.obliqueProjection.forward(e);return n.isIdentity&&(a.x*=Xs,a.y*=Xs),a}function qk(n,e){n.isIdentity&&(e.x*=Bi,e.y*=Bi);const t=n.obliqueProjection.inverse(e);let{x:r,y:i}=t;if(r<Number.MAX_VALUE){r-=n.lamp;const s=Math.cos(r),a=Math.sin(i),o=Math.cos(i);e.x=Math.atan2(o*Math.sin(r),n.sphip*o*s-n.cphip*a),e.y=Math.asin(n.sphip*a+n.cphip*o*s)}return e.x=Vt(e.x+n.long0),e}function Yk(n,e){n.isIdentity&&(e.x*=Bi,e.y*=Bi);const t=n.obliqueProjection.inverse(e);let{x:r,y:i}=t;if(r<Number.MAX_VALUE){const s=Math.cos(i);r-=n.lamp,e.x=Math.atan2(s*Math.sin(r),-1*Math.sin(i)),e.y=Math.asin(s*Math.cos(r))}return e.x=Vt(e.x+n.long0),e}var Zk=["General Oblique Transformation","General_Oblique_Transformation","ob_tran"];const Jk={init:Gk,forward:Vk,inverse:Hk,names:Zk};function Kk(n){n.Proj.projections.add(wg),n.Proj.projections.add(Eg),n.Proj.projections.add(z8),n.Proj.projections.add(Y8),n.Proj.projections.add($8),n.Proj.projections.add(rO),n.Proj.projections.add(cO),n.Proj.projections.add(mO),n.Proj.projections.add(xO),n.Proj.projections.add(TO),n.Proj.projections.add(kO),n.Proj.projections.add(WO),n.Proj.projections.add(ZO),n.Proj.projections.add(t6),n.Proj.projections.add(a6),n.Proj.projections.add(h6),n.Proj.projections.add(g6),n.Proj.projections.add(S6),n.Proj.projections.add(A6),n.Proj.projections.add(L6),n.Proj.projections.add(O6),n.Proj.projections.add(V6),n.Proj.projections.add(Z6),n.Proj.projections.add(ek),n.Proj.projections.add(sk),n.Proj.projections.add(dk),n.Proj.projections.add(yk),n.Proj.projections.add(wk),n.Proj.projections.add(Ck),n.Proj.projections.add(Nk),n.Proj.projections.add(Bk),n.Proj.projections.add(Jk)}const v1=Object.assign(n8,{defaultDatum:"WGS84",Proj:Ca,WGS84:new Ca("WGS84"),Point:Hf,toPoint:MT,defs:Wr,nadgrid:kF,transform:Tv,mgrs:i8,version:"__VERSION__"});Kk(v1);v1.defs("EPSG:2193","+proj=tmerc +lat_0=0 +lon_0=173 +k=0.9996 +x_0=1600000 +y_0=10000000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs");const DT="EPSG:4326",UT="EPSG:2193",FT=104381901652e-4,OT=-32605867284e-4,G_=256,kT=39135.758482011;function Qk(n,e){const[t,r]=v1(DT,UT,[e,n]);return{e:t,n:r}}function dg(n,e){const[t,r]=v1(UT,DT,[n,e]);return{lat:r,lon:t}}function $k(n,e,t){const r=kT/Math.pow(2,t),i=n-OT,s=Math.floor(i/(G_*r)),a=FT-e,o=Math.floor(a/(G_*r));return{col:s,row:o}}function ez(n,e,t){const r=kT/Math.pow(2,t),i=G_*r,s=OT+n*i,a=s+i,o=FT-e*i,u=o-i;return{left:s,top:o,right:a,bottom:u}}const o_=17,pg=3,tz="https://basemaps.linz.govt.nz/v1/tiles/wellington-2025-0.2m/NZTM2000Quad/{z}/{x}/{y}.jpg?api=c01kcnafcmyays2y3hygwc7nrd9",nz=({col:n,row:e,zoom:t})=>{const r=se.useMemo(()=>{const{left:a,top:o,right:u,bottom:c}=ez(n,e,t),f=dg(a,o),m=dg(u,o),g=dg(a,c),y=dg(u,c),_=js(f.lat,f.lon,Ir,Lr),E=js(m.lat,m.lon,Ir,Lr),x=js(g.lat,g.lon,Ir,Lr),S=js(y.lat,y.lon,Ir,Lr),T=new Float32Array([_.x,-.6,_.z,E.x,-.6,E.z,x.x,-.6,x.z,S.x,-.6,S.z]),A=new Uint16Array([0,2,1,2,3,1]),P=new Float32Array([0,1,1,1,0,0,1,0]),L=new Sn;return L.setAttribute("position",new jn(T,3)),L.setAttribute("uv",new jn(P,2)),L.setIndex(new jn(A,1)),L.computeVertexNormals(),L},[n,e,t]),i=tz.replace("{z}",t.toString()).replace("{x}",n.toString()).replace("{y}",e.toString()),s=Au(Sx,i);return s.colorSpace=rs,O.jsx("mesh",{geometry:r,receiveShadow:!0,children:O.jsx("meshStandardMaterial",{map:s})})},iz=()=>{const[n,e]=se.useState([]),t=se.useRef(null);return oi(()=>{const{x:r,z:i}=Ht.getState().telemetry.position,{lat:s,lon:a}=lT(r,i,Ir,Lr),{e:o,n:u}=Qk(s,a),c=$k(o,u,o_);if(!t.current||t.current.col!==c.col||t.current.row!==c.row){t.current=c;const f=[];for(let m=-pg;m<=pg;m++)for(let g=-pg;g<=pg;g++){const y=c.col+m,_=c.row+g;f.push({col:y,row:_,key:`${o_}-${y}-${_}`})}e(f)}}),O.jsx("group",{children:n.map(r=>O.jsx(nz,{col:r.col,row:r.row,zoom:o_},r.key))})};class rz{nodes=new Map;chunkedNodes=new Map;constructor(e){this.buildGraph(e)}getNodeKey(e,t){return`${Math.round(e)},${Math.round(t)}`}buildGraph(e){e.forEach(t=>{if(!t.geometry)return;const r=t.geometry.type,i=t.geometry.coordinates,s=t.properties?.name||"Unknown Road",a=o=>{if(o.length<2)return;const u=o.map(T=>{const A=js(T[1],T[0],Ir,Lr);return new X(A.x,0,A.z)}),c=u[0],f=u[u.length-1],m=this.getNodeKey(c.x,c.z),g=this.getNodeKey(f.x,f.z),y=(T,A)=>{if(!this.nodes.has(T)){const P={id:T,position:A,edges:[]};this.nodes.set(T,P);const L=Vf(A.x,A.z);this.chunkedNodes.has(L)||this.chunkedNodes.set(L,[]),this.chunkedNodes.get(L).push(P)}return this.nodes.get(T)},_=y(m,c),E=y(g,f),x={id:`${m}-${g}`,from:m,to:g,points:u,roadName:s};_.edges.push(x);const S={id:`${g}-${m}`,from:g,to:m,points:[...u].reverse(),roadName:s};E.edges.push(S)};r==="LineString"?a(i):r==="MultiLineString"&&i.forEach(o=>{a(o)})})}getClosestNode(e){let t=null,r=1/0;const i=Vf(e.x,e.z),[s,a]=i.split(",").map(Number);for(let o=-1;o<=1;o++)for(let u=-1;u<=1;u++){const c=`${s+o},${a+u}`,f=this.chunkedNodes.get(c);if(f)for(const m of f){const g=Math.sqrt(Math.pow(m.position.x-e.x,2)+Math.pow(m.position.z-e.z,2));g<r&&(r=g,t=m)}}return t}getNodesInChunk(e){return this.chunkedNodes.get(e)||[]}getRandomNodeInChunk(e){const t=this.chunkedNodes.get(e);return!t||t.length===0?null:t[Math.floor(Math.random()*t.length)]}getRandomPath(e,t=5){let r=this.nodes.get(e);if(!r)return[];const i=[r.position];let s=null;for(let a=0;a<t;a++){const o=r.edges.filter(c=>c.to!==s);if(o.length===0)break;const u=o[Math.floor(Math.random()*o.length)];for(let c=1;c<u.points.length;c++)i.push(u.points[c]);if(s=r.id,r=this.nodes.get(u.to),!r)break}return i}}const Go=Uo.memo(se.forwardRef(({startPos:n=[0,0,0],endPos:e=[0,0,0],speed:t=5,delay:r=0,color:i="red",indicatingLeft:s=!1,indicatingRight:a=!1,rotation:o=[0,0,0],pathPoints:u},c)=>{const f=se.useRef(null);se.useImperativeHandle(c,()=>f.current);const[m,g]=se.useState(!1),[y,_]=se.useState({left:!1,right:!1}),E=se.useRef(0),x=se.useRef(!0),S=se.useRef(0),T=se.useRef(0),A=se.useRef(0),{fullPath:P,totalPathDistance:L}=se.useMemo(()=>{let U=[];u&&u.length>1?U=u:U=[new X(...n),new X(...e)];let V=0;for(let H=0;H<U.length-1;H++)V+=U[H].distanceTo(U[H+1]);return{fullPath:U,totalPathDistance:V}},[u,n,e]);se.useEffect(()=>{const U=setInterval(()=>g(V=>!V),400);return()=>clearInterval(U)},[]);const D=se.useRef(`aiCar_${Math.random().toFixed(5)}`),F=new X(2,1,4);se.useEffect(()=>{if(!f.current)return;const U={id:D.current,position:f.current.position,quaternion:f.current.quaternion,size:F,type:"aiCar",onCollide:V=>{}};return Yt.registerObject(U),()=>{Yt.unregisterObject(D.current)}},[]),oi((U,V)=>{if(!f.current||L===0)return;if(x.current){S.current+=V,S.current>=r&&(x.current=!1,A.current=U.clock.getElapsedTime()),f.current.position.copy(P[0]),f.current.quaternion.setFromEuler(new Qi(...o));return}const H=T.current,J=P[H],$=P[H+1];if(!J||!$){T.current=0,E.current=0,A.current=U.clock.getElapsedTime();return}const ne=J.distanceTo($)/t,oe=U.clock.getElapsedTime()-A.current;let te=Math.min(1,oe/ne);const ie=new X().lerpVectors(J,$,te),Y=new X().subVectors($,J).normalize(),z=new xn;z.setFromUnitVectors(new X(0,0,-1),Y),f.current.quaternion.slerp(z,.1);const K=H+2;let le=!1,me=!1;if(K<P.length){const re=P[H+1],he=P[K],ye=new X().subVectors(he,re).normalize();if(Y.dot(ye)<.95){const Ve=Y.x*ye.z-Y.z*ye.x;Ve<-.1&&(le=!0),Ve>.1&&(me=!0)}}(le!==y.left||me!==y.right)&&_({left:le,right:me}),f.current.position.copy(ie),te>=1&&(T.current++,A.current=U.clock.getElapsedTime(),T.current>=P.length-1&&(T.current=0,A.current=U.clock.getElapsedTime()));const ve=Yt.getObject(D.current);ve&&(ve.position.copy(f.current.position),ve.quaternion.copy(f.current.quaternion))});const k=s||y.left,R=a||y.right;return O.jsxs("group",{ref:f,position:P[0].toArray(),rotation:o,userData:{type:"aiCar"},children:[O.jsxs("mesh",{position:[0,.5,0],castShadow:!0,children:[O.jsx("boxGeometry",{args:[2,1,4]}),O.jsx("meshStandardMaterial",{color:i})]}),O.jsxs("group",{children:[O.jsxs("mesh",{position:[-1.1,.25,1.2],rotation:[0,0,Math.PI/2],children:[O.jsx("cylinderGeometry",{args:[.35,.35,.4,16]}),O.jsx("meshStandardMaterial",{color:"black"})]}),O.jsxs("mesh",{position:[1.1,.25,1.2],rotation:[0,0,Math.PI/2],children:[O.jsx("cylinderGeometry",{args:[.35,.35,.4,16]}),O.jsx("meshStandardMaterial",{color:"black"})]}),O.jsxs("mesh",{position:[-1.1,.25,-1.2],rotation:[0,0,Math.PI/2],children:[O.jsx("cylinderGeometry",{args:[.35,.35,.4,16]}),O.jsx("meshStandardMaterial",{color:"black"})]}),O.jsxs("mesh",{position:[1.1,.25,-1.2],rotation:[0,0,Math.PI/2],children:[O.jsx("cylinderGeometry",{args:[.35,.35,.4,16]}),O.jsx("meshStandardMaterial",{color:"black"})]})]}),O.jsxs("mesh",{position:[0,.9,-.5],children:[O.jsx("boxGeometry",{args:[1.8,.6,1.5]}),O.jsx("meshStandardMaterial",{color:"#87CEEB",transparent:!0,opacity:.7})]}),O.jsxs("group",{children:[O.jsxs("mesh",{position:[-.9,.5,-2.05],children:[O.jsx("boxGeometry",{args:[.4,.2,.1]}),O.jsx("meshStandardMaterial",{color:k&&m?"#FFAA00":"#333",emissive:k&&m?"#FFAA00":"#000",emissiveIntensity:2})]}),O.jsxs("mesh",{position:[-.9,.5,2.05],children:[O.jsx("boxGeometry",{args:[.4,.2,.1]}),O.jsx("meshStandardMaterial",{color:k&&m?"#FFAA00":"#333",emissive:k&&m?"#FFAA00":"#000",emissiveIntensity:2})]}),O.jsxs("mesh",{position:[.9,.5,-2.05],children:[O.jsx("boxGeometry",{args:[.4,.2,.1]}),O.jsx("meshStandardMaterial",{color:R&&m?"#FFAA00":"#333",emissive:R&&m?"#FFAA00":"#000",emissiveIntensity:2})]}),O.jsxs("mesh",{position:[.9,.5,2.05],children:[O.jsx("boxGeometry",{args:[.4,.2,.1]}),O.jsx("meshStandardMaterial",{color:R&&m?"#FFAA00":"#333",emissive:R&&m?"#FFAA00":"#000",emissiveIntensity:2})]})]})]})})),sz=8,az=20,oz=az/4,lz=({features:n})=>{const[e,t]=se.useState([]),r=se.useMemo(()=>new rz(n),[n]),i=se.useRef(0),s=a=>{const o=[];if(a.length<2)return a;for(let u=0;u<a.length;u++){const c=a[u],f=a[u+1],m=a[u-1];let g=new X;f?g.subVectors(f,c).normalize():m&&g.subVectors(c,m).normalize();const _=new X(0,1,0).cross(g).normalize().multiplyScalar(oz);o.push(c.clone().add(_))}return o};return oi(a=>{if(!r||n.length===0)return;const o=a.clock.getElapsedTime();if(o<i.current)return;const u=Ht.getState().telemetry.position,c=jx(u.x,u.z,1),f=new Set(c);t(m=>{const g=m.filter(y=>f.has(y.currentChunkId));if(g.length<sz){const y=c[Math.floor(Math.random()*c.length)],_=r.getRandomNodeInChunk(y);if(_&&_.position.distanceTo(new X(u.x,0,u.z))>50){const x=r.getRandomPath(_.id,10);if(x.length>1){const S=s(x),T={id:`car-${o}-${Math.random()}`,path:S,color:["red","blue","white","silver","black"][Math.floor(Math.random()*5)],speed:8+Math.random()*4,currentChunkId:y};g.push(T)}}}return g}),i.current=o+.5}),O.jsx("group",{children:e.map(a=>O.jsx(Go,{pathPoints:a.path,speed:a.speed,color:a.color},a.id))})},uz=()=>{const{setMessage:n,setScore:e,failLevel:t,mapType:r}=Ht(),[i,s]=se.useState([]),a=-41.341425,o=174.7722,{x:u,z:c}=js(a,o,Ir,Lr),f=se.useRef(`grass_${Math.random().toFixed(5)}`),m=new X(1e5,1,1e5),g=new X(0,-1,0);return se.useEffect(()=>{Ht.setState({levelStatus:"playing"}),n("Welcome to Wellington! Drive around. (Roads are visual guides only)"),e(0),(async()=>{try{const _=await fetch("/nz-driving-simulator/wellington_roads.geojson");if(!_.ok)throw new Error("Failed to fetch roads");const E=await _.json();s(E.features)}catch(_){console.error(_)}})()},[n,e]),se.useEffect(()=>{const y={id:f.current,position:g,quaternion:new xn,size:m,type:"grass",onCollide:_=>{_.type==="playerCar"&&console.log("Player drove off road!")}};return Yt.registerObject(y),()=>{Yt.unregisterObject(f.current)}},[t]),O.jsxs("group",{children:[r==="satellite"?O.jsx(iz,{}):O.jsx(qU,{}),O.jsx(GU,{features:i}),O.jsx(jU,{features:i}),O.jsx(lz,{features:i}),O.jsx(jr,{position:[u,1,c],rotation:[0,0,0]})]})},zT=({position:n=[0,0,0],rotation:e=[0,0,0]})=>{const t=se.useRef(null),r=se.useRef(`largeIntersection_${Math.random().toFixed(5)}`),i=new X(20,.1,20);return se.useEffect(()=>{if(!t.current)return;const s=new xn().setFromEuler(new Qi(...e)),a={id:r.current,position:t.current.position,quaternion:s,size:i,type:"largeIntersection",onCollide:o=>{}};return Yt.registerObject(a),()=>{Yt.unregisterObject(r.current)}},[n,e]),O.jsx("group",{ref:t,position:n,rotation:e,userData:{type:"largeIntersection"},children:O.jsxs("mesh",{rotation:[-Math.PI/2,0,0],receiveShadow:!0,children:[O.jsx("planeGeometry",{args:[20,20]}),O.jsx("meshStandardMaterial",{color:"#333333"})]})})},BT=({position:n,rotation:e=[0,0,0]})=>{const t=se.useRef(null),r=se.useRef(`stopSign_${Math.random().toFixed(5)}`),i=new X(.8,2.5,.05);return se.useEffect(()=>{if(!t.current)return;const s=new xn().setFromEuler(new Qi(...e)),a={id:r.current,position:t.current.position,quaternion:s,size:i,type:"sign",onCollide:o=>{}};return Yt.registerObject(a),()=>{Yt.unregisterObject(r.current)}},[n,e]),O.jsxs("group",{ref:t,position:n,rotation:e,userData:{type:"sign"},children:[O.jsxs("mesh",{position:[0,1,0],children:[O.jsx("cylinderGeometry",{args:[.05,.05,2]}),O.jsx("meshStandardMaterial",{color:"gray"})]}),O.jsxs("mesh",{position:[0,2,0],rotation:[Math.PI/2,0,0],children:[O.jsx("cylinderGeometry",{args:[.4,.4,.05,8]}),O.jsx("meshStandardMaterial",{color:"#b71c1c"})]}),O.jsxs("mesh",{position:[0,2,.03],rotation:[Math.PI/2,0,0],children:[O.jsx("cylinderGeometry",{args:[.35,.35,.05,8]}),O.jsx("meshStandardMaterial",{color:"#b71c1c"})]})]})},cz=()=>{const n=Ht(u=>u.setMessage),e=Ht(u=>u.failLevel),t=Ht(u=>u.passLevel),r=Ht(u=>u.setFlag),i=se.useRef(!1),s=se.useRef(`grass_${Math.random().toFixed(5)}`),a=new X(100,1,100),o=new X(0,-.6,-20);return se.useEffect(()=>{n("Scenario: Stop Sign. Come to a complete stop at the line before crossing.")},[n]),se.useEffect(()=>{const u={id:s.current,position:o,quaternion:new xn,size:a,type:"grass",onCollide:c=>{c.type==="playerCar"&&e("You drove off the road!")}};return Yt.registerObject(u),()=>{Yt.unregisterObject(s.current)}},[e]),oi(()=>{if(i.current)return;const u=Ht.getState().telemetry;if(!u||!u.position)return;const{position:c,speed:f}=u,m=c.z;m<-5&&m>-19&&Math.abs(f)<1.1&&(Ht.getState().flags.stopSignStopped||(r("stopSignStopped",!0),Ht.getState().message!=="Stopped. Safe to proceed."&&n("Stopped. Safe to proceed."))),m<-30&&(i.current=!0,Ht.getState().flags.stopSignStopped?t():e("FAILED: You ran the Stop Sign!"))}),O.jsxs("group",{children:[O.jsxs("mesh",{position:o,receiveShadow:!0,children:[O.jsx("boxGeometry",{args:[100,1,100]}),O.jsx("meshStandardMaterial",{color:"#4caf50"})]}),O.jsx(en,{position:[0,0,0],length:20}),O.jsx(en,{position:[0,0,-40],length:20}),O.jsx(en,{position:[-20,0,-20],rotation:[0,Math.PI/2,0],length:20}),O.jsx(en,{position:[20,0,-20],rotation:[0,Math.PI/2,0],length:20}),O.jsx(zT,{position:[0,0,-20]}),O.jsx(BT,{position:[-5.5,0,-14],rotation:[0,Math.PI,0]}),O.jsx(jr,{position:[-2.5,1,8]})]})},GT=Uo.memo(se.forwardRef(({startPos:n,endPos:e,speed:t=1.5,color:r="#8E44AD",active:i=!1},s)=>{const a=se.useRef(null);se.useImperativeHandle(s,()=>a.current);const o=se.useMemo(()=>new X,[]),u=se.useRef(null),{start:c,end:f,totalDistance:m}=se.useMemo(()=>{const _=new X(...n),E=new X(...e),x=_.distanceTo(E);return{start:_,end:E,totalDistance:x}},[n[0],n[1],n[2],e[0],e[1],e[2]]),g=se.useRef(`pedestrian_${Math.random().toFixed(5)}`),y=new X(.5,1.8,.5);return se.useEffect(()=>{if(!a.current)return;const _={id:g.current,position:a.current.position,quaternion:new xn,size:y,type:"pedestrian",onCollide:E=>{}};return Yt.registerObject(_),()=>{Yt.unregisterObject(g.current)}},[]),oi(_=>{if(!a.current||m===0)return;if(!i){a.current.position.copy(c),u.current=null;return}u.current===null&&(u.current=_.clock.getElapsedTime());const S=(_.clock.getElapsedTime()-u.current)*t,T=Math.min(1,S/m);o.lerpVectors(c,f,T),a.current.position.copy(o);const A=Yt.getObject(g.current);A&&A.position.copy(a.current.position)}),O.jsx("group",{ref:a,position:n,castShadow:!0,userData:{type:"pedestrian"},children:O.jsxs("mesh",{position:[0,1,0],children:[O.jsx("boxGeometry",{args:[.5,1.8,.5]})," ",O.jsx("meshStandardMaterial",{color:r})]})})})),hz=()=>{const{setMessage:n,failLevel:e,passLevel:t}=Ht(),[r,i]=se.useState(!1),s=se.useRef(!1),[a,o]=se.useState(!1),u=se.useRef(!1),c=se.useRef(null),[f,m]=se.useState(!1),g=se.useRef(`grass_${Math.random().toFixed(5)}`),y=new X(50,1,100),_=new X(0,-.6,-20);return se.useEffect(()=>{n("Scenario: Pedestrian Crossing. Give way to the pedestrian!")},[n]),se.useEffect(()=>{const E={id:g.current,position:_,quaternion:new xn,size:y,type:"grass",onCollide:x=>{x.type==="playerCar"&&e("You drove off the road!")}};return Yt.registerObject(E),()=>{Yt.unregisterObject(g.current)}},[e]),oi(()=>{if(r||s.current)return;const E=Ht.getState().telemetry;if(!E||!E.position)return;const{position:x}=E,T=E.speed,A=-20,P=-15,D=10/2;let F=0,k=!1;c.current&&(F=c.current.position.x,k=F>-D&&F<D),!f&&x.z<-5&&x.z>-15&&(m(!0),n("Pedestrian ahead! Stop before the crossing."));const R=x.z<P+5&&x.z>P-5;if(f&&!a&&R&&T<1.5&&o(!0),c.current&&!u.current&&F>=D&&(u.current=!0,k||n("Pedestrian has safely crossed. You may proceed.")),f&&!a&&x.z<P-2){e("You did not stop for the pedestrian!"),s.current=!0,i(!0);return}if(x.z<A-10){if(f){if(!a){e("You did not stop for the pedestrian!"),s.current=!0,i(!0);return}if(!u.current){e("You drove before the pedestrian safely crossed!"),s.current=!0,i(!0);return}}t(),i(!0)}}),O.jsxs("group",{children:[O.jsxs("mesh",{position:_,receiveShadow:!0,children:[O.jsx("boxGeometry",{args:[50,1,100]}),O.jsx("meshStandardMaterial",{color:"#81c784"})]}),O.jsx(en,{position:[0,0,0],length:20}),O.jsx(en,{position:[0,0,-20],length:20}),O.jsx(en,{position:[0,0,-40],length:20}),Uo.createElement(GT,{ref:c,startPos:[-6,.2,-20],endPos:[6,.2,-20],speed:1.5,active:f}),Array.from({length:10}).map((E,x)=>O.jsxs("mesh",{position:[-4.5+x,.02,-20],rotation:[-Math.PI/2,0,0],children:[O.jsx("planeGeometry",{args:[.6,4]}),O.jsx("meshStandardMaterial",{color:"white"})]},x)),O.jsx(jr,{position:[-2.5,1,10]})]})},fz=()=>{const n=Ht(_=>_.setMessage),e=Ht(_=>_.failLevel),t=Ht(_=>_.passLevel),[r,i]=se.useState(!1),s=se.useRef(Date.now()),a=se.useRef(`grass_${Math.random().toFixed(5)}`),o=se.useRef(`barrier1_${Math.random().toFixed(5)}`),u=se.useRef(`barrier2_${Math.random().toFixed(5)}`),c=new X(50,1,100),f=new X(0,-.6,-20),m=new X(2,1,4),g=new X(-4,.5,-5),y=new X(-4,.5,-19);return se.useEffect(()=>{n("Scenario: Parallel Parking. Park in the green box between the barriers.")},[n]),se.useEffect(()=>{const _={id:a.current,position:f,quaternion:new xn,size:c,type:"grass",onCollide:S=>{S.type==="playerCar"&&e("You drove off the road!")}};Yt.registerObject(_);const E={id:o.current,position:g,quaternion:new xn,size:m,type:"barrier",onCollide:S=>{S.type==="playerCar"&&e("You hit a barrier!")}};Yt.registerObject(E);const x={id:u.current,position:y,quaternion:new xn,size:m,type:"barrier",onCollide:S=>{S.type==="playerCar"&&e("You hit a barrier!")}};return Yt.registerObject(x),()=>{Yt.unregisterObject(a.current),Yt.unregisterObject(o.current),Yt.unregisterObject(u.current)}},[e]),oi(()=>{if(r)return;const _=Ht.getState().telemetry,{position:E,speed:x}=_;Math.abs(x)<.1&&Date.now()-s.current>3e3&&E.x>=-4.5&&E.x<=-3.5&&E.z>=-14&&E.z<=-10&&(t(),i(!0))}),O.jsxs("group",{children:[O.jsxs("mesh",{position:f,receiveShadow:!0,children:[O.jsx("boxGeometry",{args:[50,1,100]}),O.jsx("meshStandardMaterial",{color:"#90a4ae"})]}),O.jsx(en,{position:[0,0,0],length:20}),O.jsx(en,{position:[0,0,-20],length:20}),O.jsxs("mesh",{position:[-4,.02,-12],rotation:[-Math.PI/2,0,0],children:[" ",O.jsx("planeGeometry",{args:[3,8]})," ",O.jsx("meshStandardMaterial",{color:"green",transparent:!0,opacity:.3})]}),O.jsxs("group",{children:[" ",O.jsxs("mesh",{position:g,castShadow:!0,children:[O.jsx("boxGeometry",{args:[2,1,4]}),O.jsx("meshStandardMaterial",{color:"red"})]}),O.jsxs("mesh",{position:y,castShadow:!0,children:[O.jsx("boxGeometry",{args:[2,1,4]}),O.jsx("meshStandardMaterial",{color:"blue"})]})]}),O.jsx(jr,{position:[-2.5,1,5]})]})},dz=()=>{const{currentScenario:n,levelStatus:e,currentLevelIndex:t,message:r,startCareer:i,nextLevel:s,retryLevel:a,selectScenario:o,goToMenu:u,isPaused:c,togglePause:f,mapType:m,setMapType:g}=Ht(),[y,_]=se.useState(!1);return se.useEffect(()=>{const E=x=>{if(!(x.target instanceof HTMLInputElement||x.target instanceof HTMLTextAreaElement)&&!(n==="menu"||y))switch(x.key){case"Escape":y?_(!1):(c||e==="playing")&&f();break;case"Enter":e==="passed"&&!c&&s();break;case"r":case"R":(e==="failed"||e==="playing"&&c)&&a();break}};return window.addEventListener("keydown",E),()=>window.removeEventListener("keydown",E)},[n,e,c,y,s,a,f]),n==="menu"?O.jsxs("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.8)",color:"white",zIndex:10},children:[O.jsx("h1",{children:"NZ Driving Simulator"}),O.jsx("p",{style:{maxWidth:"600px",textAlign:"center",marginBottom:"20px"},children:"Master the New Zealand Road Code through interactive scenarios."}),O.jsx("button",{onClick:i,style:{margin:"10px",padding:"15px 40px",fontSize:"1.5em",cursor:"pointer",background:"#4CAF50",color:"white",border:"none",borderRadius:"5px"},children:"Start Career"}),O.jsxs("div",{style:{marginTop:"20px"},children:[O.jsx("p",{children:"Free Roam:"}),O.jsxs("div",{style:{marginBottom:"10px"},children:[O.jsx("label",{htmlFor:"mapType",style:{marginRight:"10px"},children:"Map Layer:"}),O.jsxs("select",{id:"mapType",value:m,onChange:E=>g(E.target.value),style:{padding:"5px"},children:[O.jsx("option",{value:"satellite",children:"Satellite (Photo)"}),O.jsx("option",{value:"osm",children:"OpenStreetMap (Standard)"})]})]}),O.jsx("button",{onClick:()=>o("wellington"),style:{margin:"5px",padding:"10px 20px",fontSize:"1em",cursor:"pointer"},children:"Wellington City"})]})]}):c?y?O.jsxs("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.8)",color:"white",zIndex:30},children:[O.jsx("h1",{children:"CONTROLS"}),O.jsxs("ul",{style:{listStyle:"none",padding:0,textAlign:"left",fontSize:"1.2em"},children:[O.jsxs("li",{style:{marginBottom:"10px"},children:[O.jsx("strong",{children:"W:"})," Accelerate"]}),O.jsxs("li",{style:{marginBottom:"10px"},children:[O.jsx("strong",{children:"S:"})," Brake / Reverse"]}),O.jsxs("li",{style:{marginBottom:"10px"},children:[O.jsx("strong",{children:"A:"})," Steer Left"]}),O.jsxs("li",{style:{marginBottom:"10px"},children:[O.jsx("strong",{children:"D:"})," Steer Right"]}),O.jsxs("li",{style:{marginBottom:"10px"},children:[O.jsx("strong",{children:"Q:"})," Indicate Left"]}),O.jsxs("li",{style:{marginBottom:"10px"},children:[O.jsx("strong",{children:"E:"})," Indicate Right"]}),O.jsxs("li",{style:{marginBottom:"10px"},children:[O.jsx("strong",{children:"Esc:"})," Pause / Resume"]}),O.jsxs("li",{style:{marginBottom:"10px"},children:[O.jsx("strong",{children:"Enter:"})," Next Level (when Passed)"]}),O.jsxs("li",{style:{marginBottom:"10px"},children:[O.jsx("strong",{children:"R:"})," Restart Scenario"]})]}),O.jsx("button",{onClick:()=>_(!1),style:{margin:"10px",padding:"15px 30px",fontSize:"1.5em",cursor:"pointer"},children:"Back to Pause Menu"})]}):O.jsxs("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.8)",color:"white",zIndex:30},children:[O.jsx("h1",{children:"PAUSED"}),O.jsx("p",{children:"Press 'Esc' to resume, 'R' to restart, or choose an option below."}),n==="wellington"&&O.jsxs("div",{style:{margin:"10px"},children:[O.jsx("label",{htmlFor:"pauseMapType",style:{marginRight:"10px"},children:"Map Layer:"}),O.jsxs("select",{id:"pauseMapType",value:m,onChange:E=>g(E.target.value),style:{padding:"5px",fontSize:"1em"},children:[O.jsx("option",{value:"satellite",children:"Satellite (Photo)"}),O.jsx("option",{value:"osm",children:"OpenStreetMap (Standard)"})]})]}),O.jsx("button",{onClick:f,style:{margin:"10px",padding:"15px 30px",fontSize:"1.5em",cursor:"pointer"},children:"Resume"}),O.jsx("button",{onClick:a,style:{margin:"10px",padding:"10px 20px",fontSize:"1em",cursor:"pointer"},children:"Restart Scenario"}),O.jsx("button",{onClick:()=>_(!0),style:{margin:"10px",padding:"10px 20px",fontSize:"1em",cursor:"pointer"},children:"Controls"}),O.jsx("button",{onClick:u,style:{margin:"10px",padding:"10px 20px",fontSize:"1em",cursor:"pointer"},children:"Quit to Menu"})]}):e==="passed"?O.jsxs("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"rgba(0,100,0,0.8)",color:"white",zIndex:20},children:[O.jsx("h1",{children:"SCENARIO PASSED!"}),O.jsx("p",{children:r}),O.jsx("p",{children:"Press 'Enter' to continue."}),O.jsx("button",{onClick:s,style:{marginTop:"20px",padding:"15px 30px",fontSize:"1.5em",cursor:"pointer"},children:t<Tl.length-1?"Next Level":"Finish Career"})]}):e==="failed"?O.jsxs("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"rgba(100,0,0,0.8)",color:"white",zIndex:20},children:[O.jsx("h1",{children:"SCENARIO FAILED"}),O.jsx("h2",{style:{color:"#ffcdd2"},children:r}),O.jsx("p",{children:"Press 'R' to retry, or choose an option below."}),O.jsx("button",{onClick:a,style:{marginTop:"20px",padding:"15px 30px",fontSize:"1.5em",cursor:"pointer"},children:"Retry Scenario"}),O.jsx("button",{onClick:u,style:{marginTop:"10px",padding:"10px 20px",fontSize:"1em",cursor:"pointer"},children:"Quit to Menu"})]}):e==="playing"?O.jsxs("div",{style:{position:"absolute",top:0,left:0,width:"100%",padding:"20px",boxSizing:"border-box",color:"white",pointerEvents:"none",display:"flex",justifyContent:"space-between"},children:[O.jsxs("div",{children:[n!=="wellington"&&O.jsxs("h2",{style:{background:"rgba(0,0,0,0.5)",padding:"5px 10px",borderRadius:"5px"},children:["Scenario ",t+1,"/",Tl.length,": ",Tl[t]?.title]}),O.jsx("h3",{style:{background:"rgba(0,0,0,0.5)",padding:"5px 10px",borderRadius:"5px"},children:r})]}),O.jsx("div",{style:{pointerEvents:"auto"},children:O.jsx("button",{onClick:f,style:{padding:"10px",cursor:"pointer"},children:"Pause"})})]}):null},pz=()=>{const{setMessage:n,passLevel:e,failLevel:t}=Ht(),[r,i]=se.useState(!1),s=se.useRef(!1),a=se.useRef(!1),o=se.useRef(null),u=se.useRef(`grass_${Math.random().toFixed(5)}`),c=new X(100,1,100),f=new X(0,-.6,-10);return se.useEffect(()=>{n("Scenario: T-Intersection (Right). Give Way to ALL traffic. Turn Right.")},[n]),se.useEffect(()=>{const m={id:u.current,position:f,quaternion:new xn,size:c,type:"grass",onCollide:g=>{g.type==="playerCar"&&t("You drove off the road!")}};return Yt.registerObject(m),()=>{Yt.unregisterObject(u.current)}},[t]),oi(()=>{if(a.current)return;const m=Ht.getState().telemetry,{position:g,speed:y,indicators:_}=m;let E=-50,x=10,S=!1;if(o.current){E=o.current.position.x;const T=o.current.position.z;x=Math.sqrt(Math.pow(g.x-E,2)+Math.pow(g.z-T,2)),E>-10&&E<10&&(S=!0)}if(_.right&&(s.current=!0),g.z<0&&!s.current&&!_.right){t("You did not indicate right!"),a.current=!0;return}if(g.z<0&&g.z>-10&&Math.abs(y)<.1&&(r||i(!0)),g.z<-5.5){if(!r&&S&&x<15){t("You entered the intersection without stopping for hazards!"),a.current=!0;return}if(S&&x<10){t("You pulled out in front of incoming traffic! (Crash Imminent)"),a.current=!0;return}}g.x>5&&(e(),a.current=!0),g.z<-30&&(t("You went straight/off-road!"),a.current=!0),g.x<-15&&(t("You turned left! You were supposed to turn right."),a.current=!0)}),O.jsxs("group",{children:[O.jsxs("mesh",{position:f,receiveShadow:!0,children:[O.jsx("boxGeometry",{args:[100,1,100]}),O.jsx("meshStandardMaterial",{color:"#558b2f"})]}),O.jsx(en,{position:[-10,0,-10],rotation:[0,Math.PI/2,0],length:10}),O.jsx(en,{position:[10,0,-10],rotation:[0,Math.PI/2,0],length:10}),O.jsx(Nu,{position:[0,0,-10]}),O.jsx(en,{position:[0,0,0],length:10}),O.jsx(en,{position:[0,0,10],length:10}),O.jsx(Du,{position:[-5.5,0,-5.5],rotation:[0,0,0]}),O.jsx(Go,{ref:o,startPos:[-15,.2,-12.5],endPos:[15,.2,-12.5],speed:12,delay:0,color:"blue",rotation:[0,3*Math.PI/2,0]}),O.jsx(jr,{position:[-2.5,1,9]})]})},mz=()=>{const{setMessage:n,passLevel:e,failLevel:t}=Ht(),[r,i]=se.useState(!1),s=se.useRef(!1),a=se.useRef(`grass_${Math.random().toFixed(5)}`),o=new X(100,1,100),u=new X(0,-.6,-10);return se.useEffect(()=>{n("Scenario: Crossroads. Go Straight. Give Way to crossing traffic.")},[n]),se.useEffect(()=>{const c={id:a.current,position:u,quaternion:new xn,size:o,type:"grass",onCollide:f=>{f.type==="playerCar"&&t("You drove off the road!")}};return Yt.registerObject(c),()=>{Yt.unregisterObject(a.current)}},[t]),oi(()=>{if(r||s.current)return;const c=Ht.getState().telemetry,{position:f}=c;f.z<-20&&(e(),s.current=!0,i(!0)),(f.x<-15||f.x>15)&&(t("You turned! You were supposed to go straight."),s.current=!0,i(!0))}),O.jsxs("group",{children:[O.jsxs("mesh",{position:u,receiveShadow:!0,children:[O.jsx("boxGeometry",{args:[100,1,100]}),O.jsx("meshStandardMaterial",{color:"#558b2f"})]}),O.jsx(Nu,{position:[0,0,-10]}),O.jsx(en,{position:[0,0,0],length:10}),"       ",O.jsx(en,{position:[0,0,-20],length:10}),"     ",O.jsx(en,{position:[-10,0,-10],rotation:[0,Math.PI/2,0],length:10})," ",O.jsx(en,{position:[10,0,-10],rotation:[0,Math.PI/2,0],length:10}),"  ",O.jsx(Du,{position:[-5.5,0,-1],rotation:[0,0,0]}),O.jsx(_v,{position:[7.5,.2,-7.5],rotation:[0,Math.PI/2,0],color:"orange",indicatingLeft:!0,indicatingRight:!1}),O.jsx(_v,{position:[-7.5,.2,-12.5],rotation:[0,3*Math.PI/2,0],color:"red",indicatingLeft:!0,indicatingRight:!1}),O.jsx(jr,{position:[-2.5,1,4]})]})},gz=()=>{const{setMessage:n,passLevel:e,failLevel:t}=Ht(),r=se.useRef(!1),i=se.useRef(!1),[s,a]=se.useState(!1),o=se.useRef(!1),u=se.useRef(null),c=se.useRef(`grass_${Math.random().toFixed(5)}`),f=new X(100,1,100),m=new X(0,-.6,-10);return se.useEffect(()=>{n("Scenario: T-Intersection Give Way. Give Way to traffic from your right. Turn Left.")},[n]),se.useEffect(()=>{const g={id:c.current,position:m,quaternion:new xn,size:f,type:"grass",onCollide:y=>{y.type==="playerCar"&&t("You drove off the road!")}};return Yt.registerObject(g),()=>{Yt.unregisterObject(c.current)}},[t]),oi(()=>{if(s||o.current)return;const g=Ht.getState().telemetry;if(!g||!g.position)return;const{position:y,speed:_,indicators:E}=g,x=y.z,S=y.x;let T=-50,A=-10,P=10,L=!1;if(u.current&&(T=u.current.position.x,A=u.current.position.z,P=Math.sqrt(Math.pow(S-T,2)+Math.pow(x-A,2)),T<10&&T>-10&&(L=!0)),x<1&&x>-5&&Math.abs(_)<.1&&(r.current||(r.current=!0,n("Stopped. Safe to proceed (when clear)."))),x<0){if(E.left)i.current=!0;else if(E.right){t("You indicated right, but you can only go straight or left!"),o.current=!0,a(!0);return}}if(x<-1){if(!r.current&&L&&P<15){t("You entered the intersection without stopping for hazards!"),o.current=!0,a(!0);return}if(L&&P<10){t("You pulled out in front of incoming traffic! (Crash Imminent)"),o.current=!0,a(!0);return}}if(x<-10&&S<5&&S>-5)e(),o.current=!0,a(!0);else if(S<-10&&x<-5){if(!i.current){t("You turned left but did not indicate!"),o.current=!0,a(!0);return}e(),o.current=!0,a(!0)}S>10&&x<-5&&(t("You turned right! You were supposed to go straight or turn left."),o.current=!0,a(!0)),x<-10&&(S>15||S<-15)&&(t("You drove off the road!"),o.current=!0,a(!0))}),O.jsxs("group",{children:[O.jsxs("mesh",{position:m,receiveShadow:!0,children:[O.jsx("boxGeometry",{args:[100,1,100]}),O.jsx("meshStandardMaterial",{color:"#558b2f"})]}),O.jsx(en,{position:[-10,0,-10],rotation:[0,Math.PI/2,0],length:10}),O.jsx(en,{position:[10,0,-10],rotation:[0,Math.PI/2,0],length:10}),O.jsx(Nu,{position:[0,0,-10]}),O.jsx(en,{position:[0,0,0],length:10}),O.jsx(en,{position:[0,0,10],length:10}),O.jsx(Du,{position:[-5.5,0,-1],rotation:[0,0,0]}),O.jsx(Go,{ref:u,startPos:[15,.2,-7.5],endPos:[-15,.2,-7.5],speed:12,delay:0,color:"blue",rotation:[0,Math.PI/2,0]}),O.jsx(jr,{position:[-2.5,1,9]})]})},vz=()=>{const n=Ht(u=>u.setMessage),e=Ht(u=>u.failLevel),t=Ht(u=>u.passLevel),r=se.useRef(!1),i=se.useRef(null),s=se.useRef(`grass_${Math.random().toFixed(5)}`),a=new X(100,1,100),o=new X(0,-.6,-20);return se.useEffect(()=>{n("Scenario: Stop Sign with Cross Traffic. Come to a complete stop and give way to cross traffic before proceeding.")},[n]),se.useEffect(()=>{const u={id:s.current,position:o,quaternion:new xn,size:a,type:"grass",onCollide:c=>{c.type==="playerCar"&&e("You drove off the road!")}};return Yt.registerObject(u),()=>{Yt.unregisterObject(s.current),r.current=!1}},[e]),oi(()=>{if(r.current)return;const u=Ht.getState().telemetry;if(!u||!u.position)return;const{position:c,speed:f}=u,m=c.z,g=c.x;let y=100,_=-20,E=100,x=!1;if(i.current&&(y=i.current.position.x,_=i.current.position.z,E=Math.sqrt(Math.pow(g-y,2)+Math.pow(m-_,2)),y<20&&y>-20&&(x=!0)),Math.abs(m- -14)<10&&Math.abs(f)<1.1&&(Ht.getState().flags.stopSignStopped||Ht.getState().setFlag("stopSignStopped",!0),Ht.getState().message!=="Stopped. Wait for safe gap."&&n("Stopped. Wait for safe gap.")),m<-16){if(!Ht.getState().flags.stopSignStopped){e("FAILED: You ran the Stop Sign!"),r.current=!0;return}if(x&&E<15){e("FAILED: You pulled out in front of cross traffic!"),r.current=!0;return}}m<-30&&(r.current=!0,Ht.getState().flags.stopSignStopped?t():e("FAILED: Did not stop at Stop Sign or drove off road!"))}),O.jsxs("group",{children:[O.jsxs("mesh",{position:o,receiveShadow:!0,children:[O.jsx("boxGeometry",{args:[100,1,100]}),O.jsx("meshStandardMaterial",{color:"#4caf50"})]}),O.jsx(en,{position:[0,0,0],length:20}),O.jsx(en,{position:[0,0,-40],length:20}),O.jsx(en,{position:[-20,0,-20],rotation:[0,Math.PI/2,0],length:20}),O.jsx(en,{position:[20,0,-20],rotation:[0,Math.PI/2,0],length:20}),O.jsx(zT,{position:[0,0,-20]}),O.jsx(BT,{position:[-5.5,0,-14],rotation:[0,Math.PI,0]}),O.jsx(Go,{ref:i,startPos:[-30,.2,-22.5],endPos:[30,.2,-22.5],speed:15,delay:0,color:"red",rotation:[0,3*Math.PI/2,0]}),O.jsx(jr,{position:[-2.5,1,8]})]})},yz=()=>{const{setMessage:n,passLevel:e,failLevel:t}=Ht(),[r,i]=se.useState(!1),s=se.useRef(!1),a=se.useRef(null),o=se.useRef(null),u=se.useRef(null),c=se.useRef(`grass_${Math.random().toFixed(5)}`),f=new X(100,1,100),m=new X(0,-.6,-10);return se.useEffect(()=>{n("Scenario: Give Way (Merge). Give way to continuous traffic flow from your right. Merge safely onto the main road and proceed.")},[n]),se.useEffect(()=>{const g={id:c.current,position:m,quaternion:new xn,size:f,type:"grass",onCollide:y=>{y.type==="playerCar"&&t("You drove off the road!")}};return Yt.registerObject(g),()=>{Yt.unregisterObject(c.current)}},[t]),oi(()=>{if(r||s.current)return;const g=Ht.getState().telemetry;if(!g||!g.position)return;const{position:y}=g,_=y.x,E=y.z,x=[a,o,u];let S=!1,T=1/0;if(x.forEach(A=>{if(A.current){const P=A.current.position.x,L=A.current.position.z,D=Math.sqrt(Math.pow(_-P,2)+Math.pow(E-L,2));T=Math.min(T,D),P<15&&P>-15&&(S=!0)}}),E<-5&&S&&T<10){t("You merged unsafely into traffic!"),s.current=!0,i(!0);return}if(_<-10&&E<-5){e(),s.current=!0,i(!0);return}!s.current&&(E<-30||_>15||_<-25)&&(t("You drove off the road or went the wrong way!"),s.current=!0,i(!0))}),O.jsxs("group",{children:[O.jsxs("mesh",{position:m,receiveShadow:!0,children:[O.jsx("boxGeometry",{args:[100,1,100]}),O.jsx("meshStandardMaterial",{color:"#558b2f"})]}),O.jsx(Nu,{position:[0,0,-10]}),O.jsx(en,{position:[0,0,0],length:10}),"       ",O.jsx(en,{position:[-10,0,-10],rotation:[0,Math.PI/2,0],length:10})," ",O.jsx(en,{position:[10,0,-10],rotation:[0,Math.PI/2,0],length:10}),"  ",O.jsx(en,{position:[-20,0,-10],rotation:[0,Math.PI/2,0],length:10})," ",O.jsx(Du,{position:[-5.5,0,-1],rotation:[0,0,0]}),O.jsx(Go,{ref:a,startPos:[20,.2,-7.5],endPos:[-20,.2,-7.5],speed:10,delay:0,color:"red",rotation:[0,-Math.PI/2,0]}),O.jsx(Go,{ref:o,startPos:[100,1,-7.5],endPos:[60,1,-7.5],speed:10,delay:12,color:"purple",rotation:[0,-Math.PI/2,0]}),O.jsx(jr,{position:[-2.5,1,4]})]})},_z=()=>{const n=Ht(f=>f.setMessage),e=Ht(f=>f.passLevel),t=Ht(f=>f.failLevel),[r,i]=se.useState(!1),s=se.useRef(!1),a=se.useRef(null),o=se.useRef(`grass_${Math.random().toFixed(5)}`),u=new X(100,1,100),c=new X(0,-.6,-10);return se.useEffect(()=>{n("Scenario: Give Way (Right-to-Left). You are at the intersection. Give way to the car approaching from your right before proceeding right.")},[n]),se.useEffect(()=>{const f={id:o.current,position:c,quaternion:new xn,size:u,type:"grass",onCollide:m=>{m.type==="playerCar"&&t("You drove off the road!")}};return Yt.registerObject(f),()=>{Yt.unregisterObject(o.current)}},[t]),oi(()=>{if(r||s.current)return;const f=Ht.getState().telemetry;if(!f||!f.position)return;const{position:m,indicators:g}=f,y=m.z,_=m.x;let E=-50,x=-10,S=10,T=!1;if(a.current&&(E=a.current.position.x,x=a.current.position.z,S=Math.sqrt(Math.pow(_-E,2)+Math.pow(y-x,2)),E<10&&E>-10&&(T=!0)),y<-1&&T&&S<4){t("You entered the intersection without giving way to cross traffic!"),s.current=!0,i(!0);return}_>10&&(!T||S>8)&&(g.right?e():t("You forgot to indicate right!"),s.current=!0,i(!0)),_<-10&&(t("You turned left! You were supposed to go right."),s.current=!0,i(!0)),y<-15&&_<5&&_>-5&&(t("You went straight! You were supposed to turn right."),s.current=!0,i(!0)),(y<-30||y>20||Math.abs(_)>20)&&(t("You drove off the road!"),s.current=!0,i(!0))}),O.jsxs("group",{children:[O.jsxs("mesh",{position:c,receiveShadow:!0,children:[O.jsx("boxGeometry",{args:[100,1,100]}),O.jsx("meshStandardMaterial",{color:"#558b2f"})]}),O.jsx(en,{position:[-10,0,-10],rotation:[0,Math.PI/2,0],length:10}),O.jsx(en,{position:[10,0,-10],rotation:[0,Math.PI/2,0],length:10}),O.jsx(Nu,{position:[0,0,-10]}),O.jsx(en,{position:[0,0,0],length:10}),O.jsx(en,{position:[0,0,10],length:10}),O.jsx(Du,{position:[-5.5,0,-1],rotation:[0,0,0]}),O.jsx(Go,{ref:a,startPos:[15,.2,-7.5],endPos:[-15,.2,-7.5],speed:8,delay:0,color:"blue",rotation:[0,Math.PI/2,0]}),O.jsx(jr,{position:[-2.5,1,12]})," "]})},xz=()=>{const n=Ht(m=>m.setMessage),e=Ht(m=>m.passLevel),t=Ht(m=>m.failLevel),r=Ht(m=>m.setFlag),[i,s]=se.useState(!1),a=se.useRef(!1),o=se.useRef(null),u=se.useRef(`grass_${Math.random().toFixed(5)}`),c=new X(100,1,100),f=new X(0,-.6,-10);return se.useEffect(()=>{n("Scenario: Four-Way Give Way. Give way to traffic from your right. Go Straight.")},[n]),se.useEffect(()=>{const m={id:u.current,position:f,quaternion:new xn,size:c,type:"grass",onCollide:g=>{g.type==="playerCar"&&t("You drove off the road!")}};return Yt.registerObject(m),()=>{Yt.unregisterObject(u.current)}},[t]),oi(()=>{if(i||a.current)return;const m=Ht.getState().telemetry;if(!m||!m.position)return;const{position:g,speed:y}=m,_=g.z,E=g.x;let x=100,S=-10,T=100,A=!1;o.current&&(x=o.current.position.x,S=o.current.position.z,T=Math.sqrt(Math.pow(E-x,2)+Math.pow(_-S,2)),S<0&&S>-20&&(A=!0));const P=-5;if(_<P+5&&_>P-5&&Math.abs(y)<1.1&&(Ht.getState().flags.fourWayStopped||r("fourWayStopped",!0),Ht.getState().message!=="Stopped. Wait for cross traffic from your right."&&n("Stopped. Wait for cross traffic from your right.")),_<P-2){if(A&&T<8){t("You entered the intersection without giving way to cross traffic!"),a.current=!0,s(!0);return}if(A&&!Ht.getState().flags.fourWayStopped){t("You ran the Give Way sign without stopping for traffic!"),a.current=!0,s(!0);return}}if(_<-20&&E<5&&E>-5){if(A&&T<10){t("You pulled out too close to cross traffic!"),a.current=!0,s(!0);return}e(),a.current=!0,s(!0)}(E<-10||E>10||_>10||_<-30&&(E<-5||E>5))&&(t("You turned or drove off the road!"),a.current=!0,s(!0))}),O.jsxs("group",{children:[O.jsxs("mesh",{position:f,receiveShadow:!0,children:[O.jsx("boxGeometry",{args:[100,1,100]}),O.jsx("meshStandardMaterial",{color:"#558b2f"})]}),O.jsx(en,{position:[0,0,0],length:10}),"       ",O.jsx(en,{position:[0,0,-20],length:10}),"     ",O.jsx(en,{position:[-10,0,-10],rotation:[0,Math.PI/2,0],length:10})," ",O.jsx(en,{position:[10,0,-10],rotation:[0,Math.PI/2,0],length:10}),"  ",O.jsx(Nu,{position:[0,0,-10]}),O.jsx(Du,{position:[-5.5,0,-5],rotation:[0,0,0]})," ",O.jsx(Go,{ref:o,startPos:[15,.2,-7.5],endPos:[-15,.2,-7.5],speed:8,delay:0,color:"red",pathPoints:[new X(15,.2,-7.5),new X(7,.2,-7.5),new X(2,.2,-10),new X(-2,.2,-15),new X(-2,.2,-20),new X(-2,.2,-22.5)],indicatingRight:!0,indicatingLeft:!1}),O.jsx(jr,{position:[-2.5,1,7.5]})," "]})},Sz=()=>{const n=Ht(f=>f.setMessage),e=Ht(f=>f.passLevel),t=Ht(f=>f.failLevel),r=Ht(f=>f.setFlag),[i,s]=se.useState(!1),a=se.useRef(!1),o=se.useRef(`grass_${Math.random().toFixed(5)}`),u=new X(100,1,100),c=new X(0,-.6,-20);return se.useEffect(()=>{n("Scenario: Train Crossing. Stop at the tracks before crossing.")},[n]),se.useEffect(()=>{const f={id:o.current,position:c,quaternion:new xn,size:u,type:"grass",onCollide:m=>{m.type==="playerCar"&&t("You drove off the road!")}};return Yt.registerObject(f),()=>{Yt.unregisterObject(o.current)}},[t]),oi((f,m)=>{if(i||a.current)return;const g=Ht.getState().telemetry;if(!g||!g.position)return;const{position:y,speed:_}=g,E=y.z,x=y.x,S=-15;if(E<S+5&&E>S-5&&Math.abs(_)<1.1&&(Ht.getState().flags.trainCrossingStopped||r("trainCrossingStopped",!0),Ht.getState().message!=="Stopped. Proceed when safe."&&n("Stopped. Proceed when safe.")),E<-20&&!Ht.getState().flags.trainCrossingStopped){t("FAILED: You did not stop at the tracks!"),a.current=!0,s(!0);return}if(E<-30||x<-10||x>10){t("FAILED: You drove off the road!"),a.current=!0,s(!0);return}if(E<-25&&Ht.getState().flags.trainCrossingStopped){e(),a.current=!0,s(!0);return}}),O.jsxs("group",{children:[O.jsxs("mesh",{position:c,receiveShadow:!0,children:[O.jsx("boxGeometry",{args:[100,1,100]}),O.jsx("meshStandardMaterial",{color:"#558b2f"})]}),O.jsx(en,{position:[0,0,-10],length:20}),"       ",O.jsx(en,{position:[0,0,-30],length:20}),"     ",O.jsxs("group",{position:[0,.05,-20],children:[" ",Array.from({length:20}).map((f,m)=>O.jsxs("mesh",{position:[-20+m*2,0,0],rotation:[0,Math.PI/2,0],children:[O.jsx("boxGeometry",{args:[.2,.1,3]}),O.jsx("meshStandardMaterial",{color:"#614B3A"})]},m)),O.jsxs("mesh",{position:[0,.1,-1],children:[O.jsx("boxGeometry",{args:[40,.1,.1]}),O.jsx("meshStandardMaterial",{color:"#A9A9A9"})]}),O.jsxs("mesh",{position:[0,.1,1],children:[O.jsx("boxGeometry",{args:[40,.1,.1]}),O.jsx("meshStandardMaterial",{color:"#A9A9A9"})]})]}),O.jsx(jr,{position:[-2.5,1,5]})," "]})},Mz=()=>{const{setMessage:n,passLevel:e,failLevel:t}=Ht(),r=se.useRef(!1),[i,s]=se.useState(!1),a=se.useRef(!1),o=se.useRef(null),u=se.useRef(null),c=se.useRef(`grass_${Math.random().toFixed(5)}`),f=new X(100,1,100),m=new X(0,-.6,-10);return se.useEffect(()=>{n("Scenario: T-Intersection (Left Turn, Oncoming). Prepare to turn left. Give way to oncoming traffic.")},[n]),se.useEffect(()=>{const g={id:c.current,position:m,quaternion:new xn,size:f,type:"grass",onCollide:y=>{y.type==="playerCar"&&t("You drove off the road!")}};return Yt.registerObject(g),()=>{Yt.unregisterObject(c.current)}},[t]),oi(()=>{if(i||a.current)return;const g=Ht.getState().telemetry;if(!g||!g.position)return;const{position:y,indicators:_}=g,E=y.z,x=y.x;let S=100,T=!1;if(o.current){const L=o.current.position.x,D=o.current.position.z;S=Math.sqrt(Math.pow(x-L,2)+Math.pow(E-D,2)),L<10&&L>-10&&(T=!0)}let A=100,P=!1;if(u.current){const L=u.current.position.x,D=u.current.position.z;A=Math.sqrt(Math.pow(x-L,2)+Math.pow(E-D,2)),L<10&&L>-10&&(P=!0)}if(E>-8&&_.left&&(r.current=!0),E<-8){if(!r.current){t("You did not indicate left!"),a.current=!0,s(!0);return}if(T&&S<15){t("You turned left in front of oncoming traffic!"),a.current=!0,s(!0);return}if(P&&A<5){t("You hit cross-traffic!"),a.current=!0,s(!0);return}}if(x<-15&&E<-5){if(T&&S<20){t("You cleared the intersection too close to oncoming traffic!"),a.current=!0,s(!0);return}if(P&&A<10){t("You cleared the intersection too close to cross traffic!"),a.current=!0,s(!0);return}e(),a.current=!0,s(!0)}E<-30&&x<5&&x>-5&&(t("You went straight! You were supposed to turn left."),a.current=!0,s(!0)),x>15&&E<-5&&(t("You turned right! You were supposed to turn left."),a.current=!0,s(!0)),(E<-30||x<-20||x>20)&&(t("You drove off the road!"),a.current=!0,s(!0))}),O.jsxs("group",{children:[O.jsxs("mesh",{position:m,receiveShadow:!0,children:[O.jsx("boxGeometry",{args:[100,1,100]}),O.jsx("meshStandardMaterial",{color:"#558b2f"})]}),O.jsx(en,{position:[-10,0,-10],rotation:[0,Math.PI/2,0],length:10}),O.jsx(en,{position:[10,0,-10],rotation:[0,Math.PI/2,0],length:10}),O.jsx(Nu,{position:[0,0,-10]}),O.jsx(en,{position:[0,0,0],length:10}),O.jsx(en,{position:[0,0,10],length:10}),O.jsx(Du,{position:[-5.5,0,-1],rotation:[0,0,0]}),O.jsx(Go,{ref:o,startPos:[20,.2,-7.5],endPos:[-20,.2,-7.5],speed:10,delay:0,color:"orange",rotation:[0,Math.PI/2,0]}),O.jsx(Go,{ref:u,startPos:[-20,.2,-12.5],endPos:[20,.2,-12.5],speed:10,delay:0,color:"red",rotation:[0,3*Math.PI/2,0]}),O.jsx(jr,{position:[-2.5,1,9]})]})},wz=Uo.memo(se.forwardRef(({startPos:n,endPos:e,speed:t=4,delay:r=0,color:i="#0000FF"},s)=>{const a=se.useRef(null);se.useImperativeHandle(s,()=>a.current);const o=se.useMemo(()=>new X,[]),{start:u,end:c,totalDistance:f}=se.useMemo(()=>{const y=new X(...n),_=new X(...e),E=y.distanceTo(_);return{start:y,end:_,totalDistance:E}},[n[0],n[1],n[2],e[0],e[1],e[2]]),m=se.useRef(`cyclist_${Math.random().toFixed(5)}`),g=new X(.5,1.5,1.5);return se.useEffect(()=>{if(!a.current)return;const y={id:m.current,position:a.current.position,quaternion:new xn,size:g,type:"cyclist",onCollide:_=>{}};return Yt.registerObject(y),()=>{Yt.unregisterObject(m.current)}},[]),oi(y=>{if(!a.current||f===0)return;const _=y.clock.getElapsedTime();if(_<r){a.current.position.copy(u);return}const x=(_-r)*t%f/f;o.lerpVectors(u,c,x),a.current.position.copy(o);const S=Yt.getObject(m.current);S&&S.position.copy(a.current.position)}),O.jsxs("group",{ref:a,position:n,userData:{type:"cyclist"},children:[O.jsxs("mesh",{position:[0,1,0],children:[O.jsx("boxGeometry",{args:[.3,1.2,.5]}),O.jsx("meshStandardMaterial",{color:i})]}),O.jsxs("mesh",{position:[0,.5,0],children:[O.jsx("boxGeometry",{args:[.1,.5,1.5]}),O.jsx("meshStandardMaterial",{color:i})]}),O.jsxs("mesh",{position:[0,.5,.75],children:[O.jsx("cylinderGeometry",{args:[.3,.3,.1,16]}),O.jsx("meshStandardMaterial",{color:"black"})]}),O.jsxs("mesh",{position:[0,.5,-.75],children:[O.jsx("cylinderGeometry",{args:[.3,.3,.1,16]}),O.jsx("meshStandardMaterial",{color:"black"})]})]})})),Ez=()=>{const n=Ht(f=>f.setMessage),e=Ht(f=>f.passLevel),t=Ht(f=>f.failLevel),[r,i]=se.useState(!1),s=se.useRef(!1),a=se.useRef(null),o=se.useRef(`grass_${Math.random().toFixed(5)}`),u=new X(100,1,200),c=new X(0,-.6,-50);return se.useEffect(()=>{n("Scenario: Cyclist Ahead. Overtake safely (leave 1.5m gap).")},[n]),se.useEffect(()=>{const f={id:o.current,position:c,quaternion:new xn,size:u,type:"grass",onCollide:m=>{m.type==="playerCar"&&t("You drove off the road!")}};return Yt.registerObject(f),()=>{Yt.unregisterObject(o.current)}},[t]),oi(()=>{if(r||s.current)return;const{position:f}=Ht.getState().telemetry,m=f.z,g=f.x;let y=-30;if(a.current&&(y=a.current.position.z),m<-20&&m>-70&&a.current&&Math.abs(m-y)<5&&g<.5){t("You passed too close to the cyclist! Maintain safe distance."),s.current=!0,i(!0);return}m<-80&&y>-90&&(e(),s.current=!0,i(!0)),(g<-5.5||g>5.5)&&(t("You drove off the road!"),s.current=!0,i(!0))}),O.jsxs("group",{children:[O.jsxs("mesh",{position:[0,-.6,-50],receiveShadow:!0,children:[O.jsx("boxGeometry",{args:[100,1,200]}),O.jsx("meshStandardMaterial",{color:"#558b2f"})]}),O.jsx(en,{position:[0,0,0],length:10}),O.jsx(en,{position:[0,0,-10],length:10}),O.jsx(en,{position:[0,0,-20],length:10}),O.jsx(en,{position:[0,0,-30],length:10}),O.jsx(en,{position:[0,0,-40],length:10}),O.jsx(en,{position:[0,0,-50],length:10}),O.jsx(en,{position:[0,0,-60],length:10}),O.jsx(en,{position:[0,0,-70],length:10}),O.jsx(en,{position:[0,0,-80],length:10}),O.jsx(en,{position:[0,0,-90],length:10}),O.jsx(en,{position:[0,0,-100],length:10}),O.jsx(wz,{ref:a,startPos:[-3.5,.2,-10],endPos:[-3.5,.2,-90],speed:3,delay:0}),O.jsx(jr,{position:[-2.5,1,0]})]})},Tz=()=>{const{setMessage:n,failLevel:e,passLevel:t}=Ht(),[r,i]=se.useState(!1),s=se.useRef(!1),[a,o]=se.useState(!1),u=se.useRef(!1),c=se.useRef(null),[f,m]=se.useState(!1),g=se.useRef(`grass_${Math.random().toFixed(5)}`),y=new X(50,1,100),_=new X(0,-.6,-20),E=2,x=4,S=6,T=-20,A=new X(0,.2,T+x/2+S/2),P=new X(0,.2,T-x/2-S/2);return se.useEffect(()=>{n("Scenario: Pedestrian Crossing (Island). Stop until pedestrian reaches the island, then proceed.")},[n]),se.useEffect(()=>{const L={id:g.current,position:_,quaternion:new xn,size:y,type:"grass",onCollide:k=>{k.type==="playerCar"&&e("You drove off the road!")}};Yt.registerObject(L);const D={id:`trafficIslandFront_${Math.random().toFixed(5)}`,position:A,quaternion:new xn,size:new X(E,1,x),type:"roadBoundary",onCollide:k=>{k.type==="playerCar"&&e("You drove onto the traffic island!")}};Yt.registerObject(D);const F={id:`trafficIslandBack_${Math.random().toFixed(5)}`,position:P,quaternion:new xn,size:new X(E,1,x),type:"roadBoundary",onCollide:k=>{k.type==="playerCar"&&e("You drove onto the traffic island!")}};return Yt.registerObject(F),()=>{Yt.unregisterObject(g.current),Yt.unregisterObject(D.id),Yt.unregisterObject(F.id)}},[e,A,P,E,x]),oi(()=>{if(r||s.current)return;const L=Ht.getState().telemetry;if(!L||!L.position)return;const{position:D}=L,k=L.speed,R=-20,U=-5,V=0;let H=0;c.current&&(H=c.current.position.x),!f&&D.z<5&&D.z>-15&&(m(!0),n("Pedestrian ahead! Stop before the crossing."));const J=D.z<U+5&&D.z>U-5;if(f&&!a&&J&&k<1.5&&(o(!0),n("STOP DETECTED!")),c.current&&!u.current&&H>=V&&(u.current=!0,n("Pedestrian on island. Proceed when safe for you.")),f&&!a&&D.z<U-2){e("You did not stop for the pedestrian!"),s.current=!0,i(!0);return}if(D.z<R-10){if(f){if(!a){e("You did not stop for the pedestrian!"),s.current=!0,i(!0);return}if(!u.current){e("You drove before the pedestrian reached the safety of the island!"),s.current=!0,i(!0);return}}t(),i(!0)}}),O.jsxs("group",{children:[O.jsxs("mesh",{position:_,receiveShadow:!0,children:[O.jsx("boxGeometry",{args:[50,1,100]}),O.jsx("meshStandardMaterial",{color:"#81c784"})]}),O.jsx(en,{position:[0,0,0],length:20}),O.jsx(en,{position:[0,0,-20],length:20}),O.jsx(en,{position:[0,0,-40],length:20}),O.jsxs("mesh",{position:A,castShadow:!0,children:[O.jsx("boxGeometry",{args:[E,.5,x]}),O.jsx("meshStandardMaterial",{color:"gray"})]}),O.jsxs("mesh",{position:P,castShadow:!0,children:[O.jsx("boxGeometry",{args:[E,.5,x]}),O.jsx("meshStandardMaterial",{color:"gray"})]}),Uo.createElement(GT,{ref:c,startPos:[-6,.2,T],endPos:[0,.2,T],speed:1.5,active:f}),Array.from({length:10}).map((L,D)=>O.jsxs("mesh",{position:[-4.5+D,.02,T],rotation:[-Math.PI/2,0,0],children:[O.jsx("planeGeometry",{args:[.6,4]}),O.jsx("meshStandardMaterial",{color:"white"})]},D)),O.jsx(jr,{position:[-2.5,1,10]})]})};function bz(){const{currentScenario:n,currentLevelIndex:e,retryCount:t}=Ht(),r=`${n}-${e}-${t}`;return oi((i,s)=>{Yt.update(s)}),O.jsxs(O.Fragment,{children:[O.jsx("ambientLight",{intensity:.5}),O.jsx("directionalLight",{position:[10,20,10],intensity:1,castShadow:!0}),O.jsx(IU,{preset:"city"}),O.jsxs("group",{children:[n==="cyclist-hazard"&&O.jsx(Ez,{}),n==="giveway"&&O.jsx(mz,{}),n==="t-intersection"&&O.jsx(UU,{}),n==="roundabout"&&O.jsx(OU,{}),n==="stop-sign"&&O.jsx(cz,{}),n==="pedestrian"&&O.jsx(hz,{}),n==="pedestrian-island"&&O.jsx(Tz,{})," ",n==="parking"&&O.jsx(fz,{}),n==="wellington"&&O.jsx(uz,{}),n==="t-intersection-right"&&O.jsx(pz,{}),n==="t-intersection-give-way"&&O.jsx(gz,{}),n==="stop-sign-cross-traffic"&&O.jsx(vz,{}),n==="giveway-merge-traffic"&&O.jsx(yz,{}),n==="giveway-right-to-left"&&O.jsx(_z,{}),n==="four-way-give-way"&&O.jsx(xz,{}),n==="train-crossing"&&O.jsx(Sz,{}),n==="t-intersection-left-oncoming"&&O.jsx(Mz,{})," "]},r)]})}function Az(){return O.jsxs(O.Fragment,{children:[O.jsx(dz,{}),O.jsx(JN,{children:O.jsx(bz,{})})]})}xb.createRoot(document.getElementById("root")).render(O.jsx(se.StrictMode,{children:O.jsx(Az,{})}));
